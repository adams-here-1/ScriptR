(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){const PIXI=require("pixi.js");const view_port=require("pixi-viewport");exports.view_port=view_port;const colyseusjs=require("colyseus.js");const doc=require("./document/document.js");const level=require("./game/level.js");const gun_drop=require("./entities/gundrop.js");const player=require("./entities/player.js");const bullet=require("./entities/bullet.js");const announcement=require("./document/announcement.js");const objective=require("./entities/objective.js");const bloodsplatter=require("./entities/bloodsplatter.js");const skins=require("./game/skins.js");const sounds=require("./game/sounds.js");const view=require("./game/view.js");const client=new colyseusjs.Client(`ws://${window.location.host}`);var room;exports.room=room;var client_players={},client_players_idList=[],client_bullets={},client_bullets_idList=[],blood_splatters=[],lastUpdate=Date.now(),movingMouse=false;var game={duration:0,currentDuration:0,prepDuration:0,started:false,over:false,spectating:false,spectatingPlayerId:0};var obj={duration:4};var app=new PIXI.Application(window.innerWidth,window.innerHeight,{view:doc.game_canvas,backgroundColor:3964928,antialias:true});exports.app=app;var viewport=new view_port({screenWidth:document.getElementById("game-wrapper").clientWidth,screenHeight:document.getElementById("game-wrapper").clientHeight,interaction:app.renderer.interaction,worldWidth:3e3,worldHeight:3e3,defaultWidth:1920,defaultHeight:1080});exports.viewport=viewport;app.stage.addChild(viewport);var floorContainer=new PIXI.Container,levelContainer=new PIXI.Container,bloodContainer=new PIXI.Container,gunDropContainer=new PIXI.Container,bulletContainer=new PIXI.Container,playerContainer=new PIXI.Container,carpetContainer=new PIXI.Container;playerContainer.sortableContainer=true;levelContainer.sortableContainer=true;exports.floorContainer=floorContainer;exports.levelContainer=levelContainer;exports.bloodContainer=bloodContainer;exports.gunDropContainer=gunDropContainer;exports.bulletContainer=bulletContainer;exports.playerContainer=playerContainer;exports.carpetContainer=carpetContainer;viewport.addChild(floorContainer);viewport.addChild(carpetContainer);viewport.addChild(levelContainer);viewport.addChild(bloodContainer);viewport.addChild(gunDropContainer);viewport.addChild(bulletContainer);viewport.addChild(playerContainer);var game_level,gunDrop=new gun_drop.GunDrop,objective_drops=[],spectateTimeout={},radioPartPickupSound={};var defaultPlayerData={dataType:"player-data",movingUp:false,movingDown:false,movingLeft:false,movingRight:false,angle:0,sprinting:false,attacking:false,dancing:false,weaponType:0,switchingWeapons:false};var playerData=defaultPlayerData;exports.playerData=playerData;function gameJoin(){room=client.join("play",skins.skinNumber);playerData=Object.assign({},defaultPlayerData);exports.playerData=playerData;document.getElementById("menu-wrapper").style.display="none";document.getElementById("game-wrapper").style.display="block";document.getElementById("game-hud-spectate-wrapper").style.display="none";game.spectating=false;document.getElementById("game-hud-role-wrapper").innerHTML="Innocent";doc.stopGameTimer();gunDrop.clear();doc.changeZoom(viewport.worldScreenWidth,viewport.worldScreenHeight);doc.togglePauseMenu(false);game.over=false;room.onMessage.add(async function(message){switch(message.dataType){case"game-win":game.over=true;playerData.attacking=false;announcement.deleteAnnouncement();document.getElementById("game-death-overlay-wrapper").style.display="block";document.getElementById("game-death-overlay-wrapper").style.opacity="100";document.getElementById("game-hud-wrapper").style.opacity="0";document.getElementById("game-spectate-button").style.display="none";gunDrop.clear();switch(message.winType){case 0:document.getElementById("game-death-overlay-header").innerHTML="Innocents win!";document.getElementById("game-death-overlay-subheader").innerHTML="The murderer did not kill all innocents in time...";break;case 1:document.getElementById("game-death-overlay-header").innerHTML="Innocents win!";document.getElementById("game-death-overlay-subheader").innerHTML="The detective has killed the murderer!";break;case 2:document.getElementById("game-death-overlay-header").innerHTML="Murderer wins!";document.getElementById("game-death-overlay-subheader").innerHTML="The murderer has killed all innocents!";break;case 3:document.getElementById("game-death-overlay-header").innerHTML="Innocents win!";document.getElementById("game-death-overlay-subheader").innerHTML="Murderer has left the game... :(";break;case 4:document.getElementById("game-death-overlay-header").innerHTML="Innocents win!";document.getElementById("game-death-overlay-subheader").innerHTML="The police have arrived!";break}break;case"game-objective-pickup":objective_drops[message.id].clear();objective_drops.splice(message.id,1);break;case"game-objective-walkover":doc.startGameTimer(obj.duration);radioPartPickupSound=sounds.playSound("radiopart_pickup_01",{x:client_players[room.sessionId].x-viewport.center.x,y:client_players[room.sessionId].y-viewport.center.y});break;case"game-objective-stop":doc.stopGameTimer();sounds.sounds["radiopart_pickup_01"].sound.fade(1,0,250,radioPartPickupSound);break;case"game-role-assign":client_players[room.sessionId].role=message.role;client_players[room.sessionId].weapon_type=0;switch(message.role){case 0:document.getElementById("game-hud-role-wrapper").innerHTML="Innocent";break;case 1:document.getElementById("game-hud-role-wrapper").innerHTML="Detective";break;case 2:document.getElementById("game-hud-role-wrapper").innerHTML="Murderer";break}break;case"game-level-assign":if(!level.loadedMap[message.id]){game_level=new level.Level(message.id,message.objects);level.loadedMap=true}break;case"player-add":client_players_idList.push(message.id);client_players[message.id]=new player.Player(message.skin_options);document.getElementById("game-hud-player-count-digit").innerHTML=client_players_idList.length;document.getElementById("game-hud-player-count-subtitle").innerHTML=client_players_idList.length==1?"Player":"Players";break;case"player-remove":removePlayer(message.id);document.getElementById("game-hud-player-count-digit").innerHTML=client_players_idList.length;document.getElementById("game-hud-player-count-subtitle").innerHTML=client_players_idList.length==1?"Player":"Players";break;case"player-death":blood_splatters.push(new bloodsplatter.BloodSplatter(message.x,message.y));sounds.playSound("knife_kill_01",{x:message.x-viewport.center.x,y:message.y-viewport.center.y});break;case"player-update":let id=message.id;if(message.dead){removePlayer(id)}else{client_players[id].x=message.x;client_players[id].y=message.y;client_players[id].rotation_body=message.angle;if(message.weaponType!==client_players[id].weapon_type){client_players[id].weapon_type=message.weaponType;if(id==room.sessionId||game.spectating&&client_players_idList[game.spectatingPlayerId]==id){updateWeaponHUD()}}client_players[id].attacking=message.attacking;client_players[id].walkType=message.walkType;client_players[id].soundType=message.soundType;if(message.dancing){client_players[id].dance()}if(client_players[id].stamina!=message.stamina&&room.sessionId==id||game.spectating&&client_players_idList[game.spectatingPlayerId]==id){client_players[id].stamina=message.stamina;if(message.stamina<=74){document.getElementById("game-hud-stamina-75-part-wrapper").style.width=message.stamina*100/74+"%";document.getElementById("game-hud-stamina-25-part-wrapper").style.width="0%"}else if(message.stamina>=76){document.getElementById("game-hud-stamina-75-part-wrapper").style.width="100%";document.getElementById("game-hud-stamina-25-part-wrapper").style.width=(message.stamina-76)/.24+"%"}if(message.stamina==100){document.getElementById("game-hud-stamina-wrapper").style.opacity=0}else{document.getElementById("game-hud-stamina-wrapper").style.opacity=1}}if(id==room.sessionId||game.spectating&&client_players_idList[game.spectatingPlayerId]==id){if(message.canSprint){document.getElementById("game-hud-stamina-75-part-wrapper").style.backgroundImage="linear-gradient(to right, rgba(255, 144, 46, 0.9), rgba(255, 163, 83, 0.9))";document.getElementById("game-hud-stamina-25-part-wrapper").style.backgroundImage="linear-gradient(to right, rgba(255, 163, 83, 0.9), rgba(255, 179, 112, 0.9))"}else{document.getElementById("game-hud-stamina-75-part-wrapper").style.backgroundImage="linear-gradient(to right, rgba(180, 180, 180, 0.5), rgba(200, 200, 200, 0.5))";document.getElementById("game-hud-stamina-25-part-wrapper").style.backgroundImage="linear-gradient(to right, rgba(200, 200, 200, 0.5), rgba(210, 210, 210, 0.5))"}}}break}});room.listen("bullets/:id",change=>{if(change.operation==="add"){client_bullets[change.path.id]=new bullet.Bullet(change.value.x,change.value.y,change.value.angle);client_bullets_idList.push(change.path.id)}else if(change.operation==="remove"){client_bullets[change.path.id].clearAnimation();delete client_bullets[change.path.id]}});room.listen("bullets/:id/:attributes",change=>{switch(change.path.attributes){case"x":client_bullets[change.path.id].x=change.value;break;case"y":client_bullets[change.path.id].y=change.value;break}});room.listen("game/:id",change=>{switch(change.path.id){case"duration":game.duration=change.value;break;case"prepDuration":game.prepDuration=change.value;break;case"currentDuration":game.currentDuration=change.value;if(change.value==0&&!game.started){document.getElementById("game-hud-time-wrapper").style.display="none";document.getElementById("game-hud-weapon-wrapper").style.bottom="0"}else if(change.value!=0&&document.getElementById("game-hud-time-wrapper").style.display=="none"){document.getElementById("game-hud-time-wrapper").style.display="table-cell";document.getElementById("game-hud-time-wrapper").style.borderTopLeftRadius="0";document.getElementById("game-hud-weapon-wrapper").style.bottom="1.175em"}if(game.started){let time=game.duration-game.currentDuration;document.getElementById("game-hud-time-wrapper").innerHTML=Math.trunc(time%600/60)+":"+("0"+time%60).slice(-2);if(time%60==0&&time!=game.duration){announcement.makeAnnouncement("Game ending in <em>"+time/60+" minute"+(time/60==1?"":"s")+"</em>!",time==60?"Roles have been revealed!":"")}else if(time<=30&&time>0&&time%15==0)announcement.makeAnnouncement("Game ending in <em>"+time+" seconds</em>!")}else{let time=game.prepDuration-game.currentDuration;document.getElementById("game-hud-time-wrapper").innerHTML=Math.trunc(time%600/60)+":"+("0"+time%60).slice(-2)}break;case"started":game.started=change.value;if(game.started){let role=client_players[room.sessionId].role;announcement.makeAnnouncement("Game has started! You are "+(role==0?"<em>innocent</em>!":role==1?"a <em>detective</em>!":"a <em>murderer</em>!"),role==0?"Survive as long as you can!":role==1?"Find and kill the murderer!":"Kill everything!");doc.toggleRoleHUD(true);updateWeaponHUD()}else{document.getElementById("game-hud-time-wrapper").style.display="none";document.getElementById("game-hud-time-wrapper").style.borderTopLeftRadius="1vw";document.getElementById("game-hud-weapon-wrapper").style.bottom="0";doc.toggleRoleHUD(false)}break;case"prepStarted":if(change.value){announcement.makeAnnouncement("Game starting in <em>"+(game.prepDuration-game.currentDuration)+" seconds</em>!")}else announcement.makeAnnouncement("Waiting for players...","",999999999);break}});room.listen("gun_drop/:id",change=>{switch(change.path.id){case"x":gunDrop.x=change.value;break;case"y":gunDrop.y=change.value;break;case"radius":gunDrop.radius=change.value;break;case"active":if(change.operation=="replace"){if(change.value){gunDrop.draw(gunDrop.x,gunDrop.y);announcement.makeAnnouncement("<em>The detective has been killed!</em>","Pick up their gun to kill the murderer!")}else{gunDrop.clear();announcement.makeAnnouncement("<em>The detective's gun has been picked up!</em>","There's a new detective in town!")}}break}});room.listen("objective/:id",change=>{switch(change.path.id){case"active":if(change.value){document.getElementById("game-hud-objective-wrapper").style.opacity="1"}else{document.getElementById("game-hud-objective-wrapper").style.opacity="0"}break;case"progress":document.getElementById("game-hud-objective-1-part-wrapper").style.width="0%";document.getElementById("game-hud-objective-2-part-wrapper").style.width="0%";document.getElementById("game-hud-objective-3-part-wrapper").style.width="0%";document.getElementById("game-hud-objective-4-part-wrapper").style.width="0%";document.getElementById("game-hud-objective-5-part-wrapper").style.width="0%";switch(change.value){case 0:break;case 1:document.getElementById("game-hud-objective-1-part-wrapper").style.width="100%";announcement.makeAnnouncement("<em>The first radio part was found!<em>");break;case 2:document.getElementById("game-hud-objective-1-part-wrapper").style.width="100%";document.getElementById("game-hud-objective-2-part-wrapper").style.width="100%";announcement.makeAnnouncement("<em>The second radio part was found!<em>");break;case 3:document.getElementById("game-hud-objective-1-part-wrapper").style.width="100%";document.getElementById("game-hud-objective-2-part-wrapper").style.width="100%";document.getElementById("game-hud-objective-3-part-wrapper").style.width="100%";announcement.makeAnnouncement("<em>The third radio part was found!<em>");break;case 4:document.getElementById("game-hud-objective-1-part-wrapper").style.width="100%";document.getElementById("game-hud-objective-2-part-wrapper").style.width="100%";document.getElementById("game-hud-objective-3-part-wrapper").style.width="100%";document.getElementById("game-hud-objective-4-part-wrapper").style.width="100%";announcement.makeAnnouncement("<em>The fourth radio part was found!<em>");break;case 5:document.getElementById("game-hud-objective-1-part-wrapper").style.width="100%";document.getElementById("game-hud-objective-2-part-wrapper").style.width="100%";document.getElementById("game-hud-objective-3-part-wrapper").style.width="100%";document.getElementById("game-hud-objective-4-part-wrapper").style.width="100%";document.getElementById("game-hud-objective-5-part-wrapper").style.width="100%";break}break;case"complete":if(change.value){if(game.currentDuration<60)announcement.makeAnnouncement("<em>The cops have been called!<em>");else announcement.makeAnnouncement("<em>The cops have been called!<em> Game ends in <em>one minute<em>!","Roles have been revealed!")}break;case"pickUpDuration":obj.duration=change.value;break}});room.listen("objective_drops/:id",change=>{if(change.operation==="add"){objective_drops.push(new objective.ObjectiveDrop(change.value.x,change.value.y))}});interval=setInterval(function(){let now=Date.now();let dt=now-lastUpdate;let temporaryDeltaTimer=now;lastUpdate=now;if(game_level&&game_level.update!=null){game_level.update()}for(var i=0;i<client_players_idList.length;){if(client_players[client_players_idList[i]]==null){client_players_idList.splice(i,1)}else{if(client_players[client_players_idList[i]].attacking){client_players[client_players_idList[i]].attack()}client_players[client_players_idList[i]].animate(dt);i++}}for(var i=0;i<client_bullets_idList.length;){if(client_bullets[client_bullets_idList[i]]==null){client_bullets_idList.splice(i,1)}else{client_bullets[client_bullets_idList[i]].animate();i++}}for(var i=0;i<blood_splatters.length;){if(blood_splatters[i].deleted){blood_splatters.splice(i,1)}else{blood_splatters[i].update();i++}}if(client_players[room.sessionId]!=null){if(movingMouse){let mousePos={x:app.renderer.plugins.interaction.mouse.global.x+client_players[room.sessionId].x-window.innerWidth/2,y:app.renderer.plugins.interaction.mouse.global.y+client_players[room.sessionId].y-window.innerHeight/2};playerData.angle=Math.atan2(client_players[room.sessionId].y-mousePos.y,client_players[room.sessionId].x-mousePos.x)}else{if(client_players[room.sessionId].key_turningLeft){playerData.angle-=.11}if(client_players[room.sessionId].key_turningRight){playerData.angle+=.11}}viewport.moveCenter(client_players[room.sessionId].x,client_players[room.sessionId].y);if(!client_players[room.sessionId].dead&&!game.over){room.send(playerData);playerData.switchingWeapons=false}}if(game.spectating){viewport.moveCenter(client_players[client_players_idList[game.spectatingPlayerId]].x,client_players[client_players_idList[game.spectatingPlayerId]].y)}if(viewport.dirty){view.cull.cull({x:viewport.center.x-viewport.worldScreenWidth*.8,y:viewport.center.y-viewport.worldScreenHeight,width:viewport.worldScreenWidth*1.6,height:viewport.worldScreenHeight*2});viewport.dirty=false}},1e3/60);updateWeaponHUD(true)}function gameLeave(){document.getElementById("menu-wrapper").style.display="block";document.getElementById("game-wrapper").style.display="none";document.getElementById("game-death-overlay-wrapper").style.display="none";document.getElementById("game-death-overlay-wrapper").style.opacity="0";document.getElementById("game-hud-wrapper").style.opacity="100";for(var i=0;i<client_players_idList.length;i++){client_players[client_players_idList[i]].clearAnimation()}for(var i=0;i<client_bullets_idList.length;i++){client_bullets[client_bullets_idList[i]].clearAnimation()}for(var i=0;i<objective_drops.length;i++){objective_drops[i].clear()}for(var i=0;i<blood_splatters.length;i++){blood_splatters[i].clear()}client_players.length=0;client_players_idList.length=0;client_bullets.length=0;client_bullets_idList.length=0;objective_drops.length=0;blood_splatters.length=0;game_level.clearLevel();gunDrop.clear();clearInterval(interval);clearTimeout(spectateTimeout);room.leave()}function removePlayer(id){if(client_players[id]!=null){client_players[id].clearAnimation()}delete client_players[id];for(var i=0;i<client_players_idList.length;i++){if(client_players_idList[i]==id){if(game.spectatingPlayerId==i&&i==client_players_idList.length-1){if(i==0){game.spectating=false}else{game.spectatingPlayerId--}}client_players_idList.splice(i,1);break}}if(id==room.sessionId&&!game.over){document.getElementById("game-death-overlay-wrapper").style.display="block";document.getElementById("game-death-overlay-wrapper").style.opacity="1";document.getElementById("game-hud-wrapper").style.opacity="0";document.getElementById("game-death-overlay-header").innerHTML="You died!";document.getElementById("game-death-overlay-subheader").innerHTML="Rest in peace...";document.getElementById("game-spectate-button").style.display="table-cell";spectateTimeout=setTimeout(()=>{if(client_players_idList.length>0){game.spectating=true;game.spectatingPlayerId=Math.floor(Math.random()*client_players_idList.length)}},5e3)}else if(game.over){document.getElementById("game-spectate-button").style.display="none"}document.getElementById("game-hud-player-count-digit").innerHTML=client_players_idList.length;document.getElementById("game-hud-player-count-subtitle").innerHTML=client_players_idList.length==1?"Player":"Players"}doc.documentSetup();document.getElementById("menu-play-button").addEventListener("click",gameJoin);document.getElementById("game-restart-button").addEventListener("click",()=>{gameLeave();gameJoin()});document.getElementById("game-quit-button").addEventListener("click",gameLeave);document.getElementById("game-pause-menu-quit-button").addEventListener("click",gameLeave);document.getElementById("game-pause-menu-resume-button").addEventListener("click",()=>{doc.togglePauseMenu(false)});document.getElementById("game-spectate-button").addEventListener("click",()=>{if(client_players_idList.length>0&&!game.over){game.spectating=true;game.spectatingPlayerId=Math.floor(Math.random()*client_players_idList.length);if(spectateTimeout!==null)clearTimeout(spectateTimeout);document.getElementById("game-hud-spectate-wrapper").style.display="block";document.getElementById("game-hud-wrapper").style.opacity="1";document.getElementById("game-death-overlay-wrapper").style.display="none";document.getElementById("game-death-overlay-wrapper").style.opacity="0";doc.toggleRoleHUD(false);updateWeaponHUD()}});document.getElementById("game-hud-spectate-next-button").addEventListener("click",()=>{if(game.spectating){game.spectatingPlayerId=game.spectatingPlayerId==client_players_idList.length-1?0:game.spectatingPlayerId+1;updateWeaponHUD()}});document.getElementById("game-hud-spectate-prev-button").addEventListener("click",()=>{if(game.spectating){game.spectatingPlayerId=game.spectatingPlayerId==0?client_players_idList.length-1:game.spectatingPlayerId-1;updateWeaponHUD()}});document.getElementById("game-hud-spectate-quit-button").addEventListener("click",gameLeave);document.addEventListener("keydown",function(event){switch(event.keyCode){case 65:case 37:playerData.movingLeft=true;break;case 87:case 38:playerData.movingUp=true;break;case 68:case 39:playerData.movingRight=true;break;case 83:case 40:playerData.movingDown=true;break;case 16:playerData.sprinting=true;break;case 32:playerData.attacking=true;break;case 49:case 50:case 81:switchWeapons();updateWeaponHUD();break;case 84:playerData.dancing=true;break;case 188:client_players[room.sessionId].key_turningLeft=true;movingMouse=false;break;case 190:client_players[room.sessionId].key_turningRight=true;movingMouse=false;break}});document.addEventListener("keyup",function(event){switch(event.keyCode){case 65:case 37:if(game.spectating&&!game.over&&document.getElementById("game-hud-spectate-wrapper").style.display=="block"){game.spectatingPlayerId=game.spectatingPlayerId==0?client_players_idList.length-1:game.spectatingPlayerId-1}else{playerData.movingLeft=false}break;case 87:case 38:playerData.movingUp=false;break;case 68:case 39:if(game.spectating&&!game.over&&document.getElementById("game-hud-spectate-wrapper").style.display=="block"){game.spectatingPlayerId=game.spectatingPlayerId==client_players_idList.length-1?0:game.spectatingPlayerId+1}else{playerData.movingRight=false}break;case 83:case 40:playerData.movingDown=false;break;case 16:playerData.sprinting=false;break;case 32:playerData.attacking=false;break;case 27:doc.togglePauseMenu();break;case 84:playerData.dancing=false;break;case 188:client_players[room.sessionId].key_turningLeft=false;break;case 190:client_players[room.sessionId].key_turningRight=false;break}});document.addEventListener("mousewheel",switchWeapons,false);document.addEventListener("DOMMouseScroll",switchWeapons,false);document.body.onmousedown=function(e){if(e.which==1){playerData.attacking=true}else if(e.which==3){playerData.sprinting=true}};document.body.onmouseup=function(e){if(e.which==1){playerData.attacking=false}else if(e.which==3){playerData.sprinting=false}};document.body.onmousemove=function(e){movingMouse=true};document.body.addEventListener("contextmenu",function(e){if(document.getElementById("game-wrapper").style.display=="block"){e.preventDefault();return false}});function switchWeapons(){playerData.switchingWeapons=true}function updateWeaponHUD(init){if(init){document.getElementById("game-hud-weapon-wrapper").innerHTML="Fists";return}if(game.spectating){document.getElementById("game-hud-weapon-wrapper").innerHTML=client_players[client_players_idList[game.spectatingPlayerId]].weapon_type==0?"Fists":client_players[client_players_idList[game.spectatingPlayerId]].weapon_type==1?"Gun":"Knife"}else if(room!=null&&client_players[room.sessionId]!=null){document.getElementById("game-hud-weapon-wrapper").innerHTML=client_players[room.sessionId].weapon_type==0?"Fists":client_players[room.sessionId].weapon_type==1?"Gun":"Knife"}}},{"./document/announcement.js":2,"./document/document.js":3,"./entities/bloodsplatter.js":4,"./entities/bullet.js":5,"./entities/gundrop.js":7,"./entities/objective.js":8,"./entities/player.js":9,"./game/level.js":10,"./game/skins.js":11,"./game/sounds.js":12,"./game/view.js":13,"colyseus.js":34,"pixi-viewport":83,"pixi.js":200}],2:[function(require,module,exports){var announcementTimeout;exports.makeAnnouncement=((message1,message2,length)=>{if(document.getElementById("game-death-overlay-wrapper").style.display=="block")return;deleteAnnouncement();let aWrapper=document.getElementById("game-announcement-wrapper");let aText1=document.getElementById("game-announcement-1-text");let aText2=document.getElementById("game-announcement-2-text");aWrapper.style.opacity=1;aText1.innerHTML=message1;if(message2!==undefined)aText2.innerHTML=message2;announcementTimeout=setTimeout(()=>{aWrapper.style.opacity="0"},length?length:3e3)});var deleteAnnouncement=()=>{document.getElementById("game-announcement-wrapper").opacity=0;document.getElementById("game-announcement-1-text").innerHTML="";document.getElementById("game-announcement-2-text").innerHTML="";if(announcementTimeout!=null){clearTimeout(announcementTimeout)}};exports.deleteAnnouncement=deleteAnnouncement},{}],3:[function(require,module,exports){var game_canvas=document.getElementById("game-canvas");exports.game_canvas=game_canvas;var skins=require("../game/skins.js");var prevScreenDims={x:window.innerWidth,y:window.innerHeight};var gameTimerInterval,gameTimerTimeout,gameTimerIncrement,gameTimerLength,viewportZoomFactor=1,allowMouseLooking=true;var main_app=require("../app.js");var sounds=require("../game/sounds.js");var windowResize=function(){if(window.innerWidth<=950){document.getElementById("menu-notice-wrapper").style.display="none"}else{document.getElementById("menu-notice-wrapper").style.display="table"}if(window.innerWidth<=733){document.getElementById("menu-main-content-wrapper").style.width="calc(100vw - 0.4rem)";document.getElementById("menu-main-content-wrapper").style.left="0";document.getElementById("crim-io_300x250").style.display="none"}else{document.getElementById("menu-main-content-wrapper").style.width="45em";document.getElementById("menu-main-content-wrapper").style.left="calc(50% - 22.5em)";document.getElementById("crim-io_300x250").style.display="table"}if(window.innerWidth<=728){document.getElementById("crim-io_728x90").style.width="100vw";document.getElementById("crim-io_728x90").style.height=`calc(100vw * 90 / 728)`;document.getElementById("crim-io_728x90").style.right=`calc(50% - ${document.getElementById("crim-io_728x90").style.width} / 2 - 0.3rem)`}else{document.getElementById("crim-io_728x90").style.width="728px";document.getElementById("crim-io_728x90").style.height="90px";document.getElementById("crim-io_728x90").style.right=`calc(50% - 728px / 2 - 0.3rem)`}if(window.innerHeight<=888){document.getElementById("menu-main-content-wrapper").style.height="calc(34em - "+(888-window.innerHeight)+"px)";document.getElementById("crim-io_728x90").style.top="inherit";document.getElementById("crim-io_728x90").style.bottom=0;if(window.innerWidth<=728){document.getElementById("menu-main-content-wrapper").style.height="calc(34em + 90px - (90px / 728px))"}}else{document.getElementById("menu-main-content-wrapper").style.height="34em";document.getElementById("crim-io_728x90").style.top="calc(14.5rem + 34em + 1rem)";document.getElementById("crim-io_728x90").style.bottom="inherit"}if(window.innerHeight<=1e3){document.getElementById("menu-footer-wrapper").style.display="none";document.getElementById("menu-hamburger-icon").style.display="block"}else{document.getElementById("menu-footer-wrapper").style.display="block";document.getElementById("menu-hamburger-icon").style.display="none";if(document.getElementById("menu-settings-wrapper").style.left=="0rem"){document.getElementById("menu-hamburger-icon").classList.toggle("open");document.getElementById("menu-settings-wrapper").style.opacity="0";document.getElementById("menu-settings-wrapper").style.left="-20rem"}}changeZoom(main_app.viewport.worldScreenWidth,main_app.viewport.worldScreenHeight)};exports.documentSetup=(()=>{skins.skinSetup();sounds.loadSounds();document.getElementById("game-wrapper").style.display="none";document.getElementById("game-wrapper").appendChild(main_app.app.view);document.getElementById("menu-wrapper").style.display="block";document.getElementById("menu-header-info-wrapper").addEventListener("click",function(){menu_openPage("home")});document.getElementById("menu-header-store-wrapper").addEventListener("click",function(){menu_openPage("store")});document.getElementById("menu-header-tutorial-wrapper").addEventListener("click",function(){menu_openPage("tutorial")});let browserZoomLevel=window.devicePixelRatio/1.25;main_app.viewport.zoomPercent(1/browserZoomLevel-.85,true);windowResize();window.addEventListener("resize",function(event){main_app.app.renderer.resize(window.innerWidth,window.innerHeight);main_app.viewport.resize(window.innerWidth,window.innerHeight,main_app.viewport.worldWidth,main_app.viewport.worldHeight);let prevZoom=browserZoomLevel;browserZoomLevel=window.devicePixelRatio/1.25;zoomViewport(prevZoom/browserZoomLevel-1);windowResize()});window.addEventListener("blur",function(event){main_app.playerData.movingDown=main_app.playerData.movingUp=main_app.playerData.movingLeft=main_app.playerData.movingRight=main_app.playerData.sprinting=main_app.playerData.attacking=main_app.playerData.switchingWeapons=false});document.getElementById("menu-hamburger-icon").addEventListener("click",function(event){this.classList.toggle("open");if(document.getElementById("menu-settings-wrapper").style.opacity=="0"){document.getElementById("menu-settings-wrapper").style.opacity="1";document.getElementById("menu-settings-wrapper").style.left="0rem"}else{document.getElementById("menu-settings-wrapper").style.opacity="0";document.getElementById("menu-settings-wrapper").style.left="-20rem"}})});function menu_openPage(page){document.getElementById("menu-home-wrapper").style.opacity=document.getElementById("menu-tutorial-wrapper").style.opacity=document.getElementById("menu-store-wrapper").style.opacity=0;setTimeout(()=>{document.getElementById("menu-home-wrapper").style.display=document.getElementById("menu-tutorial-wrapper").style.display=document.getElementById("menu-store-wrapper").style.display="none";switch(page){case"home":document.getElementById("menu-home-wrapper").setAttribute("style","display:block; opacity:1;");break;case"store":document.getElementById("menu-store-wrapper").setAttribute("style","display:block; opacity:1;");break;case"tutorial":document.getElementById("menu-tutorial-wrapper").setAttribute("style","display:block; opacity:1;");break}},250)}function changeZoom(x,y){if(document.getElementById("game-wrapper").style.display=="none")return;let aspectRatio=x/y;let w=1920/1.4,h=1080/1.4;if(aspectRatio<=9/16){zoomViewport(x/w-1);zoomViewport(1);zoomViewport(y/(x*16/9)-1)}else if(aspectRatio<1&&aspectRatio>9/16){zoomViewport(1/8);zoomViewport(x/h-1)}else if(aspectRatio>1&&aspectRatio<=16/9){zoomViewport(x/w-1);zoomViewport(1/8);zoomViewport(y/(x*9/16)-1)}else if(aspectRatio>16/9){zoomViewport(x/w-1);zoomViewport(1/8)}}exports.changeZoom=changeZoom;function zoomViewport(percent){main_app.viewport.zoomPercent(percent,true);viewportZoomFactor*=percent+1}exports.zoomViewport=zoomViewport;function resetZoomViewport(){main_app.viewport.zoomPercent(1/viewportZoomFactor-1,true);viewportZoomFactor=1}exports.togglePauseMenu=function(displayed){let w=document.getElementById("game-pause-menu-wrapper");if(displayed!==undefined){if(displayed){w.style.opacity="1";w.style.display="block"}else{w.style.opacity=0;setTimeout(()=>{w.style.display="none"},300)}}else{if(w.style.display=="block"){w.style.opacity=0;setTimeout(()=>{w.style.display="none"},300)}else{w.style.display="none";w.style.opacity="1";w.style.display="block"}}};var lastGameTimerTime=Date.now();exports.startGameTimer=function(time){stopGameTimer();gameTimerIncrement=0;document.getElementById("game-hud-timer-wrapper").style.opacity=1;document.getElementById("game-hud-timer-progress-part-wrapper").style.transition="inherit";document.getElementById("game-hud-timer-progress-part-wrapper").style.width="0%";gameTimerLength=time*1e3;lastGameTimerTime=Date.now();gameTimerInterval=setInterval(()=>{let gameTimerTime=Date.now();let dt=gameTimerTime-lastGameTimerTime;lastGameTimerTime=gameTimerTime;let mult=dt/(1e3/60);gameTimerIncrement+=mult;document.getElementById("game-hud-timer-progress-part-wrapper").style.width=gameTimerIncrement/(time*60)*100+"%";let n=gameTimerLength-gameTimerIncrement*1e3/60;if(n<0)n=1;document.getElementById("game-hud-timer-progress-time-display").innerHTML=parseFloat(Math.round(n/10)/100).toFixed(1)+"s";if(gameTimerIncrement>=time*60){clearInterval(gameTimerInterval);gameTimerIncrement=0}},1e3/60);return new Promise(resolve=>{gameTimerTimeout=setTimeout(()=>{document.getElementById("game-hud-timer-wrapper").style.opacity=0;clearTimeout(gameTimerTimeout);if(gameTimerInterval!==null)clearInterval(gameTimerInterval);resolve()},time*1e3)})};var stopGameTimer=function(){if(gameTimerInterval!=null)clearInterval(gameTimerInterval);if(gameTimerTimeout!=null)clearTimeout(gameTimerTimeout);document.getElementById("game-hud-timer-wrapper").style.opacity=0;document.getElementById("game-hud-timer-progress-part-wrapper").style.transition="width 0.5s ease-in-out";document.getElementById("game-hud-timer-progress-part-wrapper").style.width="0%"};exports.stopGameTimer=stopGameTimer;exports.toggleSpectateHUD=function(){let w=document.getElementById("game-hud-spectate-wrapper").style.display;w=w=="block"?"none":"block"};exports.toggleRoleHUD=function(enable){if(enable){document.getElementById("game-hud-role-wrapper").style.height="1.2em";document.getElementById("game-hud-stamina-wrapper").style.bottom="4em"}else{document.getElementById("game-hud-role-wrapper").style.height="0em";document.getElementById("game-hud-stamina-wrapper").style.bottom="0.375em"}}},{"../app.js":1,"../game/skins.js":11,"../game/sounds.js":12}],4:[function(require,module,exports){var main_app=require("../app.js");var view=require("../game/view.js");exports.BloodSplatter=class{constructor(x,y){this.radius=32;this.sprite=new PIXI.Sprite.fromImage("static/blood_splatter.png");this.sprite.anchor.set(.5,.5);this.sprite.scale.x=this.sprite.scale.y=.04;this.sprite.alpha=1;this.deleted=false;main_app.bloodContainer.addChild(this.sprite);this.sprite.x=x;this.sprite.y=y}update(){this.sprite.alpha-=1/(60*40);if(this.sprite.alpha<=0){this.clear();this.deleted=true}}clear(){this.sprite.visible=false}}},{"../app.js":1,"../game/view.js":13}],5:[function(require,module,exports){var entity=require("./entity.js");var main_app=require("../app.js");var view=require("../game/view.js");exports.Bullet=class extends entity.Entity{constructor(x,y,rotation){super();this.sprite=new PIXI.Sprite.fromImage("./static/models/bullet.png");this.sprite.anchor.set(.5,.5);this.sprite.rotation=rotation;this.x=x;this.y=y;main_app.bulletContainer.addChild(this.sprite)}animate(){this.sprite.x=this.x;this.sprite.y=this.y}clearAnimation(){this.sprite.visible=false}}},{"../app.js":1,"../game/view.js":13,"./entity.js":6}],6:[function(require,module,exports){exports.Entity=class{constructor(spriteLocation){this.hasSprite=spriteLocation!==undefined;if(this.hasSprite){this.sprite=new PIXI.Sprite.fromImage(spriteLocation);this.sprite.anchor.set(.5)}this.x=this.y=0;this.moveSpeed=0}}},{}],7:[function(require,module,exports){var main_app=require("../app.js");var view=require("../game/view.js");exports.GunDrop=class{constructor(){this.radius=32;this.graphics=new PIXI.Graphics;this.sprite=new PIXI.Sprite.fromImage("./static/revolver.png");this.sprite.scale.x=.125;this.sprite.scale.y=.125;this.sprite.anchor.set(.5,.5);main_app.gunDropContainer.addChild(this.graphics);main_app.gunDropContainer.addChild(this.sprite);this.sprite.visible=false;this.x=0;this.y=0}draw(x,y){this.graphics.lineStyle(3,0);this.graphics.beginFill(7829367,.3);this.graphics.drawCircle(x,y,this.radius);this.sprite.x=x;this.sprite.y=y;this.sprite.visible=true}clear(){this.graphics.clear();this.sprite.visible=false}}},{"../app.js":1,"../game/view.js":13}],8:[function(require,module,exports){var main_app=require("../app.js");var view=require("../game/view.js");exports.ObjectiveDrop=class{constructor(x,y){this.radius=32;this.graphics=new PIXI.Graphics;this.sprite=new PIXI.Sprite.fromImage("static/radio_parts.png");this.sprite.scale.x=.125;this.sprite.scale.y=.125;this.sprite.anchor.set(.5,.5);main_app.gunDropContainer.addChild(this.graphics);main_app.gunDropContainer.addChild(this.sprite);this.graphics.lineStyle(3,0);this.graphics.beginFill(7829367,.3);this.graphics.drawCircle(x,y,this.radius);this.sprite.x=x;this.sprite.y=y}clear(){this.graphics.clear();this.sprite.visible=false}}},{"../app.js":1,"../game/view.js":13}],9:[function(require,module,exports){var entity=require("./entity.js");var bullet=require("./bullet.js");var main_app=require("../app.js");var skins=require("../game/skins.js");var sounds=require("../game/sounds.js");var view=require("../game/view.js");exports.Player=class extends entity.Entity{constructor(skin_options){super();this.graphics=new PIXI.Graphics;this.graphics.zOrder=1;this.x=0;this.y=0;this.rotation=0;this.rotation_weapon=0;this.rotation_body=0;this.walkType=0;this.soundType="grass";this.footStepTimer={};this.footStepTimerActivated=false;this.head_radius=32;this.fist_radius=15;this.fist_distanceFromHead=this.head_radius;this.fist_isGoingForward=true;this.fist_punchDistance=0;this.fist_punchMaxDistance=56;this.fist_punchingLeft=false;this.fist_punchingSpeed=15;this.fist_positionLeft={x:0,y:0};this.fist_positionRight={x:0,y:0};this.fist_attackAngle=30*Math.PI/180;this.fist_punchBodyRotation=5*Math.PI/180;this.gun_position={x:this.head_radius,y:-20};this.gun_tipPosition=this.gun_position.y-75;this.gun_fireSpeed=1;this.weapon_attacking=false;this.weapon_type=0;this.weapon_ready=true;this.danceDistance=0;this.danceMaxDistance=100;this.danceType=0;this.dancing=false;this.dancingForward=false;this.danceCd=500;this.danceReady=true;this.danceVariant=0;this.danceRate=[15];this.weapon_attackSpeed={fist:3,gun:.8,knife:1.8};this.knife_slashingAnimationType=0;this.knife_positionFromFist={x:0,y:-20};this.knife_rotation=0;this.knife_slashingDistance=0;this.knife_slashingMaxDistance=56;this.knife_slashRotation=24*Math.PI/180;this.knife_madeSound=false;this.stamina=0;this.rotationWeaponMin=0;this.rotationWeaponMax=0;this.rotationWeaponMinMax={fist:[{min:-this.fist_punchMaxDistance/3*Math.PI/180,max:0},{min:0,max:this.fist_punchMaxDistance/3*Math.PI/180}],gun:{min:0,max:0},knife:[{min:-this.fist_punchMaxDistance/2.5*Math.PI/180,max:0},{min:-(this.fist_punchMaxDistance/3)/(this.fist_punchingSpeed/4)*(24/1.75)*Math.PI/180,max:this.fist_punchMaxDistance*2/3/(this.fist_punchingSpeed/1.7)*24*Math.PI/180},{min:-(this.fist_punchMaxDistance*2/3)/(this.fist_punchingSpeed/1.7)*24*Math.PI/180,max:this.fist_punchMaxDistance/3/(this.fist_punchingSpeed/4)*(24/1.75)*Math.PI/180}]};this.knife_sprite=PIXI.Sprite.from("static/models/knife_"+((skin_options.knife<10?"0":"")+skin_options.knife)+".png");switch(skin_options.knife){case 4:this.knife_sprite.anchor.set(.2,.85);break;default:this.knife_sprite.anchor.set(.2,.8);break}this.knife_sprite.scale.x=this.knife_sprite.scale.y=.073;this.gun_sprite=PIXI.Sprite.from("static/models/gun_"+((skin_options.gun<10?"0":"")+skin_options.gun)+".png");this.gun_sprite.anchor.set(.5,1.15);this.gun_sprite.scale.x=this.gun_sprite.scale.y=.103;this.playerColor=skin_options.color;this.key_turningLeft=false;this.key_turningRight=false;main_app.playerContainer.addChild(this.knife_sprite);main_app.playerContainer.addChild(this.graphics);main_app.playerContainer.addChild(this.gun_sprite)}attack(){if(this.weapon_ready){this.weapon_attacking=true;this.weapon_ready=false;switch(this.weapon_type){case 0:sounds.playSound("punch_swing_01",{x:this.x-main_app.viewport.center.x,y:this.y-main_app.viewport.center.y});break;case 1:sounds.playSound("gun_shoot_01",{x:this.x-main_app.viewport.center.x,y:this.y-main_app.viewport.center.y});break;case 2:if(this.knife_slashingAnimationType==0){this.knifeSwingSound()}break}setTimeout(()=>{this.weapon_ready=true},1e3/(this.weapon_type==0?this.weapon_attackSpeed.fist:this.weapon_type==1?this.weapon_attackSpeed.gun:this.weapon_attackSpeed.knife))}}attackAnimation(mult){if(this.weapon_attacking&&this.weapon_type!=1){if(this.fist_isGoingForward){if(this.fist_punchDistance<this.fist_punchMaxDistance){if(this.weapon_type==0){this.fist_punchDistance+=this.fist_punchingSpeed*mult;if(this.fist_punchingLeft){this.rotation_weapon+=this.fist_punchBodyRotation*mult}else{this.rotation_weapon-=this.fist_punchBodyRotation*mult}}else if(this.weapon_type==2){switch(this.knife_slashingAnimationType){case 0:this.fist_punchDistance+=this.fist_punchingSpeed*mult;this.rotation_weapon-=this.knife_slashRotation/4*mult;break;case 1:if(this.fist_punchDistance<=this.fist_punchMaxDistance/3){this.fist_punchDistance+=this.fist_punchingSpeed/4*mult;this.rotation_weapon-=this.knife_slashRotation/1.75*mult;this.knife_madeSound=false}else{this.fist_punchDistance+=this.fist_punchingSpeed/1.7*mult;this.rotation_weapon+=this.knife_slashRotation*mult;if(!this.knife_madeSound){this.knifeSwingSound();this.knife_madeSound=true}}break;case 2:if(this.fist_punchDistance<=this.fist_punchMaxDistance/3){this.fist_punchDistance+=this.fist_punchingSpeed/4*mult;this.rotation_weapon+=this.knife_slashRotation/1.75*mult;this.knife_madeSound=false}else{this.fist_punchDistance+=this.fist_punchingSpeed/1.7*mult;this.rotation_weapon-=this.knife_slashRotation*mult;if(!this.knife_madeSound){this.knifeSwingSound();this.knife_madeSound=true}}break}}if(this.fist_punchDistance>this.fist_punchMaxDistance)this.fist_punchDistance=this.fist_punchMaxDistance;else if(this.fist_punchDistance<0)this.fist_punchDistance=0}else this.fist_isGoingForward=false}else{if(this.fist_punchDistance>0){this.fist_punchDistance-=this.fist_punchDistance/(this.fist_punchDistance/(this.fist_punchingSpeed/3))*mult;if(this.rotation_weapon!=0){this.rotation_weapon-=this.rotation_weapon/(this.fist_punchDistance/(this.fist_punchingSpeed/3))*mult}}else{this.fist_punchDistance=0;this.rotation_weapon=0;this.weapon_attacking=false;this.fist_isGoingForward=true;this.fist_punchingLeft=!this.fist_punchingLeft;if(this.weapon_type==2){this.knife_slashingAnimationType=Math.floor(Math.random()*3)}}}switch(this.weapon_type){case 0:if(this.rotation_weapon<this.rotationWeaponMinMax.fist[this.fist_punchingLeft?1:0].min){this.rotation_weapon=this.rotationWeaponMinMax.fist[this.fist_punchingLeft?1:0].min}else if(this.rotation_weapon>this.rotationWeaponMinMax.fist[this.fist_punchingLeft?1:0].max){this.rotation_weapon=this.rotationWeaponMinMax.fist[this.fist_punchingLeft?1:0].max}break;case 2:if(this.rotation_weapon<this.rotationWeaponMinMax.knife[this.knife_slashingAnimationType].min){this.rotation_weapon=this.rotationWeaponMinMax.knife[this.knife_slashingAnimationType].min}else if(this.rotation_weapon>this.rotationWeaponMinMax.knife[this.knife_slashingAnimationType].max){this.rotation_weapon=this.rotationWeaponMinMax.knife[this.knife_slashingAnimationType].max}break}}}dance(){if(this.danceReady&&!this.weapon_attacking&&this.weapon_type==0){this.dancing=true;this.danceReady=false;this.dancingForward=true;sounds.playSound("punch_swing_01",{x:this.x-main_app.viewport.center.x,y:this.y-main_app.viewport.center.y});setTimeout(()=>{this.danceReady=true;this.danceVariant=this.danceVariant==0?1:0},this.danceCd)}}danceAnimation(mult){if(this.dancing){if(this.dancingForward){if(this.danceDistance<this.danceMaxDistance){this.danceDistance+=this.danceRate[0]*mult}else if(this.danceDistance>this.danceMaxDistance){this.danceDistance=this.danceMaxDistance;this.dancingForward=false}}else{if(this.danceDistance>0){this.danceDistance-=this.danceDistance/(this.danceDistance/(this.danceRate[0]/3.5))*mult}else if(this.danceDistance<0){this.danceDistance=0;this.dancing=false}}}}renderFists(graphics){this.graphics.lineStyle(4,0,1);this.graphics.beginFill(this.playerColor);if(this.weapon_type==0){if(this.dancing){switch(this.danceType){case 0:if(this.danceVariant==0){this.fist_positionLeft.y=this.head_radius-this.danceDistance/2.5;this.fist_positionLeft.x=this.head_radius+this.fist_distanceFromHead-this.danceDistance/1.8;this.fist_positionRight.y=this.head_radius-this.danceDistance/8;this.fist_positionRight.x=this.head_radius-this.fist_distanceFromHead-this.danceDistance/2.5}else{this.fist_positionLeft.y=this.head_radius-this.danceDistance/8;this.fist_positionLeft.x=this.head_radius+this.fist_distanceFromHead+this.danceDistance/2.5;this.fist_positionRight.y=this.head_radius-this.danceDistance/2.5;this.fist_positionRight.x=this.head_radius-this.fist_distanceFromHead+this.danceDistance/1.8}break}}else{this.fist_positionLeft.y=this.head_radius-(this.fist_punchingLeft?this.fist_punchDistance:0);this.fist_positionLeft.x=this.head_radius+this.fist_distanceFromHead-(this.fist_punchingLeft?this.fist_punchDistance/2.5:0);this.fist_positionRight.y=this.head_radius-(this.fist_punchingLeft?0:this.fist_punchDistance);this.fist_positionRight.x=this.head_radius-this.fist_distanceFromHead+(this.fist_punchingLeft?0:this.fist_punchDistance/2.5)}}else if(this.weapon_type==1){this.fist_positionLeft.x=this.gun_position.x+8;this.fist_positionLeft.y=this.gun_position.y-8;this.fist_positionRight.x=this.gun_position.x-2;this.fist_positionRight.y=this.gun_position.y+2}else if(this.weapon_type==2){this.fist_positionLeft.y=this.head_radius;this.fist_positionLeft.x=this.head_radius+this.fist_distanceFromHead;this.fist_positionRight.y=this.head_radius-this.fist_punchDistance;this.fist_positionRight.x=this.head_radius-this.fist_distanceFromHead+this.fist_punchDistance/2.5}graphics.drawCircle(this.fist_positionLeft.y,this.fist_positionLeft.x,this.fist_radius);graphics.drawCircle(this.fist_positionRight.y,this.fist_positionRight.x,this.fist_radius)}renderModel(graphics){graphics.clear();this.renderFists(graphics);if(this.weapon_type==1){this.rotation_weapon=0;this.gun_sprite.visible=true}else{this.gun_sprite.visible=false}if(this.weapon_type==2){this.knife_sprite.visible=true}else{this.knife_sprite.visible=false}graphics.lineStyle(4,0,1);graphics.beginFill(16768421);graphics.drawCircle(this.head_radius,this.head_radius,this.head_radius);graphics.endFill()}animate(dt){dt/=1e3/60;if(this.dancing){this.danceAnimation(dt)}else{this.attackAnimation(dt)}this.renderModel(this.graphics);this.rotation=this.rotation_body+this.rotation_weapon;this.graphics.rotation=this.rotation;this.graphics.pivot.x=this.head_radius;this.graphics.pivot.y=this.head_radius;this.graphics.x=this.x;this.graphics.y=this.y;this.knife_rotation=this.rotation-Math.PI/1.75;this.knife_sprite.rotation=this.knife_rotation;this.knife_sprite.x=this.x+this.head_radius*Math.cos(this.rotation-Math.PI/2)-this.fist_punchDistance*Math.cos(this.fist_attackAngle-this.rotation);this.knife_sprite.y=this.y+this.head_radius*Math.sin(this.rotation-Math.PI/2)+this.fist_punchDistance*Math.sin(this.fist_attackAngle-this.rotation);this.gun_sprite.x=this.x+this.head_radius*Math.cos(this.rotation+Math.PI);this.gun_sprite.y=this.y+this.head_radius*Math.sin(this.rotation+Math.PI);this.gun_sprite.rotation=this.rotation-Math.PI/2;this.footStepSounds()}footStepSounds(){if(this.walkType==0||this.footStepTimerActivated){return}this.footStepTimerActivated=true;this.footStepTimer=setTimeout(()=>{if(this.walkType!=0){let sound=Math.floor(Math.random()*3)+1;sounds.playSound(`walk_${this.soundType}_0${sound}`,{x:this.x-main_app.viewport.center.x,y:this.y-main_app.viewport.center.y})}this.footStepTimerActivated=false},this.walkType==1?350:250)}knifeSwingSound(){let sound=Math.floor(Math.random()*3)+1;sounds.playSound(`knife_swing_0${sound}`,{x:this.x-main_app.viewport.center.x,y:this.y-main_app.viewport.center.y})}clearAnimation(){this.knife_sprite.visible=false;this.gun_sprite.visible=false;this.graphics.clear()}}},{"../app.js":1,"../game/skins.js":11,"../game/sounds.js":12,"../game/view.js":13,"./bullet.js":5,"./entity.js":6}],10:[function(require,module,exports){var main_app=require("../app.js");var loadedMap=[];var mapScenes=[];exports.loadedMap=loadedMap;var view=require("../game/view.js");exports.Level=class{constructor(id,objs){this.id=id;if(!loadedMap[id]){mapScenes[id]={carpet:new PIXI.Container,objects:new PIXI.Container}}this.map=PIXI.BaseTexture.fromImage(`./static/maps/map${id}.png`);this.map_chunkCount=32;if(this.map.hasLoaded){this.setupChunks()}else{this.map.on("loaded",()=>{this.setupChunks()})}if(!loadedMap[id]){if(objs){this.objects=[];for(var i=0;i<objs.length;i++){if(objs[i].type.startsWith("counter")){this.objects.push(new PIXI.Sprite(new PIXI.Texture(PIXI.BaseTexture.fromImage("./static/maps/counter.png"),new PIXI.Rectangle(512*parseInt(objs[i].type.slice(-2)),0,512,512))))}else{this.objects.push(PIXI.Sprite.from(`./static/maps/${objs[i].type}.png`))}let o=this.objects[this.objects.length-1];o.x=objs[i].x;o.y=objs[i].y;o.width=objs[i].width;o.height=objs[i].height;o.anchor.set(0,1);o.rotation=objs[i].rotation*Math.PI/180;if(objs[i].flip){o.scale.x=-1;o.anchor.x=1}if(objs[i].type.startsWith("carpet")){mapScenes[id].carpet.addChild(o)}else{mapScenes[id].objects.addChild(o)}view.cull.add(o,false)}main_app.carpetContainer.addChild(mapScenes[id].carpet);main_app.levelContainer.addChild(mapScenes[id].objects);loadedMap[id]=true}}mapScenes[id].carpet.visible=true;mapScenes[id].objects.visible=true}setupChunks(){this.map_chunkSize=this.map.width/this.map_chunkCount;this.map_chunks=[];for(var i=0;i<this.map_chunkCount;i++){this.map_chunks.push([]);for(var a=0;a<this.map_chunkCount;a++){this.map_chunks[this.map_chunks.length-1].push(new PIXI.Sprite(new PIXI.Texture(this.map,new PIXI.Rectangle(a*this.map_chunkSize,i*this.map_chunkSize,this.map_chunkSize,this.map_chunkSize))));this.map_chunks[this.map_chunks.length-1][this.map_chunks[this.map_chunks.length-1].length-1].x=a*this.map_chunkSize;this.map_chunks[this.map_chunks.length-1][this.map_chunks[this.map_chunks.length-1].length-1].y=i*this.map_chunkSize;this.map_chunks[this.map_chunks.length-1][this.map_chunks[this.map_chunks.length-1].length-1].visible=false;main_app.floorContainer.addChild(this.map_chunks[this.map_chunks.length-1][this.map_chunks[this.map_chunks.length-1].length-1])}}}update(){let cx=Math.round((main_app.viewport.center.x-this.map_chunkSize/2)/this.map_chunkSize),cy=Math.round((main_app.viewport.center.y-this.map_chunkSize/2)/this.map_chunkSize),vx=Math.round(main_app.viewport.worldScreenWidth/2/this.map_chunkSize)+2,vy=Math.round(main_app.viewport.worldScreenHeight/2/this.map_chunkSize)+2,lx=cx-vx<0?0:cx-vx,rx=cx+vx>this.map_chunkCount-1?this.map_chunkCount-1:cx+vx,ly=cy-vy<0?0:cy-vy,ry=cy+vy>this.map_chunkCount-1?this.map_chunkCount-1:cy+vy;for(var i=ly;i<=ry;i++){for(var a=lx;a<=rx;a++){if((lx==0||a>lx)&&(rx==this.map_chunkCount-1||a<rx)&&(ly==0||i>ly)&&(ry==this.map_chunkCount-1||i<ry)){this.map_chunks[i][a].visible=true}else{this.map_chunks[i][a].visible=false}}}}inCameraView(obj){return main_app.viewport.center.x+main_app.viewport.worldScreenWidth/4>obj.x-obj.r&&main_app.viewport.center.x-main_app.viewport.worldScreenWidth/4<obj.x+obj.r&&main_app.viewport.center.y+main_app.viewport.worldScreenHeight/4>obj.y-obj.r&&main_app.viewport.center.y-main_app.viewport.worldScreenHeight/4<obj.y+obj.r}clearLevel(){mapScenes[this.id].carpet.visible=false;mapScenes[this.id].objects.visible=false}}},{"../app.js":1,"../game/view.js":13}],11:[function(require,module,exports){var skinNumber={knife:0,gun:0};exports.skinNumber=skinNumber;var maxKnife=8,maxGun=3;var knife_selectedElement=document.getElementById("menu-store-skin-knife00");var gun_selectedElement=document.getElementById("menu-store-skin-gun00");exports.skinSetup=function(){knife_selectedElement.style.backgroundColor="rgba(0,255,0,0.15)";gun_selectedElement.style.backgroundColor="rgba(0,255,0,0.15)";for(var i=0;i<maxKnife;i++){let string=`menu-store-skin-knife${i<10?"0"+i:i}`;document.getElementById(string).n=i;document.getElementById(string).addEventListener("click",function(){skinNumber.knife=document.getElementById(string).n;knife_selectedElement.style.backgroundColor="rgba(0,0,0,0.25)";knife_selectedElement=document.getElementById(string);knife_selectedElement.style.backgroundColor="rgba(0,255,0,0.15)"})}for(var i=0;i<maxGun;i++){let string=`menu-store-skin-gun${i<10?"0"+i:i}`;document.getElementById(string).n=i;document.getElementById(string).addEventListener("click",function(){skinNumber.gun=document.getElementById(string).n;gun_selectedElement.style.backgroundColor="rgba(0,0,0,0.25)";gun_selectedElement=document.getElementById(string);gun_selectedElement.style.backgroundColor="rgba(0,255,0,0.15)"})}}},{}],12:[function(require,module,exports){var Howl=require("howler");var soundDefinitions=[{dir:"./static/sounds/punch_swing_01.mp3",id:"punch_swing_01"},{dir:"./static/sounds/knife_swing_01.mp3",id:"knife_swing_01"},{dir:"./static/sounds/knife_swing_02.mp3",id:"knife_swing_02"},{dir:"./static/sounds/knife_swing_03.mp3",id:"knife_swing_03"},{dir:"./static/sounds/knife_kill_01.mp3",id:"knife_kill_01"},{dir:"./static/sounds/radiopart_pickup_01.mp3",id:"radiopart_pickup_01"},{dir:"./static/sounds/gun_shoot_01.mp3",id:"gun_shoot_01",volumeDivisor:1400},{dir:"./static/sounds/walk_wood_01.mp3",id:"walk_wood_01",volumeDivisor:600},{dir:"./static/sounds/walk_wood_02.mp3",id:"walk_wood_02",volumeDivisor:600},{dir:"./static/sounds/walk_wood_03.mp3",id:"walk_wood_03",volumeDivisor:600},{dir:"./static/sounds/walk_grass_01.mp3",id:"walk_grass_01",volumeDivisor:600},{dir:"./static/sounds/walk_grass_02.mp3",id:"walk_grass_02",volumeDivisor:600},{dir:"./static/sounds/walk_grass_03.mp3",id:"walk_grass_03",volumeDivisor:600}];var sounds={};exports.sounds=sounds;var panDivisor=750,volumeDivisor=800;var loadSounds=function(){for(var i=0;i<soundDefinitions.length;i++){sounds[soundDefinitions[i].id]={sound:new Howl.Howl({src:[soundDefinitions[i].dir]}),volumeDivisor:soundDefinitions[i].volumeDivisor}}};exports.loadSounds=loadSounds;var playSound=function(id,pos){if(!sounds[id]){return}let pan=pos.x/panDivisor;if(pan<-1){pan=-1}else if(pan>1){pan=1}let volume=1-Math.sqrt(Math.pow(pos.x,2)+Math.pow(pos.y,2))/(sounds[id].volumeDivisor!=null?sounds[id].volumeDivisor:volumeDivisor);if(volume<0){volume=0}else if(volume>1){volume=1}sounds[id].sound.stereo(pan);sounds[id].sound.volume(volume);return sounds[id].sound.play()};exports.playSound=playSound},{howler:41}],13:[function(require,module,exports){var main_app=require("../app.js");var Cull=require("pixi-cull");var cull=new Cull.Simple;exports.cull=cull},{"../app.js":1,"pixi-cull":51}],14:[function(require,module,exports){"use strict";var Clock=function(){function Clock(useInterval){if(useInterval===void 0){useInterval=false}this.running=false;this.now=typeof window!=="undefined"&&window.performance&&window.performance.now&&window.performance.now.bind(window.performance)||Date.now;this.start(useInterval)}Clock.prototype.start=function(useInterval){if(useInterval===void 0){useInterval=false}this.deltaTime=0;this.currentTime=this.now();this.elapsedTime=0;this.running=true;if(useInterval){this._interval=setInterval(this.tick.bind(this),1e3/60)}};Clock.prototype.stop=function(){this.running=false;if(this._interval){clearInterval(this._interval)}};Clock.prototype.tick=function(newTime){if(newTime===void 0){newTime=this.now()}this.deltaTime=newTime-this.currentTime;this.currentTime=newTime;this.elapsedTime+=this.deltaTime};return Clock}();module.exports=Clock},{}],15:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var SlotList_1=require("./SlotList");var Slot_1=require("./Slot");var OnceSignal=function(){function OnceSignal(){var valueClasses=[];for(var _i=0;_i<arguments.length;_i++){valueClasses[_i]=arguments[_i]}this.slots=SlotList_1.SlotList.NIL;this.valueClasses=valueClasses.length===1&&valueClasses[0]instanceof Array?valueClasses[0]:valueClasses}Object.defineProperty(OnceSignal.prototype,"valueClasses",{get:function(){return this._valueClasses},set:function(value){this._valueClasses=value?value.slice():[];for(var i=this._valueClasses.length;i--;){if(!(this._valueClasses[i]instanceof Object)){throw new Error("Invalid valueClasses argument: "+"item at index "+i+" should be a Class but was:<"+this._valueClasses[i]+">."+this._valueClasses[i])}}},enumerable:true,configurable:true});Object.defineProperty(OnceSignal.prototype,"numListeners",{get:function(){return this.slots.length},enumerable:true,configurable:true});OnceSignal.prototype.addOnce=function(listener){return this.registerListener(listener,true)};OnceSignal.prototype.once=function(listener){return this.addOnce(listener)};OnceSignal.prototype.remove=function(listener){var slot=this.slots.find(listener);if(!slot){return null}this.slots=this.slots.filterNot(listener);return slot};OnceSignal.prototype.removeAll=function(){this.slots=SlotList_1.SlotList.NIL};OnceSignal.prototype.dispatch=function(){var valueObjects=[];for(var _i=0;_i<arguments.length;_i++){valueObjects[_i]=arguments[_i]}var numValueClasses=this._valueClasses.length;var numValueObjects=valueObjects.length;if(numValueObjects<numValueClasses){throw new Error("Incorrect number of arguments. "+"Expected at least "+numValueClasses+" but received "+numValueObjects+".")}for(var i=0;i<numValueClasses;i++){if(valueObjects[i]===null||(valueObjects[i]instanceof this._valueClasses[i]||valueObjects[i].constructor===this._valueClasses[i])){continue}throw new Error("Value object <"+valueObjects[i]+"> is not an instance of <"+this._valueClasses[i]+">.")}var slotsToProcess=this.slots;if(slotsToProcess.nonEmpty){while(slotsToProcess.nonEmpty){slotsToProcess.head.execute(valueObjects);slotsToProcess=slotsToProcess.tail}}};OnceSignal.prototype.registerListener=function(listener,once){if(once===void 0){once=false}if(this.registrationPossible(listener,once)){var newSlot=new Slot_1.Slot(listener,this,once);this.slots=this.slots.prepend(newSlot);return newSlot}return this.slots.find(listener)};OnceSignal.prototype.registrationPossible=function(listener,once){if(!this.slots.nonEmpty){return true}var existingSlot=this.slots.find(listener);if(!existingSlot){return true}if(existingSlot.once!==once){throw new Error("You cannot addOnce() then add() the same listener without removing the relationship first.")}return false};return OnceSignal}();exports.OnceSignal=OnceSignal},{"./Slot":17,"./SlotList":18}],16:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var OnceSignal_1=require("./OnceSignal");var Signal=function(_super){__extends(Signal,_super);function Signal(){return _super!==null&&_super.apply(this,arguments)||this}Signal.prototype.add=function(listener){return this.registerListener(listener)};return Signal}(OnceSignal_1.OnceSignal);exports.Signal=Signal},{"./OnceSignal":15}],17:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Slot=function(){function Slot(listener,signal,once,priority){if(once===void 0){once=false}if(priority===void 0){priority=0}this._enabled=true;this._once=false;this._priority=0;this._listener=listener;this._once=once;this._signal=signal;this._priority=priority;this.verifyListener(listener)}Slot.prototype.execute0=function(){if(!this._enabled){return}if(this._once){this.remove()}if(this._params&&this._params.length){this._listener.apply(null,this._params);return}this._listener()};Slot.prototype.execute1=function(value){if(!this._enabled){return}if(this._once){this.remove()}if(this._params&&this._params.length){this._listener.apply(null,[value].concat(this._params));return}this._listener(value)};Slot.prototype.execute=function(valueObjects){if(!this._enabled){return}if(this._once){this.remove()}if(this._params&&this._params.length){valueObjects=valueObjects.concat(this._params)}var numValueObjects=valueObjects.length;if(numValueObjects===0){this._listener()}else if(numValueObjects===1){this._listener(valueObjects[0])}else if(numValueObjects===2){this._listener(valueObjects[0],valueObjects[1])}else if(numValueObjects===3){this._listener(valueObjects[0],valueObjects[1],valueObjects[2])}else{this._listener.apply(null,valueObjects)}};Object.defineProperty(Slot.prototype,"listener",{get:function(){return this._listener},set:function(value){if(null==value){throw new Error("Given listener is null.\nDid you want to set enabled to false instead?")}this.verifyListener(value);this._listener=value},enumerable:true,configurable:true});Object.defineProperty(Slot.prototype,"once",{get:function(){return this._once},enumerable:true,configurable:true});Object.defineProperty(Slot.prototype,"priority",{get:function(){return this._priority},enumerable:true,configurable:true});Slot.prototype.toString=function(){return"[Slot listener: "+this._listener+", once: "+this._once+", priority: "+this._priority+", enabled: "+this._enabled+"]"};Object.defineProperty(Slot.prototype,"enabled",{get:function(){return this._enabled},set:function(value){this._enabled=value},enumerable:true,configurable:true});Object.defineProperty(Slot.prototype,"params",{get:function(){return this._params},set:function(value){this._params=value},enumerable:true,configurable:true});Slot.prototype.remove=function(){this._signal.remove(this._listener)};Slot.prototype.verifyListener=function(listener){if(null==listener){throw new Error("Given listener is null.")}if(null==this._signal){throw new Error("Internal signal reference has not been set yet.")}};return Slot}();exports.Slot=Slot},{}],18:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var SlotList=function(){function SlotList(head,tail){if(tail===void 0){tail=null}this.nonEmpty=false;if(!head&&!tail){if(SlotList.NIL){throw new Error("Parameters head and tail are null. Use the NIL element instead.")}this.nonEmpty=false}else if(!head){throw new Error("Parameter head cannot be null.")}else{this.head=head;this.tail=tail||SlotList.NIL;this.nonEmpty=true}}Object.defineProperty(SlotList.prototype,"length",{get:function(){if(!this.nonEmpty){return 0}if(this.tail===SlotList.NIL){return 1}var result=0;var p=this;while(p.nonEmpty){++result;p=p.tail}return result},enumerable:true,configurable:true});SlotList.prototype.prepend=function(slot){return new SlotList(slot,this)};SlotList.prototype.append=function(slot){if(!slot){return this}if(!this.nonEmpty){return new SlotList(slot)}if(this.tail===SlotList.NIL){return new SlotList(slot).prepend(this.head)}var wholeClone=new SlotList(this.head);var subClone=wholeClone;var current=this.tail;while(current.nonEmpty){subClone=subClone.tail=new SlotList(current.head);current=current.tail}subClone.tail=new SlotList(slot);return wholeClone};SlotList.prototype.insertWithPriority=function(slot){if(!this.nonEmpty){return new SlotList(slot)}var priority=slot.priority;if(priority>this.head.priority){return this.prepend(slot)}var wholeClone=new SlotList(this.head);var subClone=wholeClone;var current=this.tail;while(current.nonEmpty){if(priority>current.head.priority){subClone.tail=current.prepend(slot);return wholeClone}subClone=subClone.tail=new SlotList(current.head);current=current.tail}subClone.tail=new SlotList(slot);return wholeClone};SlotList.prototype.filterNot=function(listener){if(!this.nonEmpty||listener==null){return this}if(listener===this.head.listener){return this.tail}var wholeClone=new SlotList(this.head);var subClone=wholeClone;var current=this.tail;while(current.nonEmpty){if(current.head.listener===listener){subClone.tail=current.tail;return wholeClone}subClone=subClone.tail=new SlotList(current.head);current=current.tail}return this};SlotList.prototype.contains=function(listener){if(!this.nonEmpty){return false}var p=this;while(p.nonEmpty){if(p.head.listener===listener){return true}p=p.tail}return false};SlotList.prototype.find=function(listener){if(!this.nonEmpty){return null}var p=this;while(p.nonEmpty){if(p.head.listener===listener){return p.head}p=p.tail}return null};SlotList.prototype.toString=function(){var buffer="";var p=this;while(p.nonEmpty){buffer+=p.head+" -> ";p=p.tail}buffer+="NIL";return"[List "+buffer+"]"};SlotList.NIL=new SlotList(null,null);return SlotList}();exports.SlotList=SlotList},{}],19:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var OnceSignal_1=require("./OnceSignal");exports.OnceSignal=OnceSignal_1.OnceSignal;var Signal_1=require("./Signal");exports.Signal=Signal_1.Signal;var Slot_1=require("./Slot");exports.Slot=Slot_1.Slot;var SlotList_1=require("./SlotList");exports.SlotList=SlotList_1.SlotList},{"./OnceSignal":15,"./Signal":16,"./Slot":17,"./SlotList":18}],20:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var compare_1=require("./compare");var StateContainer=function(){function StateContainer(state){this.listeners=[];this.matcherPlaceholders={":id":/^([a-zA-Z0-9\-_]+)$/,":number":/^([0-9]+)$/,":string":/^(\w+)$/,":axis":/^([xyz])$/,":*":/(.*)/};this.state=state;this.reset()}StateContainer.prototype.set=function(newState){var patches=compare_1.compare(this.state,newState);this.state=newState;this.checkPatches(patches,this.listeners,this.defaultListener);return patches};StateContainer.prototype.registerPlaceholder=function(placeholder,matcher){this.matcherPlaceholders[placeholder]=matcher};StateContainer.prototype.listen=function(segments,callback,immediate){var _this=this;var rules;if(typeof segments==="function"){rules=[];callback=segments}else{rules=segments.split("/")}if(callback.length>1){console.warn(".listen() accepts only one parameter.")}var listener={callback:callback,rawRules:rules,rules:rules.map(function(segment){if(typeof segment==="string"){return segment.indexOf(":")===0?_this.matcherPlaceholders[segment]||_this.matcherPlaceholders[":*"]:new RegExp("^"+segment+"$")}else{return segment}})};if(rules.length===0){this.defaultListener=listener}else{this.listeners.push(listener)}if(immediate){this.checkPatches(compare_1.compare({},this.state),[listener])}return listener};StateContainer.prototype.removeListener=function(listener){for(var i=this.listeners.length-1;i>=0;i--){if(this.listeners[i]===listener){this.listeners.splice(i,1)}}};StateContainer.prototype.removeAllListeners=function(){this.reset()};StateContainer.prototype.checkPatches=function(patches,listeners,defaultListener){for(var j=0,len=listeners.length;j<len;j++){var listener=listeners[j];for(var i=patches.length-1;i>=0;i--){var pathVariables=listener&&this.getPathVariables(patches[i],listener);if(pathVariables){listener.callback({path:pathVariables,rawPath:patches[i].path,operation:patches[i].operation,value:patches[i].value});patches[i].matched=true}}}if(defaultListener){for(var i=patches.length-1;i>=0;i--){if(!patches[i].matched){defaultListener.callback(patches[i])}}}};StateContainer.prototype.getPathVariables=function(patch,listener){if(patch.path.length!==listener.rules.length){return false}var path={};for(var i=0,len=listener.rules.length;i<len;i++){var matches=patch.path[i].match(listener.rules[i]);if(!matches||matches.length===0||matches.length>2){return false}else if(listener.rawRules[i].substr(0,1)===":"){path[listener.rawRules[i].substr(1)]=matches[1]}}return path};StateContainer.prototype.reset=function(){this.listeners=[]};return StateContainer}();exports.StateContainer=StateContainer},{"./compare":21}],21:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function compare(tree1,tree2){var patches=[];generate(tree1,tree2,patches,[]);return patches}exports.compare=compare;function concat(arr,value){var newArr=arr.slice();newArr.push(value);return newArr}function objectKeys(obj){if(Array.isArray(obj)){var keys_1=new Array(obj.length);for(var k=0;k<keys_1.length;k++){keys_1[k]=""+k}return keys_1}if(Object.keys){return Object.keys(obj)}var keys=[];for(var i in obj){if(obj.hasOwnProperty(i)){keys.push(i)}}return keys}function generate(mirror,obj,patches,path){var newKeys=objectKeys(obj);var oldKeys=objectKeys(mirror);var deleted=false;for(var t=oldKeys.length-1;t>=0;t--){var key=oldKeys[t];var oldVal=mirror[key];if(obj.hasOwnProperty(key)&&!(obj[key]===undefined&&oldVal!==undefined&&Array.isArray(obj)===false)){var newVal=obj[key];if(typeof oldVal=="object"&&oldVal!=null&&typeof newVal=="object"&&newVal!=null){generate(oldVal,newVal,patches,concat(path,key))}else{if(oldVal!==newVal){patches.push({operation:"replace",path:concat(path,key),value:newVal,previousValue:oldVal})}}}else{patches.push({operation:"remove",path:concat(path,key)});deleted=true}}if(!deleted&&newKeys.length==oldKeys.length){return}for(var t=newKeys.length-1;t>=0;t--){var key=newKeys[t];if(!mirror.hasOwnProperty(key)&&obj[key]!==undefined){var newVal=obj[key];var addPath=concat(path,key);if(typeof newVal=="object"&&newVal!=null){generate({},newVal,patches,addPath)}patches.push({operation:"add",path:addPath,value:newVal})}}}},{}],22:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var StateContainer_1=require("./StateContainer");exports.StateContainer=StateContainer_1.StateContainer},{"./StateContainer":20}],23:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createBackoff=createBackoff;var backoff={exponential:function exponential(attempt,delay){return Math.floor(Math.random()*Math.pow(2,attempt)*delay)},fibonacci:function fibonacci(attempt,delay){var current=1;if(attempt>current){var prev=1,current=2;for(var index=2;index<attempt;index++){var next=prev+current;prev=current;current=next}}return Math.floor(Math.random()*current*delay)}};function createBackoff(type,options){return new Backoff(backoff[type],options)}function Backoff(func,options){this.func=func;this.attempts=0;this.delay=typeof options.initialDelay!=="undefined"?options.initialDelay:100}Backoff.prototype.backoff=function(){setTimeout(this.onReady,this.func(++this.attempts,this.delay))}},{}],24:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var createBackoff=require("./backoff").createBackoff;var WebSocketImpl=typeof WebSocket!=="undefined"?WebSocket:require("ws");var WebSocketClient=function(){function WebSocketClient(url,protocols){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};_classCallCheck(this,WebSocketClient);this.url=url;this.protocols=protocols;this.reconnectEnabled=true;this.listeners={};this.backoff=createBackoff(options.backoff||"exponential",options);this.backoff.onReady=this.onBackoffReady.bind(this);if(typeof options.connect==="undefined"||options.connect){this.open()}}_createClass(WebSocketClient,[{key:"open",value:function open(){var reconnect=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this.isReconnect=reconnect;var binaryType=this.ws&&this.ws.binaryType;this.ws=new WebSocketImpl(this.url,this.protocols);this.ws.onclose=this.onCloseCallback.bind(this);this.ws.onerror=this.onErrorCallback.bind(this);this.ws.onmessage=this.onMessageCallback.bind(this);this.ws.onopen=this.onOpenCallback.bind(this);if(binaryType){this.ws.binaryType=binaryType}}},{key:"onBackoffReady",value:function onBackoffReady(number,delay){this.open(true)}},{key:"onCloseCallback",value:function onCloseCallback(e){if(!this.isReconnect&&this.listeners["onclose"]){this.listeners["onclose"].apply(null,arguments)}if(this.reconnectEnabled&&e.code<3e3){this.backoff.backoff()}}},{key:"onErrorCallback",value:function onErrorCallback(){if(this.listeners["onerror"]){this.listeners["onerror"].apply(null,arguments)}}},{key:"onMessageCallback",value:function onMessageCallback(){if(this.listeners["onmessage"]){this.listeners["onmessage"].apply(null,arguments)}}},{key:"onOpenCallback",value:function onOpenCallback(){if(this.listeners["onopen"]){this.listeners["onopen"].apply(null,arguments)}if(this.isReconnect&&this.listeners["onreconnect"]){this.listeners["onreconnect"].apply(null,arguments)}this.isReconnect=false}},{key:"close",value:function close(code,reason){if(typeof code=="undefined"){code=1e3}this.reconnectEnabled=false;this.ws.close(code,reason)}},{key:"send",value:function send(data){this.ws.send(data)}},{key:"bufferedAmount",get:function get(){return this.ws.bufferedAmount}},{key:"readyState",get:function get(){return this.ws.readyState}},{key:"binaryType",get:function get(){return this.ws.binaryType},set:function set(binaryType){this.ws.binaryType=binaryType}},{key:"extensions",get:function get(){return this.ws.extensions},set:function set(extensions){this.ws.extensions=extensions}},{key:"protocol",get:function get(){return this.ws.protocol},set:function set(protocol){this.ws.protocol=protocol}},{key:"onclose",set:function set(listener){this.listeners["onclose"]=listener},get:function get(){return this.listeners["onclose"]}},{key:"onerror",set:function set(listener){this.listeners["onerror"]=listener},get:function get(){return this.listeners["onerror"]}},{key:"onmessage",set:function set(listener){this.listeners["onmessage"]=listener},get:function get(){return this.listeners["onmessage"]}},{key:"onopen",set:function set(listener){this.listeners["onopen"]=listener},get:function get(){return this.listeners["onopen"]}},{key:"onreconnect",set:function set(listener){this.listeners["onreconnect"]=listener},get:function get(){return this.listeners["onreconnect"]}}]);return WebSocketClient}();WebSocketClient.CONNECTING=WebSocketImpl.CONNECTING;WebSocketClient.OPEN=WebSocketImpl.OPEN;WebSocketClient.CLOSING=WebSocketImpl.CLOSING;WebSocketClient.CLOSED=WebSocketImpl.CLOSED;exports.default=WebSocketClient},{"./backoff":23,ws:27}],25:[function(require,module,exports){"use strict";exports.byteLength=byteLength;exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function getLens(b64){var len=b64.length;if(len%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var validLen=b64.indexOf("=");if(validLen===-1)validLen=len;var placeHoldersLen=validLen===len?0:4-validLen%4;return[validLen,placeHoldersLen]}function byteLength(b64){var lens=getLens(b64);var validLen=lens[0];var placeHoldersLen=lens[1];return(validLen+placeHoldersLen)*3/4-placeHoldersLen}function _byteLength(b64,validLen,placeHoldersLen){return(validLen+placeHoldersLen)*3/4-placeHoldersLen}function toByteArray(b64){var tmp;var lens=getLens(b64);var validLen=lens[0];var placeHoldersLen=lens[1];var arr=new Arr(_byteLength(b64,validLen,placeHoldersLen));var curByte=0;var len=placeHoldersLen>0?validLen-4:validLen;var i;for(i=0;i<len;i+=4){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[curByte++]=tmp>>16&255;arr[curByte++]=tmp>>8&255;arr[curByte++]=tmp&255}if(placeHoldersLen===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[curByte++]=tmp&255}if(placeHoldersLen===1){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[curByte++]=tmp>>8&255;arr[curByte++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(uint8[i+2]&255);output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(extraBytes===1){tmp=uint8[len-1];parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"=")}return parts.join("")}},{}],26:[function(require,module,exports){"use strict";"use restrict";var INT_BITS=32;exports.INT_BITS=INT_BITS;exports.INT_MAX=2147483647;exports.INT_MIN=-1<<INT_BITS-1;exports.sign=function(v){return(v>0)-(v<0)};exports.abs=function(v){var mask=v>>INT_BITS-1;return(v^mask)-mask};exports.min=function(x,y){return y^(x^y)&-(x<y)};exports.max=function(x,y){return x^(x^y)&-(x<y)};exports.isPow2=function(v){return!(v&v-1)&&!!v};exports.log2=function(v){var r,shift;r=(v>65535)<<4;v>>>=r;shift=(v>255)<<3;v>>>=shift;r|=shift;shift=(v>15)<<2;v>>>=shift;r|=shift;shift=(v>3)<<1;v>>>=shift;r|=shift;return r|v>>1};exports.log10=function(v){return v>=1e9?9:v>=1e8?8:v>=1e7?7:v>=1e6?6:v>=1e5?5:v>=1e4?4:v>=1e3?3:v>=100?2:v>=10?1:0};exports.popCount=function(v){v=v-(v>>>1&1431655765);v=(v&858993459)+(v>>>2&858993459);return(v+(v>>>4)&252645135)*16843009>>>24};function countTrailingZeros(v){var c=32;v&=-v;if(v)c--;if(v&65535)c-=16;if(v&16711935)c-=8;if(v&252645135)c-=4;if(v&858993459)c-=2;if(v&1431655765)c-=1;return c}exports.countTrailingZeros=countTrailingZeros;exports.nextPow2=function(v){v+=v===0;--v;v|=v>>>1;v|=v>>>2;v|=v>>>4;v|=v>>>8;v|=v>>>16;return v+1};exports.prevPow2=function(v){v|=v>>>1;v|=v>>>2;v|=v>>>4;v|=v>>>8;v|=v>>>16;return v-(v>>>1)};exports.parity=function(v){v^=v>>>16;v^=v>>>8;v^=v>>>4;v&=15;return 27030>>>v&1};var REVERSE_TABLE=new Array(256);(function(tab){for(var i=0;i<256;++i){var v=i,r=i,s=7;for(v>>>=1;v;v>>>=1){r<<=1;r|=v&1;--s}tab[i]=r<<s&255}})(REVERSE_TABLE);exports.reverse=function(v){return REVERSE_TABLE[v&255]<<24|REVERSE_TABLE[v>>>8&255]<<16|REVERSE_TABLE[v>>>16&255]<<8|REVERSE_TABLE[v>>>24&255]};exports.interleave2=function(x,y){x&=65535;x=(x|x<<8)&16711935;x=(x|x<<4)&252645135;x=(x|x<<2)&858993459;x=(x|x<<1)&1431655765;y&=65535;y=(y|y<<8)&16711935;y=(y|y<<4)&252645135;y=(y|y<<2)&858993459;y=(y|y<<1)&1431655765;return x|y<<1};exports.deinterleave2=function(v,n){v=v>>>n&1431655765;v=(v|v>>>1)&858993459;v=(v|v>>>2)&252645135;v=(v|v>>>4)&16711935;v=(v|v>>>16)&65535;return v<<16>>16};exports.interleave3=function(x,y,z){x&=1023;x=(x|x<<16)&4278190335;x=(x|x<<8)&251719695;x=(x|x<<4)&3272356035;x=(x|x<<2)&1227133513;y&=1023;y=(y|y<<16)&4278190335;y=(y|y<<8)&251719695;y=(y|y<<4)&3272356035;y=(y|y<<2)&1227133513;x|=y<<1;z&=1023;z=(z|z<<16)&4278190335;z=(z|z<<8)&251719695;z=(z|z<<4)&3272356035;z=(z|z<<2)&1227133513;return x|z<<2};exports.deinterleave3=function(v,n){v=v>>>n&1227133513;v=(v|v>>>2)&3272356035;v=(v|v>>>4)&251719695;v=(v|v>>>8)&4278190335;v=(v|v>>>16)&1023;return v<<22>>22};exports.nextCombination=function(v){var t=v|v-1;return t+1|(~t&-~t)-1>>>countTrailingZeros(v)+1}},{}],27:[function(require,module,exports){},{}],28:[function(require,module,exports){(function(Buffer){"use strict";var base64=require("base64-js");var ieee754=require("ieee754");var customInspectSymbol=typeof Symbol==="function"&&typeof Symbol.for==="function"?Symbol.for("nodejs.util.inspect.custom"):null;exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;exports.kMaxLength=K_MAX_LENGTH;Buffer.TYPED_ARRAY_SUPPORT=typedArraySupport();if(!Buffer.TYPED_ARRAY_SUPPORT&&typeof console!=="undefined"&&typeof console.error==="function"){console.error("This browser lacks typed array (Uint8Array) support which is required by "+"`buffer` v5.x. Use `buffer` v4.x if you require old browser support.")}function typedArraySupport(){try{var arr=new Uint8Array(1);var proto={foo:function(){return 42}};Object.setPrototypeOf(proto,Uint8Array.prototype);Object.setPrototypeOf(arr,proto);return arr.foo()===42}catch(e){return false}}Object.defineProperty(Buffer.prototype,"parent",{enumerable:true,get:function(){if(!Buffer.isBuffer(this))return undefined;return this.buffer}});Object.defineProperty(Buffer.prototype,"offset",{enumerable:true,get:function(){if(!Buffer.isBuffer(this))return undefined;return this.byteOffset}});function createBuffer(length){if(length>K_MAX_LENGTH){throw new RangeError('The value "'+length+'" is invalid for option "size"')}var buf=new Uint8Array(length);Object.setPrototypeOf(buf,Buffer.prototype);return buf}function Buffer(arg,encodingOrOffset,length){if(typeof arg==="number"){if(typeof encodingOrOffset==="string"){throw new TypeError('The "string" argument must be of type string. Received type number')}return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}if(typeof Symbol!=="undefined"&&Symbol.species!=null&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true,enumerable:false,writable:false})}Buffer.poolSize=8192;function from(value,encodingOrOffset,length){if(typeof value==="string"){return fromString(value,encodingOrOffset)}if(ArrayBuffer.isView(value)){return fromArrayLike(value)}if(value==null){throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, "+"or Array-like Object. Received type "+typeof value)}if(isInstance(value,ArrayBuffer)||value&&isInstance(value.buffer,ArrayBuffer)){return fromArrayBuffer(value,encodingOrOffset,length)}if(typeof value==="number"){throw new TypeError('The "value" argument must not be of type number. Received type number')}var valueOf=value.valueOf&&value.valueOf();if(valueOf!=null&&valueOf!==value){return Buffer.from(valueOf,encodingOrOffset,length)}var b=fromObject(value);if(b)return b;if(typeof Symbol!=="undefined"&&Symbol.toPrimitive!=null&&typeof value[Symbol.toPrimitive]==="function"){return Buffer.from(value[Symbol.toPrimitive]("string"),encodingOrOffset,length)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, "+"or Array-like Object. Received type "+typeof value)}Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)};Object.setPrototypeOf(Buffer.prototype,Uint8Array.prototype);Object.setPrototypeOf(Buffer,Uint8Array);function assertSize(size){if(typeof size!=="number"){throw new TypeError('"size" argument must be of type number')}else if(size<0){throw new RangeError('The value "'+size+'" is invalid for option "size"')}}function alloc(size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(size)}if(fill!==undefined){return typeof encoding==="string"?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill)}return createBuffer(size)}Buffer.alloc=function(size,fill,encoding){return alloc(size,fill,encoding)};function allocUnsafe(size){assertSize(size);return createBuffer(size<0?0:checked(size)|0)}Buffer.allocUnsafe=function(size){return allocUnsafe(size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)};function fromString(string,encoding){if(typeof encoding!=="string"||encoding===""){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}var length=byteLength(string,encoding)|0;var buf=createBuffer(length);var actual=buf.write(string,encoding);if(actual!==length){buf=buf.slice(0,actual)}return buf}function fromArrayLike(array){var length=array.length<0?0:checked(array.length)|0;var buf=createBuffer(length);for(var i=0;i<length;i+=1){buf[i]=array[i]&255}return buf}function fromArrayBuffer(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError('"offset" is outside of buffer bounds')}if(array.byteLength<byteOffset+(length||0)){throw new RangeError('"length" is outside of buffer bounds')}var buf;if(byteOffset===undefined&&length===undefined){buf=new Uint8Array(array)}else if(length===undefined){buf=new Uint8Array(array,byteOffset)}else{buf=new Uint8Array(array,byteOffset,length)}Object.setPrototypeOf(buf,Buffer.prototype);return buf}function fromObject(obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|0;var buf=createBuffer(len);if(buf.length===0){return buf}obj.copy(buf,0,0,len);return buf}if(obj.length!==undefined){if(typeof obj.length!=="number"||numberIsNaN(obj.length)){return createBuffer(0)}return fromArrayLike(obj)}if(obj.type==="Buffer"&&Array.isArray(obj.data)){return fromArrayLike(obj.data)}}function checked(length){if(length>=K_MAX_LENGTH){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+K_MAX_LENGTH.toString(16)+" bytes")}return length|0}function SlowBuffer(length){if(+length!=length){length=0}return Buffer.alloc(+length)}Buffer.isBuffer=function isBuffer(b){return b!=null&&b._isBuffer===true&&b!==Buffer.prototype};Buffer.compare=function compare(a,b){if(isInstance(a,Uint8Array))a=Buffer.from(a,a.offset,a.byteLength);if(isInstance(b,Uint8Array))b=Buffer.from(b,b.offset,b.byteLength);if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array')}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!Array.isArray(list)){throw new TypeError('"list" argument must be an Array of Buffers')}if(list.length===0){return Buffer.alloc(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(isInstance(buf,Uint8Array)){buf=Buffer.from(buf)}if(!Buffer.isBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers')}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}if(ArrayBuffer.isView(string)||isInstance(string,ArrayBuffer)){return string.byteLength}if(typeof string!=="string"){throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. '+"Received type "+typeof string)}var len=string.length;var mustMatch=arguments.length>2&&arguments[2]===true;if(!mustMatch&&len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase){return mustMatch?-1:utf8ToBytes(string).length}encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0){start=0}if(start>this.length){return""}if(end===undefined||end>this.length){end=this.length}if(end<=0){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4)}return this};Buffer.prototype.toString=function toString(){var length=this.length;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.toLocaleString=Buffer.prototype.toString;Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;str=this.toString("hex",0,max).replace(/(.{2})/g,"$1 ").trim();if(this.length>max)str+=" ... ";return"<Buffer "+str+">"};if(customInspectSymbol){Buffer.prototype[customInspectSymbol]=Buffer.prototype.inspect}Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(isInstance(target,Uint8Array)){target=Buffer.from(target,target.offset,target.byteLength)}if(!Buffer.isBuffer(target)){throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. '+"Received type "+typeof target)}if(start===undefined){start=0}if(end===undefined){end=target?target.length:0}if(thisStart===undefined){thisStart=0}if(thisEnd===undefined){thisEnd=this.length}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1;if(typeof byteOffset==="string"){encoding=byteOffset;byteOffset=0}else if(byteOffset>2147483647){byteOffset=2147483647}else if(byteOffset<-2147483648){byteOffset=-2147483648}byteOffset=+byteOffset;if(numberIsNaN(byteOffset)){byteOffset=dir?0:buffer.length-1}if(byteOffset<0)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1}else if(byteOffset<0){if(dir)byteOffset=0;else return-1}if(typeof val==="string"){val=Buffer.from(val,encoding)}if(Buffer.isBuffer(val)){if(val.length===0){return-1}return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if(typeof val==="number"){val=val&255;if(typeof Uint8Array.prototype.indexOf==="function"){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(indexSize===1){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;i>=0;i--){var found=true;for(var j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=false;break}}if(found)return i}}return-1}Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,true)};Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(length>strLen/2){length=strLen/2}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset>>>0;if(isFinite(length)){length=length>>>0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&127)}return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;++i){out+=hexSliceLookupTable[buf[i]]}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf=this.subarray(start,end);Object.setPrototypeOf(newBuf,Buffer.prototype);return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,255,0);this[offset]=value&255;return offset+1};Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255;return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24;return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!Buffer.isBuffer(target))throw new TypeError("argument should be a Buffer");if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("Index out of range");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;if(this===target&&typeof Uint8Array.prototype.copyWithin==="function"){this.copyWithin(targetStart,start,end)}else if(this===target&&start<targetStart&&targetStart<end){for(var i=len-1;i>=0;--i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,end),targetStart)}return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(encoding!==undefined&&typeof encoding!=="string"){throw new TypeError("encoding must be a string")}if(typeof encoding==="string"&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}if(val.length===1){var code=val.charCodeAt(0);if(encoding==="utf8"&&code<128||encoding==="latin1"){val=code}}}else if(typeof val==="number"){val=val&255}else if(typeof val==="boolean"){val=Number(val)}if(start<0||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if(typeof val==="number"){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:Buffer.from(val,encoding);var len=bytes.length;if(len===0){throw new TypeError('The value "'+val+'" is invalid for argument "value"')}for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function base64clean(str){str=str.split("=")[0];str=str.trim().replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isInstance(obj,type){return obj instanceof type||obj!=null&&obj.constructor!=null&&obj.constructor.name!=null&&obj.constructor.name===type.name}function numberIsNaN(obj){return obj!==obj}var hexSliceLookupTable=function(){var alphabet="0123456789abcdef";var table=new Array(256);for(var i=0;i<16;++i){var i16=i*16;for(var j=0;j<16;++j){table[i16+j]=alphabet[i]+alphabet[j]}}return table}()}).call(this,require("buffer").Buffer)},{"base64-js":25,buffer:28,ieee754:42}],29:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var signals_1=require("@gamestdio/signals");var msgpack=require("./msgpack");var Connection_1=require("./Connection");var Protocol_1=require("./Protocol");var Room_1=require("./Room");var Storage_1=require("./Storage");var Client=function(){function Client(url,options){if(options===void 0){options={}}var _this=this;this.onOpen=new signals_1.Signal;this.onMessage=new signals_1.Signal;this.onClose=new signals_1.Signal;this.onError=new signals_1.Signal;this.rooms={};this.connectingRooms={};this.requestId=0;this.roomsAvailableRequests={};this.hostname=url;Storage_1.getItem("colyseusid",function(colyseusid){return _this.connect(colyseusid,options)})}Client.prototype.join=function(roomName,options){if(options===void 0){options={}}return this.createRoomRequest(roomName,options)};Client.prototype.rejoin=function(roomName,sessionId){return this.join(roomName,{sessionId:sessionId})};Client.prototype.getAvailableRooms=function(roomName,callback){var _this=this;var requestId=++this.requestId;var removeRequest=function(){return delete _this.roomsAvailableRequests[requestId]};var rejectionTimeout=setTimeout(function(){removeRequest();callback([],"timeout")},1e4);this.connection.send([Protocol_1.Protocol.ROOM_LIST,requestId,roomName]);this.roomsAvailableRequests[requestId]=function(roomsAvailable){removeRequest();clearTimeout(rejectionTimeout);callback(roomsAvailable)}};Client.prototype.close=function(){this.connection.close()};Client.prototype.createRoom=function(roomName,options){if(options===void 0){options={}}return new Room_1.Room(roomName,options)};Client.prototype.createRoomRequest=function(roomName,options,reuseRoomInstance,retryCount){var _this=this;options.requestId=++this.requestId;var room=reuseRoomInstance||this.createRoom(roomName,options);room.onLeave.addOnce(function(){delete _this.rooms[room.id];delete _this.connectingRooms[options.requestId]});if(options.retryTimes){room.onError.addOnce(function(){retryCount=retryCount||0;if(!room.hasJoined&&retryCount<=options.retryTimes){retryCount++;_this.createRoomRequest(roomName,options,room,retryCount)}})}this.connectingRooms[options.requestId]=room;this.connection.send([Protocol_1.Protocol.JOIN_ROOM,roomName,options]);return room};Client.prototype.connect=function(colyseusid,options){var _this=this;if(options===void 0){options={}}this.id=colyseusid||"";this.connection=new Connection_1.Connection(this.buildEndpoint("",options));this.connection.onmessage=this.onMessageCallback.bind(this);this.connection.onclose=function(e){return _this.onClose.dispatch(e)};this.connection.onerror=function(e){return _this.onError.dispatch(e)};this.connection.onopen=function(){if(_this.id){_this.onOpen.dispatch()}}};Client.prototype.buildEndpoint=function(path,options){if(path===void 0){path=""}if(options===void 0){options={}}var params=["colyseusid="+this.id];for(var name_1 in options){if(!options.hasOwnProperty(name_1)){continue}params.push(name_1+"="+options[name_1])}return this.hostname+"/"+path+"?"+params.join("&")};Client.prototype.onMessageCallback=function(event){var message=msgpack.decode(new Uint8Array(event.data));var code=message[0];if(code===Protocol_1.Protocol.USER_ID){Storage_1.setItem("colyseusid",message[1]);this.id=message[1];this.onOpen.dispatch()}else if(code===Protocol_1.Protocol.JOIN_ROOM){var requestId=message[2];var room=this.connectingRooms[requestId];if(!room){console.warn("colyseus.js: client left room before receiving session id.");return}room.id=message[1];this.rooms[room.id]=room;room.connect(this.buildEndpoint(room.id,room.options));delete this.connectingRooms[requestId]}else if(code===Protocol_1.Protocol.JOIN_ERROR){console.error("colyseus.js: server error:",message[2]);this.onError.dispatch(message[2])}else if(code===Protocol_1.Protocol.ROOM_LIST){if(this.roomsAvailableRequests[message[1]]){this.roomsAvailableRequests[message[1]](message[2])}else{console.warn("receiving ROOM_LIST after timeout:",message[2])}}else{this.onMessage.dispatch(message)}};return Client}();exports.Client=Client},{"./Connection":30,"./Protocol":31,"./Room":32,"./Storage":33,"./msgpack":36,"@gamestdio/signals":19}],30:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var websocket_1=require("@gamestdio/websocket");var msgpack=require("./msgpack");var Connection=function(_super){__extends(Connection,_super);function Connection(url,autoConnect){if(autoConnect===void 0){autoConnect=true}var _this=_super.call(this,url,undefined,{connect:autoConnect})||this;_this._enqueuedCalls=[];return _this}Connection.prototype.onOpenCallback=function(event){_super.prototype.onOpenCallback.call(this);this.binaryType="arraybuffer";if(this._enqueuedCalls.length>0){for(var _i=0,_a=this._enqueuedCalls;_i<_a.length;_i++){var _b=_a[_i],method=_b[0],args=_b[1];this[method].apply(this,args)}this._enqueuedCalls=[]}};Connection.prototype.send=function(data){if(this.ws.readyState===websocket_1.default.OPEN){return _super.prototype.send.call(this,msgpack.encode(data))}else{this._enqueuedCalls.push(["send",[data]])}};return Connection}(websocket_1.default);exports.Connection=Connection},{"./msgpack":36,"@gamestdio/websocket":24}],31:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Protocol;(function(Protocol){Protocol[Protocol["USER_ID"]=1]="USER_ID";Protocol[Protocol["JOIN_ROOM"]=10]="JOIN_ROOM";Protocol[Protocol["JOIN_ERROR"]=11]="JOIN_ERROR";Protocol[Protocol["LEAVE_ROOM"]=12]="LEAVE_ROOM";Protocol[Protocol["ROOM_DATA"]=13]="ROOM_DATA";Protocol[Protocol["ROOM_STATE"]=14]="ROOM_STATE";Protocol[Protocol["ROOM_STATE_PATCH"]=15]="ROOM_STATE_PATCH";Protocol[Protocol["ROOM_LIST"]=20]="ROOM_LIST";Protocol[Protocol["BAD_REQUEST"]=50]="BAD_REQUEST"})(Protocol=exports.Protocol||(exports.Protocol={}))},{}],32:[function(require,module,exports){(function(Buffer){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var Clock=require("@gamestdio/clock");var signals_1=require("@gamestdio/signals");var state_listener_1=require("@gamestdio/state-listener");var fossilDelta=require("fossil-delta");var msgpack=require("./msgpack");var Connection_1=require("./Connection");var Protocol_1=require("./Protocol");var Room=function(_super){__extends(Room,_super);function Room(name,options){var _this=_super.call(this,{})||this;_this.clock=new Clock;_this.remoteClock=new Clock;_this.onJoin=new signals_1.Signal;_this.onStateChange=new signals_1.Signal;_this.onMessage=new signals_1.Signal;_this.onError=new signals_1.Signal;_this.onLeave=new signals_1.Signal;_this.id=null;_this.name=name;_this.options=options;_this.connection=new Connection_1.Connection(undefined,false);_this.onLeave.add(function(){return _this.removeAllListeners()});return _this}Room.prototype.connect=function(endpoint){var _this=this;this.connection.url=endpoint;this.connection.reconnectEnabled=false;this.connection.onmessage=this.onMessageCallback.bind(this);this.connection.onclose=function(e){return _this.onLeave.dispatch(e)};this.connection.onerror=function(e){console.warn("Possible causes: room's onAuth() failed or maxClients has been reached.");_this.onError.dispatch(e)};this.connection.open()};Room.prototype.leave=function(){if(this.connection){this.connection.send([Protocol_1.Protocol.LEAVE_ROOM])}else{this.onLeave.dispatch()}};Room.prototype.send=function(data){this.connection.send([Protocol_1.Protocol.ROOM_DATA,this.id,data])};Object.defineProperty(Room.prototype,"hasJoined",{get:function(){return this.sessionId!==undefined},enumerable:true,configurable:true});Room.prototype.removeAllListeners=function(){_super.prototype.removeAllListeners.call(this);this.onJoin.removeAll();this.onStateChange.removeAll();this.onMessage.removeAll();this.onError.removeAll();this.onLeave.removeAll()};Room.prototype.onMessageCallback=function(event){var message=msgpack.decode(new Uint8Array(event.data));var code=message[0];if(code===Protocol_1.Protocol.JOIN_ROOM){this.sessionId=message[1];this.onJoin.dispatch()}else if(code===Protocol_1.Protocol.JOIN_ERROR){console.error("Error: "+message[1]);this.onError.dispatch(message[1])}else if(code===Protocol_1.Protocol.ROOM_STATE){var state=message[1];var remoteCurrentTime=message[2];var remoteElapsedTime=message[3];this.setState(state,remoteCurrentTime,remoteElapsedTime)}else if(code===Protocol_1.Protocol.ROOM_STATE_PATCH){this.patch(message[1])}else if(code===Protocol_1.Protocol.ROOM_DATA){this.onMessage.dispatch(message[1])}else if(code===Protocol_1.Protocol.LEAVE_ROOM){this.leave()}};Room.prototype.setState=function(encodedState,remoteCurrentTime,remoteElapsedTime){var state=msgpack.decode(encodedState);this.set(state);this._previousState=new Uint8Array(encodedState);if(remoteCurrentTime&&remoteElapsedTime){this.remoteClock.currentTime=remoteCurrentTime;this.remoteClock.elapsedTime=remoteElapsedTime}this.clock.start();this.onStateChange.dispatch(state)};Room.prototype.patch=function(binaryPatch){this._previousState=Buffer.from(fossilDelta.apply(this._previousState,binaryPatch));this.set(msgpack.decode(this._previousState));this.onStateChange.dispatch(this.state)};return Room}(state_listener_1.StateContainer);exports.Room=Room}).call(this,require("buffer").Buffer)},{"./Connection":30,"./Protocol":31,"./msgpack":36,"@gamestdio/clock":14,"@gamestdio/signals":19,"@gamestdio/state-listener":22,buffer:28,"fossil-delta":40}],33:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var storage;function getStorage(){if(!storage){storage=typeof cc!=="undefined"&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:typeof window!=="undefined"?window.localStorage:{cache:{},setItem:function(key,value){this.cache[key]=value},getItem:function(key){this.cache[key]}}}return storage}function setItem(key,value){getStorage().setItem(key,value)}exports.setItem=setItem;function getItem(key,callback){var value=getStorage().getItem(key);if(typeof Promise==="undefined"||!(value instanceof Promise)){callback(value)}else{value.then(function(id){return callback(id)})}}exports.getItem=getItem},{}],34:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});require("./legacy");var Client_1=require("./Client");exports.Client=Client_1.Client;var Protocol_1=require("./Protocol");exports.Protocol=Protocol_1.Protocol;var Room_1=require("./Room");exports.Room=Room_1.Room;var helpers_1=require("./sync/helpers");exports.initializeSync=helpers_1.initializeSync;exports.sync=helpers_1.sync;exports.syncMap=helpers_1.syncMap;exports.syncObject=helpers_1.syncObject;exports.syncVar=helpers_1.syncVar;exports.syncList=helpers_1.syncList;exports.key=helpers_1.key;exports.room=helpers_1.room;exports.listen=helpers_1.listen},{"./Client":29,"./Protocol":31,"./Room":32,"./legacy":35,"./sync/helpers":37}],35:[function(require,module,exports){if(!ArrayBuffer.isView){ArrayBuffer.isView=function(a){return a!==null&&typeof a==="object"&&a.buffer instanceof ArrayBuffer}}},{}],36:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var msgpackDecode=require("notepack.io/browser/decode");var msgpackEncode=require("notepack.io/browser/encode");exports.decode=msgpackDecode;exports.encode=msgpackEncode},{"notepack.io/browser/decode":45,"notepack.io/browser/encode":46}],37:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var listeners=require("./listeners");function initializeSync(roomInstance,synchable){createBindings(roomInstance,synchable,synchable)}exports.initializeSync=initializeSync;function syncMap(type,addCallback,removeCallback){return sync(type,"map",addCallback,removeCallback)}exports.syncMap=syncMap;function syncObject(type,addCallback,removeCallback){return sync(type,"object",addCallback,removeCallback)}exports.syncObject=syncObject;function syncVar(type,addCallback,removeCallback){return sync(type,"var")}exports.syncVar=syncVar;function syncList(type,addCallback,removeCallback){return sync(type,"list",addCallback,removeCallback)}exports.syncList=syncList;function key(){return sync(undefined,"key")}exports.key=key;function room(){return function(proto,attr){Object.defineProperty(proto,attr,{configurable:true,enumerable:true,get:function(){return proto.constructor.$room}})}}exports.room=room;function sync(type,holderType,addCallback,removeCallback){if(holderType===void 0){holderType="var"}return function(target,propertyKey){if(!target.constructor.properties){target.constructor.properties={}}var variable=propertyKey;if(typeof type==="string"){variable=propertyKey;propertyKey=type;type=undefined}target.constructor.properties[propertyKey]={addCallback:addCallback,holderType:holderType,removeCallback:removeCallback,type:type,variable:variable}}}exports.sync=sync;function listen(path,op){return function(target,methodName,descriptor){if(!target.constructor.listeners){target.constructor.listeners={}}target.constructor.listeners[path]={methodName:methodName,op:op}}}exports.listen=listen;var listenersMap={};function createBindings(roomInstance,synchable,synchableRoot,parentSegment){bindProperties(synchable.constructor.properties||synchable.properties,roomInstance,synchable,synchableRoot,parentSegment);bindListeners(synchable.constructor.listeners,roomInstance,synchable)}exports.createBindings=createBindings;function bindProperties(properties,roomInstance,synchable,synchableRoot,parentSegment){if(!properties){return}Object.defineProperty(synchable,"$room",{configurable:true,enumerable:false,value:roomInstance,writable:true});synchable.$room=roomInstance;for(var segment in properties){if(!properties.hasOwnProperty(segment)){continue}var property=properties[segment];var path=parentSegment?parentSegment+"/"+segment:segment;if(property.holderType==="map"){path+="/:id"}if(listenersMap[path]){return}else{listenersMap[path]=true}var listener=listeners[property.holderType+"Listener"];if(listener){roomInstance.listen(path,listener(roomInstance,property,synchable,synchableRoot,path));if(property.type){createBindings(roomInstance,property.type,synchable,path)}}}}function bindListeners(listenersToBind,roomInstance,synchable){if(!listenersToBind){return}var _loop_1=function(path){if(!listenersToBind.hasOwnProperty(path)){return"continue"}var listener=listenersToBind[path];var callback=listener.op?function(change){if(change.operation===listener.op){synchable[listener.methodName](change)}}:synchable[listener.methodName].bind(synchable);roomInstance.listen(path,callback)};for(var path in listenersToBind){_loop_1(path)}}exports.bindListeners=bindListeners},{"./listeners":38}],38:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var helpers_1=require("./helpers");function assign(instance,property,propName,value,key){if(property.holderType==="var"){instance[propName]=value}else if(property.holderType==="key"){instance[propName]=key}}function assignMultiple(instance,properties,value,key){for(var prop in properties){if(!properties.hasOwnProperty(prop)){continue}assign(instance,properties[prop],prop,value[prop],key)}}function getInstanceContainer(root,path,offset){if(offset===void 0){offset=0}var instance=root;for(var i=0,len=path.length;i<len+offset;i++){if(typeof instance[path[i]]!=="object"){break}instance=instance[path[i]]}return instance}function objectListener(room,property,synchable,synchableRoot,parentSegment){return function(change){if(change.operation==="add"){var newType=new property.type;for(var prop in change.value){if(!change.value.hasOwnProperty(prop)){continue}newType[prop]=change.value[prop]}helpers_1.bindListeners(property.type.listeners,room,newType);synchable[property.variable]=newType;if(property.addCallback){property.addCallback.call(synchableRoot,synchableRoot,newType,change)}}else if(change.operation==="replace"){synchableRoot[this.rawRules[0]][property.variable]=change.value}else if(change.operation==="remove"){if(property.removeCallback){property.removeCallback.call(synchableRoot,synchableRoot,synchable[property.variable][change.path.id],change)}delete synchable[property.variable]}}}exports.objectListener=objectListener;function mapListener(room,property,synchable,synchableRoot,parentSegment){return function(change){var instance=getInstanceContainer(synchableRoot,change.rawPath);if(change.operation==="add"){var newType=new property.type;Object.defineProperty(newType,"__mapParent",{configurable:true,enumerable:false,value:getInstanceContainer(synchableRoot,change.rawPath,-2),writable:true});helpers_1.bindListeners(property.type.listeners,room,newType);instance[change.path.id]=newType;assignMultiple(newType,property.type.properties,change.value,change.path.id);if(property.addCallback){property.addCallback.call(newType.__mapParent,newType.__mapParent,newType,change)}}else if(change.operation==="replace"){assign(instance,property,property.variable,change.value)}else if(change.operation==="remove"){if(property.removeCallback){property.removeCallback.call(instance.__mapParent,instance.__mapParent,instance,change)}delete synchable[property.variable][change.path.id]}}}exports.mapListener=mapListener;function varListener(room,property,synchable,synchableRoot,parentSegment){return function(change){var target=getInstanceContainer(synchableRoot,change.rawPath);if(change.operation!=="remove"){assign(target,property,property.variable,change.value)}else if(change.operation==="remove"){delete target[property.variable]}}}exports.varListener=varListener},{"./helpers":37}],39:[function(require,module,exports){"use strict";module.exports=earcut;module.exports.default=earcut;function earcut(data,holeIndices,dim){dim=dim||2;var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,true),triangles=[];if(!outerNode||outerNode.next===outerNode.prev)return triangles;var minX,minY,maxX,maxY,x,y,invSize;if(hasHoles)outerNode=eliminateHoles(data,holeIndices,outerNode,dim);if(data.length>80*dim){minX=maxX=data[0];minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim){x=data[i];y=data[i+1];if(x<minX)minX=x;if(y<minY)minY=y;if(x>maxX)maxX=x;if(y>maxY)maxY=y}invSize=Math.max(maxX-minX,maxY-minY);invSize=invSize!==0?1/invSize:0}earcutLinked(outerNode,triangles,dim,minX,minY,invSize);return triangles}function linkedList(data,start,end,dim,clockwise){var i,last;if(clockwise===signedArea(data,start,end,dim)>0){for(i=start;i<end;i+=dim)last=insertNode(i,data[i],data[i+1],last)}else{for(i=end-dim;i>=start;i-=dim)last=insertNode(i,data[i],data[i+1],last)}if(last&&equals(last,last.next)){removeNode(last);last=last.next}return last}function filterPoints(start,end){if(!start)return start;if(!end)end=start;var p=start,again;do{again=false;if(!p.steiner&&(equals(p,p.next)||area(p.prev,p,p.next)===0)){removeNode(p);p=end=p.prev;if(p===p.next)break;again=true}else{p=p.next}}while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,invSize,pass){if(!ear)return;if(!pass&&invSize)indexCurve(ear,minX,minY,invSize);var stop=ear,prev,next;while(ear.prev!==ear.next){prev=ear.prev;next=ear.next;if(invSize?isEarHashed(ear,minX,minY,invSize):isEar(ear)){triangles.push(prev.i/dim);triangles.push(ear.i/dim);triangles.push(next.i/dim);removeNode(ear);ear=next.next;stop=next.next;continue}ear=next;if(ear===stop){if(!pass){earcutLinked(filterPoints(ear),triangles,dim,minX,minY,invSize,1)}else if(pass===1){ear=cureLocalIntersections(filterPoints(ear),triangles,dim);earcutLinked(ear,triangles,dim,minX,minY,invSize,2)}else if(pass===2){splitEarcut(ear,triangles,dim,minX,minY,invSize)}break}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return false;var p=ear.next.next;while(p!==ear.prev){if(pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.next}return true}function isEarHashed(ear,minX,minY,invSize){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return false;var minTX=a.x<b.x?a.x<c.x?a.x:c.x:b.x<c.x?b.x:c.x,minTY=a.y<b.y?a.y<c.y?a.y:c.y:b.y<c.y?b.y:c.y,maxTX=a.x>b.x?a.x>c.x?a.x:c.x:b.x>c.x?b.x:c.x,maxTY=a.y>b.y?a.y>c.y?a.y:c.y:b.y>c.y?b.y:c.y;var minZ=zOrder(minTX,minTY,minX,minY,invSize),maxZ=zOrder(maxTX,maxTY,minX,minY,invSize);var p=ear.prevZ,n=ear.nextZ;while(p&&p.z>=minZ&&n&&n.z<=maxZ){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.prevZ;if(n!==ear.prev&&n!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,n.x,n.y)&&area(n.prev,n,n.next)>=0)return false;n=n.nextZ}while(p&&p.z>=minZ){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.prevZ}while(n&&n.z<=maxZ){if(n!==ear.prev&&n!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,n.x,n.y)&&area(n.prev,n,n.next)>=0)return false;n=n.nextZ}return true}function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;if(!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)){triangles.push(a.i/dim);triangles.push(p.i/dim);triangles.push(b.i/dim);removeNode(p);removeNode(p.next);p=start=b}p=p.next}while(p!==start);return filterPoints(p)}function splitEarcut(start,triangles,dim,minX,minY,invSize){var a=start;do{var b=a.next.next;while(b!==a.prev){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);a=filterPoints(a,a.next);c=filterPoints(c,c.next);earcutLinked(a,triangles,dim,minX,minY,invSize);earcutLinked(c,triangles,dim,minX,minY,invSize);return}b=b.next}a=a.next}while(a!==start)}function eliminateHoles(data,holeIndices,outerNode,dim){var queue=[],i,len,start,end,list;for(i=0,len=holeIndices.length;i<len;i++){start=holeIndices[i]*dim;end=i<len-1?holeIndices[i+1]*dim:data.length;list=linkedList(data,start,end,dim,false);if(list===list.next)list.steiner=true;queue.push(getLeftmost(list))}queue.sort(compareX);for(i=0;i<queue.length;i++){eliminateHole(queue[i],outerNode);outerNode=filterPoints(outerNode,outerNode.next)}return outerNode}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){outerNode=findHoleBridge(hole,outerNode);if(outerNode){var b=splitPolygon(outerNode,hole);filterPoints(b,b.next)}}function findHoleBridge(hole,outerNode){var p=outerNode,hx=hole.x,hy=hole.y,qx=-Infinity,m;do{if(hy<=p.y&&hy>=p.next.y&&p.next.y!==p.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx){qx=x;if(x===hx){if(hy===p.y)return p;if(hy===p.next.y)return p.next}m=p.x<p.next.x?p:p.next}}p=p.next}while(p!==outerNode);if(!m)return null;if(hx===qx)return m;var stop=m,mx=m.x,my=m.y,tanMin=Infinity,tan;p=m;do{if(hx>=p.x&&p.x>=mx&&hx!==p.x&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)){tan=Math.abs(hy-p.y)/(hx-p.x);if(locallyInside(p,hole)&&(tan<tanMin||tan===tanMin&&(p.x>m.x||p.x===m.x&&sectorContainsSector(m,p)))){m=p;tanMin=tan}}p=p.next}while(p!==stop);return m}function sectorContainsSector(m,p){return area(m.prev,m,p.prev)<0&&area(p.next,m,m.next)<0}function indexCurve(start,minX,minY,invSize){var p=start;do{if(p.z===null)p.z=zOrder(p.x,p.y,minX,minY,invSize);p.prevZ=p.prev;p.nextZ=p.next;p=p.next}while(p!==start);p.prevZ.nextZ=null;p.prevZ=null;sortLinked(p)}function sortLinked(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{p=list;list=null;tail=null;numMerges=0;while(p){numMerges++;q=p;pSize=0;for(i=0;i<inSize;i++){pSize++;q=q.nextZ;if(!q)break}qSize=inSize;while(pSize>0||qSize>0&&q){if(pSize!==0&&(qSize===0||!q||p.z<=q.z)){e=p;p=p.nextZ;pSize--}else{e=q;q=q.nextZ;qSize--}if(tail)tail.nextZ=e;else list=e;e.prevZ=tail;tail=e}p=q}tail.nextZ=null;inSize*=2}while(numMerges>1);return list}function zOrder(x,y,minX,minY,invSize){x=32767*(x-minX)*invSize;y=32767*(y-minY)*invSize;x=(x|x<<8)&16711935;x=(x|x<<4)&252645135;x=(x|x<<2)&858993459;x=(x|x<<1)&1431655765;y=(y|y<<8)&16711935;y=(y|y<<4)&252645135;y=(y|y<<2)&858993459;y=(y|y<<1)&1431655765;return x|y<<1}function getLeftmost(start){var p=start,leftmost=start;do{if(p.x<leftmost.x||p.x===leftmost.x&&p.y<leftmost.y)leftmost=p;p=p.next}while(p!==start);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)-(ax-px)*(cy-py)>=0&&(ax-px)*(by-py)-(bx-px)*(ay-py)>=0&&(bx-px)*(cy-py)-(cx-px)*(by-py)>=0}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!intersectsPolygon(a,b)&&(locallyInside(a,b)&&locallyInside(b,a)&&middleInside(a,b)&&(area(a.prev,a,b.prev)||area(a,b.prev,b))||equals(a,b)&&area(a.prev,a,a.next)>0&&area(b.prev,b,b.next)>0)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects(p1,q1,p2,q2){var o1=sign(area(p1,q1,p2));var o2=sign(area(p1,q1,q2));var o3=sign(area(p2,q2,p1));var o4=sign(area(p2,q2,q1));if(o1!==o2&&o3!==o4)return true;if(o1===0&&onSegment(p1,p2,q1))return true;if(o2===0&&onSegment(p1,q2,q1))return true;if(o3===0&&onSegment(p2,p1,q2))return true;if(o4===0&&onSegment(p2,q1,q2))return true;return false}function onSegment(p,q,r){return q.x<=Math.max(p.x,r.x)&&q.x>=Math.min(p.x,r.x)&&q.y<=Math.max(p.y,r.y)&&q.y>=Math.min(p.y,r.y)}function sign(num){return num>0?1:num<0?-1:0}function intersectsPolygon(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return true;p=p.next}while(p!==a);return false}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function middleInside(a,b){var p=a,inside=false,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{if(p.y>py!==p.next.y>py&&p.next.y!==p.y&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x)inside=!inside;p=p.next}while(p!==a);return inside}function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;a.next=b;b.prev=a;a2.next=an;an.prev=a2;b2.next=a2;a2.prev=b2;bp.next=b2;b2.prev=bp;return b2}function insertNode(i,x,y,last){var p=new Node(i,x,y);if(!last){p.prev=p;p.next=p}else{p.next=last.next;p.prev=last;last.next.prev=p;last.next=p}return p}function removeNode(p){p.next.prev=p.prev;p.prev.next=p.next;if(p.prevZ)p.prevZ.nextZ=p.nextZ;if(p.nextZ)p.nextZ.prevZ=p.prevZ}function Node(i,x,y){this.i=i;this.x=x;this.y=y;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=false}earcut.deviation=function(data,holeIndices,dim,triangles){var hasHoles=holeIndices&&holeIndices.length;var outerLen=hasHoles?holeIndices[0]*dim:data.length;var polygonArea=Math.abs(signedArea(data,0,outerLen,dim));if(hasHoles){for(var i=0,len=holeIndices.length;i<len;i++){var start=holeIndices[i]*dim;var end=i<len-1?holeIndices[i+1]*dim:data.length;polygonArea-=Math.abs(signedArea(data,start,end,dim))}}var trianglesArea=0;for(i=0;i<triangles.length;i+=3){var a=triangles[i]*dim;var b=triangles[i+1]*dim;var c=triangles[i+2]*dim;trianglesArea+=Math.abs((data[a]-data[c])*(data[b+1]-data[a+1])-(data[a]-data[b])*(data[c+1]-data[a+1]))}return polygonArea===0&&trianglesArea===0?0:Math.abs((trianglesArea-polygonArea)/polygonArea)};function signedArea(data,start,end,dim){var sum=0;for(var i=start,j=end-dim;i<end;i+=dim){sum+=(data[j]-data[i])*(data[i+1]+data[j+1]);j=i}return sum}earcut.flatten=function(data){var dim=data[0][0].length,result={vertices:[],holes:[],dimensions:dim},holeIndex=0;for(var i=0;i<data.length;i++){for(var j=0;j<data[i].length;j++){for(var d=0;d<dim;d++)result.vertices.push(data[i][j][d])}if(i>0){holeIndex+=data[i-1].length;result.holes.push(holeIndex)}}return result}},{}],40:[function(require,module,exports){(function(root,factory){if(typeof module!=="undefined"&&module.exports)module.exports=factory();else root.fossilDelta=factory()})(this,function(){"use strict";var fossilDelta={};var NHASH=16;function RollingHash(){this.a=0;this.b=0;this.i=0;this.z=new Array(NHASH)}RollingHash.prototype.init=function(z,pos){var a=0,b=0,i,x;for(i=0;i<NHASH;i++){x=z[pos+i];a=a+x&65535;b=b+(NHASH-i)*x&65535;this.z[i]=x}this.a=a&65535;this.b=b&65535;this.i=0};RollingHash.prototype.next=function(c){var old=this.z[this.i];this.z[this.i]=c;this.i=this.i+1&NHASH-1;this.a=this.a-old+c&65535;this.b=this.b-NHASH*old+this.a&65535};RollingHash.prototype.value=function(){return(this.a&65535|(this.b&65535)<<16)>>>0};var zDigits="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~".split("").map(function(x){return x.charCodeAt(0)});var zValue=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,36,-1,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,-1,-1,-1,63,-1];function Reader(array){this.a=array;this.pos=0}Reader.prototype.haveBytes=function(){return this.pos<this.a.length};Reader.prototype.getByte=function(){var b=this.a[this.pos];this.pos++;if(this.pos>this.a.length)throw new RangeError("out of bounds");return b};Reader.prototype.getChar=function(){return String.fromCharCode(this.getByte())};Reader.prototype.getInt=function(){var v=0,c;while(this.haveBytes()&&(c=zValue[127&this.getByte()])>=0){v=(v<<6)+c}this.pos--;return v>>>0};function Writer(){this.a=[]}Writer.prototype.toArray=function(){return this.a};Writer.prototype.putByte=function(b){this.a.push(b&255)};Writer.prototype.putChar=function(s){this.putByte(s.charCodeAt(0))};Writer.prototype.putInt=function(v){var i,j,zBuf=[];if(v===0){this.putChar("0");return}for(i=0;v>0;i++,v>>>=6)zBuf.push(zDigits[v&63]);for(j=i-1;j>=0;j--)this.putByte(zBuf[j])};Writer.prototype.putArray=function(a,start,end){for(var i=start;i<end;i++)this.a.push(a[i])};function digitCount(v){var i,x;for(i=1,x=64;v>=x;i++,x<<=6){}return i}function checksum(arr){var sum0=0,sum1=0,sum2=0,sum3=0,z=0,N=arr.length;while(N>=16){sum0=sum0+arr[z+0]|0;sum1=sum1+arr[z+1]|0;sum2=sum2+arr[z+2]|0;sum3=sum3+arr[z+3]|0;sum0=sum0+arr[z+4]|0;sum1=sum1+arr[z+5]|0;sum2=sum2+arr[z+6]|0;sum3=sum3+arr[z+7]|0;sum0=sum0+arr[z+8]|0;sum1=sum1+arr[z+9]|0;sum2=sum2+arr[z+10]|0;sum3=sum3+arr[z+11]|0;sum0=sum0+arr[z+12]|0;sum1=sum1+arr[z+13]|0;sum2=sum2+arr[z+14]|0;sum3=sum3+arr[z+15]|0;z+=16;N-=16}while(N>=4){sum0=sum0+arr[z+0]|0;sum1=sum1+arr[z+1]|0;sum2=sum2+arr[z+2]|0;sum3=sum3+arr[z+3]|0;z+=4;N-=4}sum3=((sum3+(sum2<<8)|0)+(sum1<<16)|0)+(sum0<<24)|0;switch(N){case 3:sum3=sum3+(arr[z+2]<<8)|0;case 2:sum3=sum3+(arr[z+1]<<16)|0;case 1:sum3=sum3+(arr[z+0]<<24)|0}return sum3>>>0}fossilDelta.create=function(src,out){var zDelta=new Writer;var lenOut=out.length;var lenSrc=src.length;var i,lastRead=-1;zDelta.putInt(lenOut);zDelta.putChar("\n");if(lenSrc<=NHASH){zDelta.putInt(lenOut);zDelta.putChar(":");zDelta.putArray(out,0,lenOut);zDelta.putInt(checksum(out));zDelta.putChar(";");return zDelta.toArray()}var nHash=Math.ceil(lenSrc/NHASH);var collide=new Array(nHash);var landmark=new Array(nHash);for(i=0;i<collide.length;i++)collide[i]=-1;for(i=0;i<landmark.length;i++)landmark[i]=-1;var hv,h=new RollingHash;for(i=0;i<lenSrc-NHASH;i+=NHASH){h.init(src,i);hv=h.value()%nHash;collide[i/NHASH]=landmark[hv];landmark[hv]=i/NHASH}var base=0;var iSrc,iBlock,bestCnt,bestOfst,bestLitsz;while(base+NHASH<lenOut){bestOfst=0;bestLitsz=0;h.init(out,base);i=0;bestCnt=0;while(1){var limit=250;hv=h.value()%nHash;iBlock=landmark[hv];while(iBlock>=0&&limit-- >0){var cnt,ofst,litsz;var j,k,x,y;var sz;iSrc=iBlock*NHASH;for(j=0,x=iSrc,y=base+i;x<lenSrc&&y<lenOut;j++,x++,y++){if(src[x]!==out[y])break}j--;for(k=1;k<iSrc&&k<=i;k++){if(src[iSrc-k]!==out[base+i-k])break}k--;ofst=iSrc-k;cnt=j+k+1;litsz=i-k;sz=digitCount(i-k)+digitCount(cnt)+digitCount(ofst)+3;if(cnt>=sz&&cnt>bestCnt){bestCnt=cnt;bestOfst=iSrc-k;bestLitsz=litsz}iBlock=collide[iBlock]}if(bestCnt>0){if(bestLitsz>0){zDelta.putInt(bestLitsz);zDelta.putChar(":");zDelta.putArray(out,base,base+bestLitsz);base+=bestLitsz}base+=bestCnt;zDelta.putInt(bestCnt);zDelta.putChar("@");zDelta.putInt(bestOfst);zDelta.putChar(",");if(bestOfst+bestCnt-1>lastRead){lastRead=bestOfst+bestCnt-1}bestCnt=0;break}if(base+i+NHASH>=lenOut){zDelta.putInt(lenOut-base);zDelta.putChar(":");zDelta.putArray(out,base,base+lenOut-base);base=lenOut;break}h.next(out[base+i+NHASH]);i++}}if(base<lenOut){zDelta.putInt(lenOut-base);zDelta.putChar(":");zDelta.putArray(out,base,base+lenOut-base)}zDelta.putInt(checksum(out));zDelta.putChar(";");return zDelta.toArray()};fossilDelta.outputSize=function(delta){var zDelta=new Reader(delta);var size=zDelta.getInt();if(zDelta.getChar()!=="\n")throw new Error("size integer not terminated by '\\n'");return size};fossilDelta.apply=function(src,delta,opts){var limit,total=0;var zDelta=new Reader(delta);var lenSrc=src.length;var lenDelta=delta.length;limit=zDelta.getInt();if(zDelta.getChar()!=="\n")throw new Error("size integer not terminated by '\\n'");var zOut=new Writer;while(zDelta.haveBytes()){var cnt,ofst;cnt=zDelta.getInt();switch(zDelta.getChar()){case"@":ofst=zDelta.getInt();if(zDelta.haveBytes()&&zDelta.getChar()!==",")throw new Error("copy command not terminated by ','");total+=cnt;if(total>limit)throw new Error("copy exceeds output file size");if(ofst+cnt>lenSrc)throw new Error("copy extends past end of input");zOut.putArray(src,ofst,ofst+cnt);break;case":":total+=cnt;if(total>limit)throw new Error("insert command gives an output larger than predicted");if(cnt>lenDelta)throw new Error("insert count exceeds size of delta");zOut.putArray(zDelta.a,zDelta.pos,zDelta.pos+cnt);zDelta.pos+=cnt;break;case";":var out=zOut.toArray();if((!opts||opts.verifyChecksum!==false)&&cnt!==checksum(out))throw new Error("bad checksum");if(total!==limit)throw new Error("generated size does not match predicted size");return out;default:throw new Error("unknown delta operator")}}throw new Error("unterminated delta")};return fossilDelta})},{}],41:[function(require,module,exports){(function(global){(function(){"use strict";var HowlerGlobal=function(){this.init()};HowlerGlobal.prototype={init:function(){var self=this||Howler;self._counter=1e3;self._html5AudioPool=[];self.html5PoolSize=10;self._codecs={};self._howls=[];self._muted=false;self._volume=1;self._canPlayEvent="canplaythrough";self._navigator=typeof window!=="undefined"&&window.navigator?window.navigator:null;self.masterGain=null;self.noAudio=false;self.usingWebAudio=true;self.autoSuspend=true;self.ctx=null;self.autoUnlock=true;self._setup();return self},volume:function(vol){var self=this||Howler;vol=parseFloat(vol);if(!self.ctx){setupAudioContext()}if(typeof vol!=="undefined"&&vol>=0&&vol<=1){self._volume=vol;if(self._muted){return self}if(self.usingWebAudio){self.masterGain.gain.setValueAtTime(vol,Howler.ctx.currentTime)}for(var i=0;i<self._howls.length;i++){if(!self._howls[i]._webAudio){var ids=self._howls[i]._getSoundIds();for(var j=0;j<ids.length;j++){var sound=self._howls[i]._soundById(ids[j]);if(sound&&sound._node){sound._node.volume=sound._volume*vol}}}}return self}return self._volume},mute:function(muted){var self=this||Howler;if(!self.ctx){setupAudioContext()}self._muted=muted;if(self.usingWebAudio){self.masterGain.gain.setValueAtTime(muted?0:self._volume,Howler.ctx.currentTime)}for(var i=0;i<self._howls.length;i++){if(!self._howls[i]._webAudio){var ids=self._howls[i]._getSoundIds();for(var j=0;j<ids.length;j++){var sound=self._howls[i]._soundById(ids[j]);if(sound&&sound._node){sound._node.muted=muted?true:sound._muted}}}}return self},unload:function(){var self=this||Howler;for(var i=self._howls.length-1;i>=0;i--){self._howls[i].unload()}if(self.usingWebAudio&&self.ctx&&typeof self.ctx.close!=="undefined"){self.ctx.close();self.ctx=null;setupAudioContext()}return self},codecs:function(ext){return(this||Howler)._codecs[ext.replace(/^x-/,"")]},_setup:function(){var self=this||Howler;self.state=self.ctx?self.ctx.state||"suspended":"suspended";self._autoSuspend();if(!self.usingWebAudio){if(typeof Audio!=="undefined"){try{var test=new Audio;if(typeof test.oncanplaythrough==="undefined"){self._canPlayEvent="canplay"}}catch(e){self.noAudio=true}}else{self.noAudio=true}}try{var test=new Audio;if(test.muted){self.noAudio=true}}catch(e){}if(!self.noAudio){self._setupCodecs()}return self},_setupCodecs:function(){var self=this||Howler;var audioTest=null;try{audioTest=typeof Audio!=="undefined"?new Audio:null}catch(err){return self}if(!audioTest||typeof audioTest.canPlayType!=="function"){return self}var mpegTest=audioTest.canPlayType("audio/mpeg;").replace(/^no$/,"");var checkOpera=self._navigator&&self._navigator.userAgent.match(/OPR\/([0-6].)/g);var isOldOpera=checkOpera&&parseInt(checkOpera[0].split("/")[1],10)<33;self._codecs={mp3:!!(!isOldOpera&&(mpegTest||audioTest.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!mpegTest,opus:!!audioTest.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!audioTest.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!audioTest.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!audioTest.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!audioTest.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!audioTest.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(audioTest.canPlayType("audio/x-m4a;")||audioTest.canPlayType("audio/m4a;")||audioTest.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(audioTest.canPlayType("audio/x-mp4;")||audioTest.canPlayType("audio/mp4;")||audioTest.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!audioTest.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!audioTest.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!audioTest.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(audioTest.canPlayType("audio/x-flac;")||audioTest.canPlayType("audio/flac;")).replace(/^no$/,"")};return self},_unlockAudio:function(){var self=this||Howler;if(self._audioUnlocked||!self.ctx){return}self._audioUnlocked=false;self.autoUnlock=false;if(!self._mobileUnloaded&&self.ctx.sampleRate!==44100){self._mobileUnloaded=true;self.unload()}self._scratchBuffer=self.ctx.createBuffer(1,1,22050);var unlock=function(e){for(var i=0;i<self.html5PoolSize;i++){try{var audioNode=new Audio;audioNode._unlocked=true;self._releaseHtml5Audio(audioNode)}catch(e){self.noAudio=true}}for(var i=0;i<self._howls.length;i++){if(!self._howls[i]._webAudio){var ids=self._howls[i]._getSoundIds();for(var j=0;j<ids.length;j++){var sound=self._howls[i]._soundById(ids[j]);if(sound&&sound._node&&!sound._node._unlocked){sound._node._unlocked=true;sound._node.load()}}}}self._autoResume();var source=self.ctx.createBufferSource();source.buffer=self._scratchBuffer;source.connect(self.ctx.destination);if(typeof source.start==="undefined"){source.noteOn(0)}else{source.start(0)}if(typeof self.ctx.resume==="function"){self.ctx.resume()}source.onended=function(){source.disconnect(0);self._audioUnlocked=true;document.removeEventListener("touchstart",unlock,true);document.removeEventListener("touchend",unlock,true);document.removeEventListener("click",unlock,true);for(var i=0;i<self._howls.length;i++){self._howls[i]._emit("unlock")}}};document.addEventListener("touchstart",unlock,true);document.addEventListener("touchend",unlock,true);document.addEventListener("click",unlock,true);return self},_obtainHtml5Audio:function(){var self=this||Howler;if(self._html5AudioPool.length){return self._html5AudioPool.pop()}var testPlay=(new Audio).play();if(testPlay&&typeof Promise!=="undefined"&&(testPlay instanceof Promise||typeof testPlay.then==="function")){testPlay.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})}return new Audio},_releaseHtml5Audio:function(audio){var self=this||Howler;if(audio._unlocked){self._html5AudioPool.push(audio)}return self},_autoSuspend:function(){var self=this;if(!self.autoSuspend||!self.ctx||typeof self.ctx.suspend==="undefined"||!Howler.usingWebAudio){return}for(var i=0;i<self._howls.length;i++){if(self._howls[i]._webAudio){for(var j=0;j<self._howls[i]._sounds.length;j++){if(!self._howls[i]._sounds[j]._paused){return self}}}}if(self._suspendTimer){clearTimeout(self._suspendTimer)}self._suspendTimer=setTimeout(function(){if(!self.autoSuspend){return}self._suspendTimer=null;self.state="suspending";self.ctx.suspend().then(function(){self.state="suspended";if(self._resumeAfterSuspend){delete self._resumeAfterSuspend;self._autoResume()}})},3e4);return self},_autoResume:function(){var self=this;if(!self.ctx||typeof self.ctx.resume==="undefined"||!Howler.usingWebAudio){return}if(self.state==="running"&&self._suspendTimer){clearTimeout(self._suspendTimer);self._suspendTimer=null}else if(self.state==="suspended"){self.ctx.resume().then(function(){self.state="running";for(var i=0;i<self._howls.length;i++){self._howls[i]._emit("resume")}});if(self._suspendTimer){clearTimeout(self._suspendTimer);self._suspendTimer=null}}else if(self.state==="suspending"){self._resumeAfterSuspend=true}return self}};var Howler=new HowlerGlobal;var Howl=function(o){var self=this;if(!o.src||o.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}self.init(o)};Howl.prototype={init:function(o){var self=this;if(!Howler.ctx){setupAudioContext()}self._autoplay=o.autoplay||false;self._format=typeof o.format!=="string"?o.format:[o.format];self._html5=o.html5||false;self._muted=o.mute||false;self._loop=o.loop||false;self._pool=o.pool||5;self._preload=typeof o.preload==="boolean"?o.preload:true;self._rate=o.rate||1;self._sprite=o.sprite||{};self._src=typeof o.src!=="string"?o.src:[o.src];self._volume=o.volume!==undefined?o.volume:1;self._xhrWithCredentials=o.xhrWithCredentials||false;self._duration=0;self._state="unloaded";self._sounds=[];self._endTimers={};self._queue=[];self._playLock=false;self._onend=o.onend?[{fn:o.onend}]:[];self._onfade=o.onfade?[{fn:o.onfade}]:[];self._onload=o.onload?[{fn:o.onload}]:[];self._onloaderror=o.onloaderror?[{fn:o.onloaderror}]:[];self._onplayerror=o.onplayerror?[{fn:o.onplayerror}]:[];self._onpause=o.onpause?[{fn:o.onpause}]:[];self._onplay=o.onplay?[{fn:o.onplay}]:[];self._onstop=o.onstop?[{fn:o.onstop}]:[];self._onmute=o.onmute?[{fn:o.onmute}]:[];self._onvolume=o.onvolume?[{fn:o.onvolume}]:[];self._onrate=o.onrate?[{fn:o.onrate}]:[];self._onseek=o.onseek?[{fn:o.onseek}]:[];self._onunlock=o.onunlock?[{fn:o.onunlock}]:[];self._onresume=[];self._webAudio=Howler.usingWebAudio&&!self._html5;if(typeof Howler.ctx!=="undefined"&&Howler.ctx&&Howler.autoUnlock){Howler._unlockAudio()}Howler._howls.push(self);if(self._autoplay){self._queue.push({event:"play",action:function(){self.play()}})}if(self._preload){self.load()}return self},load:function(){var self=this;var url=null;if(Howler.noAudio){self._emit("loaderror",null,"No audio support.");return}if(typeof self._src==="string"){self._src=[self._src]}for(var i=0;i<self._src.length;i++){var ext,str;if(self._format&&self._format[i]){ext=self._format[i]}else{str=self._src[i];if(typeof str!=="string"){self._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}ext=/^data:audio\/([^;,]+);/i.exec(str);if(!ext){ext=/\.([^.]+)$/.exec(str.split("?",1)[0])}if(ext){ext=ext[1].toLowerCase()}}if(!ext){console.warn('No file extension was found. Consider using the "format" property or specify an extension.')}if(ext&&Howler.codecs(ext)){url=self._src[i];break}}if(!url){self._emit("loaderror",null,"No codec support for selected audio sources.");return}self._src=url;self._state="loading";if(window.location.protocol==="https:"&&url.slice(0,5)==="http:"){self._html5=true;self._webAudio=false}new Sound(self);if(self._webAudio){loadBuffer(self)}return self},play:function(sprite,internal){var self=this;var id=null;if(typeof sprite==="number"){id=sprite;sprite=null}else if(typeof sprite==="string"&&self._state==="loaded"&&!self._sprite[sprite]){return null}else if(typeof sprite==="undefined"){sprite="__default";if(!self._playLock){var num=0;for(var i=0;i<self._sounds.length;i++){if(self._sounds[i]._paused&&!self._sounds[i]._ended){num++;id=self._sounds[i]._id}}if(num===1){sprite=null}else{id=null}}}var sound=id?self._soundById(id):self._inactiveSound();if(!sound){return null}if(id&&!sprite){sprite=sound._sprite||"__default"}if(self._state!=="loaded"){sound._sprite=sprite;sound._ended=false;var soundId=sound._id;self._queue.push({event:"play",action:function(){self.play(soundId)}});return soundId}if(id&&!sound._paused){if(!internal){self._loadQueue("play")}return sound._id}if(self._webAudio){Howler._autoResume()}var seek=Math.max(0,sound._seek>0?sound._seek:self._sprite[sprite][0]/1e3);var duration=Math.max(0,(self._sprite[sprite][0]+self._sprite[sprite][1])/1e3-seek);var timeout=duration*1e3/Math.abs(sound._rate);var start=self._sprite[sprite][0]/1e3;var stop=(self._sprite[sprite][0]+self._sprite[sprite][1])/1e3;var loop=!!(sound._loop||self._sprite[sprite][2]);sound._sprite=sprite;sound._ended=false;var setParams=function(){sound._paused=false;sound._seek=seek;sound._start=start;sound._stop=stop;sound._loop=loop};if(seek>=stop){self._ended(sound);return}var node=sound._node;if(self._webAudio){var playWebAudio=function(){self._playLock=false;setParams();self._refreshBuffer(sound);var vol=sound._muted||self._muted?0:sound._volume;node.gain.setValueAtTime(vol,Howler.ctx.currentTime);sound._playStart=Howler.ctx.currentTime;if(typeof node.bufferSource.start==="undefined"){sound._loop?node.bufferSource.noteGrainOn(0,seek,86400):node.bufferSource.noteGrainOn(0,seek,duration)}else{sound._loop?node.bufferSource.start(0,seek,86400):node.bufferSource.start(0,seek,duration)}if(timeout!==Infinity){self._endTimers[sound._id]=setTimeout(self._ended.bind(self,sound),timeout)}if(!internal){setTimeout(function(){self._emit("play",sound._id);self._loadQueue()},0)}};if(Howler.state==="running"){playWebAudio()}else{self._playLock=true;self.once("resume",playWebAudio);self._clearTimer(sound._id)}}else{var playHtml5=function(){node.currentTime=seek;node.muted=sound._muted||self._muted||Howler._muted||node.muted;node.volume=sound._volume*Howler.volume();node.playbackRate=sound._rate;try{var play=node.play();if(play&&typeof Promise!=="undefined"&&(play instanceof Promise||typeof play.then==="function")){self._playLock=true;setParams();play.then(function(){self._playLock=false;node._unlocked=true;if(!internal){self._emit("play",sound._id);self._loadQueue()}}).catch(function(){self._playLock=false;self._emit("playerror",sound._id,"Playback was unable to start. This is most commonly an issue "+"on mobile devices and Chrome where playback was not within a user interaction.");sound._ended=true;sound._paused=true})}else if(!internal){self._playLock=false;setParams();self._emit("play",sound._id);self._loadQueue()}node.playbackRate=sound._rate;if(node.paused){self._emit("playerror",sound._id,"Playback was unable to start. This is most commonly an issue "+"on mobile devices and Chrome where playback was not within a user interaction.");return}if(sprite!=="__default"||sound._loop){self._endTimers[sound._id]=setTimeout(self._ended.bind(self,sound),timeout)}else{self._endTimers[sound._id]=function(){self._ended(sound);node.removeEventListener("ended",self._endTimers[sound._id],false)};node.addEventListener("ended",self._endTimers[sound._id],false)}}catch(err){self._emit("playerror",sound._id,err)}};if(node.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"){node.src=self._src;node.load()}var loadedNoReadyState=window&&window.ejecta||!node.readyState&&Howler._navigator.isCocoonJS;if(node.readyState>=3||loadedNoReadyState){playHtml5()}else{self._playLock=true;var listener=function(){playHtml5();node.removeEventListener(Howler._canPlayEvent,listener,false)};node.addEventListener(Howler._canPlayEvent,listener,false);self._clearTimer(sound._id)}}return sound._id},pause:function(id){var self=this;if(self._state!=="loaded"||self._playLock){self._queue.push({event:"pause",action:function(){self.pause(id)}});return self}var ids=self._getSoundIds(id);for(var i=0;i<ids.length;i++){self._clearTimer(ids[i]);var sound=self._soundById(ids[i]);if(sound&&!sound._paused){sound._seek=self.seek(ids[i]);sound._rateSeek=0;sound._paused=true;self._stopFade(ids[i]);if(sound._node){if(self._webAudio){if(!sound._node.bufferSource){continue}if(typeof sound._node.bufferSource.stop==="undefined"){sound._node.bufferSource.noteOff(0)}else{sound._node.bufferSource.stop(0)}self._cleanBuffer(sound._node)}else if(!isNaN(sound._node.duration)||sound._node.duration===Infinity){sound._node.pause()}}}if(!arguments[1]){self._emit("pause",sound?sound._id:null)}}return self},stop:function(id,internal){var self=this;if(self._state!=="loaded"||self._playLock){self._queue.push({event:"stop",action:function(){self.stop(id)}});return self}var ids=self._getSoundIds(id);for(var i=0;i<ids.length;i++){self._clearTimer(ids[i]);var sound=self._soundById(ids[i]);if(sound){sound._seek=sound._start||0;sound._rateSeek=0;sound._paused=true;sound._ended=true;self._stopFade(ids[i]);if(sound._node){if(self._webAudio){if(sound._node.bufferSource){if(typeof sound._node.bufferSource.stop==="undefined"){sound._node.bufferSource.noteOff(0)}else{sound._node.bufferSource.stop(0)}self._cleanBuffer(sound._node)}}else if(!isNaN(sound._node.duration)||sound._node.duration===Infinity){sound._node.currentTime=sound._start||0;sound._node.pause();if(sound._node.duration===Infinity){self._clearSound(sound._node)}}}if(!internal){self._emit("stop",sound._id)}}}return self},mute:function(muted,id){var self=this;if(self._state!=="loaded"||self._playLock){self._queue.push({event:"mute",action:function(){self.mute(muted,id)}});return self}if(typeof id==="undefined"){if(typeof muted==="boolean"){self._muted=muted}else{return self._muted}}var ids=self._getSoundIds(id);for(var i=0;i<ids.length;i++){var sound=self._soundById(ids[i]);if(sound){sound._muted=muted;if(sound._interval){self._stopFade(sound._id)}if(self._webAudio&&sound._node){sound._node.gain.setValueAtTime(muted?0:sound._volume,Howler.ctx.currentTime)}else if(sound._node){sound._node.muted=Howler._muted?true:muted}self._emit("mute",sound._id)}}return self},volume:function(){var self=this;var args=arguments;var vol,id;if(args.length===0){return self._volume}else if(args.length===1||args.length===2&&typeof args[1]==="undefined"){var ids=self._getSoundIds();var index=ids.indexOf(args[0]);if(index>=0){id=parseInt(args[0],10)}else{vol=parseFloat(args[0])}}else if(args.length>=2){vol=parseFloat(args[0]);id=parseInt(args[1],10)}var sound;if(typeof vol!=="undefined"&&vol>=0&&vol<=1){if(self._state!=="loaded"||self._playLock){self._queue.push({event:"volume",action:function(){self.volume.apply(self,args)}});return self}if(typeof id==="undefined"){self._volume=vol}id=self._getSoundIds(id);for(var i=0;i<id.length;i++){sound=self._soundById(id[i]);if(sound){sound._volume=vol;if(!args[2]){self._stopFade(id[i])}if(self._webAudio&&sound._node&&!sound._muted){sound._node.gain.setValueAtTime(vol,Howler.ctx.currentTime)}else if(sound._node&&!sound._muted){sound._node.volume=vol*Howler.volume()}self._emit("volume",sound._id)}}}else{sound=id?self._soundById(id):self._sounds[0];return sound?sound._volume:0}return self},fade:function(from,to,len,id){var self=this;if(self._state!=="loaded"||self._playLock){self._queue.push({event:"fade",action:function(){self.fade(from,to,len,id)}});return self}from=parseFloat(from);to=parseFloat(to);len=parseFloat(len);self.volume(from,id);var ids=self._getSoundIds(id);for(var i=0;i<ids.length;i++){var sound=self._soundById(ids[i]);if(sound){if(!id){self._stopFade(ids[i])}if(self._webAudio&&!sound._muted){var currentTime=Howler.ctx.currentTime;var end=currentTime+len/1e3;sound._volume=from;sound._node.gain.setValueAtTime(from,currentTime);sound._node.gain.linearRampToValueAtTime(to,end)}self._startFadeInterval(sound,from,to,len,ids[i],typeof id==="undefined")}}return self},_startFadeInterval:function(sound,from,to,len,id,isGroup){var self=this;var vol=from;var diff=to-from;var steps=Math.abs(diff/.01);var stepLen=Math.max(4,steps>0?len/steps:len);var lastTick=Date.now();sound._fadeTo=to;sound._interval=setInterval(function(){var tick=(Date.now()-lastTick)/len;lastTick=Date.now();vol+=diff*tick;vol=Math.max(0,vol);vol=Math.min(1,vol);vol=Math.round(vol*100)/100;if(self._webAudio){sound._volume=vol}else{self.volume(vol,sound._id,true)}if(isGroup){self._volume=vol}if(to<from&&vol<=to||to>from&&vol>=to){clearInterval(sound._interval);sound._interval=null;sound._fadeTo=null;self.volume(to,sound._id);self._emit("fade",sound._id)}},stepLen)},_stopFade:function(id){var self=this;var sound=self._soundById(id);if(sound&&sound._interval){if(self._webAudio){sound._node.gain.cancelScheduledValues(Howler.ctx.currentTime)}clearInterval(sound._interval);sound._interval=null;self.volume(sound._fadeTo,id);sound._fadeTo=null;self._emit("fade",id)}return self},loop:function(){var self=this;var args=arguments;var loop,id,sound;if(args.length===0){return self._loop}else if(args.length===1){if(typeof args[0]==="boolean"){loop=args[0];self._loop=loop}else{sound=self._soundById(parseInt(args[0],10));return sound?sound._loop:false}}else if(args.length===2){loop=args[0];id=parseInt(args[1],10)}var ids=self._getSoundIds(id);for(var i=0;i<ids.length;i++){sound=self._soundById(ids[i]);if(sound){sound._loop=loop;if(self._webAudio&&sound._node&&sound._node.bufferSource){sound._node.bufferSource.loop=loop;if(loop){sound._node.bufferSource.loopStart=sound._start||0;sound._node.bufferSource.loopEnd=sound._stop}}}}return self},rate:function(){var self=this;var args=arguments;var rate,id;if(args.length===0){id=self._sounds[0]._id}else if(args.length===1){var ids=self._getSoundIds();var index=ids.indexOf(args[0]);if(index>=0){id=parseInt(args[0],10)}else{rate=parseFloat(args[0])}}else if(args.length===2){rate=parseFloat(args[0]);id=parseInt(args[1],10)}var sound;if(typeof rate==="number"){if(self._state!=="loaded"||self._playLock){self._queue.push({event:"rate",action:function(){self.rate.apply(self,args)}});return self}if(typeof id==="undefined"){self._rate=rate}id=self._getSoundIds(id);for(var i=0;i<id.length;i++){sound=self._soundById(id[i]);if(sound){if(self.playing(id[i])){sound._rateSeek=self.seek(id[i]);sound._playStart=self._webAudio?Howler.ctx.currentTime:sound._playStart}sound._rate=rate;if(self._webAudio&&sound._node&&sound._node.bufferSource){sound._node.bufferSource.playbackRate.setValueAtTime(rate,Howler.ctx.currentTime)}else if(sound._node){sound._node.playbackRate=rate}var seek=self.seek(id[i]);var duration=(self._sprite[sound._sprite][0]+self._sprite[sound._sprite][1])/1e3-seek;var timeout=duration*1e3/Math.abs(sound._rate);if(self._endTimers[id[i]]||!sound._paused){self._clearTimer(id[i]);self._endTimers[id[i]]=setTimeout(self._ended.bind(self,sound),timeout)}self._emit("rate",sound._id)}}}else{sound=self._soundById(id);return sound?sound._rate:self._rate}return self},seek:function(){var self=this;var args=arguments;var seek,id;if(args.length===0){id=self._sounds[0]._id}else if(args.length===1){var ids=self._getSoundIds();var index=ids.indexOf(args[0]);if(index>=0){id=parseInt(args[0],10)}else if(self._sounds.length){id=self._sounds[0]._id;seek=parseFloat(args[0])}}else if(args.length===2){seek=parseFloat(args[0]);id=parseInt(args[1],10)}if(typeof id==="undefined"){return self}if(self._state!=="loaded"||self._playLock){self._queue.push({event:"seek",action:function(){self.seek.apply(self,args)}});return self}var sound=self._soundById(id);if(sound){if(typeof seek==="number"&&seek>=0){var playing=self.playing(id);if(playing){self.pause(id,true)}sound._seek=seek;sound._ended=false;self._clearTimer(id);if(!self._webAudio&&sound._node&&!isNaN(sound._node.duration)){sound._node.currentTime=seek}var seekAndEmit=function(){self._emit("seek",id);if(playing){self.play(id,true)}};if(playing&&!self._webAudio){var emitSeek=function(){if(!self._playLock){seekAndEmit()}else{setTimeout(emitSeek,0)}};setTimeout(emitSeek,0)}else{seekAndEmit()}}else{if(self._webAudio){var realTime=self.playing(id)?Howler.ctx.currentTime-sound._playStart:0;var rateSeek=sound._rateSeek?sound._rateSeek-sound._seek:0;return sound._seek+(rateSeek+realTime*Math.abs(sound._rate))}else{return sound._node.currentTime}}}return self},playing:function(id){var self=this;if(typeof id==="number"){var sound=self._soundById(id);return sound?!sound._paused:false}for(var i=0;i<self._sounds.length;i++){if(!self._sounds[i]._paused){return true}}return false},duration:function(id){var self=this;var duration=self._duration;var sound=self._soundById(id);if(sound){duration=self._sprite[sound._sprite][1]/1e3}return duration},state:function(){return this._state},unload:function(){var self=this;var sounds=self._sounds;for(var i=0;i<sounds.length;i++){if(!sounds[i]._paused){self.stop(sounds[i]._id)}if(!self._webAudio){self._clearSound(sounds[i]._node);sounds[i]._node.removeEventListener("error",sounds[i]._errorFn,false);sounds[i]._node.removeEventListener(Howler._canPlayEvent,sounds[i]._loadFn,false);Howler._releaseHtml5Audio(sounds[i]._node)}delete sounds[i]._node;self._clearTimer(sounds[i]._id)}var index=Howler._howls.indexOf(self);if(index>=0){Howler._howls.splice(index,1)}var remCache=true;for(i=0;i<Howler._howls.length;i++){if(Howler._howls[i]._src===self._src||self._src.indexOf(Howler._howls[i]._src)>=0){remCache=false;break}}if(cache&&remCache){delete cache[self._src]}Howler.noAudio=false;self._state="unloaded";self._sounds=[];self=null;return null},on:function(event,fn,id,once){var self=this;var events=self["_on"+event];if(typeof fn==="function"){events.push(once?{id:id,fn:fn,once:once}:{id:id,fn:fn})}return self},off:function(event,fn,id){var self=this;var events=self["_on"+event];var i=0;if(typeof fn==="number"){id=fn;fn=null}if(fn||id){for(i=0;i<events.length;i++){var isId=id===events[i].id;if(fn===events[i].fn&&isId||!fn&&isId){events.splice(i,1);break}}}else if(event){self["_on"+event]=[]}else{var keys=Object.keys(self);for(i=0;i<keys.length;i++){if(keys[i].indexOf("_on")===0&&Array.isArray(self[keys[i]])){self[keys[i]]=[]}}}return self},once:function(event,fn,id){var self=this;self.on(event,fn,id,1);return self},_emit:function(event,id,msg){var self=this;var events=self["_on"+event];for(var i=events.length-1;i>=0;i--){if(!events[i].id||events[i].id===id||event==="load"){setTimeout(function(fn){fn.call(this,id,msg)}.bind(self,events[i].fn),0);if(events[i].once){self.off(event,events[i].fn,events[i].id)}}}self._loadQueue(event);return self},_loadQueue:function(event){var self=this;if(self._queue.length>0){var task=self._queue[0];if(task.event===event){self._queue.shift();self._loadQueue()}if(!event){task.action()}}return self},_ended:function(sound){var self=this;var sprite=sound._sprite;if(!self._webAudio&&sound._node&&!sound._node.paused&&!sound._node.ended&&sound._node.currentTime<sound._stop){setTimeout(self._ended.bind(self,sound),100);return self}var loop=!!(sound._loop||self._sprite[sprite][2]);self._emit("end",sound._id);if(!self._webAudio&&loop){self.stop(sound._id,true).play(sound._id)}if(self._webAudio&&loop){self._emit("play",sound._id);sound._seek=sound._start||0;sound._rateSeek=0;sound._playStart=Howler.ctx.currentTime;var timeout=(sound._stop-sound._start)*1e3/Math.abs(sound._rate);self._endTimers[sound._id]=setTimeout(self._ended.bind(self,sound),timeout)}if(self._webAudio&&!loop){sound._paused=true;sound._ended=true;sound._seek=sound._start||0;sound._rateSeek=0;self._clearTimer(sound._id);self._cleanBuffer(sound._node);Howler._autoSuspend()}if(!self._webAudio&&!loop){self.stop(sound._id,true)}return self},_clearTimer:function(id){var self=this;if(self._endTimers[id]){if(typeof self._endTimers[id]!=="function"){clearTimeout(self._endTimers[id])}else{var sound=self._soundById(id);if(sound&&sound._node){sound._node.removeEventListener("ended",self._endTimers[id],false)}}delete self._endTimers[id]}return self},_soundById:function(id){var self=this;for(var i=0;i<self._sounds.length;i++){if(id===self._sounds[i]._id){return self._sounds[i]}}return null},_inactiveSound:function(){var self=this;self._drain();for(var i=0;i<self._sounds.length;i++){if(self._sounds[i]._ended){return self._sounds[i].reset()}}return new Sound(self)},_drain:function(){var self=this;var limit=self._pool;var cnt=0;var i=0;if(self._sounds.length<limit){return}for(i=0;i<self._sounds.length;i++){if(self._sounds[i]._ended){cnt++}}for(i=self._sounds.length-1;i>=0;i--){if(cnt<=limit){return}if(self._sounds[i]._ended){if(self._webAudio&&self._sounds[i]._node){self._sounds[i]._node.disconnect(0)}self._sounds.splice(i,1);cnt--}}},_getSoundIds:function(id){var self=this;if(typeof id==="undefined"){var ids=[];for(var i=0;i<self._sounds.length;i++){ids.push(self._sounds[i]._id)}return ids}else{return[id]}},_refreshBuffer:function(sound){var self=this;sound._node.bufferSource=Howler.ctx.createBufferSource();sound._node.bufferSource.buffer=cache[self._src];if(sound._panner){sound._node.bufferSource.connect(sound._panner)}else{sound._node.bufferSource.connect(sound._node)}sound._node.bufferSource.loop=sound._loop;if(sound._loop){sound._node.bufferSource.loopStart=sound._start||0;sound._node.bufferSource.loopEnd=sound._stop||0}sound._node.bufferSource.playbackRate.setValueAtTime(sound._rate,Howler.ctx.currentTime);return self},_cleanBuffer:function(node){var self=this;var isIOS=Howler._navigator&&Howler._navigator.vendor.indexOf("Apple")>=0;if(Howler._scratchBuffer&&node.bufferSource){node.bufferSource.onended=null;node.bufferSource.disconnect(0);if(isIOS){try{node.bufferSource.buffer=Howler._scratchBuffer}catch(e){}}}node.bufferSource=null;return self},_clearSound:function(node){var checkIE=/MSIE |Trident\//.test(Howler._navigator&&Howler._navigator.userAgent);if(!checkIE){node.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"}}};var Sound=function(howl){this._parent=howl;this.init()};Sound.prototype={init:function(){var self=this;var parent=self._parent;self._muted=parent._muted;self._loop=parent._loop;self._volume=parent._volume;self._rate=parent._rate;self._seek=0;self._paused=true;self._ended=true;self._sprite="__default";self._id=++Howler._counter;parent._sounds.push(self);self.create();return self},create:function(){var self=this;var parent=self._parent;var volume=Howler._muted||self._muted||self._parent._muted?0:self._volume;if(parent._webAudio){self._node=typeof Howler.ctx.createGain==="undefined"?Howler.ctx.createGainNode():Howler.ctx.createGain();self._node.gain.setValueAtTime(volume,Howler.ctx.currentTime);self._node.paused=true;self._node.connect(Howler.masterGain)}else{self._node=Howler._obtainHtml5Audio();self._errorFn=self._errorListener.bind(self);self._node.addEventListener("error",self._errorFn,false);self._loadFn=self._loadListener.bind(self);self._node.addEventListener(Howler._canPlayEvent,self._loadFn,false);self._node.src=parent._src;self._node.preload="auto";self._node.volume=volume*Howler.volume();self._node.load()}return self},reset:function(){var self=this;var parent=self._parent;self._muted=parent._muted;self._loop=parent._loop;self._volume=parent._volume;self._rate=parent._rate;self._seek=0;self._rateSeek=0;self._paused=true;self._ended=true;self._sprite="__default";self._id=++Howler._counter;return self},_errorListener:function(){var self=this;self._parent._emit("loaderror",self._id,self._node.error?self._node.error.code:0);self._node.removeEventListener("error",self._errorFn,false)},_loadListener:function(){var self=this;var parent=self._parent;parent._duration=Math.ceil(self._node.duration*10)/10;if(Object.keys(parent._sprite).length===0){parent._sprite={__default:[0,parent._duration*1e3]}}if(parent._state!=="loaded"){parent._state="loaded";parent._emit("load");parent._loadQueue()}self._node.removeEventListener(Howler._canPlayEvent,self._loadFn,false)}};var cache={};var loadBuffer=function(self){var url=self._src;if(cache[url]){self._duration=cache[url].duration;loadSound(self);return}if(/^data:[^;]+;base64,/.test(url)){var data=atob(url.split(",")[1]);var dataView=new Uint8Array(data.length);for(var i=0;i<data.length;++i){dataView[i]=data.charCodeAt(i)}decodeAudioData(dataView.buffer,self)}else{var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.withCredentials=self._xhrWithCredentials;xhr.responseType="arraybuffer";xhr.onload=function(){var code=(xhr.status+"")[0];if(code!=="0"&&code!=="2"&&code!=="3"){self._emit("loaderror",null,"Failed loading audio file with status: "+xhr.status+".");return}decodeAudioData(xhr.response,self)};xhr.onerror=function(){if(self._webAudio){self._html5=true;self._webAudio=false;self._sounds=[];delete cache[url];self.load()}};safeXhrSend(xhr)}};var safeXhrSend=function(xhr){try{xhr.send()}catch(e){xhr.onerror()}};var decodeAudioData=function(arraybuffer,self){var error=function(){self._emit("loaderror",null,"Decoding audio data failed.")};var success=function(buffer){if(buffer&&self._sounds.length>0){cache[self._src]=buffer;loadSound(self,buffer)}else{error()}};if(typeof Promise!=="undefined"&&Howler.ctx.decodeAudioData.length===1){Howler.ctx.decodeAudioData(arraybuffer).then(success).catch(error)}else{Howler.ctx.decodeAudioData(arraybuffer,success,error)}};var loadSound=function(self,buffer){if(buffer&&!self._duration){self._duration=buffer.duration}if(Object.keys(self._sprite).length===0){self._sprite={__default:[0,self._duration*1e3]}}if(self._state!=="loaded"){self._state="loaded";self._emit("load");self._loadQueue()}};var setupAudioContext=function(){if(!Howler.usingWebAudio){return}try{if(typeof AudioContext!=="undefined"){Howler.ctx=new AudioContext}else if(typeof webkitAudioContext!=="undefined"){Howler.ctx=new webkitAudioContext}else{Howler.usingWebAudio=false}}catch(e){Howler.usingWebAudio=false}if(!Howler.ctx){Howler.usingWebAudio=false}var iOS=/iP(hone|od|ad)/.test(Howler._navigator&&Howler._navigator.platform);var appVersion=Howler._navigator&&Howler._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);var version=appVersion?parseInt(appVersion[1],10):null;if(iOS&&version&&version<9){var safari=/safari/.test(Howler._navigator&&Howler._navigator.userAgent.toLowerCase());if(Howler._navigator&&Howler._navigator.standalone&&!safari||Howler._navigator&&!Howler._navigator.standalone&&!safari){Howler.usingWebAudio=false}}if(Howler.usingWebAudio){Howler.masterGain=typeof Howler.ctx.createGain==="undefined"?Howler.ctx.createGainNode():Howler.ctx.createGain();Howler.masterGain.gain.setValueAtTime(Howler._muted?0:1,Howler.ctx.currentTime);Howler.masterGain.connect(Howler.ctx.destination)}Howler._setup()};if(typeof define==="function"&&define.amd){define([],function(){return{Howler:Howler,Howl:Howl}})}if(typeof exports!=="undefined"){exports.Howler=Howler;exports.Howl=Howl}if(typeof window!=="undefined"){window.HowlerGlobal=HowlerGlobal;window.Howler=Howler;window.Howl=Howl;window.Sound=Sound}else if(typeof global!=="undefined"){global.HowlerGlobal=HowlerGlobal;global.Howler=Howler;global.Howl=Howl;global.Sound=Sound}})();(function(){"use strict";HowlerGlobal.prototype._pos=[0,0,0];HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0];HowlerGlobal.prototype.stereo=function(pan){var self=this;if(!self.ctx||!self.ctx.listener){return self}for(var i=self._howls.length-1;i>=0;i--){self._howls[i].stereo(pan)}return self};HowlerGlobal.prototype.pos=function(x,y,z){var self=this;if(!self.ctx||!self.ctx.listener){return self}y=typeof y!=="number"?self._pos[1]:y;z=typeof z!=="number"?self._pos[2]:z;if(typeof x==="number"){self._pos=[x,y,z];if(typeof self.ctx.listener.positionX!=="undefined"){self.ctx.listener.positionX.setTargetAtTime(self._pos[0],Howler.ctx.currentTime,.1);self.ctx.listener.positionY.setTargetAtTime(self._pos[1],Howler.ctx.currentTime,.1);self.ctx.listener.positionZ.setTargetAtTime(self._pos[2],Howler.ctx.currentTime,.1)}else{self.ctx.listener.setPosition(self._pos[0],self._pos[1],self._pos[2])}}else{return self._pos}return self};HowlerGlobal.prototype.orientation=function(x,y,z,xUp,yUp,zUp){var self=this;if(!self.ctx||!self.ctx.listener){return self}var or=self._orientation;y=typeof y!=="number"?or[1]:y;z=typeof z!=="number"?or[2]:z;xUp=typeof xUp!=="number"?or[3]:xUp;yUp=typeof yUp!=="number"?or[4]:yUp;zUp=typeof zUp!=="number"?or[5]:zUp;if(typeof x==="number"){self._orientation=[x,y,z,xUp,yUp,zUp];if(typeof self.ctx.listener.forwardX!=="undefined"){self.ctx.listener.forwardX.setTargetAtTime(x,Howler.ctx.currentTime,.1);self.ctx.listener.forwardY.setTargetAtTime(y,Howler.ctx.currentTime,.1);self.ctx.listener.forwardZ.setTargetAtTime(z,Howler.ctx.currentTime,.1);self.ctx.listener.upX.setTargetAtTime(x,Howler.ctx.currentTime,.1);self.ctx.listener.upY.setTargetAtTime(y,Howler.ctx.currentTime,.1);self.ctx.listener.upZ.setTargetAtTime(z,Howler.ctx.currentTime,.1)}else{self.ctx.listener.setOrientation(x,y,z,xUp,yUp,zUp)}}else{return or}return self};Howl.prototype.init=function(_super){return function(o){var self=this;self._orientation=o.orientation||[1,0,0];self._stereo=o.stereo||null;self._pos=o.pos||null;self._pannerAttr={coneInnerAngle:typeof o.coneInnerAngle!=="undefined"?o.coneInnerAngle:360,coneOuterAngle:typeof o.coneOuterAngle!=="undefined"?o.coneOuterAngle:360,coneOuterGain:typeof o.coneOuterGain!=="undefined"?o.coneOuterGain:0,distanceModel:typeof o.distanceModel!=="undefined"?o.distanceModel:"inverse",maxDistance:typeof o.maxDistance!=="undefined"?o.maxDistance:1e4,panningModel:typeof o.panningModel!=="undefined"?o.panningModel:"HRTF",refDistance:typeof o.refDistance!=="undefined"?o.refDistance:1,rolloffFactor:typeof o.rolloffFactor!=="undefined"?o.rolloffFactor:1};self._onstereo=o.onstereo?[{fn:o.onstereo}]:[];self._onpos=o.onpos?[{fn:o.onpos}]:[];self._onorientation=o.onorientation?[{fn:o.onorientation}]:[];return _super.call(this,o)}}(Howl.prototype.init);Howl.prototype.stereo=function(pan,id){var self=this;if(!self._webAudio){return self}if(self._state!=="loaded"){self._queue.push({event:"stereo",action:function(){self.stereo(pan,id)}});return self}var pannerType=typeof Howler.ctx.createStereoPanner==="undefined"?"spatial":"stereo";if(typeof id==="undefined"){if(typeof pan==="number"){self._stereo=pan;self._pos=[pan,0,0]}else{return self._stereo}}var ids=self._getSoundIds(id);for(var i=0;i<ids.length;i++){var sound=self._soundById(ids[i]);if(sound){if(typeof pan==="number"){sound._stereo=pan;sound._pos=[pan,0,0];if(sound._node){sound._pannerAttr.panningModel="equalpower";if(!sound._panner||!sound._panner.pan){setupPanner(sound,pannerType)}if(pannerType==="spatial"){if(typeof sound._panner.positionX!=="undefined"){sound._panner.positionX.setValueAtTime(pan,Howler.ctx.currentTime);sound._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime);sound._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)}else{sound._panner.setPosition(pan,0,0)}}else{sound._panner.pan.setValueAtTime(pan,Howler.ctx.currentTime)}}self._emit("stereo",sound._id)}else{return sound._stereo}}}return self};Howl.prototype.pos=function(x,y,z,id){var self=this;if(!self._webAudio){return self}if(self._state!=="loaded"){self._queue.push({event:"pos",action:function(){self.pos(x,y,z,id)}});return self}y=typeof y!=="number"?0:y;z=typeof z!=="number"?-.5:z;if(typeof id==="undefined"){if(typeof x==="number"){self._pos=[x,y,z]}else{return self._pos}}var ids=self._getSoundIds(id);for(var i=0;i<ids.length;i++){var sound=self._soundById(ids[i]);if(sound){if(typeof x==="number"){sound._pos=[x,y,z];if(sound._node){if(!sound._panner||sound._panner.pan){setupPanner(sound,"spatial")}if(typeof sound._panner.positionX!=="undefined"){sound._panner.positionX.setValueAtTime(x,Howler.ctx.currentTime);sound._panner.positionY.setValueAtTime(y,Howler.ctx.currentTime);sound._panner.positionZ.setValueAtTime(z,Howler.ctx.currentTime)}else{sound._panner.setPosition(x,y,z)}}self._emit("pos",sound._id)}else{return sound._pos}}}return self};Howl.prototype.orientation=function(x,y,z,id){var self=this;if(!self._webAudio){return self}if(self._state!=="loaded"){self._queue.push({event:"orientation",action:function(){self.orientation(x,y,z,id)}});return self}y=typeof y!=="number"?self._orientation[1]:y;z=typeof z!=="number"?self._orientation[2]:z;if(typeof id==="undefined"){if(typeof x==="number"){self._orientation=[x,y,z]}else{return self._orientation}}var ids=self._getSoundIds(id);for(var i=0;i<ids.length;i++){var sound=self._soundById(ids[i]);if(sound){if(typeof x==="number"){sound._orientation=[x,y,z];if(sound._node){if(!sound._panner){if(!sound._pos){sound._pos=self._pos||[0,0,-.5]}setupPanner(sound,"spatial")}if(typeof sound._panner.orientationX!=="undefined"){sound._panner.orientationX.setValueAtTime(x,Howler.ctx.currentTime);sound._panner.orientationY.setValueAtTime(y,Howler.ctx.currentTime);sound._panner.orientationZ.setValueAtTime(z,Howler.ctx.currentTime)}else{sound._panner.setOrientation(x,y,z)}}self._emit("orientation",sound._id)}else{return sound._orientation}}}return self};Howl.prototype.pannerAttr=function(){var self=this;var args=arguments;var o,id,sound;if(!self._webAudio){return self}if(args.length===0){return self._pannerAttr}else if(args.length===1){if(typeof args[0]==="object"){o=args[0];if(typeof id==="undefined"){if(!o.pannerAttr){o.pannerAttr={coneInnerAngle:o.coneInnerAngle,coneOuterAngle:o.coneOuterAngle,coneOuterGain:o.coneOuterGain,distanceModel:o.distanceModel,maxDistance:o.maxDistance,refDistance:o.refDistance,rolloffFactor:o.rolloffFactor,panningModel:o.panningModel}}self._pannerAttr={coneInnerAngle:typeof o.pannerAttr.coneInnerAngle!=="undefined"?o.pannerAttr.coneInnerAngle:self._coneInnerAngle,coneOuterAngle:typeof o.pannerAttr.coneOuterAngle!=="undefined"?o.pannerAttr.coneOuterAngle:self._coneOuterAngle,coneOuterGain:typeof o.pannerAttr.coneOuterGain!=="undefined"?o.pannerAttr.coneOuterGain:self._coneOuterGain,distanceModel:typeof o.pannerAttr.distanceModel!=="undefined"?o.pannerAttr.distanceModel:self._distanceModel,maxDistance:typeof o.pannerAttr.maxDistance!=="undefined"?o.pannerAttr.maxDistance:self._maxDistance,refDistance:typeof o.pannerAttr.refDistance!=="undefined"?o.pannerAttr.refDistance:self._refDistance,rolloffFactor:typeof o.pannerAttr.rolloffFactor!=="undefined"?o.pannerAttr.rolloffFactor:self._rolloffFactor,panningModel:typeof o.pannerAttr.panningModel!=="undefined"?o.pannerAttr.panningModel:self._panningModel}}}else{sound=self._soundById(parseInt(args[0],10));return sound?sound._pannerAttr:self._pannerAttr}}else if(args.length===2){o=args[0];id=parseInt(args[1],10)}var ids=self._getSoundIds(id);for(var i=0;i<ids.length;i++){sound=self._soundById(ids[i]);if(sound){var pa=sound._pannerAttr;pa={coneInnerAngle:typeof o.coneInnerAngle!=="undefined"?o.coneInnerAngle:pa.coneInnerAngle,coneOuterAngle:typeof o.coneOuterAngle!=="undefined"?o.coneOuterAngle:pa.coneOuterAngle,coneOuterGain:typeof o.coneOuterGain!=="undefined"?o.coneOuterGain:pa.coneOuterGain,distanceModel:typeof o.distanceModel!=="undefined"?o.distanceModel:pa.distanceModel,maxDistance:typeof o.maxDistance!=="undefined"?o.maxDistance:pa.maxDistance,refDistance:typeof o.refDistance!=="undefined"?o.refDistance:pa.refDistance,rolloffFactor:typeof o.rolloffFactor!=="undefined"?o.rolloffFactor:pa.rolloffFactor,panningModel:typeof o.panningModel!=="undefined"?o.panningModel:pa.panningModel};var panner=sound._panner;if(panner){panner.coneInnerAngle=pa.coneInnerAngle;panner.coneOuterAngle=pa.coneOuterAngle;panner.coneOuterGain=pa.coneOuterGain;panner.distanceModel=pa.distanceModel;panner.maxDistance=pa.maxDistance;panner.refDistance=pa.refDistance;panner.rolloffFactor=pa.rolloffFactor;panner.panningModel=pa.panningModel}else{if(!sound._pos){sound._pos=self._pos||[0,0,-.5]}setupPanner(sound,"spatial")}}}return self};Sound.prototype.init=function(_super){return function(){var self=this;var parent=self._parent;self._orientation=parent._orientation;self._stereo=parent._stereo;self._pos=parent._pos;self._pannerAttr=parent._pannerAttr;_super.call(this);if(self._stereo){parent.stereo(self._stereo)}else if(self._pos){parent.pos(self._pos[0],self._pos[1],self._pos[2],self._id)}}}(Sound.prototype.init);Sound.prototype.reset=function(_super){return function(){var self=this;var parent=self._parent;self._orientation=parent._orientation;self._stereo=parent._stereo;self._pos=parent._pos;self._pannerAttr=parent._pannerAttr;if(self._stereo){parent.stereo(self._stereo)}else if(self._pos){parent.pos(self._pos[0],self._pos[1],self._pos[2],self._id)}else if(self._panner){self._panner.disconnect(0);self._panner=undefined;parent._refreshBuffer(self)}return _super.call(this)}}(Sound.prototype.reset);var setupPanner=function(sound,type){type=type||"spatial";if(type==="spatial"){sound._panner=Howler.ctx.createPanner();sound._panner.coneInnerAngle=sound._pannerAttr.coneInnerAngle;sound._panner.coneOuterAngle=sound._pannerAttr.coneOuterAngle;sound._panner.coneOuterGain=sound._pannerAttr.coneOuterGain;sound._panner.distanceModel=sound._pannerAttr.distanceModel;sound._panner.maxDistance=sound._pannerAttr.maxDistance;sound._panner.refDistance=sound._pannerAttr.refDistance;sound._panner.rolloffFactor=sound._pannerAttr.rolloffFactor;sound._panner.panningModel=sound._pannerAttr.panningModel;if(typeof sound._panner.positionX!=="undefined"){sound._panner.positionX.setValueAtTime(sound._pos[0],Howler.ctx.currentTime);sound._panner.positionY.setValueAtTime(sound._pos[1],Howler.ctx.currentTime);sound._panner.positionZ.setValueAtTime(sound._pos[2],Howler.ctx.currentTime)}else{sound._panner.setPosition(sound._pos[0],sound._pos[1],sound._pos[2])}if(typeof sound._panner.orientationX!=="undefined"){sound._panner.orientationX.setValueAtTime(sound._orientation[0],Howler.ctx.currentTime);sound._panner.orientationY.setValueAtTime(sound._orientation[1],Howler.ctx.currentTime);sound._panner.orientationZ.setValueAtTime(sound._orientation[2],Howler.ctx.currentTime)}else{sound._panner.setOrientation(sound._orientation[0],sound._orientation[1],sound._orientation[2])}}else{sound._panner=Howler.ctx.createStereoPanner();sound._panner.pan.setValueAtTime(sound._stereo,Howler.ctx.currentTime)}sound._panner.connect(sound._node);if(!sound._paused){sound._parent.pause(sound._id,true).play(sound._id,true)}}})()}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],42:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],43:[function(require,module,exports){!function(e){var n=/iPhone/i,t=/iPod/i,r=/iPad/i,a=/\bAndroid(?:.+)Mobile\b/i,p=/Android/i,b=/\bAndroid(?:.+)SD4930UR\b/i,l=/\bAndroid(?:.+)(?:KF[A-Z]{2,4})\b/i,f=/Windows Phone/i,s=/\bWindows(?:.+)ARM\b/i,u=/BlackBerry/i,c=/BB10/i,h=/Opera Mini/i,v=/\b(CriOS|Chrome)(?:.+)Mobile/i,w=/Mobile(?:.+)Firefox\b/i;function m(e,i){return e.test(i)}function i(e){var i=e||("undefined"!=typeof navigator?navigator.userAgent:""),o=i.split("[FBAN");void 0!==o[1]&&(i=o[0]),void 0!==(o=i.split("Twitter"))[1]&&(i=o[0]);var d={apple:{phone:m(n,i)&&!m(f,i),ipod:m(t,i),tablet:!m(n,i)&&m(r,i)&&!m(f,i),device:(m(n,i)||m(t,i)||m(r,i))&&!m(f,i)},amazon:{phone:m(b,i),tablet:!m(b,i)&&m(l,i),device:m(b,i)||m(l,i)},android:{phone:!m(f,i)&&m(b,i)||!m(f,i)&&m(a,i),tablet:!m(f,i)&&!m(b,i)&&!m(a,i)&&(m(l,i)||m(p,i)),device:!m(f,i)&&(m(b,i)||m(l,i)||m(a,i)||m(p,i))||m(/\bokhttp\b/i,i)},windows:{phone:m(f,i),tablet:m(s,i),device:m(f,i)||m(s,i)},other:{blackberry:m(u,i),blackberry10:m(c,i),opera:m(h,i),firefox:m(w,i),chrome:m(v,i),device:m(u,i)||m(c,i)||m(h,i)||m(w,i)||m(v,i)}};return d.any=d.apple.device||d.android.device||d.windows.device||d.other.device,d.phone=d.apple.phone||d.android.phone||d.windows.phone,d.tablet=d.apple.tablet||d.android.tablet||d.windows.tablet,d}"undefined"!=typeof module&&module.exports&&"undefined"==typeof window?module.exports=i:"undefined"!=typeof module&&module.exports&&"undefined"!=typeof window?(module.exports=i(),module.exports.isMobile=i):"function"==typeof define&&define.amd?define([],e.isMobile=i()):e.isMobile=i()}(this)},{}],44:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var MiniSignalBinding=function(){function MiniSignalBinding(fn,once,thisArg){if(once===undefined)once=false;_classCallCheck(this,MiniSignalBinding);this._fn=fn;this._once=once;this._thisArg=thisArg;this._next=this._prev=this._owner=null}_createClass(MiniSignalBinding,[{key:"detach",value:function detach(){if(this._owner===null)return false;this._owner.detach(this);return true}}]);return MiniSignalBinding}();function _addMiniSignalBinding(self,node){if(!self._head){self._head=node;self._tail=node}else{self._tail._next=node;node._prev=self._tail;self._tail=node}node._owner=self;return node}var MiniSignal=function(){function MiniSignal(){_classCallCheck(this,MiniSignal);this._head=this._tail=undefined}_createClass(MiniSignal,[{key:"handlers",value:function handlers(){var exists=arguments.length<=0||arguments[0]===undefined?false:arguments[0];var node=this._head;if(exists)return!!node;var ee=[];while(node){ee.push(node);node=node._next}return ee}},{key:"has",value:function has(node){if(!(node instanceof MiniSignalBinding)){throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.")}return node._owner===this}},{key:"dispatch",value:function dispatch(){var node=this._head;if(!node)return false;while(node){if(node._once)this.detach(node);node._fn.apply(node._thisArg,arguments);node=node._next}return true}},{key:"add",value:function add(fn){var thisArg=arguments.length<=1||arguments[1]===undefined?null:arguments[1];if(typeof fn!=="function"){throw new Error("MiniSignal#add(): First arg must be a Function.")}return _addMiniSignalBinding(this,new MiniSignalBinding(fn,false,thisArg))}},{key:"once",value:function once(fn){var thisArg=arguments.length<=1||arguments[1]===undefined?null:arguments[1];if(typeof fn!=="function"){throw new Error("MiniSignal#once(): First arg must be a Function.")}return _addMiniSignalBinding(this,new MiniSignalBinding(fn,true,thisArg))}},{key:"detach",value:function detach(node){if(!(node instanceof MiniSignalBinding)){throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.")}if(node._owner!==this)return this;if(node._prev)node._prev._next=node._next;if(node._next)node._next._prev=node._prev;if(node===this._head){this._head=node._next;if(node._next===null){this._tail=null}}else if(node===this._tail){this._tail=node._prev;this._tail._next=null}node._owner=null;return this}},{key:"detachAll",value:function detachAll(){var node=this._head;if(!node)return this;this._head=this._tail=null;while(node){node._owner=null;node=node._next}return this}}]);return MiniSignal}();MiniSignal.MiniSignalBinding=MiniSignalBinding;exports["default"]=MiniSignal;module.exports=exports["default"]},{}],45:[function(require,module,exports){"use strict";function Decoder(buffer){this._offset=0;if(buffer instanceof ArrayBuffer){this._buffer=buffer;this._view=new DataView(this._buffer)}else if(ArrayBuffer.isView(buffer)){this._buffer=buffer.buffer;this._view=new DataView(this._buffer,buffer.byteOffset,buffer.byteLength)}else{throw new Error("Invalid argument")}}function utf8Read(view,offset,length){var string="",chr=0;for(var i=offset,end=offset+length;i<end;i++){var byte=view.getUint8(i);if((byte&128)===0){string+=String.fromCharCode(byte);continue}if((byte&224)===192){string+=String.fromCharCode((byte&31)<<6|view.getUint8(++i)&63);continue}if((byte&240)===224){string+=String.fromCharCode((byte&15)<<12|(view.getUint8(++i)&63)<<6|(view.getUint8(++i)&63)<<0);continue}if((byte&248)===240){chr=(byte&7)<<18|(view.getUint8(++i)&63)<<12|(view.getUint8(++i)&63)<<6|(view.getUint8(++i)&63)<<0;if(chr>=65536){chr-=65536;string+=String.fromCharCode((chr>>>10)+55296,(chr&1023)+56320)}else{string+=String.fromCharCode(chr)}continue}throw new Error("Invalid byte "+byte.toString(16))}return string}Decoder.prototype._array=function(length){var value=new Array(length);for(var i=0;i<length;i++){value[i]=this._parse()}return value};Decoder.prototype._map=function(length){var key="",value={};for(var i=0;i<length;i++){key=this._parse();value[key]=this._parse()}return value};Decoder.prototype._str=function(length){var value=utf8Read(this._view,this._offset,length);this._offset+=length;return value};Decoder.prototype._bin=function(length){var value=this._buffer.slice(this._offset,this._offset+length);this._offset+=length;return value};Decoder.prototype._parse=function(){var prefix=this._view.getUint8(this._offset++);var value,length=0,type=0,hi=0,lo=0;if(prefix<192){if(prefix<128){return prefix}if(prefix<144){return this._map(prefix&15)}if(prefix<160){return this._array(prefix&15)}return this._str(prefix&31)}if(prefix>223){return(255-prefix+1)*-1}switch(prefix){case 192:return null;case 194:return false;case 195:return true;case 196:length=this._view.getUint8(this._offset);this._offset+=1;return this._bin(length);case 197:length=this._view.getUint16(this._offset);this._offset+=2;return this._bin(length);case 198:length=this._view.getUint32(this._offset);this._offset+=4;return this._bin(length);case 199:length=this._view.getUint8(this._offset);type=this._view.getInt8(this._offset+1);this._offset+=2;return[type,this._bin(length)];case 200:length=this._view.getUint16(this._offset);type=this._view.getInt8(this._offset+2);this._offset+=3;return[type,this._bin(length)];case 201:length=this._view.getUint32(this._offset);type=this._view.getInt8(this._offset+4);this._offset+=5;return[type,this._bin(length)];case 202:value=this._view.getFloat32(this._offset);this._offset+=4;return value;case 203:value=this._view.getFloat64(this._offset);this._offset+=8;return value;case 204:value=this._view.getUint8(this._offset);this._offset+=1;return value;case 205:value=this._view.getUint16(this._offset);this._offset+=2;return value;case 206:value=this._view.getUint32(this._offset);this._offset+=4;return value;case 207:hi=this._view.getUint32(this._offset)*Math.pow(2,32);lo=this._view.getUint32(this._offset+4);this._offset+=8;return hi+lo;case 208:value=this._view.getInt8(this._offset);this._offset+=1;return value;case 209:value=this._view.getInt16(this._offset);this._offset+=2;return value;case 210:value=this._view.getInt32(this._offset);this._offset+=4;return value;case 211:hi=this._view.getInt32(this._offset)*Math.pow(2,32);lo=this._view.getUint32(this._offset+4);this._offset+=8;return hi+lo;case 212:type=this._view.getInt8(this._offset);this._offset+=1;if(type===0){this._offset+=1;return void 0}return[type,this._bin(1)];case 213:type=this._view.getInt8(this._offset);this._offset+=1;return[type,this._bin(2)];case 214:type=this._view.getInt8(this._offset);this._offset+=1;return[type,this._bin(4)];case 215:type=this._view.getInt8(this._offset);this._offset+=1;if(type===0){hi=this._view.getInt32(this._offset)*Math.pow(2,32);lo=this._view.getUint32(this._offset+4);this._offset+=8;return new Date(hi+lo)}return[type,this._bin(8)];case 216:type=this._view.getInt8(this._offset);this._offset+=1;return[type,this._bin(16)];case 217:length=this._view.getUint8(this._offset);this._offset+=1;return this._str(length);case 218:length=this._view.getUint16(this._offset);this._offset+=2;return this._str(length);case 219:length=this._view.getUint32(this._offset);this._offset+=4;return this._str(length);case 220:length=this._view.getUint16(this._offset);this._offset+=2;return this._array(length);case 221:length=this._view.getUint32(this._offset);this._offset+=4;return this._array(length);case 222:length=this._view.getUint16(this._offset);this._offset+=2;return this._map(length);case 223:length=this._view.getUint32(this._offset);this._offset+=4;return this._map(length)}throw new Error("Could not parse")};function decode(buffer){var decoder=new Decoder(buffer);var value=decoder._parse();if(decoder._offset!==buffer.byteLength){throw new Error(buffer.byteLength-decoder._offset+" trailing bytes")}return value}module.exports=decode},{}],46:[function(require,module,exports){"use strict";function utf8Write(view,offset,str){var c=0;for(var i=0,l=str.length;i<l;i++){c=str.charCodeAt(i);if(c<128){view.setUint8(offset++,c)}else if(c<2048){view.setUint8(offset++,192|c>>6);view.setUint8(offset++,128|c&63)}else if(c<55296||c>=57344){view.setUint8(offset++,224|c>>12);view.setUint8(offset++,128|c>>6&63);view.setUint8(offset++,128|c&63)}else{i++;c=65536+((c&1023)<<10|str.charCodeAt(i)&1023);view.setUint8(offset++,240|c>>18);view.setUint8(offset++,128|c>>12&63);view.setUint8(offset++,128|c>>6&63);view.setUint8(offset++,128|c&63)}}}function utf8Length(str){var c=0,length=0;for(var i=0,l=str.length;i<l;i++){c=str.charCodeAt(i);if(c<128){length+=1}else if(c<2048){length+=2}else if(c<55296||c>=57344){length+=3}else{i++;length+=4}}return length}function _encode(bytes,defers,value){var type=typeof value,i=0,l=0,hi=0,lo=0,length=0,size=0;if(type==="string"){length=utf8Length(value);if(length<32){bytes.push(length|160);size=1}else if(length<256){bytes.push(217,length);size=2}else if(length<65536){bytes.push(218,length>>8,length);size=3}else if(length<4294967296){bytes.push(219,length>>24,length>>16,length>>8,length);size=5}else{throw new Error("String too long")}defers.push({_str:value,_length:length,_offset:bytes.length});return size+length}if(type==="number"){if(Math.floor(value)!==value||!isFinite(value)){bytes.push(203);defers.push({_float:value,_length:8,_offset:bytes.length});return 9}if(value>=0){if(value<128){bytes.push(value);return 1}if(value<256){bytes.push(204,value);return 2}if(value<65536){bytes.push(205,value>>8,value);return 3}if(value<4294967296){bytes.push(206,value>>24,value>>16,value>>8,value);return 5}hi=value/Math.pow(2,32)>>0;lo=value>>>0;bytes.push(207,hi>>24,hi>>16,hi>>8,hi,lo>>24,lo>>16,lo>>8,lo);return 9}else{if(value>=-32){bytes.push(value);return 1}if(value>=-128){bytes.push(208,value);return 2}if(value>=-32768){bytes.push(209,value>>8,value);return 3}if(value>=-2147483648){bytes.push(210,value>>24,value>>16,value>>8,value);return 5}hi=Math.floor(value/Math.pow(2,32));lo=value>>>0;bytes.push(211,hi>>24,hi>>16,hi>>8,hi,lo>>24,lo>>16,lo>>8,lo);return 9}}if(type==="object"){if(value===null){bytes.push(192);return 1}if(Array.isArray(value)){length=value.length;if(length<16){bytes.push(length|144);size=1}else if(length<65536){bytes.push(220,length>>8,length);size=3}else if(length<4294967296){bytes.push(221,length>>24,length>>16,length>>8,length);size=5}else{throw new Error("Array too large")}for(i=0;i<length;i++){size+=_encode(bytes,defers,value[i])}return size}if(value instanceof Date){var time=value.getTime();hi=Math.floor(time/Math.pow(2,32));lo=time>>>0;bytes.push(215,0,hi>>24,hi>>16,hi>>8,hi,lo>>24,lo>>16,lo>>8,lo);return 10}if(value instanceof ArrayBuffer){length=value.byteLength;if(length<256){bytes.push(196,length);size=2}else if(length<65536){bytes.push(197,length>>8,length);size=3}else if(length<4294967296){bytes.push(198,length>>24,length>>16,length>>8,length);size=5}else{throw new Error("Buffer too large")}defers.push({_bin:value,_length:length,_offset:bytes.length});return size+length}if(typeof value.toJSON==="function"){return _encode(bytes,defers,value.toJSON())}var keys=[],key="";var allKeys=Object.keys(value);for(i=0,l=allKeys.length;i<l;i++){key=allKeys[i];if(typeof value[key]!=="function"){keys.push(key)}}length=keys.length;if(length<16){bytes.push(length|128);size=1}else if(length<65536){bytes.push(222,length>>8,length);size=3}else if(length<4294967296){bytes.push(223,length>>24,length>>16,length>>8,length);size=5}else{throw new Error("Object too large")}for(i=0;i<length;i++){key=keys[i];size+=_encode(bytes,defers,key);size+=_encode(bytes,defers,value[key])}return size}if(type==="boolean"){bytes.push(value?195:194);return 1}if(type==="undefined"){bytes.push(212,0,0);return 3}throw new Error("Could not encode")}function encode(value){var bytes=[];var defers=[];var size=_encode(bytes,defers,value);var buf=new ArrayBuffer(size);var view=new DataView(buf);var deferIndex=0;var deferWritten=0;var nextOffset=-1;if(defers.length>0){nextOffset=defers[0]._offset}var defer,deferLength=0,offset=0;for(var i=0,l=bytes.length;i<l;i++){view.setUint8(deferWritten+i,bytes[i]);if(i+1!==nextOffset){continue}defer=defers[deferIndex];deferLength=defer._length;offset=deferWritten+nextOffset;if(defer._bin){var bin=new Uint8Array(defer._bin);for(var j=0;j<deferLength;j++){view.setUint8(offset+j,bin[j])}}else if(defer._str){utf8Write(view,offset,defer._str)}else if(defer._float!==undefined){view.setFloat64(offset,defer._float)}deferIndex++;deferWritten+=deferLength;if(defers[deferIndex]){nextOffset=defers[deferIndex]._offset}}return buf}module.exports=encode},{}],47:[function(require,module,exports){"use strict";var getOwnPropertySymbols=Object.getOwnPropertySymbols;var hasOwnProperty=Object.prototype.hasOwnProperty;var propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(val===null||val===undefined){throw new TypeError("Object.assign cannot be called with null or undefined")}return Object(val)}function shouldUseNative(){try{if(!Object.assign){return false}var test1=new String("abc");test1[5]="de";if(Object.getOwnPropertyNames(test1)[0]==="5"){return false}var test2={};for(var i=0;i<10;i++){test2["_"+String.fromCharCode(i)]=i}var order2=Object.getOwnPropertyNames(test2).map(function(n){return test2[n]});if(order2.join("")!=="0123456789"){return false}var test3={};"abcdefghijklmnopqrst".split("").forEach(function(letter){test3[letter]=letter});if(Object.keys(Object.assign({},test3)).join("")!=="abcdefghijklmnopqrst"){return false}return true}catch(err){return false}}module.exports=shouldUseNative()?Object.assign:function(target,source){var from;var to=toObject(target);var symbols;for(var s=1;s<arguments.length;s++){from=Object(arguments[s]);for(var key in from){if(hasOwnProperty.call(from,key)){to[key]=from[key]}}if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++){if(propIsEnumerable.call(from,symbols[i])){to[symbols[i]]=from[symbols[i]]}}}}return to}},{}],48:[function(require,module,exports){"use strict";module.exports=function parseURI(str,opts){opts=opts||{};var o={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var m=o.parser[opts.strictMode?"strict":"loose"].exec(str);var uri={};var i=14;while(i--)uri[o.key[i]]=m[i]||"";uri[o.q.name]={};uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){if($1)uri[o.q.name][$1]=$2});return uri}},{}],49:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.isAbsolute=function(path){return path.charAt(0)==="/"};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=="string"){throw new TypeError("Arguments to path.join must be strings")}return p}).join("/"))};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/";exports.delimiter=":";exports.dirname=function(path){if(typeof path!=="string")path=path+"";if(path.length===0)return".";var code=path.charCodeAt(0);var hasRoot=code===47;var end=-1;var matchedSlash=true;for(var i=path.length-1;i>=1;--i){code=path.charCodeAt(i);if(code===47){if(!matchedSlash){end=i;break}}else{matchedSlash=false}}if(end===-1)return hasRoot?"/":".";if(hasRoot&&end===1){return"/"}return path.slice(0,end)};function basename(path){if(typeof path!=="string")path=path+"";var start=0;var end=-1;var matchedSlash=true;var i;for(i=path.length-1;i>=0;--i){if(path.charCodeAt(i)===47){if(!matchedSlash){start=i+1;break}}else if(end===-1){matchedSlash=false;end=i+1}}if(end===-1)return"";return path.slice(start,end)}exports.basename=function(path,ext){var f=basename(path);if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){if(typeof path!=="string")path=path+"";var startDot=-1;var startPart=0;var end=-1;var matchedSlash=true;var preDotState=0;for(var i=path.length-1;i>=0;--i){var code=path.charCodeAt(i);if(code===47){if(!matchedSlash){startPart=i+1;break}continue}if(end===-1){matchedSlash=false;end=i+1}if(code===46){if(startDot===-1)startDot=i;else if(preDotState!==1)preDotState=1}else if(startDot!==-1){preDotState=-1}}if(startDot===-1||end===-1||preDotState===0||preDotState===1&&startDot===end-1&&startDot===startPart+1){return""}return path.slice(startDot,end)};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}return res}var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)}}).call(this,require("_process"))},{_process:236}],50:[function(require,module,exports){(function(){var penner,umd;umd=function(factory){if(typeof exports==="object"){return module.exports=factory}else if(typeof define==="function"&&define.amd){return define([],factory)}else{return this.penner=factory}};penner={linear:function(t,b,c,d){return c*t/d+b},easeInQuad:function(t,b,c,d){return c*(t/=d)*t+b},easeOutQuad:function(t,b,c,d){return-c*(t/=d)*(t-2)+b},easeInOutQuad:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t+b}else{return-c/2*(--t*(t-2)-1)+b}},easeInCubic:function(t,b,c,d){return c*(t/=d)*t*t+b},easeOutCubic:function(t,b,c,d){return c*((t=t/d-1)*t*t+1)+b},easeInOutCubic:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t+b}else{return c/2*((t-=2)*t*t+2)+b}},easeInQuart:function(t,b,c,d){return c*(t/=d)*t*t*t+b},easeOutQuart:function(t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b},easeInOutQuart:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t*t+b}else{return-c/2*((t-=2)*t*t*t-2)+b}},easeInQuint:function(t,b,c,d){return c*(t/=d)*t*t*t*t+b},easeOutQuint:function(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b},easeInOutQuint:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t*t*t+b}else{return c/2*((t-=2)*t*t*t*t+2)+b}},easeInSine:function(t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b},easeOutSine:function(t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b},easeInOutSine:function(t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b},easeInExpo:function(t,b,c,d){if(t===0){return b}else{return c*Math.pow(2,10*(t/d-1))+b}},easeOutExpo:function(t,b,c,d){if(t===d){return b+c}else{return c*(-Math.pow(2,-10*t/d)+1)+b}},easeInOutExpo:function(t,b,c,d){if(t===0){b}if(t===d){b+c}if((t/=d/2)<1){return c/2*Math.pow(2,10*(t-1))+b}else{return c/2*(-Math.pow(2,-10*--t)+2)+b}},easeInCirc:function(t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b},easeOutCirc:function(t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b},easeInOutCirc:function(t,b,c,d){if((t/=d/2)<1){return-c/2*(Math.sqrt(1-t*t)-1)+b}else{return c/2*(Math.sqrt(1-(t-=2)*t)+1)+b}},easeInElastic:function(t,b,c,d){var a,p,s;s=1.70158;p=0;a=c;if(t===0){b}else if((t/=d)===1){b+c}if(!p){p=d*.3}if(a<Math.abs(c)){a=c;s=p/4}else{s=p/(2*Math.PI)*Math.asin(c/a)}return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b},easeOutElastic:function(t,b,c,d){var a,p,s;s=1.70158;p=0;a=c;if(t===0){b}else if((t/=d)===1){b+c}if(!p){p=d*.3}if(a<Math.abs(c)){a=c;s=p/4}else{s=p/(2*Math.PI)*Math.asin(c/a)}return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b},easeInOutElastic:function(t,b,c,d){var a,p,s;s=1.70158;p=0;a=c;if(t===0){b}else if((t/=d/2)===2){b+c}if(!p){p=d*(.3*1.5)}if(a<Math.abs(c)){a=c;s=p/4}else{s=p/(2*Math.PI)*Math.asin(c/a)}if(t<1){return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b}else{return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*.5+c+b}},easeInBack:function(t,b,c,d,s){if(s===void 0){s=1.70158}return c*(t/=d)*t*((s+1)*t-s)+b},easeOutBack:function(t,b,c,d,s){if(s===void 0){s=1.70158}return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b},easeInOutBack:function(t,b,c,d,s){if(s===void 0){s=1.70158}if((t/=d/2)<1){return c/2*(t*t*(((s*=1.525)+1)*t-s))+b}else{return c/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+b}},easeInBounce:function(t,b,c,d){var v;v=penner.easeOutBounce(d-t,0,c,d);return c-v+b},easeOutBounce:function(t,b,c,d){if((t/=d)<1/2.75){return c*(7.5625*t*t)+b}else if(t<2/2.75){return c*(7.5625*(t-=1.5/2.75)*t+.75)+b}else if(t<2.5/2.75){return c*(7.5625*(t-=2.25/2.75)*t+.9375)+b}else{return c*(7.5625*(t-=2.625/2.75)*t+.984375)+b}},easeInOutBounce:function(t,b,c,d){var v;if(t<d/2){v=penner.easeInBounce(t*2,0,c,d);return v*.5+b}else{v=penner.easeOutBounce(t*2-d,0,c,d);return v*.5+c*.5+b}}};umd(penner)}).call(this)},{}],51:[function(require,module,exports){"use strict";module.exports={Simple:require("./simple"),SpatialHash:require("./spatial-hash")}},{"./simple":52,"./spatial-hash":53}],52:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Simple=function(){function Simple(options){_classCallCheck(this,Simple);options=options||{};this.visible=options.visible||"visible";this.calculatePIXI=typeof options.calculatePIXI!=="undefined"?options.calculatePIXI:true;this.dirtyTest=typeof options.dirtyTest!=="undefined"?options.dirtyTest:true;this.AABB=options.AABB||"AABB";this.lists=[[]]}_createClass(Simple,[{key:"addList",value:function addList(array,staticObject){this.lists.push(array);if(staticObject){array.staticObject=true}if(this.calculatePIXI&&this.dirtyTest){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=array[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var object=_step.value;this.updateObject(object)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}return array}},{key:"removeList",value:function removeList(array){this.lists.splice(this.lists.indexOf(array),1);return array}},{key:"add",value:function add(object,staticObject){if(staticObject){object.staticObject=true}if(this.calculatePIXI&&(this.dirtyTest||staticObject)){this.updateObject(object)}this.lists[0].push(object);return object}},{key:"remove",value:function remove(object){this.lists[0].splice(this.lists[0].indexOf(object),1);return object}},{key:"cull",value:function cull(bounds,skipUpdate){if(this.calculatePIXI&&!skipUpdate){this.updateObjects()}var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.lists[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var list=_step2.value;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=list[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var object=_step3.value;var box=object[this.AABB];object[this.visible]=box.x+box.width>bounds.x&&box.x<bounds.x+bounds.width&&box.y+box.height>bounds.y&&box.y<bounds.y+bounds.height}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"updateObjects",value:function updateObjects(){if(this.dirtyTest){var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=this.lists[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var list=_step4.value;if(!list.staticObject){var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=list[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var object=_step5.value;if(!object.staticObject&&object[this.dirty]){this.updateObject(object);object[this.dirty]=false}}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return()}}finally{if(_didIteratorError5){throw _iteratorError5}}}}}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}}else{var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=this.lists[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var _list=_step6.value;if(!_list.staticObject){var _iteratorNormalCompletion7=true;var _didIteratorError7=false;var _iteratorError7=undefined;try{for(var _iterator7=_list[Symbol.iterator](),_step7;!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=true){var _object=_step7.value;if(!_object.staticObject){this.updateObject(_object)}}}catch(err){_didIteratorError7=true;_iteratorError7=err}finally{try{if(!_iteratorNormalCompletion7&&_iterator7.return){_iterator7.return()}}finally{if(_didIteratorError7){throw _iteratorError7}}}}}}catch(err){_didIteratorError6=true;_iteratorError6=err}finally{try{if(!_iteratorNormalCompletion6&&_iterator6.return){_iterator6.return()}}finally{if(_didIteratorError6){throw _iteratorError6}}}}}},{key:"updateObject",value:function updateObject(object){var box=object.getLocalBounds();object[this.AABB]=object[this.AABB]||{};object[this.AABB].x=object.x+box.x*object.scale.x;object[this.AABB].y=object.y+box.y*object.scale.y;object[this.AABB].width=box.width*object.scale.x;object[this.AABB].height=box.height*object.scale.y}},{key:"query",value:function query(bounds){var results=[];var _iteratorNormalCompletion8=true;var _didIteratorError8=false;var _iteratorError8=undefined;try{for(var _iterator8=this.lists[Symbol.iterator](),_step8;!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=true){var list=_step8.value;var _iteratorNormalCompletion9=true;var _didIteratorError9=false;var _iteratorError9=undefined;try{for(var _iterator9=list[Symbol.iterator](),_step9;!(_iteratorNormalCompletion9=(_step9=_iterator9.next()).done);_iteratorNormalCompletion9=true){var object=_step9.value;var box=object[this.AABB];if(box.x+box.width>bounds.x&&box.x-box.width<bounds.x+bounds.width&&box.y+box.height>bounds.y&&box.y-box.height<bounds.y+bounds.height){results.push(object)}}}catch(err){_didIteratorError9=true;_iteratorError9=err}finally{try{if(!_iteratorNormalCompletion9&&_iterator9.return){_iterator9.return()}}finally{if(_didIteratorError9){throw _iteratorError9}}}}}catch(err){_didIteratorError8=true;_iteratorError8=err}finally{try{if(!_iteratorNormalCompletion8&&_iterator8.return){_iterator8.return()}}finally{if(_didIteratorError8){throw _iteratorError8}}}return results}},{key:"queryCallback",value:function queryCallback(bounds,callback){var _iteratorNormalCompletion10=true;var _didIteratorError10=false;var _iteratorError10=undefined;try{for(var _iterator10=this.lists[Symbol.iterator](),_step10;!(_iteratorNormalCompletion10=(_step10=_iterator10.next()).done);_iteratorNormalCompletion10=true){var list=_step10.value;var _iteratorNormalCompletion11=true;var _didIteratorError11=false;var _iteratorError11=undefined;try{for(var _iterator11=list[Symbol.iterator](),_step11;!(_iteratorNormalCompletion11=(_step11=_iterator11.next()).done);_iteratorNormalCompletion11=true){var object=_step11.value;var box=object[this.AABB];if(box.x+box.width>bounds.x&&box.x-box.width<bounds.x+bounds.width&&box.y+box.height>bounds.y&&box.y-box.height<bounds.y+bounds.height){if(callback(object)){return true}}}}catch(err){_didIteratorError11=true;_iteratorError11=err}finally{try{if(!_iteratorNormalCompletion11&&_iterator11.return){_iterator11.return()}}finally{if(_didIteratorError11){throw _iteratorError11}}}}}catch(err){_didIteratorError10=true;_iteratorError10=err}finally{try{if(!_iteratorNormalCompletion10&&_iterator10.return){_iterator10.return()}}finally{if(_didIteratorError10){throw _iteratorError10}}}return false}},{key:"stats",value:function stats(){var visible=0,count=0;var _iteratorNormalCompletion12=true;var _didIteratorError12=false;var _iteratorError12=undefined;try{for(var _iterator12=this.lists[Symbol.iterator](),_step12;!(_iteratorNormalCompletion12=(_step12=_iterator12.next()).done);_iteratorNormalCompletion12=true){var list=_step12.value;list.forEach(function(object){visible+=object.visible?1:0;count++})}}catch(err){_didIteratorError12=true;_iteratorError12=err}finally{try{if(!_iteratorNormalCompletion12&&_iterator12.return){_iterator12.return()}}finally{if(_didIteratorError12){throw _iteratorError12}}}return{total:count,visible:visible,culled:count-visible}}}]);return Simple}();module.exports=Simple},{}],53:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var SpatialHash=function(){function SpatialHash(options){_classCallCheck(this,SpatialHash);options=options||{};this.xSize=options.xSize||options.size||1e3;this.ySize=options.ySize||options.size||1e3;this.AABB=options.type||"AABB";this.spatial=options.spatial||"spatial";this.calculatePIXI=typeof options.calculatePIXI!=="undefined"?options.calculatePIXI:true;this.visibleText=typeof options.visibleTest!=="undefined"?options.visibleTest:true;this.simpleTest=typeof options.simpleTest!=="undefined"?options.simpleTest:true;this.dirtyTest=typeof options.dirtyTest!=="undefined"?options.dirtyTest:true;this.visible=options.visible||"visible";this.dirty=options.dirty||"dirty";this.width=this.height=0;this.hash={};this.objects=[];this.containers=[]}_createClass(SpatialHash,[{key:"add",value:function add(object,staticObject){object[this.spatial]={hashes:[]};if(this.calculatePIXI&&this.dirtyTest){object[this.dirty]=true}if(staticObject){object.staticObject=true}this.updateObject(object);this.containers[0].push(object)}},{key:"remove",value:function remove(object){this.containers[0].splice(this.list[0].indexOf(object),1);this.removeFromHash(object);return object}},{key:"addContainer",value:function addContainer(container,staticObject){var added=function(object){object[this.spatial]={hashes:[]};this.updateObject(object)}.bind(this);var removed=function(object){this.removeFromHash(object)}.bind(this);var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=container.children[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var object=_step.value;object[this.spatial]={hashes:[]};this.updateObject(object)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}container.cull={};this.containers.push(container);container.on("childAdded",added);container.on("childRemoved",removed);container.cull.added=added;container.cull.removed=removed;if(staticObject){container.cull.static=true}}},{key:"removeContainer",value:function removeContainer(container){var _this=this;this.containers.splice(this.containers.indexOf(container),1);container.children.forEach(function(object){return _this.removeFromHash(object)});container.off("added",container.cull.added);container.off("removed",container.cull.removed);delete container.cull;return container}},{key:"cull",value:function cull(AABB,skipUpdate){var _this2=this;if(!skipUpdate){this.updateObjects()}this.invisible();var objects=this.query(AABB,this.simpleTest);objects.forEach(function(object){return object[_this2.visible]=true});return this.lastBuckets}},{key:"invisible",value:function invisible(){var _this3=this;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.containers[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var container=_step2.value;container.children.forEach(function(object){return object[_this3.visible]=false})}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"updateObjects",value:function updateObjects(){var _this4=this;if(this.dirtyTest){var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=this.objects[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var object=_step3.value;if(object[this.dirty]){this.updateObject(object);object[this.dirty]=false}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=this.containers[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var container=_step4.value;var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=container.children[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var _object=_step5.value;if(_object[this.dirty]){this.updateObject(_object);_object[this.dirty]=false}}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return()}}finally{if(_didIteratorError5){throw _iteratorError5}}}}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}}else{var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=this.containers[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var _container=_step6.value;if(!_container.cull.static){_container.children.forEach(function(object){return _this4.updateObject(object)})}}}catch(err){_didIteratorError6=true;_iteratorError6=err}finally{try{if(!_iteratorNormalCompletion6&&_iterator6.return){_iterator6.return()}}finally{if(_didIteratorError6){throw _iteratorError6}}}}}},{key:"updateObject",value:function updateObject(object){var AABB=void 0;if(this.calculatePIXI){var box=object.getLocalBounds();AABB=object[this.AABB]={x:object.x+box.x*object.scale.x,y:object.y+box.y*object.scale.y,width:box.width*object.scale.x,height:box.height*object.scale.y}}else{AABB=object[this.AABB]}var spatial=object[this.spatial];if(!spatial){spatial=object[this.spatial]={hashes:[]}}var _getBounds=this.getBounds(AABB),xStart=_getBounds.xStart,yStart=_getBounds.yStart,xEnd=_getBounds.xEnd,yEnd=_getBounds.yEnd;if(spatial.xStart!==xStart||spatial.yStart!==yStart||spatial.xEnd!==xEnd||spatial.yEnd!==yEnd){if(spatial.hashes.length){this.removeFromHash(object)}for(var y=yStart;y<=yEnd;y++){for(var x=xStart;x<=xEnd;x++){var key=x+","+y;this.insert(object,key);spatial.hashes.push(key)}}spatial.xStart=xStart;spatial.yStart=yStart;spatial.xEnd=xEnd;spatial.yEnd=yEnd}}},{key:"getBuckets",value:function getBuckets(){var minimum=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var hashes=[];for(var key in this.hash){var hash=this.hash[key];if(hash.length>=minimum){hashes.push(hash)}}return hashes}},{key:"getBounds",value:function getBounds(AABB){var xStart=Math.floor(AABB.x/this.xSize);var yStart=Math.floor(AABB.y/this.ySize);var xEnd=Math.floor((AABB.x+AABB.width)/this.xSize);var yEnd=Math.floor((AABB.y+AABB.height)/this.ySize);return{xStart:xStart,yStart:yStart,xEnd:xEnd,yEnd:yEnd}}},{key:"insert",value:function insert(object,key){if(!this.hash[key]){this.hash[key]=[object]}else{this.hash[key].push(object)}}},{key:"removeFromHash",value:function removeFromHash(object){var spatial=object[this.spatial];while(spatial.hashes.length){var key=spatial.hashes.pop();var list=this.hash[key];list.splice(list.indexOf(object),1)}}},{key:"neighbors",value:function neighbors(object){var _this5=this;var results=[];object[this.spatial].hashes.forEach(function(key){return results=results.concat(_this5.hash[key])});return results}},{key:"query",value:function query(AABB,simpleTest){simpleTest=typeof simpleTest!=="undefined"?simpleTest:true;var buckets=0;var results=[];var _getBounds2=this.getBounds(AABB),xStart=_getBounds2.xStart,yStart=_getBounds2.yStart,xEnd=_getBounds2.xEnd,yEnd=_getBounds2.yEnd;for(var y=yStart;y<=yEnd;y++){for(var x=xStart;x<=xEnd;x++){var entry=this.hash[x+","+y];if(entry){if(simpleTest){var _iteratorNormalCompletion7=true;var _didIteratorError7=false;var _iteratorError7=undefined;try{for(var _iterator7=entry[Symbol.iterator](),_step7;!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=true){var object=_step7.value;var box=object[this.AABB];if(box.x+box.width>AABB.x&&box.x<AABB.x+AABB.width&&box.y+box.height>AABB.y&&box.y<AABB.y+AABB.height){results.push(object)}}}catch(err){_didIteratorError7=true;_iteratorError7=err}finally{try{if(!_iteratorNormalCompletion7&&_iterator7.return){_iterator7.return()}}finally{if(_didIteratorError7){throw _iteratorError7}}}}else{results=results.concat(entry)}buckets++}}}this.lastBuckets=buckets;return results}},{key:"queryCallback",value:function queryCallback(AABB,callback,simpleTest){simpleTest=typeof simpleTest!=="undefined"?simpleTest:true;var _getBounds3=this.getBounds(AABB),xStart=_getBounds3.xStart,yStart=_getBounds3.yStart,xEnd=_getBounds3.xEnd,yEnd=_getBounds3.yEnd;for(var y=yStart;y<=yEnd;y++){for(var x=xStart;x<=xEnd;x++){var entry=this.hash[x+","+y];if(entry){for(var i=0;i<entry.length;i++){var object=entry[i];if(simpleTest){var _AABB=object.AABB;if(_AABB.x+_AABB.width>_AABB.x&&_AABB.x<_AABB.x+_AABB.width&&_AABB.y+_AABB.height>_AABB.y&&_AABB.y<_AABB.y+_AABB.height){if(callback(object)){return true}}}else{if(callback(object)){return true}}}}}}return false}},{key:"stats",value:function stats(){var visible=0,count=0;var _iteratorNormalCompletion8=true;var _didIteratorError8=false;var _iteratorError8=undefined;try{for(var _iterator8=this.containers[Symbol.iterator](),_step8;!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=true){var list=_step8.value;for(var i=0;i<list.children.length;i++){var object=list.children[i];visible+=object.visible?1:0;count++}}}catch(err){_didIteratorError8=true;_iteratorError8=err}finally{try{if(!_iteratorNormalCompletion8&&_iterator8.return){_iterator8.return()}}finally{if(_didIteratorError8){throw _iteratorError8}}}return{total:count,visible:visible,culled:count-visible}}},{key:"getNumberOfBuckets",value:function getNumberOfBuckets(){return Object.keys(this.hash).length}},{key:"getAverageSize",value:function getAverageSize(){var total=0;for(var key in this.hash){total+=this.hash[key].length}return total/this.getBuckets().length}},{key:"getLargest",value:function getLargest(){var largest=0;for(var key in this.hash){if(this.hash[key].length>largest){largest=this.hash[key].length}}return largest}},{key:"getWorldBounds",value:function getWorldBounds(){var xStart=Infinity,yStart=Infinity,xEnd=0,yEnd=0;for(var key in this.hash){var split=key.split(",");var x=parseInt(split[0]);var y=parseInt(split[1]);xStart=x<xStart?x:xStart;yStart=y<yStart?y:yStart;xEnd=x>xEnd?x:xEnd;yEnd=y>yEnd?y:yEnd}return{xStart:xStart,yStart:yStart,xEnd:xEnd,yEnd:yEnd}}},{key:"getSparseness",value:function getSparseness(AABB){var count=0,total=0;var _ref=AABB?this.getBounds(AABB):this.getWorldBounds(),xStart=_ref.xStart,yStart=_ref.yStart,xEnd=_ref.xEnd,yEnd=_ref.yEnd;for(var y=yStart;y<yEnd;y++){for(var x=xStart;x<xEnd;x++){count+=this.hash[x+","+y]?1:0;total++}}return count/total}}]);return SpatialHash}();module.exports=SpatialHash},{}],54:[function(require,module,exports){var EMPTY_ARRAY_BUFFER=new ArrayBuffer(0);var Buffer=function(gl,type,data,drawType){this.gl=gl;this.buffer=gl.createBuffer();this.type=type||gl.ARRAY_BUFFER;this.drawType=drawType||gl.STATIC_DRAW;this.data=EMPTY_ARRAY_BUFFER;if(data){this.upload(data)}this._updateID=0};Buffer.prototype.upload=function(data,offset,dontBind){if(!dontBind)this.bind();var gl=this.gl;data=data||this.data;offset=offset||0;if(this.data.byteLength>=data.byteLength){gl.bufferSubData(this.type,offset,data)}else{gl.bufferData(this.type,data,this.drawType)}this.data=data};Buffer.prototype.bind=function(){var gl=this.gl;gl.bindBuffer(this.type,this.buffer)};Buffer.createVertexBuffer=function(gl,data,drawType){return new Buffer(gl,gl.ARRAY_BUFFER,data,drawType)};Buffer.createIndexBuffer=function(gl,data,drawType){return new Buffer(gl,gl.ELEMENT_ARRAY_BUFFER,data,drawType)};Buffer.create=function(gl,type,data,drawType){return new Buffer(gl,type,data,drawType)};Buffer.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)};module.exports=Buffer},{}],55:[function(require,module,exports){var Texture=require("./GLTexture");var Framebuffer=function(gl,width,height){this.gl=gl;this.framebuffer=gl.createFramebuffer();this.stencil=null;this.texture=null;this.width=width||100;this.height=height||100};Framebuffer.prototype.enableTexture=function(texture){var gl=this.gl;this.texture=texture||new Texture(gl);this.texture.bind();this.bind();gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.texture.texture,0)};Framebuffer.prototype.enableStencil=function(){if(this.stencil)return;var gl=this.gl;this.stencil=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,this.stencil);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,this.stencil);gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,this.width,this.height)};Framebuffer.prototype.clear=function(r,g,b,a){this.bind();var gl=this.gl;gl.clearColor(r,g,b,a);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT)};Framebuffer.prototype.bind=function(){var gl=this.gl;gl.bindFramebuffer(gl.FRAMEBUFFER,this.framebuffer)};Framebuffer.prototype.unbind=function(){var gl=this.gl;gl.bindFramebuffer(gl.FRAMEBUFFER,null)};Framebuffer.prototype.resize=function(width,height){var gl=this.gl;this.width=width;this.height=height;if(this.texture){this.texture.uploadData(null,width,height)}if(this.stencil){gl.bindRenderbuffer(gl.RENDERBUFFER,this.stencil);gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,width,height)}};Framebuffer.prototype.destroy=function(){var gl=this.gl;if(this.texture){this.texture.destroy()}gl.deleteFramebuffer(this.framebuffer);this.gl=null;this.stencil=null;this.texture=null};Framebuffer.createRGBA=function(gl,width,height,data){var texture=Texture.fromData(gl,null,width,height);texture.enableNearestScaling();texture.enableWrapClamp();var fbo=new Framebuffer(gl,width,height);fbo.enableTexture(texture);fbo.unbind();return fbo};Framebuffer.createFloat32=function(gl,width,height,data){var texture=new Texture.fromData(gl,data,width,height);texture.enableNearestScaling();texture.enableWrapClamp();var fbo=new Framebuffer(gl,width,height);fbo.enableTexture(texture);fbo.unbind();return fbo};module.exports=Framebuffer},{"./GLTexture":57}],56:[function(require,module,exports){var compileProgram=require("./shader/compileProgram"),extractAttributes=require("./shader/extractAttributes"),extractUniforms=require("./shader/extractUniforms"),setPrecision=require("./shader/setPrecision"),generateUniformAccessObject=require("./shader/generateUniformAccessObject");var Shader=function(gl,vertexSrc,fragmentSrc,precision,attributeLocations){this.gl=gl;if(precision){vertexSrc=setPrecision(vertexSrc,precision);fragmentSrc=setPrecision(fragmentSrc,precision)}this.program=compileProgram(gl,vertexSrc,fragmentSrc,attributeLocations);this.attributes=extractAttributes(gl,this.program);this.uniformData=extractUniforms(gl,this.program);this.uniforms=generateUniformAccessObject(gl,this.uniformData)};Shader.prototype.bind=function(){this.gl.useProgram(this.program);return this};Shader.prototype.destroy=function(){this.attributes=null;this.uniformData=null;this.uniforms=null;var gl=this.gl;gl.deleteProgram(this.program)};module.exports=Shader},{"./shader/compileProgram":62,"./shader/extractAttributes":64,"./shader/extractUniforms":65,"./shader/generateUniformAccessObject":66,"./shader/setPrecision":70}],57:[function(require,module,exports){var Texture=function(gl,width,height,format,type){this.gl=gl;this.texture=gl.createTexture();this.mipmap=false;this.premultiplyAlpha=false;this.width=width||-1;this.height=height||-1;this.format=format||gl.RGBA;this.type=type||gl.UNSIGNED_BYTE};Texture.prototype.upload=function(source){this.bind();var gl=this.gl;gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha);var newWidth=source.videoWidth||source.width;var newHeight=source.videoHeight||source.height;if(newHeight!==this.height||newWidth!==this.width){gl.texImage2D(gl.TEXTURE_2D,0,this.format,this.format,this.type,source)}else{gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,this.format,this.type,source)}this.width=newWidth;this.height=newHeight};var FLOATING_POINT_AVAILABLE=false;Texture.prototype.uploadData=function(data,width,height){this.bind();var gl=this.gl;if(data instanceof Float32Array){if(!FLOATING_POINT_AVAILABLE){var ext=gl.getExtension("OES_texture_float");if(ext){FLOATING_POINT_AVAILABLE=true}else{throw new Error("floating point textures not available")}}this.type=gl.FLOAT}else{this.type=this.type||gl.UNSIGNED_BYTE}gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha);if(width!==this.width||height!==this.height){gl.texImage2D(gl.TEXTURE_2D,0,this.format,width,height,0,this.format,this.type,data||null)}else{gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,width,height,this.format,this.type,data||null)}this.width=width;this.height=height};Texture.prototype.bind=function(location){var gl=this.gl;if(location!==undefined){gl.activeTexture(gl.TEXTURE0+location)}gl.bindTexture(gl.TEXTURE_2D,this.texture)};Texture.prototype.unbind=function(){var gl=this.gl;gl.bindTexture(gl.TEXTURE_2D,null)};Texture.prototype.minFilter=function(linear){var gl=this.gl;this.bind();if(this.mipmap){gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,linear?gl.LINEAR_MIPMAP_LINEAR:gl.NEAREST_MIPMAP_NEAREST)}else{gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,linear?gl.LINEAR:gl.NEAREST)}};Texture.prototype.magFilter=function(linear){var gl=this.gl;this.bind();gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,linear?gl.LINEAR:gl.NEAREST)};Texture.prototype.enableMipmap=function(){var gl=this.gl;this.bind();this.mipmap=true;gl.generateMipmap(gl.TEXTURE_2D)};Texture.prototype.enableLinearScaling=function(){this.minFilter(true);this.magFilter(true)};Texture.prototype.enableNearestScaling=function(){this.minFilter(false);this.magFilter(false)};Texture.prototype.enableWrapClamp=function(){var gl=this.gl;this.bind();gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE)};Texture.prototype.enableWrapRepeat=function(){var gl=this.gl;this.bind();gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.REPEAT)};Texture.prototype.enableWrapMirrorRepeat=function(){var gl=this.gl;this.bind();gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.MIRRORED_REPEAT);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.MIRRORED_REPEAT)};Texture.prototype.destroy=function(){var gl=this.gl;gl.deleteTexture(this.texture)};Texture.fromSource=function(gl,source,premultiplyAlpha){var texture=new Texture(gl);texture.premultiplyAlpha=premultiplyAlpha||false;texture.upload(source);return texture};Texture.fromData=function(gl,data,width,height){var texture=new Texture(gl);texture.uploadData(data,width,height);return texture};module.exports=Texture},{}],58:[function(require,module,exports){var setVertexAttribArrays=require("./setVertexAttribArrays");function VertexArrayObject(gl,state){this.nativeVaoExtension=null;if(!VertexArrayObject.FORCE_NATIVE){this.nativeVaoExtension=gl.getExtension("OES_vertex_array_object")||gl.getExtension("MOZ_OES_vertex_array_object")||gl.getExtension("WEBKIT_OES_vertex_array_object")}this.nativeState=state;if(this.nativeVaoExtension){this.nativeVao=this.nativeVaoExtension.createVertexArrayOES();var maxAttribs=gl.getParameter(gl.MAX_VERTEX_ATTRIBS);this.nativeState={tempAttribState:new Array(maxAttribs),attribState:new Array(maxAttribs)}}this.gl=gl;this.attributes=[];this.indexBuffer=null;this.dirty=false}VertexArrayObject.prototype.constructor=VertexArrayObject;module.exports=VertexArrayObject;VertexArrayObject.FORCE_NATIVE=false;VertexArrayObject.prototype.bind=function(){if(this.nativeVao){this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao);if(this.dirty){this.dirty=false;this.activate();return this}if(this.indexBuffer){this.indexBuffer.bind()}}else{this.activate()}return this};VertexArrayObject.prototype.unbind=function(){if(this.nativeVao){this.nativeVaoExtension.bindVertexArrayOES(null)}return this};VertexArrayObject.prototype.activate=function(){var gl=this.gl;var lastBuffer=null;for(var i=0;i<this.attributes.length;i++){var attrib=this.attributes[i];if(lastBuffer!==attrib.buffer){attrib.buffer.bind();lastBuffer=attrib.buffer}gl.vertexAttribPointer(attrib.attribute.location,attrib.attribute.size,attrib.type||gl.FLOAT,attrib.normalized||false,attrib.stride||0,attrib.start||0)}setVertexAttribArrays(gl,this.attributes,this.nativeState);if(this.indexBuffer){this.indexBuffer.bind()}return this};VertexArrayObject.prototype.addAttribute=function(buffer,attribute,type,normalized,stride,start){this.attributes.push({buffer:buffer,attribute:attribute,location:attribute.location,type:type||this.gl.FLOAT,normalized:normalized||false,stride:stride||0,start:start||0});this.dirty=true;return this};VertexArrayObject.prototype.addIndex=function(buffer){this.indexBuffer=buffer;this.dirty=true;return this};VertexArrayObject.prototype.clear=function(){if(this.nativeVao){this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao)}this.attributes.length=0;this.indexBuffer=null;return this};VertexArrayObject.prototype.draw=function(type,size,start){var gl=this.gl;if(this.indexBuffer){gl.drawElements(type,size||this.indexBuffer.data.length,gl.UNSIGNED_SHORT,(start||0)*2)}else{gl.drawArrays(type,start,size||this.getSize())}return this};VertexArrayObject.prototype.destroy=function(){this.gl=null;this.indexBuffer=null;this.attributes=null;this.nativeState=null;if(this.nativeVao){this.nativeVaoExtension.deleteVertexArrayOES(this.nativeVao)}this.nativeVaoExtension=null;this.nativeVao=null};VertexArrayObject.prototype.getSize=function(){var attrib=this.attributes[0];return attrib.buffer.data.length/(attrib.stride/4||attrib.attribute.size)}},{"./setVertexAttribArrays":61}],59:[function(require,module,exports){var createContext=function(canvas,options){var gl=canvas.getContext("webgl",options)||canvas.getContext("experimental-webgl",options);if(!gl){throw new Error("This browser does not support webGL. Try using the canvas renderer")}return gl};module.exports=createContext},{}],60:[function(require,module,exports){var gl={createContext:require("./createContext"),setVertexAttribArrays:require("./setVertexAttribArrays"),GLBuffer:require("./GLBuffer"),GLFramebuffer:require("./GLFramebuffer"),GLShader:require("./GLShader"),GLTexture:require("./GLTexture"),VertexArrayObject:require("./VertexArrayObject"),shader:require("./shader")};if(typeof module!=="undefined"&&module.exports){module.exports=gl}if(typeof window!=="undefined"){window.PIXI=window.PIXI||{};window.PIXI.glCore=gl}},{"./GLBuffer":54,"./GLFramebuffer":55,"./GLShader":56,"./GLTexture":57,"./VertexArrayObject":58,"./createContext":59,"./setVertexAttribArrays":61,"./shader":67}],61:[function(require,module,exports){var setVertexAttribArrays=function(gl,attribs,state){var i;if(state){var tempAttribState=state.tempAttribState,attribState=state.attribState;for(i=0;i<tempAttribState.length;i++){tempAttribState[i]=false}for(i=0;i<attribs.length;i++){tempAttribState[attribs[i].attribute.location]=true}for(i=0;i<attribState.length;i++){if(attribState[i]!==tempAttribState[i]){attribState[i]=tempAttribState[i];if(state.attribState[i]){gl.enableVertexAttribArray(i)}else{gl.disableVertexAttribArray(i)}}}}else{for(i=0;i<attribs.length;i++){var attrib=attribs[i];gl.enableVertexAttribArray(attrib.attribute.location)}}};module.exports=setVertexAttribArrays},{}],62:[function(require,module,exports){var compileProgram=function(gl,vertexSrc,fragmentSrc,attributeLocations){var glVertShader=compileShader(gl,gl.VERTEX_SHADER,vertexSrc);var glFragShader=compileShader(gl,gl.FRAGMENT_SHADER,fragmentSrc);var program=gl.createProgram();gl.attachShader(program,glVertShader);gl.attachShader(program,glFragShader);if(attributeLocations){for(var i in attributeLocations){gl.bindAttribLocation(program,attributeLocations[i],i)}}gl.linkProgram(program);if(!gl.getProgramParameter(program,gl.LINK_STATUS)){console.error("Pixi.js Error: Could not initialize shader.");console.error("gl.VALIDATE_STATUS",gl.getProgramParameter(program,gl.VALIDATE_STATUS));console.error("gl.getError()",gl.getError());if(gl.getProgramInfoLog(program)!==""){console.warn("Pixi.js Warning: gl.getProgramInfoLog()",gl.getProgramInfoLog(program))}gl.deleteProgram(program);program=null}gl.deleteShader(glVertShader);gl.deleteShader(glFragShader);return program};var compileShader=function(gl,type,src){var shader=gl.createShader(type);gl.shaderSource(shader,src);gl.compileShader(shader);if(!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){console.log(gl.getShaderInfoLog(shader));return null}return shader};module.exports=compileProgram},{}],63:[function(require,module,exports){var defaultValue=function(type,size){switch(type){case"float":return 0;case"vec2":return new Float32Array(2*size);case"vec3":return new Float32Array(3*size);case"vec4":return new Float32Array(4*size);case"int":case"sampler2D":return 0;case"ivec2":return new Int32Array(2*size);case"ivec3":return new Int32Array(3*size);case"ivec4":return new Int32Array(4*size);case"bool":return false;case"bvec2":return booleanArray(2*size);case"bvec3":return booleanArray(3*size);case"bvec4":return booleanArray(4*size);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}};var booleanArray=function(size){var array=new Array(size);for(var i=0;i<array.length;i++){array[i]=false}return array};module.exports=defaultValue},{}],64:[function(require,module,exports){var mapType=require("./mapType");var mapSize=require("./mapSize");var extractAttributes=function(gl,program){var attributes={};var totalAttributes=gl.getProgramParameter(program,gl.ACTIVE_ATTRIBUTES);for(var i=0;i<totalAttributes;i++){var attribData=gl.getActiveAttrib(program,i);var type=mapType(gl,attribData.type);attributes[attribData.name]={type:type,size:mapSize(type),location:gl.getAttribLocation(program,attribData.name),pointer:pointer}}return attributes};var pointer=function(type,normalized,stride,start){gl.vertexAttribPointer(this.location,this.size,type||gl.FLOAT,normalized||false,stride||0,start||0)};module.exports=extractAttributes},{"./mapSize":68,"./mapType":69}],65:[function(require,module,exports){var mapType=require("./mapType");var defaultValue=require("./defaultValue");var extractUniforms=function(gl,program){var uniforms={};var totalUniforms=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS);for(var i=0;i<totalUniforms;i++){var uniformData=gl.getActiveUniform(program,i);var name=uniformData.name.replace(/\[.*?\]/,"");var type=mapType(gl,uniformData.type);uniforms[name]={type:type,size:uniformData.size,location:gl.getUniformLocation(program,name),value:defaultValue(type,uniformData.size)}}return uniforms};module.exports=extractUniforms},{"./defaultValue":63,"./mapType":69}],66:[function(require,module,exports){var generateUniformAccessObject=function(gl,uniformData){var uniforms={data:{}};uniforms.gl=gl;var uniformKeys=Object.keys(uniformData);for(var i=0;i<uniformKeys.length;i++){var fullName=uniformKeys[i];var nameTokens=fullName.split(".");var name=nameTokens[nameTokens.length-1];var uniformGroup=getUniformGroup(nameTokens,uniforms);var uniform=uniformData[fullName];uniformGroup.data[name]=uniform;uniformGroup.gl=gl;Object.defineProperty(uniformGroup,name,{get:generateGetter(name),set:generateSetter(name,uniform)})}return uniforms};var generateGetter=function(name){return function(){return this.data[name].value}};var GLSL_SINGLE_SETTERS={float:function setSingleFloat(gl,location,value){gl.uniform1f(location,value)},vec2:function setSingleVec2(gl,location,value){gl.uniform2f(location,value[0],value[1])},vec3:function setSingleVec3(gl,location,value){gl.uniform3f(location,value[0],value[1],value[2])},vec4:function setSingleVec4(gl,location,value){gl.uniform4f(location,value[0],value[1],value[2],value[3])},int:function setSingleInt(gl,location,value){gl.uniform1i(location,value)},ivec2:function setSingleIvec2(gl,location,value){gl.uniform2i(location,value[0],value[1])},ivec3:function setSingleIvec3(gl,location,value){gl.uniform3i(location,value[0],value[1],value[2])},ivec4:function setSingleIvec4(gl,location,value){gl.uniform4i(location,value[0],value[1],value[2],value[3])},bool:function setSingleBool(gl,location,value){gl.uniform1i(location,value)},bvec2:function setSingleBvec2(gl,location,value){gl.uniform2i(location,value[0],value[1])},bvec3:function setSingleBvec3(gl,location,value){gl.uniform3i(location,value[0],value[1],value[2])},bvec4:function setSingleBvec4(gl,location,value){gl.uniform4i(location,value[0],value[1],value[2],value[3])},mat2:function setSingleMat2(gl,location,value){gl.uniformMatrix2fv(location,false,value)},mat3:function setSingleMat3(gl,location,value){gl.uniformMatrix3fv(location,false,value)},mat4:function setSingleMat4(gl,location,value){gl.uniformMatrix4fv(location,false,value)},sampler2D:function setSingleSampler2D(gl,location,value){gl.uniform1i(location,value)}};var GLSL_ARRAY_SETTERS={float:function setFloatArray(gl,location,value){gl.uniform1fv(location,value)},vec2:function setVec2Array(gl,location,value){gl.uniform2fv(location,value)},vec3:function setVec3Array(gl,location,value){gl.uniform3fv(location,value)},vec4:function setVec4Array(gl,location,value){gl.uniform4fv(location,value)},int:function setIntArray(gl,location,value){gl.uniform1iv(location,value)},ivec2:function setIvec2Array(gl,location,value){gl.uniform2iv(location,value)},ivec3:function setIvec3Array(gl,location,value){gl.uniform3iv(location,value)},ivec4:function setIvec4Array(gl,location,value){gl.uniform4iv(location,value)},bool:function setBoolArray(gl,location,value){gl.uniform1iv(location,value)},bvec2:function setBvec2Array(gl,location,value){gl.uniform2iv(location,value)},bvec3:function setBvec3Array(gl,location,value){gl.uniform3iv(location,value)},bvec4:function setBvec4Array(gl,location,value){gl.uniform4iv(location,value)},sampler2D:function setSampler2DArray(gl,location,value){gl.uniform1iv(location,value)}};function generateSetter(name,uniform){return function(value){this.data[name].value=value;var location=this.data[name].location;if(uniform.size===1){GLSL_SINGLE_SETTERS[uniform.type](this.gl,location,value)}else{GLSL_ARRAY_SETTERS[uniform.type](this.gl,location,value)}}}function getUniformGroup(nameTokens,uniform){var cur=uniform;for(var i=0;i<nameTokens.length-1;i++){var o=cur[nameTokens[i]]||{data:{}};cur[nameTokens[i]]=o;cur=o}return cur}module.exports=generateUniformAccessObject},{}],67:[function(require,module,exports){module.exports={compileProgram:require("./compileProgram"),defaultValue:require("./defaultValue"),extractAttributes:require("./extractAttributes"),extractUniforms:require("./extractUniforms"),generateUniformAccessObject:require("./generateUniformAccessObject"),setPrecision:require("./setPrecision"),mapSize:require("./mapSize"),mapType:require("./mapType")}},{"./compileProgram":62,"./defaultValue":63,"./extractAttributes":64,"./extractUniforms":65,"./generateUniformAccessObject":66,"./mapSize":68,"./mapType":69,"./setPrecision":70}],68:[function(require,module,exports){var mapSize=function(type){return GLSL_TO_SIZE[type]};var GLSL_TO_SIZE={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};module.exports=mapSize},{}],69:[function(require,module,exports){var mapType=function(gl,type){if(!GL_TABLE){var typeNames=Object.keys(GL_TO_GLSL_TYPES);GL_TABLE={};for(var i=0;i<typeNames.length;++i){var tn=typeNames[i];GL_TABLE[gl[tn]]=GL_TO_GLSL_TYPES[tn]}}return GL_TABLE[type]};var GL_TABLE=null;var GL_TO_GLSL_TYPES={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D"};module.exports=mapType},{}],70:[function(require,module,exports){var setPrecision=function(src,precision){if(src.substring(0,9)!=="precision"){return"precision "+precision+" float;\n"+src}return src};module.exports=setPrecision},{}],71:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var utils=require("./utils");var Plugin=require("./plugin");module.exports=function(_Plugin){_inherits(Bounce,_Plugin);function Bounce(parent,options){_classCallCheck(this,Bounce);var _this=_possibleConstructorReturn(this,(Bounce.__proto__||Object.getPrototypeOf(Bounce)).call(this,parent));options=options||{};_this.time=options.time||150;_this.ease=utils.ease(options.ease,"easeInOutSine");_this.friction=options.friction||.5;options.sides=options.sides||"all";if(options.sides){if(options.sides==="all"){_this.top=_this.bottom=_this.left=_this.right=true}else if(options.sides==="horizontal"){_this.right=_this.left=true}else if(options.sides==="vertical"){_this.top=_this.bottom=true}else{_this.top=options.sides.indexOf("top")!==-1;_this.bottom=options.sides.indexOf("bottom")!==-1;_this.left=options.sides.indexOf("left")!==-1;_this.right=options.sides.indexOf("right")!==-1}}_this.parseUnderflow(options.underflow||"center");_this.last={};_this.reset();return _this}_createClass(Bounce,[{key:"parseUnderflow",value:function parseUnderflow(clamp){clamp=clamp.toLowerCase();if(clamp==="center"){this.underflowX=0;this.underflowY=0}else{this.underflowX=clamp.indexOf("left")!==-1?-1:clamp.indexOf("right")!==-1?1:0;this.underflowY=clamp.indexOf("top")!==-1?-1:clamp.indexOf("bottom")!==-1?1:0}}},{key:"isActive",value:function isActive(){return this.toX!==null||this.toY!==null}},{key:"down",value:function down(){this.toX=this.toY=null}},{key:"up",value:function up(){this.bounce()}},{key:"update",value:function update(elapsed){if(this.paused){return}this.bounce();if(this.toX){var toX=this.toX;toX.time+=elapsed;this.parent.emit("moved",{viewport:this.parent,type:"bounce-x"});if(toX.time>=this.time){this.parent.x=toX.end;this.toX=null;this.parent.emit("bounce-x-end",this.parent)}else{this.parent.x=this.ease(toX.time,toX.start,toX.delta,this.time)}}if(this.toY){var toY=this.toY;toY.time+=elapsed;this.parent.emit("moved",{viewport:this.parent,type:"bounce-y"});if(toY.time>=this.time){this.parent.y=toY.end;this.toY=null;this.parent.emit("bounce-y-end",this.parent)}else{this.parent.y=this.ease(toY.time,toY.start,toY.delta,this.time)}}}},{key:"calcUnderflowX",value:function calcUnderflowX(){var x=void 0;switch(this.underflowX){case-1:x=0;break;case 1:x=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}return x}},{key:"calcUnderflowY",value:function calcUnderflowY(){var y=void 0;switch(this.underflowY){case-1:y=0;break;case 1:y=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}return y}},{key:"bounce",value:function bounce(){if(this.paused){return}var oob=void 0;var decelerate=this.parent.plugins["decelerate"];if(decelerate&&(decelerate.x||decelerate.y)){if(decelerate.x&&decelerate.percentChangeX===decelerate.friction||decelerate.y&&decelerate.percentChangeY===decelerate.friction){oob=this.parent.OOB();if(oob.left&&this.left||oob.right&&this.right){decelerate.percentChangeX=this.friction}if(oob.top&&this.top||oob.bottom&&this.bottom){decelerate.percentChangeY=this.friction}}}var drag=this.parent.plugins["drag"]||{};var pinch=this.parent.plugins["pinch"]||{};decelerate=decelerate||{};if(!drag.active&&!pinch.active&&(!this.toX||!this.toY)&&(!decelerate.x||!decelerate.y)){oob=oob||this.parent.OOB();var point=oob.cornerPoint;if(!this.toX&&!decelerate.x){var x=null;if(oob.left&&this.left){x=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():0}else if(oob.right&&this.right){x=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-point.x}if(x!==null&&this.parent.x!==x){this.toX={time:0,start:this.parent.x,delta:x-this.parent.x,end:x};this.parent.emit("bounce-x-start",this.parent)}}if(!this.toY&&!decelerate.y){var y=null;if(oob.top&&this.top){y=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():0}else if(oob.bottom&&this.bottom){y=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-point.y}if(y!==null&&this.parent.y!==y){this.toY={time:0,start:this.parent.y,delta:y-this.parent.y,end:y};this.parent.emit("bounce-y-start",this.parent)}}}}},{key:"reset",value:function reset(){this.toX=this.toY=null}}]);return Bounce}(Plugin)},{"./plugin":79,"./utils":82}],72:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Plugin=require("./plugin");module.exports=function(_Plugin){_inherits(ClampZoom,_Plugin);function ClampZoom(parent,options){_classCallCheck(this,ClampZoom);var _this=_possibleConstructorReturn(this,(ClampZoom.__proto__||Object.getPrototypeOf(ClampZoom)).call(this,parent));_this.minWidth=options.minWidth;_this.minHeight=options.minHeight;_this.maxWidth=options.maxWidth;_this.maxHeight=options.maxHeight;_this.clamp();return _this}_createClass(ClampZoom,[{key:"resize",value:function resize(){this.clamp()}},{key:"clamp",value:function clamp(){if(this.paused){return}var width=this.parent.worldScreenWidth;var height=this.parent.worldScreenHeight;if(this.minWidth&&width<this.minWidth){var original=this.parent.scale.x;this.parent.fitWidth(this.minWidth,false,false,true);this.parent.scale.y*=this.parent.scale.x/original;width=this.parent.worldScreenWidth;height=this.parent.worldScreenHeight;this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.maxWidth&&width>this.maxWidth){var _original=this.parent.scale.x;this.parent.fitWidth(this.maxWidth,false,false,true);this.parent.scale.y*=this.parent.scale.x/_original;width=this.parent.worldScreenWidth;height=this.parent.worldScreenHeight;this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.minHeight&&height<this.minHeight){var _original2=this.parent.scale.y;this.parent.fitHeight(this.minHeight,false,false,true);this.parent.scale.x*=this.parent.scale.y/_original2;width=this.parent.worldScreenWidth;height=this.parent.worldScreenHeight;this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.maxHeight&&height>this.maxHeight){var _original3=this.parent.scale.y;this.parent.fitHeight(this.maxHeight,false,false,true);this.parent.scale.x*=this.parent.scale.y/_original3;this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}}}]);return ClampZoom}(Plugin)},{"./plugin":79}],73:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Plugin=require("./plugin");var utils=require("./utils");module.exports=function(_Plugin){_inherits(clamp,_Plugin);function clamp(parent,options){_classCallCheck(this,clamp);options=options||{};var _this=_possibleConstructorReturn(this,(clamp.__proto__||Object.getPrototypeOf(clamp)).call(this,parent));if(typeof options.direction==="undefined"){_this.left=utils.defaults(options.left,null);_this.right=utils.defaults(options.right,null);_this.top=utils.defaults(options.top,null);_this.bottom=utils.defaults(options.bottom,null)}else{_this.left=options.direction==="x"||options.direction==="all"?true:null;_this.right=options.direction==="x"||options.direction==="all"?true:null;_this.top=options.direction==="y"||options.direction==="all"?true:null;_this.bottom=options.direction==="y"||options.direction==="all"?true:null}_this.parseUnderflow(options.underflow||"center");_this.move();return _this}_createClass(clamp,[{key:"parseUnderflow",value:function parseUnderflow(clamp){clamp=clamp.toLowerCase();if(clamp==="none"){this.noUnderflow=true}else if(clamp==="center"){this.underflowX=this.underflowY=0;this.noUnderflow=false}else{this.underflowX=clamp.indexOf("left")!==-1?-1:clamp.indexOf("right")!==-1?1:0;this.underflowY=clamp.indexOf("top")!==-1?-1:clamp.indexOf("bottom")!==-1?1:0;this.noUnderflow=false}}},{key:"move",value:function move(){this.update()}},{key:"update",value:function update(){if(this.paused){return}var original={x:this.parent.x,y:this.parent.y};var decelerate=this.parent.plugins["decelerate"]||{};if(this.left!==null||this.right!==null){var moved=void 0;if(this.parent.screenWorldWidth<this.parent.screenWidth){if(!this.noUnderflow){switch(this.underflowX){case-1:if(this.parent.x!==0){this.parent.x=0;moved=true}break;case 1:if(this.parent.x!==this.parent.screenWidth-this.parent.screenWorldWidth){this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth;moved=true}break;default:if(this.parent.x!==(this.parent.screenWidth-this.parent.screenWorldWidth)/2){this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2;moved=true}}}}else{if(this.left!==null){if(this.parent.left<(this.left===true?0:this.left)){this.parent.x=-(this.left===true?0:this.left)*this.parent.scale.x;decelerate.x=0;moved=true}}if(this.right!==null){if(this.parent.right>(this.right===true?this.parent.worldWidth:this.right)){this.parent.x=-(this.right===true?this.parent.worldWidth:this.right)*this.parent.scale.x+this.parent.screenWidth;decelerate.x=0;moved=true}}}if(moved){this.parent.emit("moved",{viewport:this.parent,original:original,type:"clamp-x"})}}if(this.top!==null||this.bottom!==null){var _moved=void 0;if(this.parent.screenWorldHeight<this.parent.screenHeight){if(!this.noUnderflow){switch(this.underflowY){case-1:if(this.parent.y!==0){this.parent.y=0;_moved=true}break;case 1:if(this.parent.y!==this.parent.screenHeight-this.parent.screenWorldHeight){this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight;_moved=true}break;default:if(this.parent.y!==(this.parent.screenHeight-this.parent.screenWorldHeight)/2){this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2;_moved=true}}}}else{if(this.top!==null){if(this.parent.top<(this.top===true?0:this.top)){this.parent.y=-(this.top===true?0:this.top)*this.parent.scale.y;decelerate.y=0;_moved=true}}if(this.bottom!==null){if(this.parent.bottom>(this.bottom===true?this.parent.worldHeight:this.bottom)){this.parent.y=-(this.bottom===true?this.parent.worldHeight:this.bottom)*this.parent.scale.y+this.parent.screenHeight;decelerate.y=0;_moved=true}}}if(_moved){this.parent.emit("moved",{viewport:this.parent,original:original,type:"clamp-y"})}}}}]);return clamp}(Plugin)},{"./plugin":79,"./utils":82}],74:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Plugin=require("./plugin");module.exports=function(_Plugin){_inherits(Decelerate,_Plugin);function Decelerate(parent,options){_classCallCheck(this,Decelerate);var _this=_possibleConstructorReturn(this,(Decelerate.__proto__||Object.getPrototypeOf(Decelerate)).call(this,parent));options=options||{};_this.friction=options.friction||.95;_this.bounce=options.bounce||.5;_this.minSpeed=typeof options.minSpeed!=="undefined"?options.minSpeed:.01;_this.saved=[];_this.reset();_this.parent.on("moved",function(data){return _this.moved(data)});return _this}_createClass(Decelerate,[{key:"down",value:function down(){this.saved=[];this.x=this.y=false}},{key:"isActive",value:function isActive(){return this.x||this.y}},{key:"move",value:function move(){if(this.paused){return}var count=this.parent.countDownPointers();if(count===1||count>1&&!this.parent.plugins["pinch"]){this.saved.push({x:this.parent.x,y:this.parent.y,time:performance.now()});if(this.saved.length>60){this.saved.splice(0,30)}}}},{key:"moved",value:function moved(data){if(this.saved.length){var last=this.saved[this.saved.length-1];if(data.type==="clamp-x"){if(last.x===data.original.x){last.x=this.parent.x}}else if(data.type==="clamp-y"){if(last.y===data.original.y){last.y=this.parent.y}}}}},{key:"up",value:function up(){if(this.parent.countDownPointers()===0&&this.saved.length){var now=performance.now();var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.saved[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var save=_step.value;if(save.time>=now-100){var time=now-save.time;this.x=(this.parent.x-save.x)/time;this.y=(this.parent.y-save.y)/time;this.percentChangeX=this.percentChangeY=this.friction;break}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}}},{key:"activate",value:function activate(options){options=options||{};if(typeof options.x!=="undefined"){this.x=options.x;this.percentChangeX=this.friction}if(typeof options.y!=="undefined"){this.y=options.y;this.percentChangeY=this.friction}}},{key:"update",value:function update(elapsed){if(this.paused){return}var moved=void 0;if(this.x){this.parent.x+=this.x*elapsed;this.x*=this.percentChangeX;if(Math.abs(this.x)<this.minSpeed){this.x=0}moved=true}if(this.y){this.parent.y+=this.y*elapsed;this.y*=this.percentChangeY;if(Math.abs(this.y)<this.minSpeed){this.y=0}moved=true}if(moved){this.parent.emit("moved",{viewport:this.parent,type:"decelerate"})}}},{key:"reset",value:function reset(){this.x=this.y=null}}]);return Decelerate}(Plugin)},{"./plugin":79}],75:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var PIXI=require("pixi.js");var utils=require("./utils");var Plugin=require("./plugin");module.exports=function(_Plugin){_inherits(Drag,_Plugin);function Drag(parent,options){_classCallCheck(this,Drag);options=options||{};var _this=_possibleConstructorReturn(this,(Drag.__proto__||Object.getPrototypeOf(Drag)).call(this,parent));_this.moved=false;_this.wheelActive=utils.defaults(options.wheel,true);_this.wheelScroll=options.wheelScroll||1;_this.reverse=options.reverse?1:-1;_this.clampWheel=options.clampWheel;_this.factor=options.factor||1;_this.xDirection=!options.direction||options.direction==="all"||options.direction==="x";_this.yDirection=!options.direction||options.direction==="all"||options.direction==="y";_this.parseUnderflow(options.underflow||"center");_this.mouseButtons(options.mouseButtons);return _this}_createClass(Drag,[{key:"mouseButtons",value:function mouseButtons(buttons){if(!buttons||buttons==="all"){this.mouse=[1,1,1]}else{this.mouse=[buttons.indexOf("left")===-1?false:true,buttons.indexOf("middle")===-1?false:true,buttons.indexOf("right")===-1?false:true]}}},{key:"parseUnderflow",value:function parseUnderflow(clamp){clamp=clamp.toLowerCase();if(clamp==="center"){this.underflowX=0;this.underflowY=0}else{this.underflowX=clamp.indexOf("left")!==-1?-1:clamp.indexOf("right")!==-1?1:0;this.underflowY=clamp.indexOf("top")!==-1?-1:clamp.indexOf("bottom")!==-1?1:0}}},{key:"checkButtons",value:function checkButtons(e){var isMouse=e.data.pointerType==="mouse";var count=this.parent.countDownPointers();if(this.parent.parent){if(count===1||count>1&&!this.parent.plugins["pinch"]){if(!isMouse||this.mouse[e.data.button]){return true}}}return false}},{key:"down",value:function down(e){if(this.paused){return}if(this.checkButtons(e)){var parent=this.parent.parent.toLocal(e.data.global);this.last={x:e.data.global.x,y:e.data.global.y,parent:parent};this.current=e.data.pointerId;return true}else{this.last=null}}},{key:"move",value:function move(e){if(this.paused){return}if(this.last&&this.current===e.data.pointerId){var x=e.data.global.x;var y=e.data.global.y;var count=this.parent.countDownPointers();if(count===1||count>1&&!this.parent.plugins["pinch"]){var distX=x-this.last.x;var distY=y-this.last.y;if(this.moved||this.xDirection&&this.parent.checkThreshold(distX)||this.yDirection&&this.parent.checkThreshold(distY)){var newParent=this.parent.parent.toLocal(e.data.global);if(this.xDirection){this.parent.x+=(newParent.x-this.last.parent.x)*this.factor}if(this.yDirection){this.parent.y+=(newParent.y-this.last.parent.y)*this.factor}this.last={x:x,y:y,parent:newParent};if(!this.moved){this.parent.emit("drag-start",{screen:new PIXI.Point(this.last.x,this.last.y),world:this.parent.toWorld(this.last),viewport:this.parent})}this.moved=true;this.parent.emit("moved",{viewport:this.parent,type:"drag"});return true}}else{this.moved=false}}}},{key:"up",value:function up(){var touches=this.parent.getTouchPointers();if(touches.length===1){var pointer=touches[0];if(pointer.last){var parent=this.parent.parent.toLocal(pointer.last);this.last={x:pointer.last.x,y:pointer.last.y,parent:parent};this.current=pointer.last.data.pointerId}this.moved=false;return true}else if(this.last){if(this.moved){this.parent.emit("drag-end",{screen:new PIXI.Point(this.last.x,this.last.y),world:this.parent.toWorld(this.last),viewport:this.parent});this.last=this.moved=false;return true}}}},{key:"wheel",value:function wheel(e){if(this.paused){return}if(this.wheelActive){var wheel=this.parent.plugins["wheel"];if(!wheel){if(this.xDirection){this.parent.x+=e.deltaX*this.wheelScroll*this.reverse}if(this.yDirection){this.parent.y+=e.deltaY*this.wheelScroll*this.reverse}if(this.clampWheel){this.clamp()}this.parent.emit("wheel-scroll",this.parent);this.parent.emit("moved",this.parent);if(!this.parent.passiveWheel){e.preventDefault()}return true}}}},{key:"resume",value:function resume(){this.last=null;this.paused=false}},{key:"clamp",value:function clamp(){var decelerate=this.parent.plugins["decelerate"]||{};if(this.clampWheel!=="y"){if(this.parent.screenWorldWidth<this.parent.screenWidth){switch(this.underflowX){case-1:this.parent.x=0;break;case 1:this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}}else{if(this.parent.left<0){this.parent.x=0;decelerate.x=0}else if(this.parent.right>this.parent.worldWidth){this.parent.x=-this.parent.worldWidth*this.parent.scale.x+this.parent.screenWidth;decelerate.x=0}}}if(this.clampWheel!=="x"){if(this.parent.screenWorldHeight<this.parent.screenHeight){switch(this.underflowY){case-1:this.parent.y=0;break;case 1:this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}}else{if(this.parent.top<0){this.parent.y=0;decelerate.y=0}if(this.parent.bottom>this.parent.worldHeight){this.parent.y=-this.parent.worldHeight*this.parent.scale.y+this.parent.screenHeight;decelerate.y=0}}}}},{key:"active",get:function get(){return this.moved}}]);return Drag}(Plugin)},{"./plugin":79,"./utils":82,"pixi.js":200}],76:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Plugin=require("./plugin");module.exports=function(_Plugin){_inherits(Follow,_Plugin);function Follow(parent,target,options){_classCallCheck(this,Follow);var _this=_possibleConstructorReturn(this,(Follow.__proto__||Object.getPrototypeOf(Follow)).call(this,parent));options=options||{};_this.speed=options.speed||0;_this.acceleration=options.acceleration||0;_this.velocity={x:0,y:0};_this.target=target;_this.radius=options.radius;return _this}_createClass(Follow,[{key:"update",value:function update(elapsed){if(this.paused){return}var center=this.parent.center;var toX=this.target.x,toY=this.target.y;if(this.radius){var distance=Math.sqrt(Math.pow(this.target.y-center.y,2)+Math.pow(this.target.x-center.x,2));if(distance>this.radius){var angle=Math.atan2(this.target.y-center.y,this.target.x-center.x);toX=this.target.x-Math.cos(angle)*this.radius;toY=this.target.y-Math.sin(angle)*this.radius}else{return}}var deltaX=toX-center.x;var deltaY=toY-center.y;if(deltaX||deltaY){if(this.speed){if(this.acceleration){var _angle=Math.atan2(toY-center.y,toX-center.x);var _distance=Math.sqrt(Math.pow(deltaX,2)+Math.pow(deltaY,2));if(_distance){var decelerationDistance=(Math.pow(this.velocity.x,2)+Math.pow(this.velocity.y,2))/(2*this.acceleration);if(_distance>decelerationDistance){this.velocity={x:Math.min(this.velocity.x+this.acceleration*elapsed,this.speed),y:Math.min(this.velocity.y+this.acceleration*elapsed,this.speed)}}else{this.velocity={x:Math.max(this.velocity.x-this.acceleration*this.speed,0),y:Math.max(this.velocity.y-this.acceleration*this.speed,0)}}var changeX=Math.cos(_angle)*this.velocity.x;var changeY=Math.sin(_angle)*this.velocity.y;var x=Math.abs(changeX)>Math.abs(deltaX)?toX:center.x+changeX;var y=Math.abs(changeY)>Math.abs(deltaY)?toY:center.y+changeY;this.parent.moveCenter(x,y);this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}else{var _angle2=Math.atan2(toY-center.y,toX-center.x);var _changeX=Math.cos(_angle2)*this.speed;var _changeY=Math.sin(_angle2)*this.speed;var _x=Math.abs(_changeX)>Math.abs(deltaX)?toX:center.x+_changeX;var _y=Math.abs(_changeY)>Math.abs(deltaY)?toY:center.y+_changeY;this.parent.moveCenter(_x,_y);this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}else{this.parent.moveCenter(toX,toY);this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}}}]);return Follow}(Plugin)},{"./plugin":79}],77:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var utils=require("./utils");var Plugin=require("./plugin");module.exports=function(_Plugin){_inherits(MouseEdges,_Plugin);function MouseEdges(parent,options){_classCallCheck(this,MouseEdges);var _this=_possibleConstructorReturn(this,(MouseEdges.__proto__||Object.getPrototypeOf(MouseEdges)).call(this,parent));options=options||{};_this.options=options;_this.reverse=options.reverse?1:-1;_this.noDecelerate=options.noDecelerate;_this.linear=options.linear;_this.radiusSquared=Math.pow(options.radius,2);_this.resize();_this.speed=options.speed||8;return _this}_createClass(MouseEdges,[{key:"resize",value:function resize(){var options=this.options;var distance=options.distance;if(utils.exists(distance)){this.left=distance;this.top=distance;this.right=window.innerWidth-distance;this.bottom=window.innerHeight-distance}else if(!this.radius){this.left=utils.exists(options.left)?options.left:null;this.top=utils.exists(options.top)?options.top:null;this.right=utils.exists(options.right)?window.innerWidth-options.right:null;this.bottom=utils.exists(options.bottom)?window.innerHeight-options.bottom:null}}},{key:"down",value:function down(){if(!this.options.allowButtons){this.horizontal=this.vertical=null}}},{key:"move",value:function move(e){if(e.data.identifier!=="MOUSE"&&e.data.identifier!==1||!this.options.allowButtons&&e.data.buttons!==0){return}var x=e.data.global.x;var y=e.data.global.y;if(this.radiusSquared){var center=this.parent.toScreen(this.parent.center);var distance=Math.pow(center.x-x,2)+Math.pow(center.y-y,2);if(distance>=this.radiusSquared){var angle=Math.atan2(center.y-y,center.x-x);if(this.linear){this.horizontal=Math.round(Math.cos(angle))*this.speed*this.reverse*(60/1e3);this.vertical=Math.round(Math.sin(angle))*this.speed*this.reverse*(60/1e3)}else{this.horizontal=Math.cos(angle)*this.speed*this.reverse*(60/1e3);this.vertical=Math.sin(angle)*this.speed*this.reverse*(60/1e3)}}else{if(this.horizontal){this.decelerateHorizontal()}if(this.vertical){this.decelerateVertical()}this.horizontal=this.vertical=0}}else{if(utils.exists(this.left)&&x<this.left){this.horizontal=1*this.reverse*this.speed*(60/1e3)}else if(utils.exists(this.right)&&x>this.right){this.horizontal=-1*this.reverse*this.speed*(60/1e3)}else{this.decelerateHorizontal();this.horizontal=0}if(utils.exists(this.top)&&y<this.top){this.vertical=1*this.reverse*this.speed*(60/1e3)}else if(utils.exists(this.bottom)&&y>this.bottom){this.vertical=-1*this.reverse*this.speed*(60/1e3)}else{this.decelerateVertical();this.vertical=0}}}},{key:"decelerateHorizontal",value:function decelerateHorizontal(){var decelerate=this.parent.plugins["decelerate"];if(this.horizontal&&decelerate&&!this.noDecelerate){decelerate.activate({x:this.horizontal*this.speed*this.reverse/(1e3/60)})}}},{key:"decelerateVertical",value:function decelerateVertical(){var decelerate=this.parent.plugins["decelerate"];if(this.vertical&&decelerate&&!this.noDecelerate){decelerate.activate({y:this.vertical*this.speed*this.reverse/(1e3/60)})}}},{key:"up",value:function up(){if(this.horizontal){this.decelerateHorizontal()}if(this.vertical){this.decelerateVertical()}this.horizontal=this.vertical=null}},{key:"update",value:function update(){if(this.paused){return}if(this.horizontal||this.vertical){var center=this.parent.center;if(this.horizontal){center.x+=this.horizontal*this.speed}if(this.vertical){center.y+=this.vertical*this.speed}this.parent.moveCenter(center);this.parent.emit("moved",{viewport:this.parent,type:"mouse-edges"})}}}]);return MouseEdges}(Plugin)},{"./plugin":79,"./utils":82}],78:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Plugin=require("./plugin");module.exports=function(_Plugin){_inherits(Pinch,_Plugin);function Pinch(parent,options){_classCallCheck(this,Pinch);var _this=_possibleConstructorReturn(this,(Pinch.__proto__||Object.getPrototypeOf(Pinch)).call(this,parent));options=options||{};_this.percent=options.percent||1;_this.noDrag=options.noDrag;_this.center=options.center;return _this}_createClass(Pinch,[{key:"down",value:function down(){if(this.parent.countDownPointers()>=2){this.active=true;return true}}},{key:"move",value:function move(e){if(this.paused||!this.active){return}var x=e.data.global.x;var y=e.data.global.y;var pointers=this.parent.getTouchPointers();if(pointers.length>=2){var first=pointers[0];var second=pointers[1];var last=first.last&&second.last?Math.sqrt(Math.pow(second.last.x-first.last.x,2)+Math.pow(second.last.y-first.last.y,2)):null;if(first.pointerId===e.data.pointerId){first.last={x:x,y:y,data:e.data}}else if(second.pointerId===e.data.pointerId){second.last={x:x,y:y,data:e.data}}if(last){var oldPoint=void 0;var point={x:first.last.x+(second.last.x-first.last.x)/2,y:first.last.y+(second.last.y-first.last.y)/2};if(!this.center){oldPoint=this.parent.toLocal(point)}var dist=Math.sqrt(Math.pow(second.last.x-first.last.x,2)+Math.pow(second.last.y-first.last.y,2));var change=(dist-last)/this.parent.screenWidth*this.parent.scale.x*this.percent;this.parent.scale.x+=change;this.parent.scale.y+=change;this.parent.emit("zoomed",{viewport:this.parent,type:"pinch"});var clamp=this.parent.plugins["clamp-zoom"];if(clamp){clamp.clamp()}if(this.center){this.parent.moveCenter(this.center)}else{var newPoint=this.parent.toGlobal(oldPoint);this.parent.x+=point.x-newPoint.x;this.parent.y+=point.y-newPoint.y;this.parent.emit("moved",{viewport:this.parent,type:"pinch"})}if(!this.noDrag&&this.lastCenter){this.parent.x+=point.x-this.lastCenter.x;this.parent.y+=point.y-this.lastCenter.y;this.parent.emit("moved",{viewport:this.parent,type:"pinch"})}this.lastCenter=point;this.moved=true}else{if(!this.pinching){this.parent.emit("pinch-start",this.parent);this.pinching=true}}return true}}},{key:"up",value:function up(){if(this.pinching){if(this.parent.touches.length<=1){this.active=false;this.lastCenter=null;this.pinching=false;this.moved=false;this.parent.emit("pinch-end",this.parent);return true}}}}]);return Pinch}(Plugin)},{"./plugin":79}],79:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}module.exports=function(){function Plugin(parent){_classCallCheck(this,Plugin);this.parent=parent;this.paused=false}_createClass(Plugin,[{key:"down",value:function down(event){}},{key:"move",value:function move(event){}},{key:"up",value:function up(event){}},{key:"wheel",value:function wheel(event){}},{key:"update",value:function update(){}},{key:"resize",value:function resize(){}},{key:"reset",value:function reset(){}},{key:"pause",value:function pause(){this.paused=true}},{key:"resume",value:function resume(){this.paused=false}}]);return Plugin}()},{}],80:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Plugin=require("./plugin");var utils=require("./utils");module.exports=function(_Plugin){_inherits(SnapZoom,_Plugin);function SnapZoom(parent,options){_classCallCheck(this,SnapZoom);var _this=_possibleConstructorReturn(this,(SnapZoom.__proto__||Object.getPrototypeOf(SnapZoom)).call(this,parent));options=options||{};_this.width=options.width;_this.height=options.height;if(_this.width>0){_this.x_scale=parent._screenWidth/_this.width}if(_this.height>0){_this.y_scale=parent._screenHeight/_this.height}_this.xIndependent=utils.exists(_this.x_scale);_this.yIndependent=utils.exists(_this.y_scale);_this.x_scale=_this.xIndependent?_this.x_scale:_this.y_scale;_this.y_scale=_this.yIndependent?_this.y_scale:_this.x_scale;_this.time=utils.defaults(options.time,1e3);_this.ease=utils.ease(options.ease,"easeInOutSine");_this.center=options.center;_this.noMove=options.noMove;_this.stopOnResize=options.stopOnResize;_this.removeOnInterrupt=options.removeOnInterrupt;_this.removeOnComplete=utils.defaults(options.removeOnComplete,true);_this.interrupt=utils.defaults(options.interrupt,true);if(_this.time===0){parent.container.scale.x=_this.x_scale;parent.container.scale.y=_this.y_scale;if(_this.removeOnComplete){_this.parent.removePlugin("snap-zoom")}}else if(options.forceStart){_this.createSnapping()}return _this}_createClass(SnapZoom,[{key:"createSnapping",value:function createSnapping(){var scale=this.parent.scale;this.snapping={time:0,startX:scale.x,startY:scale.y,deltaX:this.x_scale-scale.x,deltaY:this.y_scale-scale.y};this.parent.emit("snap-zoom-start",this.parent)}},{key:"resize",value:function resize(){this.snapping=null;if(this.width>0){this.x_scale=this.parent._screenWidth/this.width}if(this.height>0){this.y_scale=this.parent._screenHeight/this.height}this.x_scale=this.xIndependent?this.x_scale:this.y_scale;this.y_scale=this.yIndependent?this.y_scale:this.x_scale}},{key:"reset",value:function reset(){this.snapping=null}},{key:"wheel",value:function wheel(){if(this.removeOnInterrupt){this.parent.removePlugin("snap-zoom")}}},{key:"down",value:function down(){if(this.removeOnInterrupt){this.parent.removePlugin("snap-zoom")}else if(this.interrupt){this.snapping=null}}},{key:"update",value:function update(elapsed){if(this.paused){return}if(this.interrupt&&this.parent.countDownPointers()!==0){return}var oldCenter=void 0;if(!this.center&&!this.noMove){oldCenter=this.parent.center}if(!this.snapping){if(this.parent.scale.x!==this.x_scale||this.parent.scale.y!==this.y_scale){this.createSnapping()}}else if(this.snapping){var snapping=this.snapping;snapping.time+=elapsed;if(snapping.time>=this.time){this.parent.scale.set(this.x_scale,this.y_scale);if(this.removeOnComplete){this.parent.removePlugin("snap-zoom")}this.parent.emit("snap-zoom-end",this.parent);this.snapping=null}else{var _snapping=this.snapping;this.parent.scale.x=this.ease(_snapping.time,_snapping.startX,_snapping.deltaX,this.time);this.parent.scale.y=this.ease(_snapping.time,_snapping.startY,_snapping.deltaY,this.time)}var clamp=this.parent.plugins["clamp-zoom"];if(clamp){clamp.clamp()}if(!this.noMove){if(!this.center){this.parent.moveCenter(oldCenter)}else{this.parent.moveCenter(this.center)}}}}},{key:"resume",value:function resume(){this.snapping=null;_get(SnapZoom.prototype.__proto__||Object.getPrototypeOf(SnapZoom.prototype),"resume",this).call(this)}}]);return SnapZoom}(Plugin)},{"./plugin":79,"./utils":82}],81:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Plugin=require("./plugin");var utils=require("./utils");module.exports=function(_Plugin){_inherits(Snap,_Plugin);function Snap(parent,x,y,options){_classCallCheck(this,Snap);var _this=_possibleConstructorReturn(this,(Snap.__proto__||Object.getPrototypeOf(Snap)).call(this,parent));options=options||{};_this.friction=options.friction||.8;_this.time=options.time||1e3;_this.ease=utils.ease(options.ease,"easeInOutSine");_this.x=x;_this.y=y;_this.topLeft=options.topLeft;_this.interrupt=utils.defaults(options.interrupt,true);_this.removeOnComplete=options.removeOnComplete;_this.removeOnInterrupt=options.removeOnInterrupt;if(options.forceStart){_this.startEase()}return _this}_createClass(Snap,[{key:"snapStart",value:function snapStart(){this.percent=0;this.snapping={time:0};var current=this.topLeft?this.parent.corner:this.parent.center;this.deltaX=this.x-current.x;this.deltaY=this.y-current.y;this.startX=current.x;this.startY=current.y;this.parent.emit("snap-start",this.parent)}},{key:"wheel",value:function wheel(){if(this.removeOnInterrupt){this.parent.removePlugin("snap")}}},{key:"down",value:function down(){if(this.removeOnInterrupt){this.parent.removePlugin("snap")}else if(this.interrupt){this.snapping=null}}},{key:"up",value:function up(){if(this.parent.countDownPointers()===0){var decelerate=this.parent.plugins["decelerate"];if(decelerate&&(decelerate.x||decelerate.y)){decelerate.percentChangeX=decelerate.percentChangeY=this.friction}}}},{key:"update",value:function update(elapsed){if(this.paused){return}if(this.interrupt&&this.parent.countDownPointers()!==0){return}if(!this.snapping){var current=this.topLeft?this.parent.corner:this.parent.center;if(current.x!==this.x||current.y!==this.y){this.snapStart()}}else{var snapping=this.snapping;snapping.time+=elapsed;var finished=void 0,x=void 0,y=void 0;if(snapping.time>this.time){finished=true;x=this.startX+this.deltaX;y=this.startY+this.deltaY}else{var percent=this.ease(snapping.time,0,1,this.time);x=this.startX+this.deltaX*percent;y=this.startY+this.deltaY*percent}if(this.topLeft){this.parent.moveCorner(x,y)}else{this.parent.moveCenter(x,y)}this.parent.emit("moved",{viewport:this.parent,type:"snap"});if(finished){if(this.removeOnComplete){this.parent.removePlugin("snap")}this.parent.emit("snap-end",this.parent);this.snapping=null}}}}]);return Snap}(Plugin)},{"./plugin":79,"./utils":82}],82:[function(require,module,exports){"use strict";var Penner=require("penner");function exists(a){return a!==undefined&&a!==null}function defaults(a,defaults){return a!==undefined&&a!==null?a:defaults}function ease(ease,defaults){if(!exists(ease)){return Penner[defaults]}else if(typeof ease==="function"){return ease}else if(typeof ease==="string"){return Penner[ease]}}module.exports={exists:exists,defaults:defaults,ease:ease}},{penner:50}],83:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var PIXI=require("pixi.js");var utils=require("./utils");var Drag=require("./drag");var Pinch=require("./pinch");var Clamp=require("./clamp");var ClampZoom=require("./clamp-zoom");var Decelerate=require("./decelerate");var Bounce=require("./bounce");var Snap=require("./snap");var SnapZoom=require("./snap-zoom");var Follow=require("./follow");var Wheel=require("./wheel");var MouseEdges=require("./mouse-edges");var PLUGIN_ORDER=["drag","pinch","wheel","follow","mouse-edges","decelerate","bounce","snap-zoom","clamp-zoom","snap","clamp"];var Viewport=function(_PIXI$Container){_inherits(Viewport,_PIXI$Container);function Viewport(options){_classCallCheck(this,Viewport);options=options||{};var _this=_possibleConstructorReturn(this,(Viewport.__proto__||Object.getPrototypeOf(Viewport)).call(this));_this.plugins={};_this.pluginsList=[];_this._screenWidth=options.screenWidth||window.innerWidth;_this._screenHeight=options.screenHeight||window.innerHeight;_this._worldWidth=options.worldWidth;_this._worldHeight=options.worldHeight;_this.hitAreaFullScreen=utils.defaults(options.hitAreaFullScreen,true);_this.forceHitArea=options.forceHitArea;_this.passiveWheel=utils.defaults(options.passiveWheel,true);_this.stopEvent=options.stopPropagation;_this.threshold=utils.defaults(options.threshold,5);_this.interaction=options.interaction||null;_this.div=options.divWheel||document.body;_this.listeners(_this.div);_this.div.oncontextmenu=function(e){return e.preventDefault()};_this.touches=[];if(!options.noTicker){_this.ticker=options.ticker||(PIXI.Ticker?PIXI.Ticker.shared:PIXI.ticker.shared);_this.tickerFunction=function(){return _this.update(_this.ticker.elapsedMS)};_this.ticker.add(_this.tickerFunction)}return _this}_createClass(Viewport,[{key:"removeListeners",value:function removeListeners(){this.ticker.remove(this.tickerFunction);this.div.removeEventListener("wheel",this.wheelFunction)}},{key:"destroy",value:function destroy(options){_get(Viewport.prototype.__proto__||Object.getPrototypeOf(Viewport.prototype),"destroy",this).call(this,options);this.removeListeners()}},{key:"update",value:function update(elapsed){if(!this.pause){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.pluginsList[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var plugin=_step.value;plugin.update(elapsed)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}if(this.lastViewport){if(this.lastViewport.x!==this.x||this.lastViewport.y!==this.y){this.moving=true}else{if(this.moving){this.emit("moved-end",this);this.moving=false}}if(this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y){this.zooming=true}else{if(this.zooming){this.emit("zoomed-end",this);this.zooming=false}}}if(!this.forceHitArea){this.hitArea.x=this.left;this.hitArea.y=this.top;this.hitArea.width=this.worldScreenWidth;this.hitArea.height=this.worldScreenHeight}this._dirty=this._dirty||!this.lastViewport||this.lastViewport.x!==this.x||this.lastViewport.y!==this.y||this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y;this.lastViewport={x:this.x,y:this.y,scaleX:this.scale.x,scaleY:this.scale.y}}}},{key:"resize",value:function resize(screenWidth,screenHeight,worldWidth,worldHeight){this._screenWidth=screenWidth||window.innerWidth;this._screenHeight=screenHeight||window.innerHeight;if(worldWidth){this._worldWidth=worldWidth}if(worldHeight){this._worldHeight=worldHeight}this.resizePlugins()}},{key:"resizePlugins",value:function resizePlugins(){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.pluginsList[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var plugin=_step2.value;plugin.resize()}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"getVisibleBounds",value:function getVisibleBounds(){return{x:this.left,y:this.top,width:this.worldScreenWidth,height:this.worldScreenHeight}}},{key:"listeners",value:function listeners(div){var _this2=this;this.interactive=true;if(!this.forceHitArea){this.hitArea=new PIXI.Rectangle(0,0,this.worldWidth,this.worldHeight)}this.on("pointerdown",this.down);this.on("pointermove",this.move);this.on("pointerup",this.up);this.on("pointerupoutside",this.up);this.on("pointercancel",this.up);this.on("pointerout",this.up);this.wheelFunction=function(e){return _this2.handleWheel(e)};div.addEventListener("wheel",this.wheelFunction,{passive:this.passiveWheel});this.isMouseDown=false}},{key:"down",value:function down(e){if(this.pause||!this.worldVisible){return}if(e.data.pointerType==="mouse"){this.isMouseDown=true}else{this.touches.push(e.data.pointerId)}if(this.countDownPointers()===1){this.last=e.data.global.clone();var decelerate=this.plugins["decelerate"];var bounce=this.plugins["bounce"];if((!decelerate||!decelerate.isActive())&&(!bounce||!bounce.isActive())){this.clickedAvailable=true}else{this.clickedAvailable=false}}else{this.clickedAvailable=false}var stop=void 0;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=this.pluginsList[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var plugin=_step3.value;if(plugin.down(e)){stop=true}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}if(stop&&this.stopEvent){e.stopPropagation()}}},{key:"checkThreshold",value:function checkThreshold(change){if(Math.abs(change)>=this.threshold){return true}return false}},{key:"move",value:function move(e){if(this.pause||!this.worldVisible){return}var stop=void 0;var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=this.pluginsList[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var plugin=_step4.value;if(plugin.move(e)){stop=true}}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}if(this.clickedAvailable){var distX=e.data.global.x-this.last.x;var distY=e.data.global.y-this.last.y;if(this.checkThreshold(distX)||this.checkThreshold(distY)){this.clickedAvailable=false}}if(stop&&this.stopEvent){e.stopPropagation()}}},{key:"up",value:function up(e){if(this.pause||!this.worldVisible){return}if(e.data.pointerType==="mouse"){this.isMouseDown=false}if(e.data.pointerType!=="mouse"){for(var i=0;i<this.touches.length;i++){if(this.touches[i]===e.data.pointerId){this.touches.splice(i,1);break}}}var stop=void 0;var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=this.pluginsList[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var plugin=_step5.value;if(plugin.up(e)){stop=true}}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return()}}finally{if(_didIteratorError5){throw _iteratorError5}}}if(this.clickedAvailable&&this.countDownPointers()===0){this.emit("clicked",{screen:this.last,world:this.toWorld(this.last),viewport:this});this.clickedAvailable=false}if(stop&&this.stopEvent){e.stopPropagation()}}},{key:"getPointerPosition",value:function getPointerPosition(evt){var point=new PIXI.Point;if(this.interaction){this.interaction.mapPositionToPoint(point,evt.clientX,evt.clientY)}else{point.x=evt.clientX;point.y=evt.clientY}return point}},{key:"handleWheel",value:function handleWheel(e){if(this.pause||!this.worldVisible){return}var point=this.toLocal(this.getPointerPosition(e));if(this.left<=point.x&&point.x<=this.right&&this.top<=point.y&&point.y<=this.bottom){var result=void 0;var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=this.pluginsList[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var plugin=_step6.value;if(plugin.wheel(e)){result=true}}}catch(err){_didIteratorError6=true;_iteratorError6=err}finally{try{if(!_iteratorNormalCompletion6&&_iterator6.return){_iterator6.return()}}finally{if(_didIteratorError6){throw _iteratorError6}}}return result}}},{key:"toWorld",value:function toWorld(){if(arguments.length===2){var x=arguments[0];var y=arguments[1];return this.toLocal({x:x,y:y})}else{return this.toLocal(arguments[0])}}},{key:"toScreen",value:function toScreen(){if(arguments.length===2){var x=arguments[0];var y=arguments[1];return this.toGlobal({x:x,y:y})}else{var point=arguments[0];return this.toGlobal(point)}}},{key:"moveCenter",value:function moveCenter(){var x=void 0,y=void 0;if(!isNaN(arguments[0])){x=arguments[0];y=arguments[1]}else{x=arguments[0].x;y=arguments[0].y}this.position.set((this.worldScreenWidth/2-x)*this.scale.x,(this.worldScreenHeight/2-y)*this.scale.y);this._reset();return this}},{key:"moveCorner",value:function moveCorner(){if(arguments.length===1){this.position.set(-arguments[0].x*this.scale.x,-arguments[0].y*this.scale.y)}else{this.position.set(-arguments[0]*this.scale.x,-arguments[1]*this.scale.y)}this._reset();return this}},{key:"fitWidth",value:function fitWidth(width,center){var scaleY=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var noClamp=arguments[3];var save=void 0;if(center){save=this.center}width=width||this.worldWidth;this.scale.x=this.screenWidth/width;if(scaleY){this.scale.y=this.scale.x}var clampZoom=this.plugins["clamp-zoom"];if(!noClamp&&clampZoom){clampZoom.clamp()}if(center){this.moveCenter(save)}return this}},{key:"fitHeight",value:function fitHeight(height,center){var scaleX=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var noClamp=arguments[3];var save=void 0;if(center){save=this.center}height=height||this.worldHeight;this.scale.y=this.screenHeight/height;if(scaleX){this.scale.x=this.scale.y}var clampZoom=this.plugins["clamp-zoom"];if(!noClamp&&clampZoom){clampZoom.clamp()}if(center){this.moveCenter(save)}return this}},{key:"fitWorld",value:function fitWorld(center){var save=void 0;if(center){save=this.center}this.scale.x=this.screenWidth/this.worldWidth;this.scale.y=this.screenHeight/this.worldHeight;if(this.scale.x<this.scale.y){this.scale.y=this.scale.x}else{this.scale.x=this.scale.y}var clampZoom=this.plugins["clamp-zoom"];if(clampZoom){clampZoom.clamp()}if(center){this.moveCenter(save)}return this}},{key:"fit",value:function fit(center,width,height){var save=void 0;if(center){save=this.center}width=width||this.worldWidth;height=height||this.worldHeight;this.scale.x=this.screenWidth/width;this.scale.y=this.screenHeight/height;if(this.scale.x<this.scale.y){this.scale.y=this.scale.x}else{this.scale.x=this.scale.y}var clampZoom=this.plugins["clamp-zoom"];if(clampZoom){clampZoom.clamp()}if(center){this.moveCenter(save)}return this}},{key:"zoomPercent",value:function zoomPercent(percent,center){var save=void 0;if(center){save=this.center}var scale=this.scale.x+this.scale.x*percent;this.scale.set(scale);var clampZoom=this.plugins["clamp-zoom"];if(clampZoom){clampZoom.clamp()}if(center){this.moveCenter(save)}return this}},{key:"zoom",value:function zoom(change,center){this.fitWidth(change+this.worldScreenWidth,center);return this}},{key:"snapZoom",value:function snapZoom(options){this.plugins["snap-zoom"]=new SnapZoom(this,options);this.pluginsSort();return this}},{key:"OOB",value:function OOB(){var result={};result.left=this.left<0;result.right=this.right>this._worldWidth;result.top=this.top<0;result.bottom=this.bottom>this._worldHeight;result.cornerPoint={x:this._worldWidth*this.scale.x-this._screenWidth,y:this._worldHeight*this.scale.y-this._screenHeight};return result}},{key:"countDownPointers",value:function countDownPointers(){return(this.isMouseDown?1:0)+this.touches.length}},{key:"getTouchPointers",value:function getTouchPointers(){var results=[];var pointers=this.trackedPointers;for(var key in pointers){var pointer=pointers[key];if(this.touches.indexOf(pointer.pointerId)!==-1){results.push(pointer)}}return results}},{key:"getPointers",value:function getPointers(){var results=[];var pointers=this.trackedPointers;for(var key in pointers){results.push(pointers[key])}return results}},{key:"_reset",value:function _reset(){if(this.plugins["bounce"]){this.plugins["bounce"].reset();this.plugins["bounce"].bounce()}if(this.plugins["decelerate"]){this.plugins["decelerate"].reset()}if(this.plugins["snap"]){this.plugins["snap"].reset()}if(this.plugins["clamp"]){this.plugins["clamp"].update()}if(this.plugins["clamp-zoom"]){this.plugins["clamp-zoom"].clamp()}}},{key:"userPlugin",value:function userPlugin(name,plugin){var index=arguments.length>2&&arguments[2]!==undefined?arguments[2]:PLUGIN_ORDER.length;this.plugins[name]=plugin;var current=PLUGIN_ORDER.indexOf(name);if(current!==-1){PLUGIN_ORDER.splice(current,1)}PLUGIN_ORDER.splice(index,0,name);this.pluginsSort()}},{key:"removePlugin",value:function removePlugin(type){if(this.plugins[type]){this.plugins[type]=null;this.emit(type+"-remove");this.pluginsSort()}}},{key:"pausePlugin",value:function pausePlugin(type){if(this.plugins[type]){this.plugins[type].pause()}}},{key:"resumePlugin",value:function resumePlugin(type){if(this.plugins[type]){this.plugins[type].resume()}}},{key:"pluginsSort",value:function pluginsSort(){this.pluginsList=[];var _iteratorNormalCompletion7=true;var _didIteratorError7=false;var _iteratorError7=undefined;try{for(var _iterator7=PLUGIN_ORDER[Symbol.iterator](),_step7;!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=true){var plugin=_step7.value;if(this.plugins[plugin]){this.pluginsList.push(this.plugins[plugin])}}}catch(err){_didIteratorError7=true;_iteratorError7=err}finally{try{if(!_iteratorNormalCompletion7&&_iterator7.return){_iterator7.return()}}finally{if(_didIteratorError7){throw _iteratorError7}}}}},{key:"drag",value:function drag(options){this.plugins["drag"]=new Drag(this,options);this.pluginsSort();return this}},{key:"clamp",value:function clamp(options){this.plugins["clamp"]=new Clamp(this,options);this.pluginsSort();return this}},{key:"decelerate",value:function decelerate(options){this.plugins["decelerate"]=new Decelerate(this,options);this.pluginsSort();return this}},{key:"bounce",value:function bounce(options){this.plugins["bounce"]=new Bounce(this,options);this.pluginsSort();return this}},{key:"pinch",value:function pinch(options){this.plugins["pinch"]=new Pinch(this,options);this.pluginsSort();return this}},{key:"snap",value:function snap(x,y,options){this.plugins["snap"]=new Snap(this,x,y,options);this.pluginsSort();return this}},{key:"follow",value:function follow(target,options){this.plugins["follow"]=new Follow(this,target,options);this.pluginsSort();return this}},{key:"wheel",value:function wheel(options){this.plugins["wheel"]=new Wheel(this,options);this.pluginsSort();return this}},{key:"clampZoom",value:function clampZoom(options){this.plugins["clamp-zoom"]=new ClampZoom(this,options);this.pluginsSort();return this}},{key:"mouseEdges",value:function mouseEdges(options){this.plugins["mouse-edges"]=new MouseEdges(this,options);this.pluginsSort();return this}},{key:"ensureVisible",value:function ensureVisible(x,y,width,height){if(x<this.left){this.left=x}else if(x+width>this.right){this.right=x+width}if(y<this.top){this.top=y}else if(y+height>this.bottom){this.bottom=y+height}}},{key:"screenWidth",get:function get(){return this._screenWidth},set:function set(value){this._screenWidth=value}},{key:"screenHeight",get:function get(){return this._screenHeight},set:function set(value){this._screenHeight=value}},{key:"worldWidth",get:function get(){if(this._worldWidth){return this._worldWidth}else{return this.width}},set:function set(value){this._worldWidth=value;this.resizePlugins()}},{key:"worldHeight",get:function get(){if(this._worldHeight){return this._worldHeight}else{return this.height}},set:function set(value){this._worldHeight=value;this.resizePlugins()}},{key:"worldScreenWidth",get:function get(){return this.screenWidth/this.scale.x}},{key:"worldScreenHeight",get:function get(){return this.screenHeight/this.scale.y}},{key:"screenWorldWidth",get:function get(){return this.worldWidth*this.scale.x}},{key:"screenWorldHeight",get:function get(){return this.worldHeight*this.scale.y}},{key:"center",get:function get(){return new PIXI.Point(this.worldScreenWidth/2-this.x/this.scale.x,this.worldScreenHeight/2-this.y/this.scale.y)},set:function set(value){this.moveCenter(value)}},{key:"corner",get:function get(){return new PIXI.Point(-this.x/this.scale.x,-this.y/this.scale.y)},set:function set(value){this.moveCorner(value)}},{key:"right",get:function get(){return-this.x/this.scale.x+this.worldScreenWidth},set:function set(value){this.x=-value*this.scale.x+this.screenWidth;this._reset()}},{key:"left",get:function get(){return-this.x/this.scale.x},set:function set(value){this.x=-value*this.scale.x;this._reset()}},{key:"top",get:function get(){return-this.y/this.scale.y},set:function set(value){this.y=-value*this.scale.y;this._reset()}},{key:"bottom",get:function get(){return-this.y/this.scale.y+this.worldScreenHeight},set:function set(value){this.y=-value*this.scale.y+this.screenHeight;this._reset()}},{key:"dirty",get:function get(){return this._dirty},set:function set(value){this._dirty=value}},{key:"forceHitArea",get:function get(){return this._forceHitArea},set:function set(value){if(value){this._forceHitArea=value;this.hitArea=value}else{this._forceHitArea=false;this.hitArea=new PIXI.Rectangle(0,0,this.worldWidth,this.worldHeight)}}},{key:"pause",get:function get(){return this._pause},set:function set(value){this._pause=value;this.lastViewport=null;this.moving=false;this.zooming=false;if(value){this.touches=[];this.isMouseDown=false}}}]);return Viewport}(PIXI.Container);if(typeof PIXI!=="undefined"){if(PIXI.extras){PIXI.extras.Viewport=Viewport}else{PIXI.extras={Viewport:Viewport}}}module.exports=Viewport},{"./bounce":71,"./clamp":73,"./clamp-zoom":72,"./decelerate":74,"./drag":75,"./follow":76,"./mouse-edges":77,"./pinch":78,"./snap":81,"./snap-zoom":80,"./utils":82,"./wheel":84,"pixi.js":200}],84:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Plugin=require("./plugin");module.exports=function(_Plugin){_inherits(Wheel,_Plugin);function Wheel(parent,options){_classCallCheck(this,Wheel);var _this=_possibleConstructorReturn(this,(Wheel.__proto__||Object.getPrototypeOf(Wheel)).call(this,parent));options=options||{};_this.percent=options.percent||.1;_this.center=options.center;_this.reverse=options.reverse;_this.smooth=options.smooth;_this.interrupt=typeof options.interrupt==="undefined"?true:options.interrupt;return _this}_createClass(Wheel,[{key:"down",value:function down(){if(this.interrupt){this.smoothing=null}}},{key:"update",value:function update(){if(this.smoothing){var point=this.smoothingCenter;var change=this.smoothing;var oldPoint=void 0;if(!this.center){oldPoint=this.parent.toLocal(point)}this.parent.scale.x+=change.x;this.parent.scale.y+=change.y;this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});var clamp=this.parent.plugins["clamp-zoom"];if(clamp){clamp.clamp()}if(this.center){this.parent.moveCenter(this.center)}else{var newPoint=this.parent.toGlobal(oldPoint);this.parent.x+=point.x-newPoint.x;this.parent.y+=point.y-newPoint.y}this.smoothingCount++;if(this.smoothingCount>=this.smooth){this.smoothing=null}}}},{key:"wheel",value:function wheel(e){if(this.paused){return}var point=this.parent.getPointerPosition(e);var sign=this.reverse?-1:1;var step=sign*-e.deltaY*(e.deltaMode?120:1)/500;var change=Math.pow(2,(1+this.percent)*step);if(this.smooth){var original={x:this.smoothing?this.smoothing.x*(this.smooth-this.smoothingCount):0,y:this.smoothing?this.smoothing.y*(this.smooth-this.smoothingCount):0};this.smoothing={x:((this.parent.scale.x+original.x)*change-this.parent.scale.x)/this.smooth,y:((this.parent.scale.y+original.y)*change-this.parent.scale.y)/this.smooth};this.smoothingCount=0;this.smoothingCenter=point}else{var oldPoint=void 0;if(!this.center){oldPoint=this.parent.toLocal(point)}this.parent.scale.x*=change;this.parent.scale.y*=change;this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});var clamp=this.parent.plugins["clamp-zoom"];if(clamp){clamp.clamp()}if(this.center){this.parent.moveCenter(this.center)}else{var newPoint=this.parent.toGlobal(oldPoint);this.parent.x+=point.x-newPoint.x;this.parent.y+=point.y-newPoint.y}}this.parent.emit("moved",{viewport:this.parent,type:"wheel"});this.parent.emit("wheel",{wheel:{dx:e.deltaX,dy:e.deltaY,dz:e.deltaZ},event:e,viewport:this.parent});if(!this.parent.passiveWheel){e.preventDefault()}}}]);return Wheel}(Plugin)},{"./plugin":79}],85:[function(require,module,exports){"use strict";exports.__esModule=true;var _core=require("../core");var core=_interopRequireWildcard(_core);var _ismobilejs=require("ismobilejs");var _ismobilejs2=_interopRequireDefault(_ismobilejs);var _accessibleTarget=require("./accessibleTarget");var _accessibleTarget2=_interopRequireDefault(_accessibleTarget);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}core.utils.mixins.delayMixin(core.DisplayObject.prototype,_accessibleTarget2.default);var KEY_CODE_TAB=9;var DIV_TOUCH_SIZE=100;var DIV_TOUCH_POS_X=0;var DIV_TOUCH_POS_Y=0;var DIV_TOUCH_ZINDEX=2;var DIV_HOOK_SIZE=1;var DIV_HOOK_POS_X=-1e3;var DIV_HOOK_POS_Y=-1e3;var DIV_HOOK_ZINDEX=2;var AccessibilityManager=function(){function AccessibilityManager(renderer){_classCallCheck(this,AccessibilityManager);if((_ismobilejs2.default.tablet||_ismobilejs2.default.phone)&&!navigator.isCocoonJS){this.createTouchHook()}var div=document.createElement("div");div.style.width=DIV_TOUCH_SIZE+"px";div.style.height=DIV_TOUCH_SIZE+"px";div.style.position="absolute";div.style.top=DIV_TOUCH_POS_X+"px";div.style.left=DIV_TOUCH_POS_Y+"px";div.style.zIndex=DIV_TOUCH_ZINDEX;this.div=div;this.pool=[];this.renderId=0;this.debug=false;this.renderer=renderer;this.children=[];this._onKeyDown=this._onKeyDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this.isActive=false;this.isMobileAccessabillity=false;window.addEventListener("keydown",this._onKeyDown,false)}AccessibilityManager.prototype.createTouchHook=function createTouchHook(){var _this=this;var hookDiv=document.createElement("button");hookDiv.style.width=DIV_HOOK_SIZE+"px";hookDiv.style.height=DIV_HOOK_SIZE+"px";hookDiv.style.position="absolute";hookDiv.style.top=DIV_HOOK_POS_X+"px";hookDiv.style.left=DIV_HOOK_POS_Y+"px";hookDiv.style.zIndex=DIV_HOOK_ZINDEX;hookDiv.style.backgroundColor="#FF0000";hookDiv.title="HOOK DIV";hookDiv.addEventListener("focus",function(){_this.isMobileAccessabillity=true;_this.activate();document.body.removeChild(hookDiv)});document.body.appendChild(hookDiv)};AccessibilityManager.prototype.activate=function activate(){if(this.isActive){return}this.isActive=true;window.document.addEventListener("mousemove",this._onMouseMove,true);window.removeEventListener("keydown",this._onKeyDown,false);this.renderer.on("postrender",this.update,this);if(this.renderer.view.parentNode){this.renderer.view.parentNode.appendChild(this.div)}};AccessibilityManager.prototype.deactivate=function deactivate(){if(!this.isActive||this.isMobileAccessabillity){return}this.isActive=false;window.document.removeEventListener("mousemove",this._onMouseMove,true);window.addEventListener("keydown",this._onKeyDown,false);this.renderer.off("postrender",this.update);if(this.div.parentNode){this.div.parentNode.removeChild(this.div)}};AccessibilityManager.prototype.updateAccessibleObjects=function updateAccessibleObjects(displayObject){if(!displayObject.visible){return}if(displayObject.accessible&&displayObject.interactive){if(!displayObject._accessibleActive){this.addChild(displayObject)}displayObject.renderId=this.renderId}var children=displayObject.children;for(var i=0;i<children.length;i++){this.updateAccessibleObjects(children[i])}};AccessibilityManager.prototype.update=function update(){if(!this.renderer.renderingToScreen){return}this.updateAccessibleObjects(this.renderer._lastObjectRendered);var rect=this.renderer.view.getBoundingClientRect();var sx=rect.width/this.renderer.width;var sy=rect.height/this.renderer.height;var div=this.div;div.style.left=rect.left+"px";div.style.top=rect.top+"px";div.style.width=this.renderer.width+"px";div.style.height=this.renderer.height+"px";for(var i=0;i<this.children.length;i++){var child=this.children[i];if(child.renderId!==this.renderId){child._accessibleActive=false;core.utils.removeItems(this.children,i,1);this.div.removeChild(child._accessibleDiv);this.pool.push(child._accessibleDiv);child._accessibleDiv=null;i--;if(this.children.length===0){this.deactivate()}}else{div=child._accessibleDiv;var hitArea=child.hitArea;var wt=child.worldTransform;if(child.hitArea){div.style.left=(wt.tx+hitArea.x*wt.a)*sx+"px";div.style.top=(wt.ty+hitArea.y*wt.d)*sy+"px";div.style.width=hitArea.width*wt.a*sx+"px";div.style.height=hitArea.height*wt.d*sy+"px"}else{hitArea=child.getBounds();this.capHitArea(hitArea);div.style.left=hitArea.x*sx+"px";div.style.top=hitArea.y*sy+"px";div.style.width=hitArea.width*sx+"px";div.style.height=hitArea.height*sy+"px";if(div.title!==child.accessibleTitle&&child.accessibleTitle!==null){div.title=child.accessibleTitle}if(div.getAttribute("aria-label")!==child.accessibleHint&&child.accessibleHint!==null){div.setAttribute("aria-label",child.accessibleHint)}}}}this.renderId++};AccessibilityManager.prototype.capHitArea=function capHitArea(hitArea){if(hitArea.x<0){hitArea.width+=hitArea.x;hitArea.x=0}if(hitArea.y<0){hitArea.height+=hitArea.y;hitArea.y=0}if(hitArea.x+hitArea.width>this.renderer.width){hitArea.width=this.renderer.width-hitArea.x}if(hitArea.y+hitArea.height>this.renderer.height){hitArea.height=this.renderer.height-hitArea.y}};AccessibilityManager.prototype.addChild=function addChild(displayObject){var div=this.pool.pop();if(!div){div=document.createElement("button");div.style.width=DIV_TOUCH_SIZE+"px";div.style.height=DIV_TOUCH_SIZE+"px";div.style.backgroundColor=this.debug?"rgba(255,0,0,0.5)":"transparent";div.style.position="absolute";div.style.zIndex=DIV_TOUCH_ZINDEX;div.style.borderStyle="none";if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){div.setAttribute("aria-live","off")}else{div.setAttribute("aria-live","polite")}if(navigator.userAgent.match(/rv:.*Gecko\//)){div.setAttribute("aria-relevant","additions")}else{div.setAttribute("aria-relevant","text")}div.addEventListener("click",this._onClick.bind(this));div.addEventListener("focus",this._onFocus.bind(this));div.addEventListener("focusout",this._onFocusOut.bind(this))}if(displayObject.accessibleTitle&&displayObject.accessibleTitle!==null){div.title=displayObject.accessibleTitle}else if(!displayObject.accessibleHint||displayObject.accessibleHint===null){div.title="displayObject "+displayObject.tabIndex}if(displayObject.accessibleHint&&displayObject.accessibleHint!==null){div.setAttribute("aria-label",displayObject.accessibleHint)}displayObject._accessibleActive=true;displayObject._accessibleDiv=div;div.displayObject=displayObject;this.children.push(displayObject);this.div.appendChild(displayObject._accessibleDiv);displayObject._accessibleDiv.tabIndex=displayObject.tabIndex};AccessibilityManager.prototype._onClick=function _onClick(e){var interactionManager=this.renderer.plugins.interaction;interactionManager.dispatchEvent(e.target.displayObject,"click",interactionManager.eventData)};AccessibilityManager.prototype._onFocus=function _onFocus(e){if(!e.target.getAttribute("aria-live","off")){e.target.setAttribute("aria-live","assertive")}var interactionManager=this.renderer.plugins.interaction;interactionManager.dispatchEvent(e.target.displayObject,"mouseover",interactionManager.eventData)};AccessibilityManager.prototype._onFocusOut=function _onFocusOut(e){if(!e.target.getAttribute("aria-live","off")){e.target.setAttribute("aria-live","polite")}var interactionManager=this.renderer.plugins.interaction;interactionManager.dispatchEvent(e.target.displayObject,"mouseout",interactionManager.eventData)};AccessibilityManager.prototype._onKeyDown=function _onKeyDown(e){if(e.keyCode!==KEY_CODE_TAB){return}this.activate()};AccessibilityManager.prototype._onMouseMove=function _onMouseMove(e){if(e.movementX===0&&e.movementY===0){return}this.deactivate()};AccessibilityManager.prototype.destroy=function destroy(){this.div=null;for(var i=0;i<this.children.length;i++){this.children[i].div=null}window.document.removeEventListener("mousemove",this._onMouseMove,true);window.removeEventListener("keydown",this._onKeyDown);this.pool=null;this.children=null;this.renderer=null};return AccessibilityManager}();exports.default=AccessibilityManager;core.WebGLRenderer.registerPlugin("accessibility",AccessibilityManager);core.CanvasRenderer.registerPlugin("accessibility",AccessibilityManager)},{"../core":110,"./accessibleTarget":86,ismobilejs:43}],86:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default={accessible:false,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:false,_accessibleDiv:false}},{}],87:[function(require,module,exports){"use strict";exports.__esModule=true;var _accessibleTarget=require("./accessibleTarget");Object.defineProperty(exports,"accessibleTarget",{enumerable:true,get:function get(){return _interopRequireDefault(_accessibleTarget).default}});var _AccessibilityManager=require("./AccessibilityManager");Object.defineProperty(exports,"AccessibilityManager",{enumerable:true,get:function get(){return _interopRequireDefault(_AccessibilityManager).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./AccessibilityManager":85,"./accessibleTarget":86}],88:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _autoDetectRenderer=require("./autoDetectRenderer");var _Container=require("./display/Container");var _Container2=_interopRequireDefault(_Container);var _ticker=require("./ticker");var _settings=require("./settings");var _settings2=_interopRequireDefault(_settings);var _const=require("./const");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Application=function(){function Application(options,arg2,arg3,arg4,arg5){_classCallCheck(this,Application);if(typeof options==="number"){options=Object.assign({width:options,height:arg2||_settings2.default.RENDER_OPTIONS.height,forceCanvas:!!arg4,sharedTicker:!!arg5},arg3)}this._options=options=Object.assign({autoStart:true,sharedTicker:false,forceCanvas:false,sharedLoader:false},options);this.renderer=(0,_autoDetectRenderer.autoDetectRenderer)(options);this.stage=new _Container2.default;this._ticker=null;this.ticker=options.sharedTicker?_ticker.shared:new _ticker.Ticker;if(options.autoStart){this.start()}}Application.prototype.render=function render(){this.renderer.render(this.stage)};Application.prototype.stop=function stop(){this._ticker.stop()};Application.prototype.start=function start(){this._ticker.start()};Application.prototype.destroy=function destroy(removeView,stageOptions){if(this._ticker){var oldTicker=this._ticker;this.ticker=null;oldTicker.destroy()}this.stage.destroy(stageOptions);this.stage=null;this.renderer.destroy(removeView);this.renderer=null;this._options=null};_createClass(Application,[{key:"ticker",set:function set(ticker){if(this._ticker){this._ticker.remove(this.render,this)}this._ticker=ticker;if(ticker){ticker.add(this.render,this,_const.UPDATE_PRIORITY.LOW)}},get:function get(){return this._ticker}},{key:"view",get:function get(){return this.renderer.view}},{key:"screen",get:function get(){return this.renderer.screen}}]);return Application}();exports.default=Application},{"./autoDetectRenderer":90,"./const":91,"./display/Container":93,"./settings":146,"./ticker":166}],89:[function(require,module,exports){"use strict";exports.__esModule=true;var _pixiGlCore=require("pixi-gl-core");var _settings=require("./settings");var _settings2=_interopRequireDefault(_settings);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function checkPrecision(src,def){if(src instanceof Array){if(src[0].substring(0,9)!=="precision"){var copy=src.slice(0);copy.unshift("precision "+def+" float;");return copy}}else if(src.trim().substring(0,9)!=="precision"){return"precision "+def+" float;\n"+src}return src}var Shader=function(_GLShader){_inherits(Shader,_GLShader);function Shader(gl,vertexSrc,fragmentSrc,attributeLocations,precision){_classCallCheck(this,Shader);return _possibleConstructorReturn(this,_GLShader.call(this,gl,checkPrecision(vertexSrc,precision||_settings2.default.PRECISION_VERTEX),checkPrecision(fragmentSrc,precision||_settings2.default.PRECISION_FRAGMENT),undefined,attributeLocations))}return Shader}(_pixiGlCore.GLShader);exports.default=Shader},{"./settings":146,"pixi-gl-core":60}],90:[function(require,module,exports){"use strict";exports.__esModule=true;exports.autoDetectRenderer=autoDetectRenderer;var _utils=require("./utils");var utils=_interopRequireWildcard(_utils);var _CanvasRenderer=require("./renderers/canvas/CanvasRenderer");var _CanvasRenderer2=_interopRequireDefault(_CanvasRenderer);var _WebGLRenderer=require("./renderers/webgl/WebGLRenderer");var _WebGLRenderer2=_interopRequireDefault(_WebGLRenderer);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function autoDetectRenderer(options,arg1,arg2,arg3){var forceCanvas=options&&options.forceCanvas;if(arg3!==undefined){forceCanvas=arg3}if(!forceCanvas&&utils.isWebGLSupported()){return new _WebGLRenderer2.default(options,arg1,arg2)}return new _CanvasRenderer2.default(options,arg1,arg2)}},{"./renderers/canvas/CanvasRenderer":122,"./renderers/webgl/WebGLRenderer":129,"./utils":170}],91:[function(require,module,exports){"use strict";exports.__esModule=true;var VERSION=exports.VERSION="4.8.8";var PI_2=exports.PI_2=Math.PI*2;var RAD_TO_DEG=exports.RAD_TO_DEG=180/Math.PI;var DEG_TO_RAD=exports.DEG_TO_RAD=Math.PI/180;var RENDERER_TYPE=exports.RENDERER_TYPE={UNKNOWN:0,WEBGL:1,CANVAS:2};var BLEND_MODES=exports.BLEND_MODES={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16,NORMAL_NPM:17,ADD_NPM:18,SCREEN_NPM:19};var DRAW_MODES=exports.DRAW_MODES={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};var SCALE_MODES=exports.SCALE_MODES={LINEAR:0,NEAREST:1};var WRAP_MODES=exports.WRAP_MODES={CLAMP:0,REPEAT:1,MIRRORED_REPEAT:2};var GC_MODES=exports.GC_MODES={AUTO:0,MANUAL:1};var URL_FILE_EXTENSION=exports.URL_FILE_EXTENSION=/\.(\w{3,4})(?:$|\?|#)/i;var DATA_URI=exports.DATA_URI=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;var SVG_SIZE=exports.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;var SHAPES=exports.SHAPES={POLY:0,RECT:1,CIRC:2,ELIP:3,RREC:4};var PRECISION=exports.PRECISION={LOW:"lowp",MEDIUM:"mediump",HIGH:"highp"};var TRANSFORM_MODE=exports.TRANSFORM_MODE={STATIC:0,DYNAMIC:1};var TEXT_GRADIENT=exports.TEXT_GRADIENT={LINEAR_VERTICAL:0,LINEAR_HORIZONTAL:1};var UPDATE_PRIORITY=exports.UPDATE_PRIORITY={INTERACTION:50,HIGH:25,NORMAL:0,LOW:-25,UTILITY:-50}},{}],92:[function(require,module,exports){"use strict";exports.__esModule=true;var _math=require("../math");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Bounds=function(){function Bounds(){_classCallCheck(this,Bounds);this.minX=Infinity;this.minY=Infinity;this.maxX=-Infinity;this.maxY=-Infinity;this.rect=null}Bounds.prototype.isEmpty=function isEmpty(){return this.minX>this.maxX||this.minY>this.maxY};Bounds.prototype.clear=function clear(){this.updateID++;this.minX=Infinity;this.minY=Infinity;this.maxX=-Infinity;this.maxY=-Infinity};Bounds.prototype.getRectangle=function getRectangle(rect){if(this.minX>this.maxX||this.minY>this.maxY){return _math.Rectangle.EMPTY}rect=rect||new _math.Rectangle(0,0,1,1);rect.x=this.minX;rect.y=this.minY;rect.width=this.maxX-this.minX;rect.height=this.maxY-this.minY;return rect};Bounds.prototype.addPoint=function addPoint(point){this.minX=Math.min(this.minX,point.x);this.maxX=Math.max(this.maxX,point.x);this.minY=Math.min(this.minY,point.y);this.maxY=Math.max(this.maxY,point.y)};Bounds.prototype.addQuad=function addQuad(vertices){var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;var x=vertices[0];var y=vertices[1];minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;x=vertices[2];y=vertices[3];minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;x=vertices[4];y=vertices[5];minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;x=vertices[6];y=vertices[7];minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;this.minX=minX;this.minY=minY;this.maxX=maxX;this.maxY=maxY};Bounds.prototype.addFrame=function addFrame(transform,x0,y0,x1,y1){var matrix=transform.worldTransform;var a=matrix.a;var b=matrix.b;var c=matrix.c;var d=matrix.d;var tx=matrix.tx;var ty=matrix.ty;var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;var x=a*x0+c*y0+tx;var y=b*x0+d*y0+ty;minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;x=a*x1+c*y0+tx;y=b*x1+d*y0+ty;minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;x=a*x0+c*y1+tx;y=b*x0+d*y1+ty;minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;x=a*x1+c*y1+tx;y=b*x1+d*y1+ty;minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;this.minX=minX;this.minY=minY;this.maxX=maxX;this.maxY=maxY};Bounds.prototype.addVertices=function addVertices(transform,vertices,beginOffset,endOffset){var matrix=transform.worldTransform;var a=matrix.a;var b=matrix.b;var c=matrix.c;var d=matrix.d;var tx=matrix.tx;var ty=matrix.ty;var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;for(var i=beginOffset;i<endOffset;i+=2){var rawX=vertices[i];var rawY=vertices[i+1];var x=a*rawX+c*rawY+tx;var y=d*rawY+b*rawX+ty;minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY}this.minX=minX;this.minY=minY;this.maxX=maxX;this.maxY=maxY};Bounds.prototype.addBounds=function addBounds(bounds){var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;this.minX=bounds.minX<minX?bounds.minX:minX;this.minY=bounds.minY<minY?bounds.minY:minY;this.maxX=bounds.maxX>maxX?bounds.maxX:maxX;this.maxY=bounds.maxY>maxY?bounds.maxY:maxY};Bounds.prototype.addBoundsMask=function addBoundsMask(bounds,mask){var _minX=bounds.minX>mask.minX?bounds.minX:mask.minX;var _minY=bounds.minY>mask.minY?bounds.minY:mask.minY;var _maxX=bounds.maxX<mask.maxX?bounds.maxX:mask.maxX;var _maxY=bounds.maxY<mask.maxY?bounds.maxY:mask.maxY;if(_minX<=_maxX&&_minY<=_maxY){var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;this.minX=_minX<minX?_minX:minX;this.minY=_minY<minY?_minY:minY;this.maxX=_maxX>maxX?_maxX:maxX;this.maxY=_maxY>maxY?_maxY:maxY}};Bounds.prototype.addBoundsArea=function addBoundsArea(bounds,area){var _minX=bounds.minX>area.x?bounds.minX:area.x;var _minY=bounds.minY>area.y?bounds.minY:area.y;var _maxX=bounds.maxX<area.x+area.width?bounds.maxX:area.x+area.width;var _maxY=bounds.maxY<area.y+area.height?bounds.maxY:area.y+area.height;if(_minX<=_maxX&&_minY<=_maxY){var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;this.minX=_minX<minX?_minX:minX;this.minY=_minY<minY?_minY:minY;this.maxX=_maxX>maxX?_maxX:maxX;this.maxY=_maxY>maxY?_maxY:maxY}};return Bounds}();exports.default=Bounds},{"../math":115}],93:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _utils=require("../utils");var _DisplayObject2=require("./DisplayObject");var _DisplayObject3=_interopRequireDefault(_DisplayObject2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Container=function(_DisplayObject){_inherits(Container,_DisplayObject);function Container(){_classCallCheck(this,Container);var _this=_possibleConstructorReturn(this,_DisplayObject.call(this));_this.children=[];return _this}Container.prototype.onChildrenChange=function onChildrenChange(){};Container.prototype.addChild=function addChild(child){var argumentsLength=arguments.length;if(argumentsLength>1){for(var i=0;i<argumentsLength;i++){this.addChild(arguments[i])}}else{if(child.parent){child.parent.removeChild(child)}child.parent=this;child.transform._parentID=-1;this.children.push(child);this._boundsID++;this.onChildrenChange(this.children.length-1);child.emit("added",this)}return child};Container.prototype.addChildAt=function addChildAt(child,index){if(index<0||index>this.children.length){throw new Error(child+"addChildAt: The index "+index+" supplied is out of bounds "+this.children.length)}if(child.parent){child.parent.removeChild(child)}child.parent=this;child.transform._parentID=-1;this.children.splice(index,0,child);this._boundsID++;this.onChildrenChange(index);child.emit("added",this);return child};Container.prototype.swapChildren=function swapChildren(child,child2){if(child===child2){return}var index1=this.getChildIndex(child);var index2=this.getChildIndex(child2);this.children[index1]=child2;this.children[index2]=child;this.onChildrenChange(index1<index2?index1:index2)};Container.prototype.getChildIndex=function getChildIndex(child){var index=this.children.indexOf(child);if(index===-1){throw new Error("The supplied DisplayObject must be a child of the caller")}return index};Container.prototype.setChildIndex=function setChildIndex(child,index){if(index<0||index>=this.children.length){throw new Error("The index "+index+" supplied is out of bounds "+this.children.length)}var currentIndex=this.getChildIndex(child);(0,_utils.removeItems)(this.children,currentIndex,1);this.children.splice(index,0,child);this.onChildrenChange(index)};Container.prototype.getChildAt=function getChildAt(index){if(index<0||index>=this.children.length){throw new Error("getChildAt: Index ("+index+") does not exist.")}return this.children[index]};Container.prototype.removeChild=function removeChild(child){var argumentsLength=arguments.length;if(argumentsLength>1){for(var i=0;i<argumentsLength;i++){this.removeChild(arguments[i])}}else{var index=this.children.indexOf(child);if(index===-1)return null;child.parent=null;child.transform._parentID=-1;(0,_utils.removeItems)(this.children,index,1);this._boundsID++;this.onChildrenChange(index);child.emit("removed",this)}return child};Container.prototype.removeChildAt=function removeChildAt(index){var child=this.getChildAt(index);child.parent=null;child.transform._parentID=-1;(0,_utils.removeItems)(this.children,index,1);this._boundsID++;this.onChildrenChange(index);child.emit("removed",this);return child};Container.prototype.removeChildren=function removeChildren(){var beginIndex=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var endIndex=arguments[1];var begin=beginIndex;var end=typeof endIndex==="number"?endIndex:this.children.length;var range=end-begin;var removed=void 0;if(range>0&&range<=end){removed=this.children.splice(begin,range);for(var i=0;i<removed.length;++i){removed[i].parent=null;if(removed[i].transform){removed[i].transform._parentID=-1}}this._boundsID++;this.onChildrenChange(beginIndex);for(var _i=0;_i<removed.length;++_i){removed[_i].emit("removed",this)}return removed}else if(range===0&&this.children.length===0){return[]}throw new RangeError("removeChildren: numeric values are outside the acceptable range.")};Container.prototype.updateTransform=function updateTransform(){this._boundsID++;this.transform.updateTransform(this.parent.transform);this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var i=0,j=this.children.length;i<j;++i){var child=this.children[i];if(child.visible){child.updateTransform()}}};Container.prototype.calculateBounds=function calculateBounds(){this._bounds.clear();this._calculateBounds();for(var i=0;i<this.children.length;i++){var child=this.children[i];if(!child.visible||!child.renderable){continue}child.calculateBounds();if(child._mask){child._mask.calculateBounds();this._bounds.addBoundsMask(child._bounds,child._mask._bounds)}else if(child.filterArea){this._bounds.addBoundsArea(child._bounds,child.filterArea)}else{this._bounds.addBounds(child._bounds)}}this._lastBoundsID=this._boundsID};Container.prototype._calculateBounds=function _calculateBounds(){};Container.prototype.renderWebGL=function renderWebGL(renderer){if(!this.visible||this.worldAlpha<=0||!this.renderable){return}if(this._mask||this._filters){this.renderAdvancedWebGL(renderer)}else{this._renderWebGL(renderer);for(var i=0,j=this.children.length;i<j;++i){this.children[i].renderWebGL(renderer)}}};Container.prototype.renderAdvancedWebGL=function renderAdvancedWebGL(renderer){renderer.flush();var filters=this._filters;var mask=this._mask;if(filters){if(!this._enabledFilters){this._enabledFilters=[]}this._enabledFilters.length=0;for(var i=0;i<filters.length;i++){if(filters[i].enabled){this._enabledFilters.push(filters[i])}}if(this._enabledFilters.length){renderer.filterManager.pushFilter(this,this._enabledFilters)}}if(mask){renderer.maskManager.pushMask(this,this._mask)}this._renderWebGL(renderer);for(var _i2=0,j=this.children.length;_i2<j;_i2++){this.children[_i2].renderWebGL(renderer)}renderer.flush();if(mask){renderer.maskManager.popMask(this,this._mask)}if(filters&&this._enabledFilters&&this._enabledFilters.length){renderer.filterManager.popFilter()}};Container.prototype._renderWebGL=function _renderWebGL(renderer){};Container.prototype._renderCanvas=function _renderCanvas(renderer){};Container.prototype.renderCanvas=function renderCanvas(renderer){if(!this.visible||this.worldAlpha<=0||!this.renderable){return}if(this._mask){renderer.maskManager.pushMask(this._mask)}this._renderCanvas(renderer);for(var i=0,j=this.children.length;i<j;++i){this.children[i].renderCanvas(renderer)}if(this._mask){renderer.maskManager.popMask(renderer)}};Container.prototype.destroy=function destroy(options){_DisplayObject.prototype.destroy.call(this);var destroyChildren=typeof options==="boolean"?options:options&&options.children;var oldChildren=this.removeChildren(0,this.children.length);if(destroyChildren){for(var i=0;i<oldChildren.length;++i){oldChildren[i].destroy(options)}}};_createClass(Container,[{key:"width",get:function get(){return this.scale.x*this.getLocalBounds().width},set:function set(value){var width=this.getLocalBounds().width;if(width!==0){this.scale.x=value/width}else{this.scale.x=1}this._width=value}},{key:"height",get:function get(){return this.scale.y*this.getLocalBounds().height},set:function set(value){var height=this.getLocalBounds().height;if(height!==0){this.scale.y=value/height}else{this.scale.y=1}this._height=value}}]);return Container}(_DisplayObject3.default);exports.default=Container;Container.prototype.containerUpdateTransform=Container.prototype.updateTransform},{"../utils":170,"./DisplayObject":94}],94:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _eventemitter=require("eventemitter3");var _eventemitter2=_interopRequireDefault(_eventemitter);var _const=require("../const");var _settings=require("../settings");var _settings2=_interopRequireDefault(_settings);var _TransformStatic=require("./TransformStatic");var _TransformStatic2=_interopRequireDefault(_TransformStatic);var _Transform=require("./Transform");var _Transform2=_interopRequireDefault(_Transform);var _Bounds=require("./Bounds");var _Bounds2=_interopRequireDefault(_Bounds);var _math=require("../math");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DisplayObject=function(_EventEmitter){_inherits(DisplayObject,_EventEmitter);function DisplayObject(){_classCallCheck(this,DisplayObject);var _this=_possibleConstructorReturn(this,_EventEmitter.call(this));var TransformClass=_settings2.default.TRANSFORM_MODE===_const.TRANSFORM_MODE.STATIC?_TransformStatic2.default:_Transform2.default;_this.tempDisplayObjectParent=null;_this.transform=new TransformClass;_this.alpha=1;_this.visible=true;_this.renderable=true;_this.parent=null;_this.worldAlpha=1;_this.filterArea=null;_this._filters=null;_this._enabledFilters=null;_this._bounds=new _Bounds2.default;_this._boundsID=0;_this._lastBoundsID=-1;_this._boundsRect=null;_this._localBoundsRect=null;_this._mask=null;_this._destroyed=false;return _this}DisplayObject.prototype.updateTransform=function updateTransform(){this.transform.updateTransform(this.parent.transform);this.worldAlpha=this.alpha*this.parent.worldAlpha;this._bounds.updateID++};DisplayObject.prototype._recursivePostUpdateTransform=function _recursivePostUpdateTransform(){if(this.parent){this.parent._recursivePostUpdateTransform();this.transform.updateTransform(this.parent.transform)}else{this.transform.updateTransform(this._tempDisplayObjectParent.transform)}};DisplayObject.prototype.getBounds=function getBounds(skipUpdate,rect){if(!skipUpdate){if(!this.parent){this.parent=this._tempDisplayObjectParent;this.updateTransform();this.parent=null}else{this._recursivePostUpdateTransform();this.updateTransform()}}if(this._boundsID!==this._lastBoundsID){this.calculateBounds()}if(!rect){if(!this._boundsRect){this._boundsRect=new _math.Rectangle}rect=this._boundsRect}return this._bounds.getRectangle(rect)};DisplayObject.prototype.getLocalBounds=function getLocalBounds(rect){var transformRef=this.transform;var parentRef=this.parent;this.parent=null;this.transform=this._tempDisplayObjectParent.transform;if(!rect){if(!this._localBoundsRect){this._localBoundsRect=new _math.Rectangle}rect=this._localBoundsRect}var bounds=this.getBounds(false,rect);this.parent=parentRef;this.transform=transformRef;return bounds};DisplayObject.prototype.toGlobal=function toGlobal(position,point){var skipUpdate=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!skipUpdate){this._recursivePostUpdateTransform();if(!this.parent){this.parent=this._tempDisplayObjectParent;this.displayObjectUpdateTransform();this.parent=null}else{this.displayObjectUpdateTransform()}}return this.worldTransform.apply(position,point)};DisplayObject.prototype.toLocal=function toLocal(position,from,point,skipUpdate){if(from){position=from.toGlobal(position,point,skipUpdate)}if(!skipUpdate){this._recursivePostUpdateTransform();if(!this.parent){this.parent=this._tempDisplayObjectParent;this.displayObjectUpdateTransform();this.parent=null}else{this.displayObjectUpdateTransform()}}return this.worldTransform.applyInverse(position,point)};DisplayObject.prototype.renderWebGL=function renderWebGL(renderer){};DisplayObject.prototype.renderCanvas=function renderCanvas(renderer){};DisplayObject.prototype.setParent=function setParent(container){if(!container||!container.addChild){throw new Error("setParent: Argument must be a Container")}container.addChild(this);return container};DisplayObject.prototype.setTransform=function setTransform(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var scaleX=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var scaleY=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var rotation=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var skewX=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var skewY=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var pivotX=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var pivotY=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;this.position.x=x;this.position.y=y;this.scale.x=!scaleX?1:scaleX;this.scale.y=!scaleY?1:scaleY;this.rotation=rotation;this.skew.x=skewX;this.skew.y=skewY;this.pivot.x=pivotX;this.pivot.y=pivotY;return this};DisplayObject.prototype.destroy=function destroy(){this.removeAllListeners();if(this.parent){this.parent.removeChild(this)}this.transform=null;this.parent=null;this._bounds=null;this._currentBounds=null;this._mask=null;this.filterArea=null;this.interactive=false;this.interactiveChildren=false;this._destroyed=true};_createClass(DisplayObject,[{key:"_tempDisplayObjectParent",get:function get(){if(this.tempDisplayObjectParent===null){this.tempDisplayObjectParent=new DisplayObject}return this.tempDisplayObjectParent}},{key:"x",get:function get(){return this.position.x},set:function set(value){this.transform.position.x=value}},{key:"y",get:function get(){return this.position.y},set:function set(value){this.transform.position.y=value}},{key:"worldTransform",get:function get(){return this.transform.worldTransform}},{key:"localTransform",get:function get(){return this.transform.localTransform}},{key:"position",get:function get(){return this.transform.position},set:function set(value){this.transform.position.copy(value)}},{key:"scale",get:function get(){return this.transform.scale},set:function set(value){this.transform.scale.copy(value)}},{key:"pivot",get:function get(){return this.transform.pivot},set:function set(value){this.transform.pivot.copy(value)}},{key:"skew",get:function get(){return this.transform.skew},set:function set(value){this.transform.skew.copy(value)}},{key:"rotation",get:function get(){return this.transform.rotation},set:function set(value){this.transform.rotation=value}},{key:"worldVisible",get:function get(){var item=this;do{if(!item.visible){return false}item=item.parent}while(item);return true}},{key:"mask",get:function get(){return this._mask},set:function set(value){if(this._mask){this._mask.renderable=true;this._mask.isMask=false}this._mask=value;if(this._mask){this._mask.renderable=false;this._mask.isMask=true}}},{key:"filters",get:function get(){return this._filters&&this._filters.slice()},set:function set(value){this._filters=value&&value.slice()}}]);return DisplayObject}(_eventemitter2.default);exports.default=DisplayObject;DisplayObject.prototype.displayObjectUpdateTransform=DisplayObject.prototype.updateTransform},{"../const":91,"../math":115,"../settings":146,"./Bounds":92,"./Transform":95,"./TransformStatic":97,eventemitter3:235}],95:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _math=require("../math");var _TransformBase2=require("./TransformBase");var _TransformBase3=_interopRequireDefault(_TransformBase2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Transform=function(_TransformBase){_inherits(Transform,_TransformBase);function Transform(){_classCallCheck(this,Transform);var _this=_possibleConstructorReturn(this,_TransformBase.call(this));_this.position=new _math.Point(0,0);_this.scale=new _math.Point(1,1);_this.skew=new _math.ObservablePoint(_this.updateSkew,_this,0,0);_this.pivot=new _math.Point(0,0);_this._rotation=0;_this._cx=1;_this._sx=0;_this._cy=0;_this._sy=1;return _this}Transform.prototype.updateSkew=function updateSkew(){this._cx=Math.cos(this._rotation+this.skew._y);this._sx=Math.sin(this._rotation+this.skew._y);this._cy=-Math.sin(this._rotation-this.skew._x);this._sy=Math.cos(this._rotation-this.skew._x)};Transform.prototype.updateLocalTransform=function updateLocalTransform(){var lt=this.localTransform;lt.a=this._cx*this.scale.x;lt.b=this._sx*this.scale.x;lt.c=this._cy*this.scale.y;lt.d=this._sy*this.scale.y;lt.tx=this.position.x-(this.pivot.x*lt.a+this.pivot.y*lt.c);lt.ty=this.position.y-(this.pivot.x*lt.b+this.pivot.y*lt.d)};Transform.prototype.updateTransform=function updateTransform(parentTransform){var lt=this.localTransform;lt.a=this._cx*this.scale.x;lt.b=this._sx*this.scale.x;lt.c=this._cy*this.scale.y;lt.d=this._sy*this.scale.y;lt.tx=this.position.x-(this.pivot.x*lt.a+this.pivot.y*lt.c);lt.ty=this.position.y-(this.pivot.x*lt.b+this.pivot.y*lt.d);var pt=parentTransform.worldTransform;var wt=this.worldTransform;wt.a=lt.a*pt.a+lt.b*pt.c;wt.b=lt.a*pt.b+lt.b*pt.d;wt.c=lt.c*pt.a+lt.d*pt.c;wt.d=lt.c*pt.b+lt.d*pt.d;wt.tx=lt.tx*pt.a+lt.ty*pt.c+pt.tx;wt.ty=lt.tx*pt.b+lt.ty*pt.d+pt.ty;this._worldID++};Transform.prototype.setFromMatrix=function setFromMatrix(matrix){matrix.decompose(this)};_createClass(Transform,[{key:"rotation",get:function get(){return this._rotation},set:function set(value){this._rotation=value;this.updateSkew()}}]);return Transform}(_TransformBase3.default);exports.default=Transform},{"../math":115,"./TransformBase":96}],96:[function(require,module,exports){"use strict";exports.__esModule=true;var _math=require("../math");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var TransformBase=function(){function TransformBase(){_classCallCheck(this,TransformBase);this.worldTransform=new _math.Matrix;this.localTransform=new _math.Matrix;this._worldID=0;this._parentID=0}TransformBase.prototype.updateLocalTransform=function updateLocalTransform(){};TransformBase.prototype.updateTransform=function updateTransform(parentTransform){var pt=parentTransform.worldTransform;var wt=this.worldTransform;var lt=this.localTransform;wt.a=lt.a*pt.a+lt.b*pt.c;wt.b=lt.a*pt.b+lt.b*pt.d;wt.c=lt.c*pt.a+lt.d*pt.c;wt.d=lt.c*pt.b+lt.d*pt.d;wt.tx=lt.tx*pt.a+lt.ty*pt.c+pt.tx;wt.ty=lt.tx*pt.b+lt.ty*pt.d+pt.ty;this._worldID++};return TransformBase}();exports.default=TransformBase;TransformBase.prototype.updateWorldTransform=TransformBase.prototype.updateTransform;TransformBase.IDENTITY=new TransformBase},{"../math":115}],97:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _math=require("../math");var _TransformBase2=require("./TransformBase");var _TransformBase3=_interopRequireDefault(_TransformBase2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var TransformStatic=function(_TransformBase){_inherits(TransformStatic,_TransformBase);function TransformStatic(){_classCallCheck(this,TransformStatic);var _this=_possibleConstructorReturn(this,_TransformBase.call(this));_this.position=new _math.ObservablePoint(_this.onChange,_this,0,0);_this.scale=new _math.ObservablePoint(_this.onChange,_this,1,1);_this.pivot=new _math.ObservablePoint(_this.onChange,_this,0,0);_this.skew=new _math.ObservablePoint(_this.updateSkew,_this,0,0);_this._rotation=0;_this._cx=1;_this._sx=0;_this._cy=0;_this._sy=1;_this._localID=0;_this._currentLocalID=0;return _this}TransformStatic.prototype.onChange=function onChange(){this._localID++};TransformStatic.prototype.updateSkew=function updateSkew(){this._cx=Math.cos(this._rotation+this.skew._y);this._sx=Math.sin(this._rotation+this.skew._y);this._cy=-Math.sin(this._rotation-this.skew._x);this._sy=Math.cos(this._rotation-this.skew._x);this._localID++};TransformStatic.prototype.updateLocalTransform=function updateLocalTransform(){var lt=this.localTransform;if(this._localID!==this._currentLocalID){lt.a=this._cx*this.scale._x;lt.b=this._sx*this.scale._x;lt.c=this._cy*this.scale._y;lt.d=this._sy*this.scale._y;lt.tx=this.position._x-(this.pivot._x*lt.a+this.pivot._y*lt.c);lt.ty=this.position._y-(this.pivot._x*lt.b+this.pivot._y*lt.d);this._currentLocalID=this._localID;this._parentID=-1}};TransformStatic.prototype.updateTransform=function updateTransform(parentTransform){var lt=this.localTransform;if(this._localID!==this._currentLocalID){lt.a=this._cx*this.scale._x;lt.b=this._sx*this.scale._x;lt.c=this._cy*this.scale._y;lt.d=this._sy*this.scale._y;lt.tx=this.position._x-(this.pivot._x*lt.a+this.pivot._y*lt.c);lt.ty=this.position._y-(this.pivot._x*lt.b+this.pivot._y*lt.d);this._currentLocalID=this._localID;this._parentID=-1}if(this._parentID!==parentTransform._worldID){var pt=parentTransform.worldTransform;var wt=this.worldTransform;wt.a=lt.a*pt.a+lt.b*pt.c;wt.b=lt.a*pt.b+lt.b*pt.d;wt.c=lt.c*pt.a+lt.d*pt.c;wt.d=lt.c*pt.b+lt.d*pt.d;wt.tx=lt.tx*pt.a+lt.ty*pt.c+pt.tx;wt.ty=lt.tx*pt.b+lt.ty*pt.d+pt.ty;this._parentID=parentTransform._worldID;this._worldID++}};TransformStatic.prototype.setFromMatrix=function setFromMatrix(matrix){matrix.decompose(this);this._localID++};_createClass(TransformStatic,[{key:"rotation",get:function get(){return this._rotation},set:function set(value){if(this._rotation!==value){this._rotation=value;this.updateSkew()}}}]);return TransformStatic}(_TransformBase3.default);exports.default=TransformStatic},{"../math":115,"./TransformBase":96}],98:[function(require,module,exports){"use strict";exports.__esModule=true;var _Container2=require("../display/Container");var _Container3=_interopRequireDefault(_Container2);var _RenderTexture=require("../textures/RenderTexture");var _RenderTexture2=_interopRequireDefault(_RenderTexture);var _Texture=require("../textures/Texture");var _Texture2=_interopRequireDefault(_Texture);var _GraphicsData=require("./GraphicsData");var _GraphicsData2=_interopRequireDefault(_GraphicsData);var _Sprite=require("../sprites/Sprite");var _Sprite2=_interopRequireDefault(_Sprite);var _math=require("../math");var _utils=require("../utils");var _const=require("../const");var _Bounds=require("../display/Bounds");var _Bounds2=_interopRequireDefault(_Bounds);var _bezierCurveTo2=require("./utils/bezierCurveTo");var _bezierCurveTo3=_interopRequireDefault(_bezierCurveTo2);var _CanvasRenderer=require("../renderers/canvas/CanvasRenderer");var _CanvasRenderer2=_interopRequireDefault(_CanvasRenderer);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var canvasRenderer=void 0;var tempMatrix=new _math.Matrix;var tempPoint=new _math.Point;var tempColor1=new Float32Array(4);var tempColor2=new Float32Array(4);var Graphics=function(_Container){_inherits(Graphics,_Container);function Graphics(){var nativeLines=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;_classCallCheck(this,Graphics);var _this=_possibleConstructorReturn(this,_Container.call(this));_this.fillAlpha=1;_this.lineWidth=0;_this.nativeLines=nativeLines;_this.lineColor=0;_this.lineAlignment=.5;_this.graphicsData=[];_this.tint=16777215;_this._prevTint=16777215;_this.blendMode=_const.BLEND_MODES.NORMAL;_this.currentPath=null;_this._webGL={};_this.isMask=false;_this.boundsPadding=0;_this._localBounds=new _Bounds2.default;_this.dirty=0;_this.fastRectDirty=-1;_this.clearDirty=0;_this.boundsDirty=-1;_this.cachedSpriteDirty=false;_this._spriteRect=null;_this._fastRect=false;_this._prevRectTint=null;_this._prevRectFillColor=null;return _this}Graphics.prototype.clone=function clone(){var clone=new Graphics;clone.renderable=this.renderable;clone.fillAlpha=this.fillAlpha;clone.lineWidth=this.lineWidth;clone.lineColor=this.lineColor;clone.lineAlignment=this.lineAlignment;clone.tint=this.tint;clone.blendMode=this.blendMode;clone.isMask=this.isMask;clone.boundsPadding=this.boundsPadding;clone.dirty=0;clone.cachedSpriteDirty=this.cachedSpriteDirty;for(var i=0;i<this.graphicsData.length;++i){clone.graphicsData.push(this.graphicsData[i].clone())}clone.currentPath=clone.graphicsData[clone.graphicsData.length-1];clone.updateLocalBounds();return clone};Graphics.prototype._quadraticCurveLength=function _quadraticCurveLength(fromX,fromY,cpX,cpY,toX,toY){var ax=fromX-2*cpX+toX;var ay=fromY-2*cpY+toY;var bx=2*cpX-2*fromX;var by=2*cpY-2*fromY;var a=4*(ax*ax+ay*ay);var b=4*(ax*bx+ay*by);var c=bx*bx+by*by;var s=2*Math.sqrt(a+b+c);var a2=Math.sqrt(a);var a32=2*a*a2;var c2=2*Math.sqrt(c);var ba=b/a2;return(a32*s+a2*b*(s-c2)+(4*c*a-b*b)*Math.log((2*a2+ba+s)/(ba+c2)))/(4*a32)};Graphics.prototype._bezierCurveLength=function _bezierCurveLength(fromX,fromY,cpX,cpY,cpX2,cpY2,toX,toY){var n=10;var result=0;var t=0;var t2=0;var t3=0;var nt=0;var nt2=0;var nt3=0;var x=0;var y=0;var dx=0;var dy=0;var prevX=fromX;var prevY=fromY;for(var i=1;i<=n;++i){t=i/n;t2=t*t;t3=t2*t;nt=1-t;nt2=nt*nt;nt3=nt2*nt;x=nt3*fromX+3*nt2*t*cpX+3*nt*t2*cpX2+t3*toX;y=nt3*fromY+3*nt2*t*cpY+3*nt*t2*cpY2+t3*toY;dx=prevX-x;dy=prevY-y;prevX=x;prevY=y;result+=Math.sqrt(dx*dx+dy*dy)}return result};Graphics.prototype._segmentsCount=function _segmentsCount(length){var result=Math.ceil(length/Graphics.CURVES.maxLength);if(result<Graphics.CURVES.minSegments){result=Graphics.CURVES.minSegments}else if(result>Graphics.CURVES.maxSegments){result=Graphics.CURVES.maxSegments}return result};Graphics.prototype.lineStyle=function lineStyle(){var lineWidth=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var color=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var alpha=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var alignment=arguments.length>3&&arguments[3]!==undefined?arguments[3]:.5;this.lineWidth=lineWidth;this.lineColor=color;this.lineAlpha=alpha;this.lineAlignment=alignment;if(this.currentPath){if(this.currentPath.shape.points.length){var shape=new _math.Polygon(this.currentPath.shape.points.slice(-2));shape.closed=false;this.drawShape(shape)}else{this.currentPath.lineWidth=this.lineWidth;this.currentPath.lineColor=this.lineColor;this.currentPath.lineAlpha=this.lineAlpha;this.currentPath.lineAlignment=this.lineAlignment}}return this};Graphics.prototype.moveTo=function moveTo(x,y){var shape=new _math.Polygon([x,y]);shape.closed=false;this.drawShape(shape);return this};Graphics.prototype.lineTo=function lineTo(x,y){var points=this.currentPath.shape.points;var fromX=points[points.length-2];var fromY=points[points.length-1];if(fromX!==x||fromY!==y){points.push(x,y);this.dirty++}return this};Graphics.prototype.quadraticCurveTo=function quadraticCurveTo(cpX,cpY,toX,toY){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points=[0,0]}}else{this.moveTo(0,0)}var points=this.currentPath.shape.points;var xa=0;var ya=0;if(points.length===0){this.moveTo(0,0)}var fromX=points[points.length-2];var fromY=points[points.length-1];var n=Graphics.CURVES.adaptive?this._segmentsCount(this._quadraticCurveLength(fromX,fromY,cpX,cpY,toX,toY)):20;for(var i=1;i<=n;++i){var j=i/n;xa=fromX+(cpX-fromX)*j;ya=fromY+(cpY-fromY)*j;points.push(xa+(cpX+(toX-cpX)*j-xa)*j,ya+(cpY+(toY-cpY)*j-ya)*j)}this.dirty++;return this};Graphics.prototype.bezierCurveTo=function bezierCurveTo(cpX,cpY,cpX2,cpY2,toX,toY){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points=[0,0]}}else{this.moveTo(0,0)}var points=this.currentPath.shape.points;var fromX=points[points.length-2];var fromY=points[points.length-1];points.length-=2;var n=Graphics.CURVES.adaptive?this._segmentsCount(this._bezierCurveLength(fromX,fromY,cpX,cpY,cpX2,cpY2,toX,toY)):20;(0,_bezierCurveTo3.default)(fromX,fromY,cpX,cpY,cpX2,cpY2,toX,toY,n,points);this.dirty++;return this};Graphics.prototype.arcTo=function arcTo(x1,y1,x2,y2,radius){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points.push(x1,y1)}}else{this.moveTo(x1,y1)}var points=this.currentPath.shape.points;var fromX=points[points.length-2];var fromY=points[points.length-1];var a1=fromY-y1;var b1=fromX-x1;var a2=y2-y1;var b2=x2-x1;var mm=Math.abs(a1*b2-b1*a2);if(mm<1e-8||radius===0){if(points[points.length-2]!==x1||points[points.length-1]!==y1){points.push(x1,y1)}}else{var dd=a1*a1+b1*b1;var cc=a2*a2+b2*b2;var tt=a1*a2+b1*b2;var k1=radius*Math.sqrt(dd)/mm;var k2=radius*Math.sqrt(cc)/mm;var j1=k1*tt/dd;var j2=k2*tt/cc;var cx=k1*b2+k2*b1;var cy=k1*a2+k2*a1;var px=b1*(k2+j1);var py=a1*(k2+j1);var qx=b2*(k1+j2);var qy=a2*(k1+j2);var startAngle=Math.atan2(py-cy,px-cx);var endAngle=Math.atan2(qy-cy,qx-cx);this.arc(cx+x1,cy+y1,radius,startAngle,endAngle,b1*a2>b2*a1)}this.dirty++;return this};Graphics.prototype.arc=function arc(cx,cy,radius,startAngle,endAngle){var anticlockwise=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;if(startAngle===endAngle){return this}if(!anticlockwise&&endAngle<=startAngle){endAngle+=_const.PI_2}else if(anticlockwise&&startAngle<=endAngle){startAngle+=_const.PI_2}var sweep=endAngle-startAngle;var segs=Graphics.CURVES.adaptive?this._segmentsCount(Math.abs(sweep)*radius):Math.ceil(Math.abs(sweep)/_const.PI_2)*40;if(sweep===0){return this}var startX=cx+Math.cos(startAngle)*radius;var startY=cy+Math.sin(startAngle)*radius;var points=this.currentPath?this.currentPath.shape.points:null;if(points){var xDiff=Math.abs(points[points.length-2]-startX);var yDiff=Math.abs(points[points.length-1]-startY);if(xDiff<.001&&yDiff<.001){}else{points.push(startX,startY)}}else{this.moveTo(startX,startY);points=this.currentPath.shape.points}var theta=sweep/(segs*2);var theta2=theta*2;var cTheta=Math.cos(theta);var sTheta=Math.sin(theta);var segMinus=segs-1;var remainder=segMinus%1/segMinus;for(var i=0;i<=segMinus;++i){var real=i+remainder*i;var angle=theta+startAngle+theta2*real;var c=Math.cos(angle);var s=-Math.sin(angle);points.push((cTheta*c+sTheta*s)*radius+cx,(cTheta*-s+sTheta*c)*radius+cy)}this.dirty++;return this};Graphics.prototype.beginFill=function beginFill(){var color=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var alpha=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;this.filling=true;this.fillColor=color;this.fillAlpha=alpha;if(this.currentPath){if(this.currentPath.shape.points.length<=2){this.currentPath.fill=this.filling;this.currentPath.fillColor=this.fillColor;this.currentPath.fillAlpha=this.fillAlpha}}return this};Graphics.prototype.endFill=function endFill(){this.filling=false;this.fillColor=null;this.fillAlpha=1;return this};Graphics.prototype.drawRect=function drawRect(x,y,width,height){this.drawShape(new _math.Rectangle(x,y,width,height));return this};Graphics.prototype.drawRoundedRect=function drawRoundedRect(x,y,width,height,radius){this.drawShape(new _math.RoundedRectangle(x,y,width,height,radius));return this};Graphics.prototype.drawCircle=function drawCircle(x,y,radius){this.drawShape(new _math.Circle(x,y,radius));return this};Graphics.prototype.drawEllipse=function drawEllipse(x,y,width,height){this.drawShape(new _math.Ellipse(x,y,width,height));return this};Graphics.prototype.drawPolygon=function drawPolygon(path){var points=path;var closed=true;if(points instanceof _math.Polygon){closed=points.closed;points=points.points}if(!Array.isArray(points)){points=new Array(arguments.length);for(var i=0;i<points.length;++i){points[i]=arguments[i]}}var shape=new _math.Polygon(points);shape.closed=closed;this.drawShape(shape);return this};Graphics.prototype.drawStar=function drawStar(x,y,points,radius,innerRadius){var rotation=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;innerRadius=innerRadius||radius/2;var startAngle=-1*Math.PI/2+rotation;var len=points*2;var delta=_const.PI_2/len;var polygon=[];for(var i=0;i<len;i++){var r=i%2?innerRadius:radius;var angle=i*delta+startAngle;polygon.push(x+r*Math.cos(angle),y+r*Math.sin(angle))}return this.drawPolygon(polygon)};Graphics.prototype.clear=function clear(){if(this.lineWidth||this.filling||this.graphicsData.length>0){this.lineWidth=0;this.lineAlignment=.5;this.filling=false;this.boundsDirty=-1;this.canvasTintDirty=-1;this.dirty++;this.clearDirty++;this.graphicsData.length=0}this.currentPath=null;this._spriteRect=null;return this};Graphics.prototype.isFastRect=function isFastRect(){return this.graphicsData.length===1&&this.graphicsData[0].shape.type===_const.SHAPES.RECT&&!this.graphicsData[0].lineWidth};Graphics.prototype._renderWebGL=function _renderWebGL(renderer){if(this.dirty!==this.fastRectDirty){this.fastRectDirty=this.dirty;this._fastRect=this.isFastRect()}if(this._fastRect){this._renderSpriteRect(renderer)}else{renderer.setObjectRenderer(renderer.plugins.graphics);renderer.plugins.graphics.render(this)}};Graphics.prototype._renderSpriteRect=function _renderSpriteRect(renderer){var rect=this.graphicsData[0].shape;if(!this._spriteRect){this._spriteRect=new _Sprite2.default(new _Texture2.default(_Texture2.default.WHITE))}var sprite=this._spriteRect;var fillColor=this.graphicsData[0].fillColor;if(this.tint===16777215){sprite.tint=fillColor}else if(this.tint!==this._prevRectTint||fillColor!==this._prevRectFillColor){var t1=tempColor1;var t2=tempColor2;(0,_utils.hex2rgb)(fillColor,t1);(0,_utils.hex2rgb)(this.tint,t2);t1[0]*=t2[0];t1[1]*=t2[1];t1[2]*=t2[2];sprite.tint=(0,_utils.rgb2hex)(t1);this._prevRectTint=this.tint;this._prevRectFillColor=fillColor}sprite.alpha=this.graphicsData[0].fillAlpha;sprite.worldAlpha=this.worldAlpha*sprite.alpha;sprite.blendMode=this.blendMode;sprite._texture._frame.width=rect.width;sprite._texture._frame.height=rect.height;sprite.transform.worldTransform=this.transform.worldTransform;sprite.anchor.set(-rect.x/rect.width,-rect.y/rect.height);sprite._onAnchorUpdate();sprite._renderWebGL(renderer)};Graphics.prototype._renderCanvas=function _renderCanvas(renderer){if(this.isMask===true){return}renderer.plugins.graphics.render(this)};Graphics.prototype._calculateBounds=function _calculateBounds(){if(this.boundsDirty!==this.dirty){this.boundsDirty=this.dirty;this.updateLocalBounds();this.cachedSpriteDirty=true}var lb=this._localBounds;this._bounds.addFrame(this.transform,lb.minX,lb.minY,lb.maxX,lb.maxY)};Graphics.prototype.containsPoint=function containsPoint(point){this.worldTransform.applyInverse(point,tempPoint);var graphicsData=this.graphicsData;for(var i=0;i<graphicsData.length;++i){var data=graphicsData[i];if(!data.fill){continue}if(data.shape){if(data.shape.contains(tempPoint.x,tempPoint.y)){if(data.holes){for(var _i=0;_i<data.holes.length;_i++){var hole=data.holes[_i];if(hole.contains(tempPoint.x,tempPoint.y)){return false}}}return true}}}return false};Graphics.prototype.updateLocalBounds=function updateLocalBounds(){var minX=Infinity;var maxX=-Infinity;var minY=Infinity;var maxY=-Infinity;if(this.graphicsData.length){var shape=0;var x=0;var y=0;var w=0;var h=0;for(var i=0;i<this.graphicsData.length;i++){var data=this.graphicsData[i];var type=data.type;var lineWidth=data.lineWidth;var lineAlignment=data.lineAlignment;var lineOffset=lineWidth*lineAlignment;shape=data.shape;if(type===_const.SHAPES.RECT||type===_const.SHAPES.RREC){x=shape.x-lineOffset;y=shape.y-lineOffset;w=shape.width+lineOffset*2;h=shape.height+lineOffset*2;minX=x<minX?x:minX;maxX=x+w>maxX?x+w:maxX;minY=y<minY?y:minY;maxY=y+h>maxY?y+h:maxY}else if(type===_const.SHAPES.CIRC){x=shape.x;y=shape.y;w=shape.radius+lineOffset;h=shape.radius+lineOffset;minX=x-w<minX?x-w:minX;maxX=x+w>maxX?x+w:maxX;minY=y-h<minY?y-h:minY;maxY=y+h>maxY?y+h:maxY}else if(type===_const.SHAPES.ELIP){x=shape.x;y=shape.y;w=shape.width+lineOffset;h=shape.height+lineOffset;minX=x-w<minX?x-w:minX;maxX=x+w>maxX?x+w:maxX;minY=y-h<minY?y-h:minY;maxY=y+h>maxY?y+h:maxY}else{var points=shape.points;var x2=0;var y2=0;var dx=0;var dy=0;var rw=0;var rh=0;var cx=0;var cy=0;for(var j=0;j+2<points.length;j+=2){x=points[j];y=points[j+1];x2=points[j+2];y2=points[j+3];dx=Math.abs(x2-x);dy=Math.abs(y2-y);h=lineOffset*2;w=Math.sqrt(dx*dx+dy*dy);if(w<1e-9){continue}rw=(h/w*dy+dx)/2;rh=(h/w*dx+dy)/2;cx=(x2+x)/2;cy=(y2+y)/2;minX=cx-rw<minX?cx-rw:minX;maxX=cx+rw>maxX?cx+rw:maxX;minY=cy-rh<minY?cy-rh:minY;maxY=cy+rh>maxY?cy+rh:maxY}}}}else{minX=0;maxX=0;minY=0;maxY=0}var padding=this.boundsPadding;this._localBounds.minX=minX-padding;this._localBounds.maxX=maxX+padding;this._localBounds.minY=minY-padding;this._localBounds.maxY=maxY+padding};Graphics.prototype.drawShape=function drawShape(shape){if(this.currentPath){if(this.currentPath.shape.points.length<=2){this.graphicsData.pop()}}this.currentPath=null;var data=new _GraphicsData2.default(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,this.nativeLines,shape,this.lineAlignment);this.graphicsData.push(data);if(data.type===_const.SHAPES.POLY){data.shape.closed=data.shape.closed;this.currentPath=data}this.dirty++;return data};Graphics.prototype.generateCanvasTexture=function generateCanvasTexture(scaleMode){var resolution=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var bounds=this.getLocalBounds();var canvasBuffer=_RenderTexture2.default.create(bounds.width,bounds.height,scaleMode,resolution);if(!canvasRenderer){canvasRenderer=new _CanvasRenderer2.default}this.transform.updateLocalTransform();this.transform.localTransform.copy(tempMatrix);tempMatrix.invert();tempMatrix.tx-=bounds.x;tempMatrix.ty-=bounds.y;canvasRenderer.render(this,canvasBuffer,true,tempMatrix);var texture=_Texture2.default.fromCanvas(canvasBuffer.baseTexture._canvasRenderTarget.canvas,scaleMode,"graphics");texture.baseTexture.resolution=resolution;texture.baseTexture.update();return texture};Graphics.prototype.closePath=function closePath(){var currentPath=this.currentPath;if(currentPath&&currentPath.shape){currentPath.shape.close()}return this};Graphics.prototype.addHole=function addHole(){var hole=this.graphicsData.pop();this.currentPath=this.graphicsData[this.graphicsData.length-1];this.currentPath.addHole(hole.shape);this.currentPath=null;return this};Graphics.prototype.destroy=function destroy(options){_Container.prototype.destroy.call(this,options);for(var i=0;i<this.graphicsData.length;++i){this.graphicsData[i].destroy()}for(var id in this._webGL){for(var j=0;j<this._webGL[id].data.length;++j){this._webGL[id].data[j].destroy()}}if(this._spriteRect){this._spriteRect.destroy()}this.graphicsData=null;this.currentPath=null;this._webGL=null;this._localBounds=null};return Graphics}(_Container3.default);exports.default=Graphics;Graphics._SPRITE_TEXTURE=null;Graphics.CURVES={adaptive:false,maxLength:10,minSegments:8,maxSegments:2048}},{"../const":91,"../display/Bounds":92,"../display/Container":93,"../math":115,"../renderers/canvas/CanvasRenderer":122,"../sprites/Sprite":147,"../textures/RenderTexture":158,"../textures/Texture":160,"../utils":170,"./GraphicsData":99,"./utils/bezierCurveTo":101}],99:[function(require,module,exports){"use strict";exports.__esModule=true;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var GraphicsData=function(){function GraphicsData(lineWidth,lineColor,lineAlpha,fillColor,fillAlpha,fill,nativeLines,shape,lineAlignment){_classCallCheck(this,GraphicsData);this.lineWidth=lineWidth;this.lineAlignment=lineAlignment;this.nativeLines=nativeLines;this.lineColor=lineColor;this.lineAlpha=lineAlpha;this._lineTint=lineColor;this.fillColor=fillColor;this.fillAlpha=fillAlpha;this._fillTint=fillColor;this.fill=fill;this.holes=[];this.shape=shape;this.type=shape.type}GraphicsData.prototype.clone=function clone(){return new GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.nativeLines,this.shape,this.lineAlignment)};GraphicsData.prototype.addHole=function addHole(shape){this.holes.push(shape)};GraphicsData.prototype.destroy=function destroy(){this.shape=null;this.holes=null};return GraphicsData}();exports.default=GraphicsData},{}],100:[function(require,module,exports){"use strict";exports.__esModule=true;var _CanvasRenderer=require("../../renderers/canvas/CanvasRenderer");var _CanvasRenderer2=_interopRequireDefault(_CanvasRenderer);var _const=require("../../const");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var CanvasGraphicsRenderer=function(){function CanvasGraphicsRenderer(renderer){_classCallCheck(this,CanvasGraphicsRenderer);this.renderer=renderer}CanvasGraphicsRenderer.prototype.render=function render(graphics){var renderer=this.renderer;var context=renderer.context;var worldAlpha=graphics.worldAlpha;var transform=graphics.transform.worldTransform;var resolution=renderer.resolution;context.setTransform(transform.a*resolution,transform.b*resolution,transform.c*resolution,transform.d*resolution,transform.tx*resolution,transform.ty*resolution);if(graphics.canvasTintDirty!==graphics.dirty||graphics._prevTint!==graphics.tint){this.updateGraphicsTint(graphics)}renderer.setBlendMode(graphics.blendMode);for(var i=0;i<graphics.graphicsData.length;i++){var data=graphics.graphicsData[i];var shape=data.shape;var fillColor=data._fillTint;var lineColor=data._lineTint;context.lineWidth=data.lineWidth;if(data.type===_const.SHAPES.POLY){context.beginPath();var points=shape.points;var holes=data.holes;var outerArea=void 0;var innerArea=void 0;var px=void 0;var py=void 0;context.moveTo(points[0],points[1]);for(var j=2;j<points.length;j+=2){context.lineTo(points[j],points[j+1])}if(shape.closed){context.closePath()}if(holes.length>0){outerArea=0;px=points[0];py=points[1];for(var _j=2;_j+2<points.length;_j+=2){outerArea+=(points[_j]-px)*(points[_j+3]-py)-(points[_j+2]-px)*(points[_j+1]-py)}for(var k=0;k<holes.length;k++){points=holes[k].points;if(!points){continue}innerArea=0;px=points[0];py=points[1];for(var _j2=2;_j2+2<points.length;_j2+=2){innerArea+=(points[_j2]-px)*(points[_j2+3]-py)-(points[_j2+2]-px)*(points[_j2+1]-py)}if(innerArea*outerArea<0){context.moveTo(points[0],points[1]);for(var _j3=2;_j3<points.length;_j3+=2){context.lineTo(points[_j3],points[_j3+1])}}else{context.moveTo(points[points.length-2],points[points.length-1]);for(var _j4=points.length-4;_j4>=0;_j4-=2){context.lineTo(points[_j4],points[_j4+1])}}if(holes[k].close){context.closePath()}}}if(data.fill){context.globalAlpha=data.fillAlpha*worldAlpha;context.fillStyle="#"+("00000"+(fillColor|0).toString(16)).substr(-6);context.fill()}if(data.lineWidth){context.globalAlpha=data.lineAlpha*worldAlpha;context.strokeStyle="#"+("00000"+(lineColor|0).toString(16)).substr(-6);context.stroke()}}else if(data.type===_const.SHAPES.RECT){if(data.fillColor||data.fillColor===0){context.globalAlpha=data.fillAlpha*worldAlpha;context.fillStyle="#"+("00000"+(fillColor|0).toString(16)).substr(-6);context.fillRect(shape.x,shape.y,shape.width,shape.height)}if(data.lineWidth){context.globalAlpha=data.lineAlpha*worldAlpha;context.strokeStyle="#"+("00000"+(lineColor|0).toString(16)).substr(-6);context.strokeRect(shape.x,shape.y,shape.width,shape.height)}}else if(data.type===_const.SHAPES.CIRC){context.beginPath();context.arc(shape.x,shape.y,shape.radius,0,2*Math.PI);context.closePath();if(data.fill){context.globalAlpha=data.fillAlpha*worldAlpha;context.fillStyle="#"+("00000"+(fillColor|0).toString(16)).substr(-6);context.fill()}if(data.lineWidth){context.globalAlpha=data.lineAlpha*worldAlpha;context.strokeStyle="#"+("00000"+(lineColor|0).toString(16)).substr(-6);context.stroke()}}else if(data.type===_const.SHAPES.ELIP){var w=shape.width*2;var h=shape.height*2;var x=shape.x-w/2;var y=shape.y-h/2;context.beginPath();var kappa=.5522848;var ox=w/2*kappa;var oy=h/2*kappa;var xe=x+w;var ye=y+h;var xm=x+w/2;var ym=y+h/2;context.moveTo(x,ym);context.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y);context.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym);context.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye);context.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym);context.closePath();if(data.fill){context.globalAlpha=data.fillAlpha*worldAlpha;context.fillStyle="#"+("00000"+(fillColor|0).toString(16)).substr(-6);context.fill()}if(data.lineWidth){context.globalAlpha=data.lineAlpha*worldAlpha;context.strokeStyle="#"+("00000"+(lineColor|0).toString(16)).substr(-6);context.stroke()}}else if(data.type===_const.SHAPES.RREC){var rx=shape.x;var ry=shape.y;var width=shape.width;var height=shape.height;var radius=shape.radius;var maxRadius=Math.min(width,height)/2|0;radius=radius>maxRadius?maxRadius:radius;context.beginPath();context.moveTo(rx,ry+radius);context.lineTo(rx,ry+height-radius);context.quadraticCurveTo(rx,ry+height,rx+radius,ry+height);context.lineTo(rx+width-radius,ry+height);context.quadraticCurveTo(rx+width,ry+height,rx+width,ry+height-radius);context.lineTo(rx+width,ry+radius);context.quadraticCurveTo(rx+width,ry,rx+width-radius,ry);context.lineTo(rx+radius,ry);context.quadraticCurveTo(rx,ry,rx,ry+radius);context.closePath();if(data.fillColor||data.fillColor===0){context.globalAlpha=data.fillAlpha*worldAlpha;context.fillStyle="#"+("00000"+(fillColor|0).toString(16)).substr(-6);context.fill()}if(data.lineWidth){context.globalAlpha=data.lineAlpha*worldAlpha;context.strokeStyle="#"+("00000"+(lineColor|0).toString(16)).substr(-6);context.stroke()}}}};CanvasGraphicsRenderer.prototype.updateGraphicsTint=function updateGraphicsTint(graphics){graphics._prevTint=graphics.tint;graphics.canvasTintDirty=graphics.dirty;var tintR=(graphics.tint>>16&255)/255;var tintG=(graphics.tint>>8&255)/255;var tintB=(graphics.tint&255)/255;for(var i=0;i<graphics.graphicsData.length;++i){var data=graphics.graphicsData[i];var fillColor=data.fillColor|0;var lineColor=data.lineColor|0;data._fillTint=((fillColor>>16&255)/255*tintR*255<<16)+((fillColor>>8&255)/255*tintG*255<<8)+(fillColor&255)/255*tintB*255;data._lineTint=((lineColor>>16&255)/255*tintR*255<<16)+((lineColor>>8&255)/255*tintG*255<<8)+(lineColor&255)/255*tintB*255}};CanvasGraphicsRenderer.prototype.renderPolygon=function renderPolygon(points,close,context){context.moveTo(points[0],points[1]);for(var j=1;j<points.length/2;++j){context.lineTo(points[j*2],points[j*2+1])}if(close){context.closePath()}};CanvasGraphicsRenderer.prototype.destroy=function destroy(){this.renderer=null};return CanvasGraphicsRenderer}();exports.default=CanvasGraphicsRenderer;_CanvasRenderer2.default.registerPlugin("graphics",CanvasGraphicsRenderer)},{"../../const":91,"../../renderers/canvas/CanvasRenderer":122}],101:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=bezierCurveTo;function bezierCurveTo(fromX,fromY,cpX,cpY,cpX2,cpY2,toX,toY,n){var path=arguments.length>9&&arguments[9]!==undefined?arguments[9]:[];var dt=0;var dt2=0;var dt3=0;var t2=0;var t3=0;path.push(fromX,fromY);for(var i=1,j=0;i<=n;++i){j=i/n;dt=1-j;dt2=dt*dt;dt3=dt2*dt;t2=j*j;t3=t2*j;path.push(dt3*fromX+3*dt2*j*cpX+3*dt*t2*cpX2+t3*toX,dt3*fromY+3*dt2*j*cpY+3*dt*t2*cpY2+t3*toY)}return path}},{}],102:[function(require,module,exports){"use strict";exports.__esModule=true;var _utils=require("../../utils");var _const=require("../../const");var _ObjectRenderer2=require("../../renderers/webgl/utils/ObjectRenderer");var _ObjectRenderer3=_interopRequireDefault(_ObjectRenderer2);var _WebGLRenderer=require("../../renderers/webgl/WebGLRenderer");var _WebGLRenderer2=_interopRequireDefault(_WebGLRenderer);var _WebGLGraphicsData=require("./WebGLGraphicsData");var _WebGLGraphicsData2=_interopRequireDefault(_WebGLGraphicsData);var _PrimitiveShader=require("./shaders/PrimitiveShader");var _PrimitiveShader2=_interopRequireDefault(_PrimitiveShader);var _buildPoly=require("./utils/buildPoly");var _buildPoly2=_interopRequireDefault(_buildPoly);var _buildRectangle=require("./utils/buildRectangle");var _buildRectangle2=_interopRequireDefault(_buildRectangle);var _buildRoundedRectangle=require("./utils/buildRoundedRectangle");var _buildRoundedRectangle2=_interopRequireDefault(_buildRoundedRectangle);var _buildCircle=require("./utils/buildCircle");var _buildCircle2=_interopRequireDefault(_buildCircle);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var GraphicsRenderer=function(_ObjectRenderer){_inherits(GraphicsRenderer,_ObjectRenderer);function GraphicsRenderer(renderer){_classCallCheck(this,GraphicsRenderer);var _this=_possibleConstructorReturn(this,_ObjectRenderer.call(this,renderer));_this.graphicsDataPool=[];_this.primitiveShader=null;_this.gl=renderer.gl;_this.CONTEXT_UID=0;return _this}GraphicsRenderer.prototype.onContextChange=function onContextChange(){this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID;this.primitiveShader=new _PrimitiveShader2.default(this.gl)};GraphicsRenderer.prototype.destroy=function destroy(){_ObjectRenderer3.default.prototype.destroy.call(this);for(var i=0;i<this.graphicsDataPool.length;++i){this.graphicsDataPool[i].destroy()}this.graphicsDataPool=null};GraphicsRenderer.prototype.render=function render(graphics){var renderer=this.renderer;var gl=renderer.gl;var webGLData=void 0;var webGL=graphics._webGL[this.CONTEXT_UID];if(!webGL||graphics.dirty!==webGL.dirty){this.updateGraphics(graphics);webGL=graphics._webGL[this.CONTEXT_UID]}var shader=this.primitiveShader;renderer.bindShader(shader);renderer.state.setBlendMode(graphics.blendMode);for(var i=0,n=webGL.data.length;i<n;i++){webGLData=webGL.data[i];var shaderTemp=webGLData.shader;renderer.bindShader(shaderTemp);shaderTemp.uniforms.translationMatrix=graphics.transform.worldTransform.toArray(true);shaderTemp.uniforms.tint=(0,_utils.hex2rgb)(graphics.tint);shaderTemp.uniforms.alpha=graphics.worldAlpha;renderer.bindVao(webGLData.vao);if(webGLData.nativeLines){gl.drawArrays(gl.LINES,0,webGLData.points.length/6)}else{webGLData.vao.draw(gl.TRIANGLE_STRIP,webGLData.indices.length)}}};GraphicsRenderer.prototype.updateGraphics=function updateGraphics(graphics){var gl=this.renderer.gl;var webGL=graphics._webGL[this.CONTEXT_UID];if(!webGL){webGL=graphics._webGL[this.CONTEXT_UID]={lastIndex:0,data:[],gl:gl,clearDirty:-1,dirty:-1}}webGL.dirty=graphics.dirty;if(graphics.clearDirty!==webGL.clearDirty){webGL.clearDirty=graphics.clearDirty;for(var i=0;i<webGL.data.length;i++){this.graphicsDataPool.push(webGL.data[i])}webGL.data.length=0;webGL.lastIndex=0}var webGLData=void 0;var webGLDataNativeLines=void 0;for(var _i=webGL.lastIndex;_i<graphics.graphicsData.length;_i++){var data=graphics.graphicsData[_i];webGLData=this.getWebGLData(webGL,0);if(data.nativeLines&&data.lineWidth){webGLDataNativeLines=this.getWebGLData(webGL,0,true);webGL.lastIndex++}if(data.type===_const.SHAPES.POLY){(0,_buildPoly2.default)(data,webGLData,webGLDataNativeLines)}if(data.type===_const.SHAPES.RECT){(0,_buildRectangle2.default)(data,webGLData,webGLDataNativeLines)}else if(data.type===_const.SHAPES.CIRC||data.type===_const.SHAPES.ELIP){(0,_buildCircle2.default)(data,webGLData,webGLDataNativeLines)}else if(data.type===_const.SHAPES.RREC){(0,_buildRoundedRectangle2.default)(data,webGLData,webGLDataNativeLines)}webGL.lastIndex++}this.renderer.bindVao(null);for(var _i2=0;_i2<webGL.data.length;_i2++){webGLData=webGL.data[_i2];if(webGLData.dirty){webGLData.upload()}}};GraphicsRenderer.prototype.getWebGLData=function getWebGLData(gl,type,nativeLines){var webGLData=gl.data[gl.data.length-1];if(!webGLData||webGLData.nativeLines!==nativeLines||webGLData.points.length>32e4){webGLData=this.graphicsDataPool.pop()||new _WebGLGraphicsData2.default(this.renderer.gl,this.primitiveShader,this.renderer.state.attribsState);webGLData.nativeLines=nativeLines;webGLData.reset(type);gl.data.push(webGLData)}webGLData.dirty=true;return webGLData};return GraphicsRenderer}(_ObjectRenderer3.default);exports.default=GraphicsRenderer;_WebGLRenderer2.default.registerPlugin("graphics",GraphicsRenderer)},{"../../const":91,"../../renderers/webgl/WebGLRenderer":129,"../../renderers/webgl/utils/ObjectRenderer":139,"../../utils":170,"./WebGLGraphicsData":103,"./shaders/PrimitiveShader":104,"./utils/buildCircle":105,"./utils/buildPoly":107,"./utils/buildRectangle":108,"./utils/buildRoundedRectangle":109}],103:[function(require,module,exports){"use strict";exports.__esModule=true;var _pixiGlCore=require("pixi-gl-core");var _pixiGlCore2=_interopRequireDefault(_pixiGlCore);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var WebGLGraphicsData=function(){function WebGLGraphicsData(gl,shader,attribsState){_classCallCheck(this,WebGLGraphicsData);this.gl=gl;this.color=[0,0,0];this.points=[];this.indices=[];this.buffer=_pixiGlCore2.default.GLBuffer.createVertexBuffer(gl);this.indexBuffer=_pixiGlCore2.default.GLBuffer.createIndexBuffer(gl);this.dirty=true;this.nativeLines=false;this.glPoints=null;this.glIndices=null;this.shader=shader;this.vao=new _pixiGlCore2.default.VertexArrayObject(gl,attribsState).addIndex(this.indexBuffer).addAttribute(this.buffer,shader.attributes.aVertexPosition,gl.FLOAT,false,4*6,0).addAttribute(this.buffer,shader.attributes.aColor,gl.FLOAT,false,4*6,2*4)}WebGLGraphicsData.prototype.reset=function reset(){this.points.length=0;this.indices.length=0};WebGLGraphicsData.prototype.upload=function upload(){this.glPoints=new Float32Array(this.points);this.buffer.upload(this.glPoints);this.glIndices=new Uint16Array(this.indices);this.indexBuffer.upload(this.glIndices);this.dirty=false};WebGLGraphicsData.prototype.destroy=function destroy(){this.color=null;this.points=null;this.indices=null;this.vao.destroy();this.buffer.destroy();this.indexBuffer.destroy();this.gl=null;this.buffer=null;this.indexBuffer=null;this.glPoints=null;this.glIndices=null};return WebGLGraphicsData}();exports.default=WebGLGraphicsData},{"pixi-gl-core":60}],104:[function(require,module,exports){"use strict";exports.__esModule=true;var _Shader2=require("../../../Shader");var _Shader3=_interopRequireDefault(_Shader2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var PrimitiveShader=function(_Shader){_inherits(PrimitiveShader,_Shader);function PrimitiveShader(gl){_classCallCheck(this,PrimitiveShader);return _possibleConstructorReturn(this,_Shader.call(this,gl,["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"].join("\n"),["varying vec4 vColor;","void main(void){","   gl_FragColor = vColor;","}"].join("\n")))}return PrimitiveShader}(_Shader3.default);exports.default=PrimitiveShader},{"../../../Shader":89}],105:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=buildCircle;var _buildLine=require("./buildLine");var _buildLine2=_interopRequireDefault(_buildLine);var _const=require("../../../const");var _utils=require("../../../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function buildCircle(graphicsData,webGLData,webGLDataNativeLines){var circleData=graphicsData.shape;var x=circleData.x;var y=circleData.y;var width=void 0;var height=void 0;if(graphicsData.type===_const.SHAPES.CIRC){width=circleData.radius;height=circleData.radius}else{width=circleData.width;height=circleData.height}if(width===0||height===0){return}var totalSegs=Math.floor(30*Math.sqrt(circleData.radius))||Math.floor(15*Math.sqrt(circleData.width+circleData.height));var seg=Math.PI*2/totalSegs;if(graphicsData.fill){var color=(0,_utils.hex2rgb)(graphicsData.fillColor);var alpha=graphicsData.fillAlpha;var r=color[0]*alpha;var g=color[1]*alpha;var b=color[2]*alpha;var verts=webGLData.points;var indices=webGLData.indices;var vecPos=verts.length/6;indices.push(vecPos);for(var i=0;i<totalSegs+1;i++){verts.push(x,y,r,g,b,alpha);verts.push(x+Math.sin(seg*i)*width,y+Math.cos(seg*i)*height,r,g,b,alpha);indices.push(vecPos++,vecPos++)}indices.push(vecPos-1)}if(graphicsData.lineWidth){var tempPoints=graphicsData.points;graphicsData.points=[];for(var _i=0;_i<totalSegs;_i++){graphicsData.points.push(x+Math.sin(seg*-_i)*width,y+Math.cos(seg*-_i)*height)}graphicsData.points.push(graphicsData.points[0],graphicsData.points[1]);(0,_buildLine2.default)(graphicsData,webGLData,webGLDataNativeLines);graphicsData.points=tempPoints}}},{"../../../const":91,"../../../utils":170,"./buildLine":106}],106:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=function(graphicsData,webGLData,webGLDataNativeLines){if(graphicsData.nativeLines){buildNativeLine(graphicsData,webGLDataNativeLines)}else{buildLine(graphicsData,webGLData)}};var _math=require("../../../math");var _utils=require("../../../utils");function buildLine(graphicsData,webGLData){var points=graphicsData.points;if(points.length===0){return}var firstPoint=new _math.Point(points[0],points[1]);var lastPoint=new _math.Point(points[points.length-2],points[points.length-1]);if(firstPoint.x===lastPoint.x&&firstPoint.y===lastPoint.y){points=points.slice();points.pop();points.pop();lastPoint=new _math.Point(points[points.length-2],points[points.length-1]);var midPointX=lastPoint.x+(firstPoint.x-lastPoint.x)*.5;var midPointY=lastPoint.y+(firstPoint.y-lastPoint.y)*.5;points.unshift(midPointX,midPointY);points.push(midPointX,midPointY)}var verts=webGLData.points;var indices=webGLData.indices;var length=points.length/2;var indexCount=points.length;var indexStart=verts.length/6;var width=graphicsData.lineWidth/2;var color=(0,_utils.hex2rgb)(graphicsData.lineColor);var alpha=graphicsData.lineAlpha;var r=color[0]*alpha;var g=color[1]*alpha;var b=color[2]*alpha;var p1x=points[0];var p1y=points[1];var p2x=points[2];var p2y=points[3];var p3x=0;var p3y=0;var perpx=-(p1y-p2y);var perpy=p1x-p2x;var perp2x=0;var perp2y=0;var perp3x=0;var perp3y=0;var dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx/=dist;perpy/=dist;perpx*=width;perpy*=width;var ratio=graphicsData.lineAlignment;var r1=(1-ratio)*2;var r2=ratio*2;verts.push(p1x-perpx*r1,p1y-perpy*r1,r,g,b,alpha);verts.push(p1x+perpx*r2,p1y+perpy*r2,r,g,b,alpha);for(var i=1;i<length-1;++i){p1x=points[(i-1)*2];p1y=points[(i-1)*2+1];p2x=points[i*2];p2y=points[i*2+1];p3x=points[(i+1)*2];p3y=points[(i+1)*2+1];perpx=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx/=dist;perpy/=dist;perpx*=width;perpy*=width;perp2x=-(p2y-p3y);perp2y=p2x-p3x;dist=Math.sqrt(perp2x*perp2x+perp2y*perp2y);perp2x/=dist;perp2y/=dist;perp2x*=width;perp2y*=width;var a1=-perpy+p1y-(-perpy+p2y);var b1=-perpx+p2x-(-perpx+p1x);var c1=(-perpx+p1x)*(-perpy+p2y)-(-perpx+p2x)*(-perpy+p1y);var a2=-perp2y+p3y-(-perp2y+p2y);var b2=-perp2x+p2x-(-perp2x+p3x);var c2=(-perp2x+p3x)*(-perp2y+p2y)-(-perp2x+p2x)*(-perp2y+p3y);var denom=a1*b2-a2*b1;if(Math.abs(denom)<.1){denom+=10.1;verts.push(p2x-perpx*r1,p2y-perpy*r1,r,g,b,alpha);verts.push(p2x+perpx*r2,p2y+perpy*r2,r,g,b,alpha);continue}var px=(b1*c2-b2*c1)/denom;var py=(a2*c1-a1*c2)/denom;var pdist=(px-p2x)*(px-p2x)+(py-p2y)*(py-p2y);if(pdist>196*width*width){perp3x=perpx-perp2x;perp3y=perpy-perp2y;dist=Math.sqrt(perp3x*perp3x+perp3y*perp3y);perp3x/=dist;perp3y/=dist;perp3x*=width;perp3y*=width;verts.push(p2x-perp3x*r1,p2y-perp3y*r1);verts.push(r,g,b,alpha);verts.push(p2x+perp3x*r2,p2y+perp3y*r2);verts.push(r,g,b,alpha);verts.push(p2x-perp3x*r2*r1,p2y-perp3y*r1);verts.push(r,g,b,alpha);indexCount++}else{verts.push(p2x+(px-p2x)*r1,p2y+(py-p2y)*r1);verts.push(r,g,b,alpha);verts.push(p2x-(px-p2x)*r2,p2y-(py-p2y)*r2);verts.push(r,g,b,alpha)}}p1x=points[(length-2)*2];p1y=points[(length-2)*2+1];p2x=points[(length-1)*2];p2y=points[(length-1)*2+1];perpx=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx/=dist;perpy/=dist;perpx*=width;perpy*=width;verts.push(p2x-perpx*r1,p2y-perpy*r1);verts.push(r,g,b,alpha);verts.push(p2x+perpx*r2,p2y+perpy*r2);verts.push(r,g,b,alpha);indices.push(indexStart);for(var _i=0;_i<indexCount;++_i){indices.push(indexStart++)}indices.push(indexStart-1)}function buildNativeLine(graphicsData,webGLData){var i=0;var points=graphicsData.points;if(points.length===0)return;var verts=webGLData.points;var length=points.length/2;var color=(0,_utils.hex2rgb)(graphicsData.lineColor);var alpha=graphicsData.lineAlpha;var r=color[0]*alpha;var g=color[1]*alpha;var b=color[2]*alpha;for(i=1;i<length;i++){var p1x=points[(i-1)*2];var p1y=points[(i-1)*2+1];var p2x=points[i*2];var p2y=points[i*2+1];verts.push(p1x,p1y);verts.push(r,g,b,alpha);verts.push(p2x,p2y);verts.push(r,g,b,alpha)}}},{"../../../math":115,"../../../utils":170}],107:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=buildPoly;var _buildLine=require("./buildLine");var _buildLine2=_interopRequireDefault(_buildLine);var _utils=require("../../../utils");var _earcut=require("earcut");var _earcut2=_interopRequireDefault(_earcut);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function buildPoly(graphicsData,webGLData,webGLDataNativeLines){graphicsData.points=graphicsData.shape.points.slice();var points=graphicsData.points;if(graphicsData.fill&&points.length>=6){var holeArray=[];var holes=graphicsData.holes;for(var i=0;i<holes.length;i++){var hole=holes[i];holeArray.push(points.length/2);points=points.concat(hole.points)}var verts=webGLData.points;var indices=webGLData.indices;var length=points.length/2;var color=(0,_utils.hex2rgb)(graphicsData.fillColor);var alpha=graphicsData.fillAlpha;var r=color[0]*alpha;var g=color[1]*alpha;var b=color[2]*alpha;var triangles=(0,_earcut2.default)(points,holeArray,2);if(!triangles){return}var vertPos=verts.length/6;for(var _i=0;_i<triangles.length;_i+=3){indices.push(triangles[_i]+vertPos);indices.push(triangles[_i]+vertPos);indices.push(triangles[_i+1]+vertPos);indices.push(triangles[_i+2]+vertPos);indices.push(triangles[_i+2]+vertPos)}for(var _i2=0;_i2<length;_i2++){verts.push(points[_i2*2],points[_i2*2+1],r,g,b,alpha)}}if(graphicsData.lineWidth>0){(0,_buildLine2.default)(graphicsData,webGLData,webGLDataNativeLines)}}},{"../../../utils":170,"./buildLine":106,earcut:39}],108:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=buildRectangle;var _buildLine=require("./buildLine");var _buildLine2=_interopRequireDefault(_buildLine);var _utils=require("../../../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function buildRectangle(graphicsData,webGLData,webGLDataNativeLines){var rectData=graphicsData.shape;var x=rectData.x;var y=rectData.y;var width=rectData.width;var height=rectData.height;if(graphicsData.fill){var color=(0,_utils.hex2rgb)(graphicsData.fillColor);var alpha=graphicsData.fillAlpha;var r=color[0]*alpha;var g=color[1]*alpha;var b=color[2]*alpha;var verts=webGLData.points;var indices=webGLData.indices;var vertPos=verts.length/6;verts.push(x,y);verts.push(r,g,b,alpha);verts.push(x+width,y);verts.push(r,g,b,alpha);verts.push(x,y+height);verts.push(r,g,b,alpha);verts.push(x+width,y+height);verts.push(r,g,b,alpha);indices.push(vertPos,vertPos,vertPos+1,vertPos+2,vertPos+3,vertPos+3)}if(graphicsData.lineWidth){var tempPoints=graphicsData.points;graphicsData.points=[x,y,x+width,y,x+width,y+height,x,y+height,x,y];(0,_buildLine2.default)(graphicsData,webGLData,webGLDataNativeLines);graphicsData.points=tempPoints}}},{"../../../utils":170,"./buildLine":106}],109:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=buildRoundedRectangle;var _earcut=require("earcut");var _earcut2=_interopRequireDefault(_earcut);var _buildLine=require("./buildLine");var _buildLine2=_interopRequireDefault(_buildLine);var _utils=require("../../../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function buildRoundedRectangle(graphicsData,webGLData,webGLDataNativeLines){var rrectData=graphicsData.shape;var x=rrectData.x;var y=rrectData.y;var width=rrectData.width;var height=rrectData.height;var radius=rrectData.radius;var recPoints=[];recPoints.push(x+radius,y);quadraticBezierCurve(x+width-radius,y,x+width,y,x+width,y+radius,recPoints);quadraticBezierCurve(x+width,y+height-radius,x+width,y+height,x+width-radius,y+height,recPoints);quadraticBezierCurve(x+radius,y+height,x,y+height,x,y+height-radius,recPoints);quadraticBezierCurve(x,y+radius,x,y,x+radius+1e-10,y,recPoints);if(graphicsData.fill){var color=(0,_utils.hex2rgb)(graphicsData.fillColor);var alpha=graphicsData.fillAlpha;var r=color[0]*alpha;var g=color[1]*alpha;var b=color[2]*alpha;var verts=webGLData.points;var indices=webGLData.indices;var vecPos=verts.length/6;var triangles=(0,_earcut2.default)(recPoints,null,2);for(var i=0,j=triangles.length;i<j;i+=3){indices.push(triangles[i]+vecPos);indices.push(triangles[i]+vecPos);indices.push(triangles[i+1]+vecPos);indices.push(triangles[i+2]+vecPos);indices.push(triangles[i+2]+vecPos)}for(var _i=0,_j=recPoints.length;_i<_j;_i++){verts.push(recPoints[_i],recPoints[++_i],r,g,b,alpha)}}if(graphicsData.lineWidth){var tempPoints=graphicsData.points;graphicsData.points=recPoints;(0,_buildLine2.default)(graphicsData,webGLData,webGLDataNativeLines);graphicsData.points=tempPoints}}function getPt(n1,n2,perc){var diff=n2-n1;return n1+diff*perc}function quadraticBezierCurve(fromX,fromY,cpX,cpY,toX,toY){var out=arguments.length>6&&arguments[6]!==undefined?arguments[6]:[];var n=20;var points=out;var xa=0;var ya=0;var xb=0;var yb=0;var x=0;var y=0;for(var i=0,j=0;i<=n;++i){j=i/n;xa=getPt(fromX,cpX,j);ya=getPt(fromY,cpY,j);xb=getPt(cpX,toX,j);yb=getPt(cpY,toY,j);x=getPt(xa,xb,j);y=getPt(ya,yb,j);points.push(x,y)}return points}},{"../../../utils":170,"./buildLine":106,earcut:39}],110:[function(require,module,exports){"use strict";exports.__esModule=true;exports.autoDetectRenderer=exports.Application=exports.Filter=exports.SpriteMaskFilter=exports.Quad=exports.RenderTarget=exports.ObjectRenderer=exports.WebGLManager=exports.Shader=exports.CanvasRenderTarget=exports.TextureUvs=exports.VideoBaseTexture=exports.BaseRenderTexture=exports.RenderTexture=exports.BaseTexture=exports.TextureMatrix=exports.Texture=exports.Spritesheet=exports.CanvasGraphicsRenderer=exports.GraphicsRenderer=exports.GraphicsData=exports.Graphics=exports.TextMetrics=exports.TextStyle=exports.Text=exports.SpriteRenderer=exports.CanvasTinter=exports.CanvasSpriteRenderer=exports.Sprite=exports.TransformBase=exports.TransformStatic=exports.Transform=exports.Container=exports.DisplayObject=exports.Bounds=exports.glCore=exports.WebGLRenderer=exports.CanvasRenderer=exports.ticker=exports.utils=exports.settings=undefined;var _const=require("./const");Object.keys(_const).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _const[key]}})});var _math=require("./math");Object.keys(_math).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _math[key]}})});var _pixiGlCore=require("pixi-gl-core");Object.defineProperty(exports,"glCore",{enumerable:true,get:function get(){return _interopRequireDefault(_pixiGlCore).default}});var _Bounds=require("./display/Bounds");Object.defineProperty(exports,"Bounds",{enumerable:true,get:function get(){return _interopRequireDefault(_Bounds).default}});var _DisplayObject=require("./display/DisplayObject");Object.defineProperty(exports,"DisplayObject",{enumerable:true,get:function get(){return _interopRequireDefault(_DisplayObject).default}});var _Container=require("./display/Container");Object.defineProperty(exports,"Container",{enumerable:true,get:function get(){return _interopRequireDefault(_Container).default}});var _Transform=require("./display/Transform");Object.defineProperty(exports,"Transform",{enumerable:true,get:function get(){return _interopRequireDefault(_Transform).default}});var _TransformStatic=require("./display/TransformStatic");Object.defineProperty(exports,"TransformStatic",{enumerable:true,get:function get(){return _interopRequireDefault(_TransformStatic).default}});var _TransformBase=require("./display/TransformBase");Object.defineProperty(exports,"TransformBase",{enumerable:true,get:function get(){return _interopRequireDefault(_TransformBase).default}});var _Sprite=require("./sprites/Sprite");Object.defineProperty(exports,"Sprite",{enumerable:true,get:function get(){return _interopRequireDefault(_Sprite).default}});var _CanvasSpriteRenderer=require("./sprites/canvas/CanvasSpriteRenderer");Object.defineProperty(exports,"CanvasSpriteRenderer",{enumerable:true,get:function get(){return _interopRequireDefault(_CanvasSpriteRenderer).default}});var _CanvasTinter=require("./sprites/canvas/CanvasTinter");Object.defineProperty(exports,"CanvasTinter",{enumerable:true,get:function get(){return _interopRequireDefault(_CanvasTinter).default}});var _SpriteRenderer=require("./sprites/webgl/SpriteRenderer");Object.defineProperty(exports,"SpriteRenderer",{enumerable:true,get:function get(){return _interopRequireDefault(_SpriteRenderer).default}});var _Text=require("./text/Text");Object.defineProperty(exports,"Text",{enumerable:true,get:function get(){return _interopRequireDefault(_Text).default}});var _TextStyle=require("./text/TextStyle");Object.defineProperty(exports,"TextStyle",{enumerable:true,get:function get(){return _interopRequireDefault(_TextStyle).default}});var _TextMetrics=require("./text/TextMetrics");Object.defineProperty(exports,"TextMetrics",{enumerable:true,get:function get(){return _interopRequireDefault(_TextMetrics).default}});var _Graphics=require("./graphics/Graphics");Object.defineProperty(exports,"Graphics",{enumerable:true,get:function get(){return _interopRequireDefault(_Graphics).default}});var _GraphicsData=require("./graphics/GraphicsData");Object.defineProperty(exports,"GraphicsData",{enumerable:true,get:function get(){return _interopRequireDefault(_GraphicsData).default}});var _GraphicsRenderer=require("./graphics/webgl/GraphicsRenderer");Object.defineProperty(exports,"GraphicsRenderer",{enumerable:true,get:function get(){return _interopRequireDefault(_GraphicsRenderer).default}});var _CanvasGraphicsRenderer=require("./graphics/canvas/CanvasGraphicsRenderer");Object.defineProperty(exports,"CanvasGraphicsRenderer",{enumerable:true,get:function get(){return _interopRequireDefault(_CanvasGraphicsRenderer).default}});var _Spritesheet=require("./textures/Spritesheet");Object.defineProperty(exports,"Spritesheet",{enumerable:true,get:function get(){return _interopRequireDefault(_Spritesheet).default}});var _Texture=require("./textures/Texture");Object.defineProperty(exports,"Texture",{enumerable:true,get:function get(){return _interopRequireDefault(_Texture).default}});var _TextureMatrix=require("./textures/TextureMatrix");Object.defineProperty(exports,"TextureMatrix",{enumerable:true,get:function get(){return _interopRequireDefault(_TextureMatrix).default}});var _BaseTexture=require("./textures/BaseTexture");Object.defineProperty(exports,"BaseTexture",{enumerable:true,get:function get(){return _interopRequireDefault(_BaseTexture).default}});var _RenderTexture=require("./textures/RenderTexture");Object.defineProperty(exports,"RenderTexture",{enumerable:true,get:function get(){return _interopRequireDefault(_RenderTexture).default}});var _BaseRenderTexture=require("./textures/BaseRenderTexture");Object.defineProperty(exports,"BaseRenderTexture",{enumerable:true,get:function get(){return _interopRequireDefault(_BaseRenderTexture).default}});var _VideoBaseTexture=require("./textures/VideoBaseTexture");Object.defineProperty(exports,"VideoBaseTexture",{enumerable:true,get:function get(){return _interopRequireDefault(_VideoBaseTexture).default}});var _TextureUvs=require("./textures/TextureUvs");Object.defineProperty(exports,"TextureUvs",{enumerable:true,get:function get(){return _interopRequireDefault(_TextureUvs).default}});var _CanvasRenderTarget=require("./renderers/canvas/utils/CanvasRenderTarget");Object.defineProperty(exports,"CanvasRenderTarget",{enumerable:true,get:function get(){return _interopRequireDefault(_CanvasRenderTarget).default}});var _Shader=require("./Shader");Object.defineProperty(exports,"Shader",{enumerable:true,get:function get(){return _interopRequireDefault(_Shader).default}});var _WebGLManager=require("./renderers/webgl/managers/WebGLManager");Object.defineProperty(exports,"WebGLManager",{enumerable:true,get:function get(){return _interopRequireDefault(_WebGLManager).default}});var _ObjectRenderer=require("./renderers/webgl/utils/ObjectRenderer");Object.defineProperty(exports,"ObjectRenderer",{enumerable:true,get:function get(){return _interopRequireDefault(_ObjectRenderer).default}});var _RenderTarget=require("./renderers/webgl/utils/RenderTarget");Object.defineProperty(exports,"RenderTarget",{enumerable:true,get:function get(){return _interopRequireDefault(_RenderTarget).default}});var _Quad=require("./renderers/webgl/utils/Quad");Object.defineProperty(exports,"Quad",{enumerable:true,get:function get(){return _interopRequireDefault(_Quad).default}});var _SpriteMaskFilter=require("./renderers/webgl/filters/spriteMask/SpriteMaskFilter");Object.defineProperty(exports,"SpriteMaskFilter",{enumerable:true,get:function get(){return _interopRequireDefault(_SpriteMaskFilter).default}});var _Filter=require("./renderers/webgl/filters/Filter");Object.defineProperty(exports,"Filter",{enumerable:true,get:function get(){return _interopRequireDefault(_Filter).default}});var _Application=require("./Application");Object.defineProperty(exports,"Application",{enumerable:true,get:function get(){return _interopRequireDefault(_Application).default}});var _autoDetectRenderer=require("./autoDetectRenderer");Object.defineProperty(exports,"autoDetectRenderer",{enumerable:true,get:function get(){return _autoDetectRenderer.autoDetectRenderer}});var _utils=require("./utils");var utils=_interopRequireWildcard(_utils);var _ticker=require("./ticker");var ticker=_interopRequireWildcard(_ticker);var _settings=require("./settings");var _settings2=_interopRequireDefault(_settings);var _CanvasRenderer=require("./renderers/canvas/CanvasRenderer");var _CanvasRenderer2=_interopRequireDefault(_CanvasRenderer);var _WebGLRenderer=require("./renderers/webgl/WebGLRenderer");var _WebGLRenderer2=_interopRequireDefault(_WebGLRenderer);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.settings=_settings2.default;exports.utils=utils;exports.ticker=ticker;exports.CanvasRenderer=_CanvasRenderer2.default;exports.WebGLRenderer=_WebGLRenderer2.default},{"./Application":88,"./Shader":89,"./autoDetectRenderer":90,"./const":91,"./display/Bounds":92,"./display/Container":93,"./display/DisplayObject":94,"./display/Transform":95,"./display/TransformBase":96,"./display/TransformStatic":97,"./graphics/Graphics":98,"./graphics/GraphicsData":99,"./graphics/canvas/CanvasGraphicsRenderer":100,"./graphics/webgl/GraphicsRenderer":102,"./math":115,"./renderers/canvas/CanvasRenderer":122,"./renderers/canvas/utils/CanvasRenderTarget":124,"./renderers/webgl/WebGLRenderer":129,"./renderers/webgl/filters/Filter":131,"./renderers/webgl/filters/spriteMask/SpriteMaskFilter":134,"./renderers/webgl/managers/WebGLManager":138,"./renderers/webgl/utils/ObjectRenderer":139,"./renderers/webgl/utils/Quad":140,"./renderers/webgl/utils/RenderTarget":141,"./settings":146,"./sprites/Sprite":147,"./sprites/canvas/CanvasSpriteRenderer":148,"./sprites/canvas/CanvasTinter":149,"./sprites/webgl/SpriteRenderer":151,"./text/Text":153,"./text/TextMetrics":154,"./text/TextStyle":155,"./textures/BaseRenderTexture":156,"./textures/BaseTexture":157,"./textures/RenderTexture":158,"./textures/Spritesheet":159,"./textures/Texture":160,"./textures/TextureMatrix":161,"./textures/TextureUvs":162,"./textures/VideoBaseTexture":163,"./ticker":166,"./utils":170,"pixi-gl-core":60}],111:[function(require,module,exports){"use strict";exports.__esModule=true;var _Matrix=require("./Matrix");var _Matrix2=_interopRequireDefault(_Matrix);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ux=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1];var uy=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1];var vx=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1];var vy=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1];var tempMatrices=[];var mul=[];function signum(x){if(x<0){return-1}if(x>0){return 1}return 0}function init(){for(var i=0;i<16;i++){var row=[];mul.push(row);for(var j=0;j<16;j++){var _ux=signum(ux[i]*ux[j]+vx[i]*uy[j]);var _uy=signum(uy[i]*ux[j]+vy[i]*uy[j]);var _vx=signum(ux[i]*vx[j]+vx[i]*vy[j]);var _vy=signum(uy[i]*vx[j]+vy[i]*vy[j]);for(var k=0;k<16;k++){if(ux[k]===_ux&&uy[k]===_uy&&vx[k]===_vx&&vy[k]===_vy){row.push(k);break}}}}for(var _i=0;_i<16;_i++){var mat=new _Matrix2.default;mat.set(ux[_i],uy[_i],vx[_i],vy[_i],0,0);tempMatrices.push(mat)}}init();var GroupD8={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MIRROR_HORIZONTAL:12,uX:function uX(ind){return ux[ind]},uY:function uY(ind){return uy[ind]},vX:function vX(ind){return vx[ind]},vY:function vY(ind){return vy[ind]},inv:function inv(rotation){if(rotation&8){return rotation&15}return-rotation&7},add:function add(rotationSecond,rotationFirst){return mul[rotationSecond][rotationFirst]},sub:function sub(rotationSecond,rotationFirst){return mul[rotationSecond][GroupD8.inv(rotationFirst)]},rotate180:function rotate180(rotation){return rotation^4},isVertical:function isVertical(rotation){return(rotation&3)===2},byDirection:function byDirection(dx,dy){if(Math.abs(dx)*2<=Math.abs(dy)){if(dy>=0){return GroupD8.S}return GroupD8.N}else if(Math.abs(dy)*2<=Math.abs(dx)){if(dx>0){return GroupD8.E}return GroupD8.W}else if(dy>0){if(dx>0){return GroupD8.SE}return GroupD8.SW}else if(dx>0){return GroupD8.NE}return GroupD8.NW},matrixAppendRotationInv:function matrixAppendRotationInv(matrix,rotation){var tx=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var ty=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var mat=tempMatrices[GroupD8.inv(rotation)];mat.tx=tx;mat.ty=ty;matrix.append(mat)}};exports.default=GroupD8},{"./Matrix":112}],112:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _Point=require("./Point");var _Point2=_interopRequireDefault(_Point);var _const=require("../const");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Matrix=function(){function Matrix(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var c=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var d=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var tx=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var ty=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;_classCallCheck(this,Matrix);this.a=a;this.b=b;this.c=c;this.d=d;this.tx=tx;this.ty=ty;this.array=null}Matrix.prototype.fromArray=function fromArray(array){this.a=array[0];this.b=array[1];this.c=array[3];this.d=array[4];this.tx=array[2];this.ty=array[5]};Matrix.prototype.set=function set(a,b,c,d,tx,ty){this.a=a;this.b=b;this.c=c;this.d=d;this.tx=tx;this.ty=ty;return this};Matrix.prototype.toArray=function toArray(transpose,out){if(!this.array){this.array=new Float32Array(9)}var array=out||this.array;if(transpose){array[0]=this.a;array[1]=this.b;array[2]=0;array[3]=this.c;array[4]=this.d;array[5]=0;array[6]=this.tx;array[7]=this.ty;array[8]=1}else{array[0]=this.a;array[1]=this.c;array[2]=this.tx;array[3]=this.b;array[4]=this.d;array[5]=this.ty;array[6]=0;array[7]=0;array[8]=1}return array};Matrix.prototype.apply=function apply(pos,newPos){newPos=newPos||new _Point2.default;var x=pos.x;var y=pos.y;newPos.x=this.a*x+this.c*y+this.tx;newPos.y=this.b*x+this.d*y+this.ty;return newPos};Matrix.prototype.applyInverse=function applyInverse(pos,newPos){newPos=newPos||new _Point2.default;var id=1/(this.a*this.d+this.c*-this.b);var x=pos.x;var y=pos.y;newPos.x=this.d*id*x+-this.c*id*y+(this.ty*this.c-this.tx*this.d)*id;newPos.y=this.a*id*y+-this.b*id*x+(-this.ty*this.a+this.tx*this.b)*id;return newPos};Matrix.prototype.translate=function translate(x,y){this.tx+=x;this.ty+=y;return this};Matrix.prototype.scale=function scale(x,y){this.a*=x;this.d*=y;this.c*=x;this.b*=y;this.tx*=x;this.ty*=y;return this};Matrix.prototype.rotate=function rotate(angle){var cos=Math.cos(angle);var sin=Math.sin(angle);var a1=this.a;var c1=this.c;var tx1=this.tx;this.a=a1*cos-this.b*sin;this.b=a1*sin+this.b*cos;this.c=c1*cos-this.d*sin;this.d=c1*sin+this.d*cos;this.tx=tx1*cos-this.ty*sin;this.ty=tx1*sin+this.ty*cos;return this};Matrix.prototype.append=function append(matrix){var a1=this.a;var b1=this.b;var c1=this.c;var d1=this.d;this.a=matrix.a*a1+matrix.b*c1;this.b=matrix.a*b1+matrix.b*d1;this.c=matrix.c*a1+matrix.d*c1;this.d=matrix.c*b1+matrix.d*d1;this.tx=matrix.tx*a1+matrix.ty*c1+this.tx;this.ty=matrix.tx*b1+matrix.ty*d1+this.ty;return this};Matrix.prototype.setTransform=function setTransform(x,y,pivotX,pivotY,scaleX,scaleY,rotation,skewX,skewY){this.a=Math.cos(rotation+skewY)*scaleX;this.b=Math.sin(rotation+skewY)*scaleX;this.c=-Math.sin(rotation-skewX)*scaleY;this.d=Math.cos(rotation-skewX)*scaleY;this.tx=x-(pivotX*this.a+pivotY*this.c);this.ty=y-(pivotX*this.b+pivotY*this.d);return this};Matrix.prototype.prepend=function prepend(matrix){var tx1=this.tx;if(matrix.a!==1||matrix.b!==0||matrix.c!==0||matrix.d!==1){var a1=this.a;var c1=this.c;this.a=a1*matrix.a+this.b*matrix.c;this.b=a1*matrix.b+this.b*matrix.d;this.c=c1*matrix.a+this.d*matrix.c;this.d=c1*matrix.b+this.d*matrix.d}this.tx=tx1*matrix.a+this.ty*matrix.c+matrix.tx;this.ty=tx1*matrix.b+this.ty*matrix.d+matrix.ty;return this};Matrix.prototype.decompose=function decompose(transform){var a=this.a;var b=this.b;var c=this.c;var d=this.d;var skewX=-Math.atan2(-c,d);var skewY=Math.atan2(b,a);var delta=Math.abs(skewX+skewY);if(delta<1e-5||Math.abs(_const.PI_2-delta)<1e-5){transform.rotation=skewY;transform.skew.x=transform.skew.y=0}else{transform.rotation=0;transform.skew.x=skewX;transform.skew.y=skewY}transform.scale.x=Math.sqrt(a*a+b*b);transform.scale.y=Math.sqrt(c*c+d*d);transform.position.x=this.tx;transform.position.y=this.ty;return transform};Matrix.prototype.invert=function invert(){var a1=this.a;var b1=this.b;var c1=this.c;var d1=this.d;var tx1=this.tx;var n=a1*d1-b1*c1;this.a=d1/n;this.b=-b1/n;this.c=-c1/n;this.d=a1/n;this.tx=(c1*this.ty-d1*tx1)/n;this.ty=-(a1*this.ty-b1*tx1)/n;return this};Matrix.prototype.identity=function identity(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0;return this};Matrix.prototype.clone=function clone(){var matrix=new Matrix;matrix.a=this.a;matrix.b=this.b;matrix.c=this.c;matrix.d=this.d;matrix.tx=this.tx;matrix.ty=this.ty;return matrix};Matrix.prototype.copy=function copy(matrix){matrix.a=this.a;matrix.b=this.b;matrix.c=this.c;matrix.d=this.d;matrix.tx=this.tx;matrix.ty=this.ty;return matrix};_createClass(Matrix,null,[{key:"IDENTITY",get:function get(){return new Matrix}},{key:"TEMP_MATRIX",get:function get(){return new Matrix}}]);return Matrix}();exports.default=Matrix},{"../const":91,"./Point":114}],113:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ObservablePoint=function(){function ObservablePoint(cb,scope){var x=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var y=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;_classCallCheck(this,ObservablePoint);this._x=x;this._y=y;this.cb=cb;this.scope=scope}ObservablePoint.prototype.clone=function clone(){var cb=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var scope=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var _cb=cb||this.cb;var _scope=scope||this.scope;return new ObservablePoint(_cb,_scope,this._x,this._y)};ObservablePoint.prototype.set=function set(x,y){var _x=x||0;var _y=y||(y!==0?_x:0);if(this._x!==_x||this._y!==_y){this._x=_x;this._y=_y;this.cb.call(this.scope)}};ObservablePoint.prototype.copy=function copy(point){if(this._x!==point.x||this._y!==point.y){this._x=point.x;this._y=point.y;this.cb.call(this.scope)}};ObservablePoint.prototype.equals=function equals(p){return p.x===this._x&&p.y===this._y};_createClass(ObservablePoint,[{key:"x",get:function get(){return this._x},set:function set(value){if(this._x!==value){this._x=value;this.cb.call(this.scope)}}},{key:"y",get:function get(){return this._y},set:function set(value){if(this._y!==value){this._y=value;this.cb.call(this.scope)}}}]);return ObservablePoint}();exports.default=ObservablePoint},{}],114:[function(require,module,exports){"use strict";exports.__esModule=true;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Point=function(){function Point(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,Point);this.x=x;this.y=y}Point.prototype.clone=function clone(){return new Point(this.x,this.y)};Point.prototype.copy=function copy(p){this.set(p.x,p.y)};Point.prototype.equals=function equals(p){return p.x===this.x&&p.y===this.y};Point.prototype.set=function set(x,y){this.x=x||0;this.y=y||(y!==0?this.x:0)};return Point}();exports.default=Point},{}],115:[function(require,module,exports){"use strict";exports.__esModule=true;var _Point=require("./Point");Object.defineProperty(exports,"Point",{enumerable:true,get:function get(){return _interopRequireDefault(_Point).default}});var _ObservablePoint=require("./ObservablePoint");Object.defineProperty(exports,"ObservablePoint",{enumerable:true,get:function get(){return _interopRequireDefault(_ObservablePoint).default}});var _Matrix=require("./Matrix");Object.defineProperty(exports,"Matrix",{enumerable:true,get:function get(){return _interopRequireDefault(_Matrix).default}});var _GroupD=require("./GroupD8");Object.defineProperty(exports,"GroupD8",{enumerable:true,get:function get(){return _interopRequireDefault(_GroupD).default}});var _Circle=require("./shapes/Circle");Object.defineProperty(exports,"Circle",{enumerable:true,get:function get(){return _interopRequireDefault(_Circle).default}});var _Ellipse=require("./shapes/Ellipse");Object.defineProperty(exports,"Ellipse",{enumerable:true,get:function get(){return _interopRequireDefault(_Ellipse).default}});var _Polygon=require("./shapes/Polygon");Object.defineProperty(exports,"Polygon",{enumerable:true,get:function get(){return _interopRequireDefault(_Polygon).default}});var _Rectangle=require("./shapes/Rectangle");Object.defineProperty(exports,"Rectangle",{enumerable:true,get:function get(){return _interopRequireDefault(_Rectangle).default}});var _RoundedRectangle=require("./shapes/RoundedRectangle");Object.defineProperty(exports,"RoundedRectangle",{enumerable:true,get:function get(){return _interopRequireDefault(_RoundedRectangle).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./GroupD8":111,"./Matrix":112,"./ObservablePoint":113,"./Point":114,"./shapes/Circle":116,"./shapes/Ellipse":117,"./shapes/Polygon":118,"./shapes/Rectangle":119,"./shapes/RoundedRectangle":120}],116:[function(require,module,exports){"use strict";exports.__esModule=true;var _Rectangle=require("./Rectangle");var _Rectangle2=_interopRequireDefault(_Rectangle);var _const=require("../../const");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Circle=function(){function Circle(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var radius=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,Circle);this.x=x;this.y=y;this.radius=radius;this.type=_const.SHAPES.CIRC}Circle.prototype.clone=function clone(){return new Circle(this.x,this.y,this.radius)};Circle.prototype.contains=function contains(x,y){if(this.radius<=0){return false}var r2=this.radius*this.radius;var dx=this.x-x;var dy=this.y-y;dx*=dx;dy*=dy;return dx+dy<=r2};Circle.prototype.getBounds=function getBounds(){return new _Rectangle2.default(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)};return Circle}();exports.default=Circle},{"../../const":91,"./Rectangle":119}],117:[function(require,module,exports){"use strict";exports.__esModule=true;var _Rectangle=require("./Rectangle");var _Rectangle2=_interopRequireDefault(_Rectangle);var _const=require("../../const");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Ellipse=function(){function Ellipse(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var halfWidth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var halfHeight=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;_classCallCheck(this,Ellipse);this.x=x;this.y=y;this.width=halfWidth;this.height=halfHeight;this.type=_const.SHAPES.ELIP}Ellipse.prototype.clone=function clone(){return new Ellipse(this.x,this.y,this.width,this.height)};Ellipse.prototype.contains=function contains(x,y){if(this.width<=0||this.height<=0){return false}var normx=(x-this.x)/this.width;var normy=(y-this.y)/this.height;normx*=normx;normy*=normy;return normx+normy<=1};Ellipse.prototype.getBounds=function getBounds(){return new _Rectangle2.default(this.x-this.width,this.y-this.height,this.width,this.height)};return Ellipse}();exports.default=Ellipse},{"../../const":91,"./Rectangle":119}],118:[function(require,module,exports){"use strict";exports.__esModule=true;var _Point=require("../Point");var _Point2=_interopRequireDefault(_Point);var _const=require("../../const");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Polygon=function(){function Polygon(){for(var _len=arguments.length,points=Array(_len),_key=0;_key<_len;_key++){points[_key]=arguments[_key]}_classCallCheck(this,Polygon);if(Array.isArray(points[0])){points=points[0]}if(points[0]instanceof _Point2.default){var p=[];for(var i=0,il=points.length;i<il;i++){p.push(points[i].x,points[i].y)}points=p}this.closed=true;this.points=points;this.type=_const.SHAPES.POLY}Polygon.prototype.clone=function clone(){return new Polygon(this.points.slice())};Polygon.prototype.close=function close(){var points=this.points;if(points[0]!==points[points.length-2]||points[1]!==points[points.length-1]){points.push(points[0],points[1])}};Polygon.prototype.contains=function contains(x,y){var inside=false;var length=this.points.length/2;for(var i=0,j=length-1;i<length;j=i++){var xi=this.points[i*2];var yi=this.points[i*2+1];var xj=this.points[j*2];var yj=this.points[j*2+1];var intersect=yi>y!==yj>y&&x<(xj-xi)*((y-yi)/(yj-yi))+xi;if(intersect){inside=!inside}}return inside};return Polygon}();exports.default=Polygon},{"../../const":91,"../Point":114}],119:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _const=require("../../const");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Rectangle=function(){function Rectangle(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var width=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var height=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;_classCallCheck(this,Rectangle);this.x=Number(x);this.y=Number(y);this.width=Number(width);this.height=Number(height);this.type=_const.SHAPES.RECT}Rectangle.prototype.clone=function clone(){return new Rectangle(this.x,this.y,this.width,this.height)};Rectangle.prototype.copy=function copy(rectangle){this.x=rectangle.x;this.y=rectangle.y;this.width=rectangle.width;this.height=rectangle.height;return this};Rectangle.prototype.contains=function contains(x,y){if(this.width<=0||this.height<=0){return false}if(x>=this.x&&x<this.x+this.width){if(y>=this.y&&y<this.y+this.height){return true}}return false};Rectangle.prototype.pad=function pad(paddingX,paddingY){paddingX=paddingX||0;paddingY=paddingY||(paddingY!==0?paddingX:0);this.x-=paddingX;this.y-=paddingY;this.width+=paddingX*2;this.height+=paddingY*2};Rectangle.prototype.fit=function fit(rectangle){var x1=Math.max(this.x,rectangle.x);var x2=Math.min(this.x+this.width,rectangle.x+rectangle.width);var y1=Math.max(this.y,rectangle.y);var y2=Math.min(this.y+this.height,rectangle.y+rectangle.height);this.x=x1;this.width=Math.max(x2-x1,0);this.y=y1;this.height=Math.max(y2-y1,0)};Rectangle.prototype.enlarge=function enlarge(rectangle){var x1=Math.min(this.x,rectangle.x);var x2=Math.max(this.x+this.width,rectangle.x+rectangle.width);var y1=Math.min(this.y,rectangle.y);var y2=Math.max(this.y+this.height,rectangle.y+rectangle.height);this.x=x1;this.width=x2-x1;this.y=y1;this.height=y2-y1};Rectangle.prototype.ceil=function ceil(){var resolution=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var eps=arguments.length>1&&arguments[1]!==undefined?arguments[1]:.001;var x2=Math.ceil((this.x+this.width-eps)*resolution)/resolution;var y2=Math.ceil((this.y+this.height-eps)*resolution)/resolution;this.x=Math.floor((this.x+eps)*resolution)/resolution;this.y=Math.floor((this.y+eps)*resolution)/resolution;this.width=x2-this.x;this.height=y2-this.y};_createClass(Rectangle,[{key:"left",get:function get(){return this.x}},{key:"right",get:function get(){return this.x+this.width}},{key:"top",get:function get(){return this.y}},{key:"bottom",get:function get(){return this.y+this.height}}],[{key:"EMPTY",get:function get(){return new Rectangle(0,0,0,0)}}]);return Rectangle}();exports.default=Rectangle},{"../../const":91}],120:[function(require,module,exports){"use strict";exports.__esModule=true;var _const=require("../../const");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var RoundedRectangle=function(){function RoundedRectangle(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var width=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var height=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var radius=arguments.length>4&&arguments[4]!==undefined?arguments[4]:20;_classCallCheck(this,RoundedRectangle);this.x=x;this.y=y;this.width=width;this.height=height;this.radius=radius;this.type=_const.SHAPES.RREC}RoundedRectangle.prototype.clone=function clone(){return new RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)};RoundedRectangle.prototype.contains=function contains(x,y){if(this.width<=0||this.height<=0){return false}if(x>=this.x&&x<=this.x+this.width){if(y>=this.y&&y<=this.y+this.height){if(y>=this.y+this.radius&&y<=this.y+this.height-this.radius||x>=this.x+this.radius&&x<=this.x+this.width-this.radius){return true}var dx=x-(this.x+this.radius);var dy=y-(this.y+this.radius);var radius2=this.radius*this.radius;if(dx*dx+dy*dy<=radius2){return true}dx=x-(this.x+this.width-this.radius);if(dx*dx+dy*dy<=radius2){return true}dy=y-(this.y+this.height-this.radius);if(dx*dx+dy*dy<=radius2){return true}dx=x-(this.x+this.radius);if(dx*dx+dy*dy<=radius2){return true}}}return false};return RoundedRectangle}();exports.default=RoundedRectangle},{"../../const":91}],121:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _utils=require("../utils");var _math=require("../math");var _const=require("../const");var _settings=require("../settings");var _settings2=_interopRequireDefault(_settings);var _Container=require("../display/Container");var _Container2=_interopRequireDefault(_Container);var _RenderTexture=require("../textures/RenderTexture");var _RenderTexture2=_interopRequireDefault(_RenderTexture);var _eventemitter=require("eventemitter3");var _eventemitter2=_interopRequireDefault(_eventemitter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var tempMatrix=new _math.Matrix;var SystemRenderer=function(_EventEmitter){_inherits(SystemRenderer,_EventEmitter);function SystemRenderer(system,options,arg2,arg3){_classCallCheck(this,SystemRenderer);var _this=_possibleConstructorReturn(this,_EventEmitter.call(this));(0,_utils.sayHello)(system);if(typeof options==="number"){options=Object.assign({width:options,height:arg2||_settings2.default.RENDER_OPTIONS.height},arg3)}options=Object.assign({},_settings2.default.RENDER_OPTIONS,options);_this.options=options;_this.type=_const.RENDERER_TYPE.UNKNOWN;_this.screen=new _math.Rectangle(0,0,options.width,options.height);_this.view=options.view||document.createElement("canvas");_this.resolution=options.resolution||_settings2.default.RESOLUTION;_this.transparent=options.transparent;_this.autoResize=options.autoResize||false;_this.blendModes=null;_this.preserveDrawingBuffer=options.preserveDrawingBuffer;_this.clearBeforeRender=options.clearBeforeRender;_this.roundPixels=options.roundPixels;_this._backgroundColor=0;_this._backgroundColorRgba=[0,0,0,0];_this._backgroundColorString="#000000";_this.backgroundColor=options.backgroundColor||_this._backgroundColor;_this._tempDisplayObjectParent=new _Container2.default;_this._lastObjectRendered=_this._tempDisplayObjectParent;return _this}SystemRenderer.prototype.resize=function resize(screenWidth,screenHeight){this.screen.width=screenWidth;this.screen.height=screenHeight;this.view.width=screenWidth*this.resolution;this.view.height=screenHeight*this.resolution;if(this.autoResize){this.view.style.width=screenWidth+"px";this.view.style.height=screenHeight+"px"}};SystemRenderer.prototype.generateTexture=function generateTexture(displayObject,scaleMode,resolution,region){region=region||displayObject.getLocalBounds();var renderTexture=_RenderTexture2.default.create(region.width|0,region.height|0,scaleMode,resolution);tempMatrix.tx=-region.x;tempMatrix.ty=-region.y;this.render(displayObject,renderTexture,false,tempMatrix,!!displayObject.parent);return renderTexture};SystemRenderer.prototype.destroy=function destroy(removeView){if(removeView&&this.view.parentNode){this.view.parentNode.removeChild(this.view)}this.type=_const.RENDERER_TYPE.UNKNOWN;this.view=null;this.screen=null;this.resolution=0;this.transparent=false;this.autoResize=false;this.blendModes=null;this.options=null;this.preserveDrawingBuffer=false;this.clearBeforeRender=false;this.roundPixels=false;this._backgroundColor=0;this._backgroundColorRgba=null;this._backgroundColorString=null;this._tempDisplayObjectParent=null;this._lastObjectRendered=null};_createClass(SystemRenderer,[{key:"width",get:function get(){return this.view.width}},{key:"height",get:function get(){return this.view.height}},{key:"backgroundColor",get:function get(){return this._backgroundColor},set:function set(value){this._backgroundColor=value;this._backgroundColorString=(0,_utils.hex2string)(value);(0,_utils.hex2rgb)(value,this._backgroundColorRgba)}}]);return SystemRenderer}(_eventemitter2.default);exports.default=SystemRenderer},{"../const":91,"../display/Container":93,"../math":115,"../settings":146,"../textures/RenderTexture":158,"../utils":170,eventemitter3:235}],122:[function(require,module,exports){"use strict";exports.__esModule=true;var _SystemRenderer2=require("../SystemRenderer");var _SystemRenderer3=_interopRequireDefault(_SystemRenderer2);var _CanvasMaskManager=require("./utils/CanvasMaskManager");var _CanvasMaskManager2=_interopRequireDefault(_CanvasMaskManager);var _CanvasRenderTarget=require("./utils/CanvasRenderTarget");var _CanvasRenderTarget2=_interopRequireDefault(_CanvasRenderTarget);var _mapCanvasBlendModesToPixi=require("./utils/mapCanvasBlendModesToPixi");var _mapCanvasBlendModesToPixi2=_interopRequireDefault(_mapCanvasBlendModesToPixi);var _utils=require("../../utils");var _const=require("../../const");var _settings=require("../../settings");var _settings2=_interopRequireDefault(_settings);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CanvasRenderer=function(_SystemRenderer){_inherits(CanvasRenderer,_SystemRenderer);function CanvasRenderer(options,arg2,arg3){_classCallCheck(this,CanvasRenderer);var _this=_possibleConstructorReturn(this,_SystemRenderer.call(this,"Canvas",options,arg2,arg3));_this.type=_const.RENDERER_TYPE.CANVAS;_this.rootContext=_this.view.getContext("2d",{alpha:_this.transparent});_this.context=_this.rootContext;_this.refresh=true;_this.maskManager=new _CanvasMaskManager2.default(_this);_this.smoothProperty="imageSmoothingEnabled";if(!_this.rootContext.imageSmoothingEnabled){if(_this.rootContext.webkitImageSmoothingEnabled){_this.smoothProperty="webkitImageSmoothingEnabled"}else if(_this.rootContext.mozImageSmoothingEnabled){_this.smoothProperty="mozImageSmoothingEnabled"}else if(_this.rootContext.oImageSmoothingEnabled){_this.smoothProperty="oImageSmoothingEnabled"}else if(_this.rootContext.msImageSmoothingEnabled){_this.smoothProperty="msImageSmoothingEnabled"}}_this.initPlugins();_this.blendModes=(0,_mapCanvasBlendModesToPixi2.default)();_this._activeBlendMode=null;_this.renderingToScreen=false;_this.resize(_this.options.width,_this.options.height);return _this}CanvasRenderer.prototype.render=function render(displayObject,renderTexture,clear,transform,skipUpdateTransform){if(!this.view){return}this.renderingToScreen=!renderTexture;this.emit("prerender");var rootResolution=this.resolution;if(renderTexture){renderTexture=renderTexture.baseTexture||renderTexture;if(!renderTexture._canvasRenderTarget){renderTexture._canvasRenderTarget=new _CanvasRenderTarget2.default(renderTexture.width,renderTexture.height,renderTexture.resolution);renderTexture.source=renderTexture._canvasRenderTarget.canvas;renderTexture.valid=true}this.context=renderTexture._canvasRenderTarget.context;this.resolution=renderTexture._canvasRenderTarget.resolution}else{this.context=this.rootContext}var context=this.context;if(!renderTexture){this._lastObjectRendered=displayObject}if(!skipUpdateTransform){var cacheParent=displayObject.parent;var tempWt=this._tempDisplayObjectParent.transform.worldTransform;if(transform){transform.copy(tempWt);this._tempDisplayObjectParent.transform._worldID=-1}else{tempWt.identity()}displayObject.parent=this._tempDisplayObjectParent;displayObject.updateTransform();displayObject.parent=cacheParent}context.save();context.setTransform(1,0,0,1,0,0);context.globalAlpha=1;this._activeBlendMode=_const.BLEND_MODES.NORMAL;context.globalCompositeOperation=this.blendModes[_const.BLEND_MODES.NORMAL];if(navigator.isCocoonJS&&this.view.screencanvas){context.fillStyle="black";context.clear()}if(clear!==undefined?clear:this.clearBeforeRender){if(this.renderingToScreen){if(this.transparent){context.clearRect(0,0,this.width,this.height)}else{context.fillStyle=this._backgroundColorString;context.fillRect(0,0,this.width,this.height)}}}var tempContext=this.context;this.context=context;displayObject.renderCanvas(this);this.context=tempContext;context.restore();this.resolution=rootResolution;this.emit("postrender")};CanvasRenderer.prototype.clear=function clear(clearColor){var context=this.context;clearColor=clearColor||this._backgroundColorString;if(!this.transparent&&clearColor){context.fillStyle=clearColor;context.fillRect(0,0,this.width,this.height)}else{context.clearRect(0,0,this.width,this.height)}};CanvasRenderer.prototype.setBlendMode=function setBlendMode(blendMode){if(this._activeBlendMode===blendMode){return}this._activeBlendMode=blendMode;this.context.globalCompositeOperation=this.blendModes[blendMode]};CanvasRenderer.prototype.destroy=function destroy(removeView){this.destroyPlugins();_SystemRenderer.prototype.destroy.call(this,removeView);this.context=null;this.refresh=true;this.maskManager.destroy();this.maskManager=null;this.smoothProperty=null};CanvasRenderer.prototype.resize=function resize(screenWidth,screenHeight){_SystemRenderer.prototype.resize.call(this,screenWidth,screenHeight);if(this.smoothProperty){this.rootContext[this.smoothProperty]=_settings2.default.SCALE_MODE===_const.SCALE_MODES.LINEAR}};CanvasRenderer.prototype.invalidateBlendMode=function invalidateBlendMode(){this._activeBlendMode=this.blendModes.indexOf(this.context.globalCompositeOperation)};return CanvasRenderer}(_SystemRenderer3.default);exports.default=CanvasRenderer;_utils.pluginTarget.mixin(CanvasRenderer)},{"../../const":91,"../../settings":146,"../../utils":170,"../SystemRenderer":121,"./utils/CanvasMaskManager":123,"./utils/CanvasRenderTarget":124,"./utils/mapCanvasBlendModesToPixi":126}],123:[function(require,module,exports){"use strict";exports.__esModule=true;var _const=require("../../../const");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var CanvasMaskManager=function(){function CanvasMaskManager(renderer){_classCallCheck(this,CanvasMaskManager);this.renderer=renderer}CanvasMaskManager.prototype.pushMask=function pushMask(maskData){var renderer=this.renderer;renderer.context.save();var cacheAlpha=maskData.alpha;var transform=maskData.transform.worldTransform;var resolution=renderer.resolution;renderer.context.setTransform(transform.a*resolution,transform.b*resolution,transform.c*resolution,transform.d*resolution,transform.tx*resolution,transform.ty*resolution);if(!maskData._texture){this.renderGraphicsShape(maskData);renderer.context.clip()}maskData.worldAlpha=cacheAlpha};CanvasMaskManager.prototype.renderGraphicsShape=function renderGraphicsShape(graphics){var context=this.renderer.context;var len=graphics.graphicsData.length;if(len===0){return}context.beginPath();for(var i=0;i<len;i++){var data=graphics.graphicsData[i];var shape=data.shape;if(data.type===_const.SHAPES.POLY){var points=shape.points;var holes=data.holes;var outerArea=void 0;var innerArea=void 0;context.moveTo(points[0],points[1]);for(var j=2;j<points.length;j+=2){context.lineTo(points[j],points[j+1])}if(points[0]===points[points.length-2]&&points[1]===points[points.length-1]){context.closePath()}if(holes.length>0){outerArea=0;for(var _j=0;_j<points.length;_j+=2){outerArea+=points[_j]*points[_j+3]-points[_j+1]*points[_j+2]}for(var k=0;k<holes.length;k++){points=holes[k].points;innerArea=0;for(var _j2=0;_j2<points.length;_j2+=2){innerArea+=points[_j2]*points[_j2+3]-points[_j2+1]*points[_j2+2]}context.moveTo(points[0],points[1]);if(innerArea*outerArea<0){for(var _j3=2;_j3<points.length;_j3+=2){context.lineTo(points[_j3],points[_j3+1])}}else{for(var _j4=points.length-2;_j4>=2;_j4-=2){context.lineTo(points[_j4],points[_j4+1])}}}}}else if(data.type===_const.SHAPES.RECT){context.rect(shape.x,shape.y,shape.width,shape.height);context.closePath()}else if(data.type===_const.SHAPES.CIRC){context.arc(shape.x,shape.y,shape.radius,0,2*Math.PI);context.closePath()}else if(data.type===_const.SHAPES.ELIP){var w=shape.width*2;var h=shape.height*2;var x=shape.x-w/2;var y=shape.y-h/2;var kappa=.5522848;var ox=w/2*kappa;var oy=h/2*kappa;var xe=x+w;var ye=y+h;var xm=x+w/2;var ym=y+h/2;context.moveTo(x,ym);context.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y);context.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym);context.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye);context.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym);context.closePath()}else if(data.type===_const.SHAPES.RREC){var rx=shape.x;var ry=shape.y;var width=shape.width;var height=shape.height;var radius=shape.radius;var maxRadius=Math.min(width,height)/2|0;radius=radius>maxRadius?maxRadius:radius;context.moveTo(rx,ry+radius);context.lineTo(rx,ry+height-radius);context.quadraticCurveTo(rx,ry+height,rx+radius,ry+height);context.lineTo(rx+width-radius,ry+height);context.quadraticCurveTo(rx+width,ry+height,rx+width,ry+height-radius);context.lineTo(rx+width,ry+radius);context.quadraticCurveTo(rx+width,ry,rx+width-radius,ry);context.lineTo(rx+radius,ry);context.quadraticCurveTo(rx,ry,rx,ry+radius);context.closePath()}}};CanvasMaskManager.prototype.popMask=function popMask(renderer){renderer.context.restore();renderer.invalidateBlendMode()};CanvasMaskManager.prototype.destroy=function destroy(){};return CanvasMaskManager}();exports.default=CanvasMaskManager},{"../../../const":91}],124:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _settings=require("../../../settings");var _settings2=_interopRequireDefault(_settings);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var CanvasRenderTarget=function(){function CanvasRenderTarget(width,height,resolution){_classCallCheck(this,CanvasRenderTarget);this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.resolution=resolution||_settings2.default.RESOLUTION;this.resize(width,height)}CanvasRenderTarget.prototype.clear=function clear(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.canvas.width,this.canvas.height)};CanvasRenderTarget.prototype.resize=function resize(width,height){this.canvas.width=width*this.resolution;this.canvas.height=height*this.resolution};CanvasRenderTarget.prototype.destroy=function destroy(){this.context=null;this.canvas=null};_createClass(CanvasRenderTarget,[{key:"width",get:function get(){return this.canvas.width},set:function set(val){this.canvas.width=val}},{key:"height",get:function get(){return this.canvas.height},set:function set(val){this.canvas.height=val}}]);return CanvasRenderTarget}();exports.default=CanvasRenderTarget},{"../../../settings":146}],125:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=canUseNewCanvasBlendModes;function createColoredCanvas(color){var canvas=document.createElement("canvas");canvas.width=6;canvas.height=1;var context=canvas.getContext("2d");context.fillStyle=color;context.fillRect(0,0,6,1);return canvas}function canUseNewCanvasBlendModes(){if(typeof document==="undefined"){return false}var magenta=createColoredCanvas("#ff00ff");var yellow=createColoredCanvas("#ffff00");var canvas=document.createElement("canvas");canvas.width=6;canvas.height=1;var context=canvas.getContext("2d");context.globalCompositeOperation="multiply";context.drawImage(magenta,0,0);context.drawImage(yellow,2,0);var imageData=context.getImageData(2,0,1,1);if(!imageData){return false}var data=imageData.data;return data[0]===255&&data[1]===0&&data[2]===0}},{}],126:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=mapCanvasBlendModesToPixi;var _const=require("../../../const");var _canUseNewCanvasBlendModes=require("./canUseNewCanvasBlendModes");var _canUseNewCanvasBlendModes2=_interopRequireDefault(_canUseNewCanvasBlendModes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function mapCanvasBlendModesToPixi(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];if((0,_canUseNewCanvasBlendModes2.default)()){array[_const.BLEND_MODES.NORMAL]="source-over";array[_const.BLEND_MODES.ADD]="lighter";array[_const.BLEND_MODES.MULTIPLY]="multiply";array[_const.BLEND_MODES.SCREEN]="screen";array[_const.BLEND_MODES.OVERLAY]="overlay";array[_const.BLEND_MODES.DARKEN]="darken";array[_const.BLEND_MODES.LIGHTEN]="lighten";array[_const.BLEND_MODES.COLOR_DODGE]="color-dodge";array[_const.BLEND_MODES.COLOR_BURN]="color-burn";array[_const.BLEND_MODES.HARD_LIGHT]="hard-light";array[_const.BLEND_MODES.SOFT_LIGHT]="soft-light";array[_const.BLEND_MODES.DIFFERENCE]="difference";array[_const.BLEND_MODES.EXCLUSION]="exclusion";array[_const.BLEND_MODES.HUE]="hue";array[_const.BLEND_MODES.SATURATION]="saturate";array[_const.BLEND_MODES.COLOR]="color";array[_const.BLEND_MODES.LUMINOSITY]="luminosity"}else{array[_const.BLEND_MODES.NORMAL]="source-over";array[_const.BLEND_MODES.ADD]="lighter";array[_const.BLEND_MODES.MULTIPLY]="source-over";array[_const.BLEND_MODES.SCREEN]="source-over";array[_const.BLEND_MODES.OVERLAY]="source-over";array[_const.BLEND_MODES.DARKEN]="source-over";array[_const.BLEND_MODES.LIGHTEN]="source-over";array[_const.BLEND_MODES.COLOR_DODGE]="source-over";array[_const.BLEND_MODES.COLOR_BURN]="source-over";array[_const.BLEND_MODES.HARD_LIGHT]="source-over";array[_const.BLEND_MODES.SOFT_LIGHT]="source-over";array[_const.BLEND_MODES.DIFFERENCE]="source-over";array[_const.BLEND_MODES.EXCLUSION]="source-over";array[_const.BLEND_MODES.HUE]="source-over";array[_const.BLEND_MODES.SATURATION]="source-over";array[_const.BLEND_MODES.COLOR]="source-over";array[_const.BLEND_MODES.LUMINOSITY]="source-over"}array[_const.BLEND_MODES.NORMAL_NPM]=array[_const.BLEND_MODES.NORMAL];array[_const.BLEND_MODES.ADD_NPM]=array[_const.BLEND_MODES.ADD];array[_const.BLEND_MODES.SCREEN_NPM]=array[_const.BLEND_MODES.SCREEN];return array}},{"../../../const":91,"./canUseNewCanvasBlendModes":125}],127:[function(require,module,exports){"use strict";exports.__esModule=true;var _const=require("../../const");var _settings=require("../../settings");var _settings2=_interopRequireDefault(_settings);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var TextureGarbageCollector=function(){function TextureGarbageCollector(renderer){_classCallCheck(this,TextureGarbageCollector);this.renderer=renderer;this.count=0;this.checkCount=0;this.maxIdle=_settings2.default.GC_MAX_IDLE;this.checkCountMax=_settings2.default.GC_MAX_CHECK_COUNT;this.mode=_settings2.default.GC_MODE}TextureGarbageCollector.prototype.update=function update(){this.count++;if(this.mode===_const.GC_MODES.MANUAL){return}this.checkCount++;if(this.checkCount>this.checkCountMax){this.checkCount=0;this.run()}};TextureGarbageCollector.prototype.run=function run(){var tm=this.renderer.textureManager;var managedTextures=tm._managedTextures;var wasRemoved=false;for(var i=0;i<managedTextures.length;i++){var texture=managedTextures[i];if(!texture._glRenderTargets&&this.count-texture.touched>this.maxIdle){tm.destroyTexture(texture,true);managedTextures[i]=null;wasRemoved=true}}if(wasRemoved){var j=0;for(var _i=0;_i<managedTextures.length;_i++){if(managedTextures[_i]!==null){managedTextures[j++]=managedTextures[_i]}}managedTextures.length=j}};TextureGarbageCollector.prototype.unload=function unload(displayObject){var tm=this.renderer.textureManager;if(displayObject._texture&&displayObject._texture._glRenderTargets){tm.destroyTexture(displayObject._texture,true)}for(var i=displayObject.children.length-1;i>=0;i--){this.unload(displayObject.children[i])}};return TextureGarbageCollector}();exports.default=TextureGarbageCollector},{"../../const":91,"../../settings":146}],128:[function(require,module,exports){"use strict";exports.__esModule=true;var _pixiGlCore=require("pixi-gl-core");var _const=require("../../const");var _RenderTarget=require("./utils/RenderTarget");var _RenderTarget2=_interopRequireDefault(_RenderTarget);var _utils=require("../../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var TextureManager=function(){function TextureManager(renderer){_classCallCheck(this,TextureManager);this.renderer=renderer;this.gl=renderer.gl;this._managedTextures=[]}TextureManager.prototype.bindTexture=function bindTexture(){};TextureManager.prototype.getTexture=function getTexture(){};TextureManager.prototype.updateTexture=function updateTexture(texture,location){var gl=this.gl;var isRenderTexture=!!texture._glRenderTargets;if(!texture.hasLoaded){return null}var boundTextures=this.renderer.boundTextures;if(location===undefined){location=0;for(var i=0;i<boundTextures.length;++i){if(boundTextures[i]===texture){location=i;break}}}boundTextures[location]=texture;gl.activeTexture(gl.TEXTURE0+location);var glTexture=texture._glTextures[this.renderer.CONTEXT_UID];if(!glTexture){if(isRenderTexture){var renderTarget=new _RenderTarget2.default(this.gl,texture.width,texture.height,texture.scaleMode,texture.resolution);renderTarget.resize(texture.width,texture.height);texture._glRenderTargets[this.renderer.CONTEXT_UID]=renderTarget;glTexture=renderTarget.texture;if(!this.renderer._activeRenderTarget.root){this.renderer._activeRenderTarget.frameBuffer.bind()}}else{glTexture=new _pixiGlCore.GLTexture(this.gl,null,null,null,null);glTexture.bind(location);glTexture.premultiplyAlpha=true;glTexture.upload(texture.source)}texture._glTextures[this.renderer.CONTEXT_UID]=glTexture;texture.on("update",this.updateTexture,this);texture.on("dispose",this.destroyTexture,this);this._managedTextures.push(texture);if(texture.isPowerOfTwo){if(texture.mipmap){glTexture.enableMipmap()}if(texture.wrapMode===_const.WRAP_MODES.CLAMP){glTexture.enableWrapClamp()}else if(texture.wrapMode===_const.WRAP_MODES.REPEAT){glTexture.enableWrapRepeat()}else{glTexture.enableWrapMirrorRepeat()}}else{glTexture.enableWrapClamp()}if(texture.scaleMode===_const.SCALE_MODES.NEAREST){glTexture.enableNearestScaling()}else{glTexture.enableLinearScaling()}}else if(isRenderTexture){texture._glRenderTargets[this.renderer.CONTEXT_UID].resize(texture.width,texture.height)}else{glTexture.upload(texture.source)}return glTexture};TextureManager.prototype.destroyTexture=function destroyTexture(texture,skipRemove){texture=texture.baseTexture||texture;if(!texture.hasLoaded){return}var renderer=this.renderer;var uid=renderer.CONTEXT_UID;var glTextures=texture._glTextures;var glRenderTargets=texture._glRenderTargets;if(glTextures[uid]){renderer.unbindTexture(texture);glTextures[uid].destroy();texture.off("update",this.updateTexture,this);texture.off("dispose",this.destroyTexture,this);delete glTextures[uid];if(!skipRemove){var i=this._managedTextures.indexOf(texture);if(i!==-1){(0,_utils.removeItems)(this._managedTextures,i,1)}}}if(glRenderTargets&&glRenderTargets[uid]){if(renderer._activeRenderTarget===glRenderTargets[uid]){renderer.bindRenderTarget(renderer.rootRenderTarget)}glRenderTargets[uid].destroy();delete glRenderTargets[uid]}};TextureManager.prototype.removeAll=function removeAll(){for(var i=0;i<this._managedTextures.length;++i){var texture=this._managedTextures[i];if(texture._glTextures[this.renderer.CONTEXT_UID]){delete texture._glTextures[this.renderer.CONTEXT_UID]}}};TextureManager.prototype.destroy=function destroy(){for(var i=0;i<this._managedTextures.length;++i){var texture=this._managedTextures[i];this.destroyTexture(texture,true);texture.off("update",this.updateTexture,this);texture.off("dispose",this.destroyTexture,this)}this._managedTextures=null};return TextureManager}();exports.default=TextureManager},{"../../const":91,"../../utils":170,"./utils/RenderTarget":141,"pixi-gl-core":60}],129:[function(require,module,exports){"use strict";exports.__esModule=true;var _SystemRenderer2=require("../SystemRenderer");var _SystemRenderer3=_interopRequireDefault(_SystemRenderer2);var _MaskManager=require("./managers/MaskManager");var _MaskManager2=_interopRequireDefault(_MaskManager);var _StencilManager=require("./managers/StencilManager");var _StencilManager2=_interopRequireDefault(_StencilManager);var _FilterManager=require("./managers/FilterManager");var _FilterManager2=_interopRequireDefault(_FilterManager);var _RenderTarget=require("./utils/RenderTarget");var _RenderTarget2=_interopRequireDefault(_RenderTarget);var _ObjectRenderer=require("./utils/ObjectRenderer");var _ObjectRenderer2=_interopRequireDefault(_ObjectRenderer);var _TextureManager=require("./TextureManager");var _TextureManager2=_interopRequireDefault(_TextureManager);var _BaseTexture=require("../../textures/BaseTexture");var _BaseTexture2=_interopRequireDefault(_BaseTexture);var _TextureGarbageCollector=require("./TextureGarbageCollector");var _TextureGarbageCollector2=_interopRequireDefault(_TextureGarbageCollector);var _WebGLState=require("./WebGLState");var _WebGLState2=_interopRequireDefault(_WebGLState);var _mapWebGLDrawModesToPixi=require("./utils/mapWebGLDrawModesToPixi");var _mapWebGLDrawModesToPixi2=_interopRequireDefault(_mapWebGLDrawModesToPixi);var _validateContext=require("./utils/validateContext");var _validateContext2=_interopRequireDefault(_validateContext);var _utils=require("../../utils");var _pixiGlCore=require("pixi-gl-core");var _pixiGlCore2=_interopRequireDefault(_pixiGlCore);var _const=require("../../const");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CONTEXT_UID=0;var WebGLRenderer=function(_SystemRenderer){_inherits(WebGLRenderer,_SystemRenderer);function WebGLRenderer(options,arg2,arg3){_classCallCheck(this,WebGLRenderer);var _this=_possibleConstructorReturn(this,_SystemRenderer.call(this,"WebGL",options,arg2,arg3));_this.legacy=_this.options.legacy;if(_this.legacy){_pixiGlCore2.default.VertexArrayObject.FORCE_NATIVE=true}_this.type=_const.RENDERER_TYPE.WEBGL;_this.handleContextLost=_this.handleContextLost.bind(_this);_this.handleContextRestored=_this.handleContextRestored.bind(_this);_this.view.addEventListener("webglcontextlost",_this.handleContextLost,false);_this.view.addEventListener("webglcontextrestored",_this.handleContextRestored,false);_this._contextOptions={alpha:_this.transparent,antialias:_this.options.antialias,premultipliedAlpha:_this.transparent&&_this.transparent!=="notMultiplied",stencil:true,preserveDrawingBuffer:_this.options.preserveDrawingBuffer,powerPreference:_this.options.powerPreference};_this._backgroundColorRgba[3]=_this.transparent?0:1;_this.maskManager=new _MaskManager2.default(_this);_this.stencilManager=new _StencilManager2.default(_this);_this.emptyRenderer=new _ObjectRenderer2.default(_this);_this.currentRenderer=_this.emptyRenderer;_this.textureManager=null;_this.filterManager=null;_this.initPlugins();if(_this.options.context){(0,_validateContext2.default)(_this.options.context)}_this.gl=_this.options.context||_pixiGlCore2.default.createContext(_this.view,_this._contextOptions);_this.CONTEXT_UID=CONTEXT_UID++;_this.state=new _WebGLState2.default(_this.gl);_this.renderingToScreen=true;_this.boundTextures=null;_this._activeShader=null;_this._activeVao=null;_this._activeRenderTarget=null;_this._initContext();_this.drawModes=(0,_mapWebGLDrawModesToPixi2.default)(_this.gl);_this._nextTextureLocation=0;_this.setBlendMode(0);return _this}WebGLRenderer.prototype._initContext=function _initContext(){var gl=this.gl;if(gl.isContextLost()&&gl.getExtension("WEBGL_lose_context")){gl.getExtension("WEBGL_lose_context").restoreContext()}var maxTextures=gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);this._activeShader=null;this._activeVao=null;this.boundTextures=new Array(maxTextures);this.emptyTextures=new Array(maxTextures);this._unknownBoundTextures=false;this.textureManager=new _TextureManager2.default(this);this.filterManager=new _FilterManager2.default(this);this.textureGC=new _TextureGarbageCollector2.default(this);this.state.resetToDefault();this.rootRenderTarget=new _RenderTarget2.default(gl,this.width,this.height,null,this.resolution,true);this.rootRenderTarget.clearColor=this._backgroundColorRgba;this.bindRenderTarget(this.rootRenderTarget);var emptyGLTexture=new _pixiGlCore2.default.GLTexture.fromData(gl,null,1,1);var tempObj={_glTextures:{}};tempObj._glTextures[this.CONTEXT_UID]={};for(var i=0;i<maxTextures;i++){var empty=new _BaseTexture2.default;empty._glTextures[this.CONTEXT_UID]=emptyGLTexture;this.boundTextures[i]=tempObj;this.emptyTextures[i]=empty;this.bindTexture(null,i)}this.emit("context",gl);this.resize(this.screen.width,this.screen.height)};WebGLRenderer.prototype.render=function render(displayObject,renderTexture,clear,transform,skipUpdateTransform){this.renderingToScreen=!renderTexture;this.emit("prerender");if(!this.gl||this.gl.isContextLost()){return}this._nextTextureLocation=0;if(!renderTexture){this._lastObjectRendered=displayObject}if(!skipUpdateTransform){var cacheParent=displayObject.parent;displayObject.parent=this._tempDisplayObjectParent;displayObject.updateTransform();displayObject.parent=cacheParent}this.bindRenderTexture(renderTexture,transform);this.currentRenderer.start();if(clear!==undefined?clear:this.clearBeforeRender){this._activeRenderTarget.clear()}displayObject.renderWebGL(this);this.currentRenderer.flush();this.textureGC.update();this.emit("postrender")};WebGLRenderer.prototype.setObjectRenderer=function setObjectRenderer(objectRenderer){if(this.currentRenderer===objectRenderer){return}this.currentRenderer.stop();this.currentRenderer=objectRenderer;this.currentRenderer.start()};WebGLRenderer.prototype.flush=function flush(){this.setObjectRenderer(this.emptyRenderer)};WebGLRenderer.prototype.resize=function resize(screenWidth,screenHeight){_SystemRenderer3.default.prototype.resize.call(this,screenWidth,screenHeight);this.rootRenderTarget.resize(screenWidth,screenHeight);if(this._activeRenderTarget===this.rootRenderTarget){this.rootRenderTarget.activate();if(this._activeShader){this._activeShader.uniforms.projectionMatrix=this.rootRenderTarget.projectionMatrix.toArray(true)}}};WebGLRenderer.prototype.setBlendMode=function setBlendMode(blendMode){this.state.setBlendMode(blendMode)};WebGLRenderer.prototype.clear=function clear(clearColor){this._activeRenderTarget.clear(clearColor)};WebGLRenderer.prototype.setTransform=function setTransform(matrix){this._activeRenderTarget.transform=matrix};WebGLRenderer.prototype.clearRenderTexture=function clearRenderTexture(renderTexture,clearColor){var baseTexture=renderTexture.baseTexture;var renderTarget=baseTexture._glRenderTargets[this.CONTEXT_UID];if(renderTarget){renderTarget.clear(clearColor)}return this};WebGLRenderer.prototype.bindRenderTexture=function bindRenderTexture(renderTexture,transform){var renderTarget=void 0;if(renderTexture){var baseTexture=renderTexture.baseTexture;if(!baseTexture._glRenderTargets[this.CONTEXT_UID]){this.textureManager.updateTexture(baseTexture,0)}this.unbindTexture(baseTexture);renderTarget=baseTexture._glRenderTargets[this.CONTEXT_UID];renderTarget.setFrame(renderTexture.frame)}else{renderTarget=this.rootRenderTarget}renderTarget.transform=transform;this.bindRenderTarget(renderTarget);return this};WebGLRenderer.prototype.bindRenderTarget=function bindRenderTarget(renderTarget){if(renderTarget!==this._activeRenderTarget){this._activeRenderTarget=renderTarget;renderTarget.activate();if(this._activeShader){this._activeShader.uniforms.projectionMatrix=renderTarget.projectionMatrix.toArray(true)}this.stencilManager.setMaskStack(renderTarget.stencilMaskStack)}return this};WebGLRenderer.prototype.bindShader=function bindShader(shader,autoProject){if(this._activeShader!==shader){this._activeShader=shader;shader.bind();if(autoProject!==false){shader.uniforms.projectionMatrix=this._activeRenderTarget.projectionMatrix.toArray(true)}}return this};WebGLRenderer.prototype.bindTexture=function bindTexture(texture,location,forceLocation){texture=texture||this.emptyTextures[location];texture=texture.baseTexture||texture;texture.touched=this.textureGC.count;if(!forceLocation){for(var i=0;i<this.boundTextures.length;i++){if(this.boundTextures[i]===texture){return i}}if(location===undefined){this._nextTextureLocation++;this._nextTextureLocation%=this.boundTextures.length;location=this.boundTextures.length-this._nextTextureLocation-1}}else{location=location||0}var gl=this.gl;var glTexture=texture._glTextures[this.CONTEXT_UID];if(!glTexture){this.textureManager.updateTexture(texture,location)}else{this.boundTextures[location]=texture;gl.activeTexture(gl.TEXTURE0+location);gl.bindTexture(gl.TEXTURE_2D,glTexture.texture)}return location};WebGLRenderer.prototype.unbindTexture=function unbindTexture(texture){var gl=this.gl;texture=texture.baseTexture||texture;if(this._unknownBoundTextures){this._unknownBoundTextures=false;for(var i=0;i<this.boundTextures.length;i++){if(this.boundTextures[i]===this.emptyTextures[i]){gl.activeTexture(gl.TEXTURE0+i);gl.bindTexture(gl.TEXTURE_2D,this.emptyTextures[i]._glTextures[this.CONTEXT_UID].texture)}}}for(var _i=0;_i<this.boundTextures.length;_i++){if(this.boundTextures[_i]===texture){this.boundTextures[_i]=this.emptyTextures[_i];gl.activeTexture(gl.TEXTURE0+_i);gl.bindTexture(gl.TEXTURE_2D,this.emptyTextures[_i]._glTextures[this.CONTEXT_UID].texture)}}return this};WebGLRenderer.prototype.createVao=function createVao(){return new _pixiGlCore2.default.VertexArrayObject(this.gl,this.state.attribState)};WebGLRenderer.prototype.bindVao=function bindVao(vao){if(this._activeVao===vao){return this}if(vao){vao.bind()}else if(this._activeVao){this._activeVao.unbind()}this._activeVao=vao;return this};WebGLRenderer.prototype.reset=function reset(){this.setObjectRenderer(this.emptyRenderer);this.bindVao(null);this._activeShader=null;this._activeRenderTarget=this.rootRenderTarget;this._unknownBoundTextures=true;for(var i=0;i<this.boundTextures.length;i++){this.boundTextures[i]=this.emptyTextures[i]}this.rootRenderTarget.activate();this.state.resetToDefault();return this};WebGLRenderer.prototype.handleContextLost=function handleContextLost(event){event.preventDefault()};WebGLRenderer.prototype.handleContextRestored=function handleContextRestored(){this.textureManager.removeAll();this.filterManager.destroy(true);this._initContext()};WebGLRenderer.prototype.destroy=function destroy(removeView){this.destroyPlugins();this.view.removeEventListener("webglcontextlost",this.handleContextLost);this.view.removeEventListener("webglcontextrestored",this.handleContextRestored);this.textureManager.destroy();_SystemRenderer.prototype.destroy.call(this,removeView);this.uid=0;this.maskManager.destroy();this.stencilManager.destroy();this.filterManager.destroy();this.maskManager=null;this.filterManager=null;this.textureManager=null;this.currentRenderer=null;this.handleContextLost=null;this.handleContextRestored=null;this._contextOptions=null;this.gl.useProgram(null);if(this.gl.getExtension("WEBGL_lose_context")){this.gl.getExtension("WEBGL_lose_context").loseContext()}this.gl=null};return WebGLRenderer}(_SystemRenderer3.default);exports.default=WebGLRenderer;_utils.pluginTarget.mixin(WebGLRenderer)},{"../../const":91,"../../textures/BaseTexture":157,"../../utils":170,"../SystemRenderer":121,"./TextureGarbageCollector":127,"./TextureManager":128,"./WebGLState":130,"./managers/FilterManager":135,"./managers/MaskManager":136,"./managers/StencilManager":137,"./utils/ObjectRenderer":139,"./utils/RenderTarget":141,"./utils/mapWebGLDrawModesToPixi":144,"./utils/validateContext":145,"pixi-gl-core":60}],130:[function(require,module,exports){"use strict";exports.__esModule=true;var _mapWebGLBlendModesToPixi=require("./utils/mapWebGLBlendModesToPixi");var _mapWebGLBlendModesToPixi2=_interopRequireDefault(_mapWebGLBlendModesToPixi);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var BLEND=0;var DEPTH_TEST=1;var FRONT_FACE=2;var CULL_FACE=3;var BLEND_FUNC=4;var WebGLState=function(){function WebGLState(gl){_classCallCheck(this,WebGLState);this.activeState=new Uint8Array(16);this.defaultState=new Uint8Array(16);this.defaultState[0]=1;this.stackIndex=0;this.stack=[];this.gl=gl;this.maxAttribs=gl.getParameter(gl.MAX_VERTEX_ATTRIBS);this.attribState={tempAttribState:new Array(this.maxAttribs),attribState:new Array(this.maxAttribs)};this.blendModes=(0,_mapWebGLBlendModesToPixi2.default)(gl);this.nativeVaoExtension=gl.getExtension("OES_vertex_array_object")||gl.getExtension("MOZ_OES_vertex_array_object")||gl.getExtension("WEBKIT_OES_vertex_array_object")}WebGLState.prototype.push=function push(){var state=this.stack[this.stackIndex];if(!state){state=this.stack[this.stackIndex]=new Uint8Array(16)}++this.stackIndex;for(var i=0;i<this.activeState.length;i++){state[i]=this.activeState[i]}};WebGLState.prototype.pop=function pop(){var state=this.stack[--this.stackIndex];this.setState(state)};WebGLState.prototype.setState=function setState(state){this.setBlend(state[BLEND]);this.setDepthTest(state[DEPTH_TEST]);this.setFrontFace(state[FRONT_FACE]);this.setCullFace(state[CULL_FACE]);this.setBlendMode(state[BLEND_FUNC])};WebGLState.prototype.setBlend=function setBlend(value){value=value?1:0;if(this.activeState[BLEND]===value){return}this.activeState[BLEND]=value;this.gl[value?"enable":"disable"](this.gl.BLEND)};WebGLState.prototype.setBlendMode=function setBlendMode(value){if(value===this.activeState[BLEND_FUNC]){return}this.activeState[BLEND_FUNC]=value;var mode=this.blendModes[value];if(mode.length===2){this.gl.blendFunc(mode[0],mode[1])}else{this.gl.blendFuncSeparate(mode[0],mode[1],mode[2],mode[3])}};WebGLState.prototype.setDepthTest=function setDepthTest(value){value=value?1:0;if(this.activeState[DEPTH_TEST]===value){return}this.activeState[DEPTH_TEST]=value;this.gl[value?"enable":"disable"](this.gl.DEPTH_TEST)};WebGLState.prototype.setCullFace=function setCullFace(value){value=value?1:0;if(this.activeState[CULL_FACE]===value){return}this.activeState[CULL_FACE]=value;this.gl[value?"enable":"disable"](this.gl.CULL_FACE)};WebGLState.prototype.setFrontFace=function setFrontFace(value){value=value?1:0;if(this.activeState[FRONT_FACE]===value){return}this.activeState[FRONT_FACE]=value;this.gl.frontFace(this.gl[value?"CW":"CCW"])};WebGLState.prototype.resetAttributes=function resetAttributes(){for(var i=0;i<this.attribState.tempAttribState.length;i++){this.attribState.tempAttribState[i]=0}for(var _i=0;_i<this.attribState.attribState.length;_i++){this.attribState.attribState[_i]=0}for(var _i2=1;_i2<this.maxAttribs;_i2++){this.gl.disableVertexAttribArray(_i2)}};WebGLState.prototype.resetToDefault=function resetToDefault(){if(this.nativeVaoExtension){this.nativeVaoExtension.bindVertexArrayOES(null)}this.resetAttributes();for(var i=0;i<this.activeState.length;++i){this.activeState[i]=32}this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,false);this.setState(this.defaultState)};return WebGLState}();exports.default=WebGLState},{"./utils/mapWebGLBlendModesToPixi":143}],131:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _extractUniformsFromSrc=require("./extractUniformsFromSrc");var _extractUniformsFromSrc2=_interopRequireDefault(_extractUniformsFromSrc);var _utils=require("../../../utils");var _const=require("../../../const");var _settings=require("../../../settings");var _settings2=_interopRequireDefault(_settings);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var SOURCE_KEY_MAP={};var Filter=function(){function Filter(vertexSrc,fragmentSrc,uniformData){_classCallCheck(this,Filter);this.vertexSrc=vertexSrc||Filter.defaultVertexSrc;this.fragmentSrc=fragmentSrc||Filter.defaultFragmentSrc;this._blendMode=_const.BLEND_MODES.NORMAL;this.uniformData=uniformData||(0,_extractUniformsFromSrc2.default)(this.vertexSrc,this.fragmentSrc,"projectionMatrix|uSampler");this.uniforms={};for(var i in this.uniformData){this.uniforms[i]=this.uniformData[i].value;if(this.uniformData[i].type){this.uniformData[i].type=this.uniformData[i].type.toLowerCase()}}this.glShaders={};if(!SOURCE_KEY_MAP[this.vertexSrc+this.fragmentSrc]){SOURCE_KEY_MAP[this.vertexSrc+this.fragmentSrc]=(0,_utils.uid)()}this.glShaderKey=SOURCE_KEY_MAP[this.vertexSrc+this.fragmentSrc];this.padding=4;this.resolution=_settings2.default.FILTER_RESOLUTION;this.enabled=true;this.autoFit=true}Filter.prototype.apply=function apply(filterManager,input,output,clear,currentState){filterManager.applyFilter(this,input,output,clear)};_createClass(Filter,[{key:"blendMode",get:function get(){return this._blendMode},set:function set(value){this._blendMode=value}}],[{key:"defaultVertexSrc",get:function get(){return["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 projectionMatrix;","uniform mat3 filterMatrix;","varying vec2 vTextureCoord;","varying vec2 vFilterCoord;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;","   vTextureCoord = aTextureCoord ;","}"].join("\n")}},{key:"defaultFragmentSrc",get:function get(){return["varying vec2 vTextureCoord;","varying vec2 vFilterCoord;","uniform sampler2D uSampler;","uniform sampler2D filterSampler;","void main(void){","   vec4 masky = texture2D(filterSampler, vFilterCoord);","   vec4 sample = texture2D(uSampler, vTextureCoord);","   vec4 color;","   if(mod(vFilterCoord.x, 1.0) > 0.5)","   {","     color = vec4(1.0, 0.0, 0.0, 1.0);","   }","   else","   {","     color = vec4(0.0, 1.0, 0.0, 1.0);","   }","   gl_FragColor = mix(sample, masky, 0.5);","   gl_FragColor *= sample.a;","}"].join("\n")}}]);return Filter}();exports.default=Filter},{"../../../const":91,"../../../settings":146,"../../../utils":170,"./extractUniformsFromSrc":132}],132:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=extractUniformsFromSrc;var _pixiGlCore=require("pixi-gl-core");var _pixiGlCore2=_interopRequireDefault(_pixiGlCore);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var defaultValue=_pixiGlCore2.default.shader.defaultValue;function extractUniformsFromSrc(vertexSrc,fragmentSrc,mask){var vertUniforms=extractUniformsFromString(vertexSrc,mask);var fragUniforms=extractUniformsFromString(fragmentSrc,mask);return Object.assign(vertUniforms,fragUniforms)}function extractUniformsFromString(string){var maskRegex=new RegExp("^(projectionMatrix|uSampler|filterArea|filterClamp)$");var uniforms={};var nameSplit=void 0;var lines=string.replace(/\s+/g," ").split(/\s*;\s*/);for(var i=0;i<lines.length;i++){var line=lines[i].trim();if(line.indexOf("uniform")>-1){var splitLine=line.split(" ");var type=splitLine[1];var name=splitLine[2];var size=1;if(name.indexOf("[")>-1){nameSplit=name.split(/\[|]/);name=nameSplit[0];size*=Number(nameSplit[1])}if(!name.match(maskRegex)){uniforms[name]={value:defaultValue(type,size),name:name,type:type}}}}return uniforms}},{"pixi-gl-core":60}],133:[function(require,module,exports){"use strict";exports.__esModule=true;exports.calculateScreenSpaceMatrix=calculateScreenSpaceMatrix;exports.calculateNormalizedScreenSpaceMatrix=calculateNormalizedScreenSpaceMatrix;exports.calculateSpriteMatrix=calculateSpriteMatrix;var _math=require("../../../math");function calculateScreenSpaceMatrix(outputMatrix,filterArea,textureSize){var mappedMatrix=outputMatrix.identity();mappedMatrix.translate(filterArea.x/textureSize.width,filterArea.y/textureSize.height);mappedMatrix.scale(textureSize.width,textureSize.height);return mappedMatrix}function calculateNormalizedScreenSpaceMatrix(outputMatrix,filterArea,textureSize){var mappedMatrix=outputMatrix.identity();mappedMatrix.translate(filterArea.x/textureSize.width,filterArea.y/textureSize.height);var translateScaleX=textureSize.width/filterArea.width;var translateScaleY=textureSize.height/filterArea.height;mappedMatrix.scale(translateScaleX,translateScaleY);return mappedMatrix}function calculateSpriteMatrix(outputMatrix,filterArea,textureSize,sprite){var orig=sprite._texture.orig;var mappedMatrix=outputMatrix.set(textureSize.width,0,0,textureSize.height,filterArea.x,filterArea.y);var worldTransform=sprite.worldTransform.copy(_math.Matrix.TEMP_MATRIX);worldTransform.invert();mappedMatrix.prepend(worldTransform);mappedMatrix.scale(1/orig.width,1/orig.height);mappedMatrix.translate(sprite.anchor.x,sprite.anchor.y);return mappedMatrix}},{"../../../math":115}],134:[function(require,module,exports){"use strict";exports.__esModule=true;var _Filter2=require("../Filter");var _Filter3=_interopRequireDefault(_Filter2);var _math=require("../../../../math");var _path=require("path");var _TextureMatrix=require("../../../../textures/TextureMatrix");var _TextureMatrix2=_interopRequireDefault(_TextureMatrix);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var SpriteMaskFilter=function(_Filter){_inherits(SpriteMaskFilter,_Filter);function SpriteMaskFilter(sprite){_classCallCheck(this,SpriteMaskFilter);var maskMatrix=new _math.Matrix;var _this=_possibleConstructorReturn(this,_Filter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n\n    original *= (masky.r * masky.a * alpha * clip);\n\n    gl_FragColor = original;\n}\n"));sprite.renderable=false;_this.maskSprite=sprite;_this.maskMatrix=maskMatrix;return _this}SpriteMaskFilter.prototype.apply=function apply(filterManager,input,output,clear){var maskSprite=this.maskSprite;var tex=this.maskSprite.texture;if(!tex.valid){return}if(!tex.transform){tex.transform=new _TextureMatrix2.default(tex,0)}tex.transform.update();this.uniforms.mask=tex;this.uniforms.otherMatrix=filterManager.calculateSpriteMatrix(this.maskMatrix,maskSprite).prepend(tex.transform.mapCoord);this.uniforms.alpha=maskSprite.worldAlpha;this.uniforms.maskClamp=tex.transform.uClampFrame;filterManager.applyFilter(this,input,output,clear)};return SpriteMaskFilter}(_Filter3.default);exports.default=SpriteMaskFilter},{"../../../../math":115,"../../../../textures/TextureMatrix":161,"../Filter":131,path:49}],135:[function(require,module,exports){"use strict";exports.__esModule=true;var _WebGLManager2=require("./WebGLManager");var _WebGLManager3=_interopRequireDefault(_WebGLManager2);var _RenderTarget=require("../utils/RenderTarget");var _RenderTarget2=_interopRequireDefault(_RenderTarget);var _Quad=require("../utils/Quad");var _Quad2=_interopRequireDefault(_Quad);var _math=require("../../../math");var _Shader=require("../../../Shader");var _Shader2=_interopRequireDefault(_Shader);var _filterTransforms=require("../filters/filterTransforms");var filterTransforms=_interopRequireWildcard(_filterTransforms);var _bitTwiddle=require("bit-twiddle");var _bitTwiddle2=_interopRequireDefault(_bitTwiddle);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var FilterState=function(){function FilterState(){_classCallCheck(this,FilterState);this.renderTarget=null;this.target=null;this.resolution=1;this.sourceFrame=new _math.Rectangle;this.destinationFrame=new _math.Rectangle;this.filters=[]}FilterState.prototype.clear=function clear(){this.filters=null;this.target=null;this.renderTarget=null};return FilterState}();var screenKey="screen";var FilterManager=function(_WebGLManager){_inherits(FilterManager,_WebGLManager);function FilterManager(renderer){_classCallCheck(this,FilterManager);var _this=_possibleConstructorReturn(this,_WebGLManager.call(this,renderer));_this.gl=_this.renderer.gl;_this.quad=new _Quad2.default(_this.gl,renderer.state.attribState);_this.shaderCache={};_this.pool={};_this.filterData=null;_this.managedFilters=[];_this.renderer.on("prerender",_this.onPrerender,_this);_this._screenWidth=renderer.view.width;_this._screenHeight=renderer.view.height;return _this}FilterManager.prototype.pushFilter=function pushFilter(target,filters){var renderer=this.renderer;var filterData=this.filterData;if(!filterData){filterData=this.renderer._activeRenderTarget.filterStack;var filterState=new FilterState;filterState.sourceFrame=filterState.destinationFrame=this.renderer._activeRenderTarget.size;filterState.renderTarget=renderer._activeRenderTarget;this.renderer._activeRenderTarget.filterData=filterData={index:0,stack:[filterState]};this.filterData=filterData}var currentState=filterData.stack[++filterData.index];var renderTargetFrame=filterData.stack[0].destinationFrame;if(!currentState){currentState=filterData.stack[filterData.index]=new FilterState}var fullScreen=target.filterArea&&target.filterArea.x===0&&target.filterArea.y===0&&target.filterArea.width===renderer.screen.width&&target.filterArea.height===renderer.screen.height;var resolution=filters[0].resolution;var padding=filters[0].padding|0;var targetBounds=fullScreen?renderer.screen:target.filterArea||target.getBounds(true);var sourceFrame=currentState.sourceFrame;var destinationFrame=currentState.destinationFrame;sourceFrame.x=(targetBounds.x*resolution|0)/resolution;sourceFrame.y=(targetBounds.y*resolution|0)/resolution;sourceFrame.width=(targetBounds.width*resolution|0)/resolution;sourceFrame.height=(targetBounds.height*resolution|0)/resolution;if(!fullScreen){if(filterData.stack[0].renderTarget.transform){}else if(filters[0].autoFit){sourceFrame.fit(renderTargetFrame)}sourceFrame.pad(padding)}destinationFrame.width=sourceFrame.width;destinationFrame.height=sourceFrame.height;var renderTarget=this.getPotRenderTarget(renderer.gl,sourceFrame.width,sourceFrame.height,resolution);currentState.target=target;currentState.filters=filters;currentState.resolution=resolution;currentState.renderTarget=renderTarget;renderTarget.setFrame(destinationFrame,sourceFrame);renderer.bindRenderTarget(renderTarget);renderTarget.clear()};FilterManager.prototype.popFilter=function popFilter(){var filterData=this.filterData;var lastState=filterData.stack[filterData.index-1];var currentState=filterData.stack[filterData.index];this.quad.map(currentState.renderTarget.size,currentState.sourceFrame).upload();var filters=currentState.filters;if(filters.length===1){filters[0].apply(this,currentState.renderTarget,lastState.renderTarget,false,currentState);this.freePotRenderTarget(currentState.renderTarget)}else{var flip=currentState.renderTarget;var flop=this.getPotRenderTarget(this.renderer.gl,currentState.sourceFrame.width,currentState.sourceFrame.height,currentState.resolution);flop.setFrame(currentState.destinationFrame,currentState.sourceFrame);flop.clear();var i=0;for(i=0;i<filters.length-1;++i){filters[i].apply(this,flip,flop,true,currentState);var t=flip;flip=flop;flop=t}filters[i].apply(this,flip,lastState.renderTarget,false,currentState);this.freePotRenderTarget(flip);this.freePotRenderTarget(flop)}currentState.clear();filterData.index--;if(filterData.index===0){this.filterData=null}};FilterManager.prototype.applyFilter=function applyFilter(filter,input,output,clear){var renderer=this.renderer;var gl=renderer.gl;var shader=filter.glShaders[renderer.CONTEXT_UID];if(!shader){if(filter.glShaderKey){shader=this.shaderCache[filter.glShaderKey];if(!shader){shader=new _Shader2.default(this.gl,filter.vertexSrc,filter.fragmentSrc);filter.glShaders[renderer.CONTEXT_UID]=this.shaderCache[filter.glShaderKey]=shader;this.managedFilters.push(filter)}}else{shader=filter.glShaders[renderer.CONTEXT_UID]=new _Shader2.default(this.gl,filter.vertexSrc,filter.fragmentSrc);this.managedFilters.push(filter)}renderer.bindVao(null);this.quad.initVao(shader)}renderer.bindVao(this.quad.vao);renderer.bindRenderTarget(output);if(clear){gl.disable(gl.SCISSOR_TEST);renderer.clear();gl.enable(gl.SCISSOR_TEST)}if(output===renderer.maskManager.scissorRenderTarget){renderer.maskManager.pushScissorMask(null,renderer.maskManager.scissorData)}renderer.bindShader(shader);var tex=this.renderer.emptyTextures[0];this.renderer.boundTextures[0]=tex;this.syncUniforms(shader,filter);renderer.state.setBlendMode(filter.blendMode);gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,input.texture.texture);this.quad.vao.draw(this.renderer.gl.TRIANGLES,6,0);gl.bindTexture(gl.TEXTURE_2D,tex._glTextures[this.renderer.CONTEXT_UID].texture)};FilterManager.prototype.syncUniforms=function syncUniforms(shader,filter){var uniformData=filter.uniformData;var uniforms=filter.uniforms;var textureCount=1;var currentState=void 0;if(shader.uniforms.filterArea){currentState=this.filterData.stack[this.filterData.index];var filterArea=shader.uniforms.filterArea;filterArea[0]=currentState.renderTarget.size.width;filterArea[1]=currentState.renderTarget.size.height;filterArea[2]=currentState.sourceFrame.x;filterArea[3]=currentState.sourceFrame.y;shader.uniforms.filterArea=filterArea}if(shader.uniforms.filterClamp){currentState=currentState||this.filterData.stack[this.filterData.index];var filterClamp=shader.uniforms.filterClamp;filterClamp[0]=0;filterClamp[1]=0;filterClamp[2]=(currentState.sourceFrame.width-1)/currentState.renderTarget.size.width;filterClamp[3]=(currentState.sourceFrame.height-1)/currentState.renderTarget.size.height;shader.uniforms.filterClamp=filterClamp}for(var i in uniformData){if(!shader.uniforms.data[i]){continue}var type=uniformData[i].type;if(type==="sampler2d"&&uniforms[i]!==0){if(uniforms[i].baseTexture){shader.uniforms[i]=this.renderer.bindTexture(uniforms[i].baseTexture,textureCount)}else{shader.uniforms[i]=textureCount;var gl=this.renderer.gl;this.renderer.boundTextures[textureCount]=this.renderer.emptyTextures[textureCount];gl.activeTexture(gl.TEXTURE0+textureCount);uniforms[i].texture.bind()}textureCount++}else if(type==="mat3"){if(uniforms[i].a!==undefined){shader.uniforms[i]=uniforms[i].toArray(true)}else{shader.uniforms[i]=uniforms[i]}}else if(type==="vec2"){if(uniforms[i].x!==undefined){var val=shader.uniforms[i]||new Float32Array(2);val[0]=uniforms[i].x;val[1]=uniforms[i].y;shader.uniforms[i]=val}else{shader.uniforms[i]=uniforms[i]}}else if(type==="float"){if(shader.uniforms.data[i].value!==uniformData[i]){shader.uniforms[i]=uniforms[i]}}else{shader.uniforms[i]=uniforms[i]}}};FilterManager.prototype.getRenderTarget=function getRenderTarget(clear,resolution){var currentState=this.filterData.stack[this.filterData.index];var renderTarget=this.getPotRenderTarget(this.renderer.gl,currentState.sourceFrame.width,currentState.sourceFrame.height,resolution||currentState.resolution);renderTarget.setFrame(currentState.destinationFrame,currentState.sourceFrame);return renderTarget};FilterManager.prototype.returnRenderTarget=function returnRenderTarget(renderTarget){this.freePotRenderTarget(renderTarget)};FilterManager.prototype.calculateScreenSpaceMatrix=function calculateScreenSpaceMatrix(outputMatrix){var currentState=this.filterData.stack[this.filterData.index];return filterTransforms.calculateScreenSpaceMatrix(outputMatrix,currentState.sourceFrame,currentState.renderTarget.size)};FilterManager.prototype.calculateNormalizedScreenSpaceMatrix=function calculateNormalizedScreenSpaceMatrix(outputMatrix){var currentState=this.filterData.stack[this.filterData.index];return filterTransforms.calculateNormalizedScreenSpaceMatrix(outputMatrix,currentState.sourceFrame,currentState.renderTarget.size,currentState.destinationFrame)};FilterManager.prototype.calculateSpriteMatrix=function calculateSpriteMatrix(outputMatrix,sprite){var currentState=this.filterData.stack[this.filterData.index];return filterTransforms.calculateSpriteMatrix(outputMatrix,currentState.sourceFrame,currentState.renderTarget.size,sprite)};FilterManager.prototype.destroy=function destroy(){var contextLost=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var renderer=this.renderer;var filters=this.managedFilters;renderer.off("prerender",this.onPrerender,this);for(var i=0;i<filters.length;i++){if(!contextLost){filters[i].glShaders[renderer.CONTEXT_UID].destroy()}delete filters[i].glShaders[renderer.CONTEXT_UID]}this.shaderCache={};if(!contextLost){this.emptyPool()}else{this.pool={}}};FilterManager.prototype.getPotRenderTarget=function getPotRenderTarget(gl,minWidth,minHeight,resolution){var key=screenKey;minWidth*=resolution;minHeight*=resolution;if(minWidth!==this._screenWidth||minHeight!==this._screenHeight){minWidth=_bitTwiddle2.default.nextPow2(minWidth);minHeight=_bitTwiddle2.default.nextPow2(minHeight);key=(minWidth&65535)<<16|minHeight&65535}if(!this.pool[key]){this.pool[key]=[]}var renderTarget=this.pool[key].pop();if(!renderTarget){var tex=this.renderer.boundTextures[0];gl.activeTexture(gl.TEXTURE0);renderTarget=new _RenderTarget2.default(gl,minWidth,minHeight,null,1);gl.bindTexture(gl.TEXTURE_2D,tex._glTextures[this.renderer.CONTEXT_UID].texture)}renderTarget.resolution=resolution;renderTarget.defaultFrame.width=renderTarget.size.width=minWidth/resolution;renderTarget.defaultFrame.height=renderTarget.size.height=minHeight/resolution;renderTarget.filterPoolKey=key;return renderTarget};FilterManager.prototype.emptyPool=function emptyPool(){for(var i in this.pool){var textures=this.pool[i];if(textures){for(var j=0;j<textures.length;j++){textures[j].destroy(true)}}}this.pool={}};FilterManager.prototype.freePotRenderTarget=function freePotRenderTarget(renderTarget){this.pool[renderTarget.filterPoolKey].push(renderTarget)};FilterManager.prototype.onPrerender=function onPrerender(){if(this._screenWidth!==this.renderer.view.width||this._screenHeight!==this.renderer.view.height){this._screenWidth=this.renderer.view.width;this._screenHeight=this.renderer.view.height;var textures=this.pool[screenKey];if(textures){for(var j=0;j<textures.length;j++){textures[j].destroy(true)}}this.pool[screenKey]=[]}};return FilterManager}(_WebGLManager3.default);exports.default=FilterManager},{"../../../Shader":89,"../../../math":115,"../filters/filterTransforms":133,"../utils/Quad":140,"../utils/RenderTarget":141,"./WebGLManager":138,"bit-twiddle":26}],136:[function(require,module,exports){"use strict";exports.__esModule=true;var _WebGLManager2=require("./WebGLManager");var _WebGLManager3=_interopRequireDefault(_WebGLManager2);var _SpriteMaskFilter=require("../filters/spriteMask/SpriteMaskFilter");var _SpriteMaskFilter2=_interopRequireDefault(_SpriteMaskFilter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MaskManager=function(_WebGLManager){_inherits(MaskManager,_WebGLManager);function MaskManager(renderer){_classCallCheck(this,MaskManager);var _this=_possibleConstructorReturn(this,_WebGLManager.call(this,renderer));_this.scissor=false;_this.scissorData=null;_this.scissorRenderTarget=null;_this.enableScissor=true;_this.alphaMaskPool=[];_this.alphaMaskIndex=0;return _this}MaskManager.prototype.pushMask=function pushMask(target,maskData){if(maskData.texture){this.pushSpriteMask(target,maskData)}else if(this.enableScissor&&!this.scissor&&this.renderer._activeRenderTarget.root&&!this.renderer.stencilManager.stencilMaskStack.length&&maskData.isFastRect()){var matrix=maskData.worldTransform;var rot=Math.atan2(matrix.b,matrix.a);rot=Math.round(rot*(180/Math.PI));if(rot%90){this.pushStencilMask(maskData)}else{this.pushScissorMask(target,maskData)}}else{this.pushStencilMask(maskData)}};MaskManager.prototype.popMask=function popMask(target,maskData){if(maskData.texture){this.popSpriteMask(target,maskData)}else if(this.enableScissor&&!this.renderer.stencilManager.stencilMaskStack.length){this.popScissorMask(target,maskData)}else{this.popStencilMask(target,maskData)}};MaskManager.prototype.pushSpriteMask=function pushSpriteMask(target,maskData){var alphaMaskFilter=this.alphaMaskPool[this.alphaMaskIndex];if(!alphaMaskFilter){alphaMaskFilter=this.alphaMaskPool[this.alphaMaskIndex]=[new _SpriteMaskFilter2.default(maskData)]}alphaMaskFilter[0].resolution=this.renderer.resolution;alphaMaskFilter[0].maskSprite=maskData;var stashFilterArea=target.filterArea;target.filterArea=maskData.getBounds(true);this.renderer.filterManager.pushFilter(target,alphaMaskFilter);target.filterArea=stashFilterArea;this.alphaMaskIndex++};MaskManager.prototype.popSpriteMask=function popSpriteMask(){this.renderer.filterManager.popFilter();this.alphaMaskIndex--};MaskManager.prototype.pushStencilMask=function pushStencilMask(maskData){this.renderer.currentRenderer.stop();this.renderer.stencilManager.pushStencil(maskData)};MaskManager.prototype.popStencilMask=function popStencilMask(){this.renderer.currentRenderer.stop();this.renderer.stencilManager.popStencil()};MaskManager.prototype.pushScissorMask=function pushScissorMask(target,maskData){maskData.renderable=true;var renderTarget=this.renderer._activeRenderTarget;var bounds=maskData.getBounds();bounds.fit(renderTarget.size);maskData.renderable=false;this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST);var resolution=this.renderer.resolution;this.renderer.gl.scissor(bounds.x*resolution,(renderTarget.root?renderTarget.size.height-bounds.y-bounds.height:bounds.y)*resolution,bounds.width*resolution,bounds.height*resolution);this.scissorRenderTarget=renderTarget;this.scissorData=maskData;this.scissor=true};MaskManager.prototype.popScissorMask=function popScissorMask(){this.scissorRenderTarget=null;this.scissorData=null;this.scissor=false;var gl=this.renderer.gl;gl.disable(gl.SCISSOR_TEST)};return MaskManager}(_WebGLManager3.default);exports.default=MaskManager},{"../filters/spriteMask/SpriteMaskFilter":134,"./WebGLManager":138}],137:[function(require,module,exports){"use strict";exports.__esModule=true;var _WebGLManager2=require("./WebGLManager");var _WebGLManager3=_interopRequireDefault(_WebGLManager2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var StencilManager=function(_WebGLManager){_inherits(StencilManager,_WebGLManager);function StencilManager(renderer){_classCallCheck(this,StencilManager);var _this=_possibleConstructorReturn(this,_WebGLManager.call(this,renderer));_this.stencilMaskStack=null;return _this}StencilManager.prototype.setMaskStack=function setMaskStack(stencilMaskStack){this.stencilMaskStack=stencilMaskStack;var gl=this.renderer.gl;if(stencilMaskStack.length===0){gl.disable(gl.STENCIL_TEST)}else{gl.enable(gl.STENCIL_TEST)}};StencilManager.prototype.pushStencil=function pushStencil(graphics){this.renderer.setObjectRenderer(this.renderer.plugins.graphics);this.renderer._activeRenderTarget.attachStencilBuffer();var gl=this.renderer.gl;var prevMaskCount=this.stencilMaskStack.length;if(prevMaskCount===0){gl.enable(gl.STENCIL_TEST)}this.stencilMaskStack.push(graphics);gl.colorMask(false,false,false,false);gl.stencilFunc(gl.EQUAL,prevMaskCount,this._getBitwiseMask());gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR);this.renderer.plugins.graphics.render(graphics);this._useCurrent()};StencilManager.prototype.popStencil=function popStencil(){this.renderer.setObjectRenderer(this.renderer.plugins.graphics);var gl=this.renderer.gl;var graphics=this.stencilMaskStack.pop();if(this.stencilMaskStack.length===0){gl.disable(gl.STENCIL_TEST);gl.clear(gl.STENCIL_BUFFER_BIT);gl.clearStencil(0)}else{gl.colorMask(false,false,false,false);gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR);this.renderer.plugins.graphics.render(graphics);this._useCurrent()}};StencilManager.prototype._useCurrent=function _useCurrent(){var gl=this.renderer.gl;gl.colorMask(true,true,true,true);gl.stencilFunc(gl.EQUAL,this.stencilMaskStack.length,this._getBitwiseMask());gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP)};StencilManager.prototype._getBitwiseMask=function _getBitwiseMask(){return(1<<this.stencilMaskStack.length)-1};StencilManager.prototype.destroy=function destroy(){_WebGLManager3.default.prototype.destroy.call(this);this.stencilMaskStack.stencilStack=null};return StencilManager}(_WebGLManager3.default);exports.default=StencilManager},{"./WebGLManager":138}],138:[function(require,module,exports){"use strict";exports.__esModule=true;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var WebGLManager=function(){function WebGLManager(renderer){_classCallCheck(this,WebGLManager);this.renderer=renderer;this.renderer.on("context",this.onContextChange,this)}WebGLManager.prototype.onContextChange=function onContextChange(){};WebGLManager.prototype.destroy=function destroy(){this.renderer.off("context",this.onContextChange,this);this.renderer=null};return WebGLManager}();exports.default=WebGLManager},{}],139:[function(require,module,exports){"use strict";exports.__esModule=true;var _WebGLManager2=require("../managers/WebGLManager");var _WebGLManager3=_interopRequireDefault(_WebGLManager2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ObjectRenderer=function(_WebGLManager){_inherits(ObjectRenderer,_WebGLManager);function ObjectRenderer(){_classCallCheck(this,ObjectRenderer);return _possibleConstructorReturn(this,_WebGLManager.apply(this,arguments))}ObjectRenderer.prototype.start=function start(){};ObjectRenderer.prototype.stop=function stop(){this.flush()};ObjectRenderer.prototype.flush=function flush(){};ObjectRenderer.prototype.render=function render(object){};return ObjectRenderer}(_WebGLManager3.default);exports.default=ObjectRenderer},{"../managers/WebGLManager":138}],140:[function(require,module,exports){"use strict";exports.__esModule=true;var _pixiGlCore=require("pixi-gl-core");var _pixiGlCore2=_interopRequireDefault(_pixiGlCore);var _createIndicesForQuads=require("../../../utils/createIndicesForQuads");var _createIndicesForQuads2=_interopRequireDefault(_createIndicesForQuads);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Quad=function(){function Quad(gl,state){_classCallCheck(this,Quad);this.gl=gl;this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]);this.uvs=new Float32Array([0,0,1,0,1,1,0,1]);this.interleaved=new Float32Array(8*2);for(var i=0;i<4;i++){this.interleaved[i*4]=this.vertices[i*2];this.interleaved[i*4+1]=this.vertices[i*2+1];this.interleaved[i*4+2]=this.uvs[i*2];this.interleaved[i*4+3]=this.uvs[i*2+1]}this.indices=(0,_createIndicesForQuads2.default)(1);this.vertexBuffer=_pixiGlCore2.default.GLBuffer.createVertexBuffer(gl,this.interleaved,gl.STATIC_DRAW);this.indexBuffer=_pixiGlCore2.default.GLBuffer.createIndexBuffer(gl,this.indices,gl.STATIC_DRAW);this.vao=new _pixiGlCore2.default.VertexArrayObject(gl,state)}Quad.prototype.initVao=function initVao(shader){this.vao.clear().addIndex(this.indexBuffer).addAttribute(this.vertexBuffer,shader.attributes.aVertexPosition,this.gl.FLOAT,false,4*4,0).addAttribute(this.vertexBuffer,shader.attributes.aTextureCoord,this.gl.FLOAT,false,4*4,2*4)};Quad.prototype.map=function map(targetTextureFrame,destinationFrame){var x=0;var y=0;this.uvs[0]=x;this.uvs[1]=y;this.uvs[2]=x+destinationFrame.width/targetTextureFrame.width;this.uvs[3]=y;this.uvs[4]=x+destinationFrame.width/targetTextureFrame.width;this.uvs[5]=y+destinationFrame.height/targetTextureFrame.height;this.uvs[6]=x;this.uvs[7]=y+destinationFrame.height/targetTextureFrame.height;x=destinationFrame.x;y=destinationFrame.y;this.vertices[0]=x;this.vertices[1]=y;this.vertices[2]=x+destinationFrame.width;this.vertices[3]=y;this.vertices[4]=x+destinationFrame.width;this.vertices[5]=y+destinationFrame.height;this.vertices[6]=x;this.vertices[7]=y+destinationFrame.height;return this};Quad.prototype.upload=function upload(){for(var i=0;i<4;i++){this.interleaved[i*4]=this.vertices[i*2];this.interleaved[i*4+1]=this.vertices[i*2+1];this.interleaved[i*4+2]=this.uvs[i*2];this.interleaved[i*4+3]=this.uvs[i*2+1]}this.vertexBuffer.upload(this.interleaved);return this};Quad.prototype.destroy=function destroy(){var gl=this.gl;gl.deleteBuffer(this.vertexBuffer);gl.deleteBuffer(this.indexBuffer)};return Quad}();exports.default=Quad},{"../../../utils/createIndicesForQuads":168,"pixi-gl-core":60}],141:[function(require,module,exports){"use strict";exports.__esModule=true;var _math=require("../../../math");var _const=require("../../../const");var _settings=require("../../../settings");var _settings2=_interopRequireDefault(_settings);var _pixiGlCore=require("pixi-gl-core");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var RenderTarget=function(){function RenderTarget(gl,width,height,scaleMode,resolution,root){_classCallCheck(this,RenderTarget);this.gl=gl;this.frameBuffer=null;this.texture=null;this.clearColor=[0,0,0,0];this.size=new _math.Rectangle(0,0,1,1);this.resolution=resolution||_settings2.default.RESOLUTION;this.projectionMatrix=new _math.Matrix;this.transform=null;this.frame=null;this.defaultFrame=new _math.Rectangle;this.destinationFrame=null;this.sourceFrame=null;this.stencilBuffer=null;this.stencilMaskStack=[];this.filterData=null;this.filterPoolKey="";this.scaleMode=scaleMode!==undefined?scaleMode:_settings2.default.SCALE_MODE;this.root=root||false;if(!this.root){this.frameBuffer=_pixiGlCore.GLFramebuffer.createRGBA(gl,100,100);if(this.scaleMode===_const.SCALE_MODES.NEAREST){this.frameBuffer.texture.enableNearestScaling()}else{this.frameBuffer.texture.enableLinearScaling()}this.texture=this.frameBuffer.texture}else{this.frameBuffer=new _pixiGlCore.GLFramebuffer(gl,100,100);this.frameBuffer.framebuffer=null}this.setFrame();this.resize(width,height)}RenderTarget.prototype.clear=function clear(clearColor){var cc=clearColor||this.clearColor;this.frameBuffer.clear(cc[0],cc[1],cc[2],cc[3])};RenderTarget.prototype.attachStencilBuffer=function attachStencilBuffer(){if(!this.root){this.frameBuffer.enableStencil()}};RenderTarget.prototype.setFrame=function setFrame(destinationFrame,sourceFrame){this.destinationFrame=destinationFrame||this.destinationFrame||this.defaultFrame;this.sourceFrame=sourceFrame||this.sourceFrame||this.destinationFrame};RenderTarget.prototype.activate=function activate(){var gl=this.gl;this.frameBuffer.bind();this.calculateProjection(this.destinationFrame,this.sourceFrame);if(this.transform){this.projectionMatrix.append(this.transform)}if(this.destinationFrame!==this.sourceFrame){gl.enable(gl.SCISSOR_TEST);gl.scissor(this.destinationFrame.x|0,this.destinationFrame.y|0,this.destinationFrame.width*this.resolution|0,this.destinationFrame.height*this.resolution|0)}else{gl.disable(gl.SCISSOR_TEST)}gl.viewport(this.destinationFrame.x|0,this.destinationFrame.y|0,this.destinationFrame.width*this.resolution|0,this.destinationFrame.height*this.resolution|0)};RenderTarget.prototype.calculateProjection=function calculateProjection(destinationFrame,sourceFrame){var pm=this.projectionMatrix;sourceFrame=sourceFrame||destinationFrame;pm.identity();if(!this.root){pm.a=1/destinationFrame.width*2;pm.d=1/destinationFrame.height*2;pm.tx=-1-sourceFrame.x*pm.a;pm.ty=-1-sourceFrame.y*pm.d}else{pm.a=1/destinationFrame.width*2;pm.d=-1/destinationFrame.height*2;pm.tx=-1-sourceFrame.x*pm.a;pm.ty=1-sourceFrame.y*pm.d}};RenderTarget.prototype.resize=function resize(width,height){width=width|0;height=height|0;if(this.size.width===width&&this.size.height===height){return}this.size.width=width;this.size.height=height;this.defaultFrame.width=width;this.defaultFrame.height=height;this.frameBuffer.resize(width*this.resolution,height*this.resolution);var projectionFrame=this.frame||this.size;this.calculateProjection(projectionFrame)};RenderTarget.prototype.destroy=function destroy(){if(this.frameBuffer.stencil){this.gl.deleteRenderbuffer(this.frameBuffer.stencil)}this.frameBuffer.destroy();this.frameBuffer=null;this.texture=null};return RenderTarget}();exports.default=RenderTarget},{"../../../const":91,"../../../math":115,"../../../settings":146,"pixi-gl-core":60}],142:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=checkMaxIfStatmentsInShader;var _pixiGlCore=require("pixi-gl-core");var _pixiGlCore2=_interopRequireDefault(_pixiGlCore);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var fragTemplate=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function checkMaxIfStatmentsInShader(maxIfs,gl){var createTempContext=!gl;if(maxIfs===0){throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`")}if(createTempContext){var tinyCanvas=document.createElement("canvas");tinyCanvas.width=1;tinyCanvas.height=1;gl=_pixiGlCore2.default.createContext(tinyCanvas)}var shader=gl.createShader(gl.FRAGMENT_SHADER);while(true){var fragmentSrc=fragTemplate.replace(/%forloop%/gi,generateIfTestSrc(maxIfs));gl.shaderSource(shader,fragmentSrc);gl.compileShader(shader);if(!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){maxIfs=maxIfs/2|0}else{break}}if(createTempContext){if(gl.getExtension("WEBGL_lose_context")){gl.getExtension("WEBGL_lose_context").loseContext()}}return maxIfs}function generateIfTestSrc(maxIfs){var src="";for(var i=0;i<maxIfs;++i){if(i>0){src+="\nelse "}if(i<maxIfs-1){src+="if(test == "+i+".0){}"}}return src}},{"pixi-gl-core":60}],143:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=mapWebGLBlendModesToPixi;var _const=require("../../../const");function mapWebGLBlendModesToPixi(gl){var array=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];array[_const.BLEND_MODES.NORMAL]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.ADD]=[gl.ONE,gl.ONE];array[_const.BLEND_MODES.MULTIPLY]=[gl.DST_COLOR,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.SCREEN]=[gl.ONE,gl.ONE_MINUS_SRC_COLOR,gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.OVERLAY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.DARKEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.LIGHTEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.COLOR_DODGE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.COLOR_BURN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.HARD_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.SOFT_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.DIFFERENCE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.EXCLUSION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.HUE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.SATURATION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.COLOR]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.LUMINOSITY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.NORMAL_NPM]=[gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.ADD_NPM]=[gl.SRC_ALPHA,gl.ONE,gl.ONE,gl.ONE];array[_const.BLEND_MODES.SCREEN_NPM]=[gl.SRC_ALPHA,gl.ONE_MINUS_SRC_COLOR,gl.ONE,gl.ONE_MINUS_SRC_ALPHA];return array}},{"../../../const":91}],144:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=mapWebGLDrawModesToPixi;var _const=require("../../../const");function mapWebGLDrawModesToPixi(gl){var object=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};object[_const.DRAW_MODES.POINTS]=gl.POINTS;object[_const.DRAW_MODES.LINES]=gl.LINES;object[_const.DRAW_MODES.LINE_LOOP]=gl.LINE_LOOP;object[_const.DRAW_MODES.LINE_STRIP]=gl.LINE_STRIP;object[_const.DRAW_MODES.TRIANGLES]=gl.TRIANGLES;object[_const.DRAW_MODES.TRIANGLE_STRIP]=gl.TRIANGLE_STRIP;object[_const.DRAW_MODES.TRIANGLE_FAN]=gl.TRIANGLE_FAN;return object}},{"../../../const":91}],145:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=validateContext;function validateContext(gl){var attributes=gl.getContextAttributes();if(!attributes.stencil){console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly")}}},{}],146:[function(require,module,exports){"use strict";exports.__esModule=true;var _maxRecommendedTextures=require("./utils/maxRecommendedTextures");var _maxRecommendedTextures2=_interopRequireDefault(_maxRecommendedTextures);var _canUploadSameBuffer=require("./utils/canUploadSameBuffer");var _canUploadSameBuffer2=_interopRequireDefault(_canUploadSameBuffer);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={TARGET_FPMS:.06,MIPMAP_TEXTURES:true,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:(0,_maxRecommendedTextures2.default)(32),SPRITE_BATCH_SIZE:4096,RETINA_PREFIX:/@([0-9\.]+)x/,RENDER_OPTIONS:{view:null,antialias:false,forceFXAA:false,autoResize:false,transparent:false,backgroundColor:0,clearBeforeRender:true,preserveDrawingBuffer:false,roundPixels:false,width:800,height:600,legacy:false},TRANSFORM_MODE:0,GC_MODE:0,GC_MAX_IDLE:60*60,GC_MAX_CHECK_COUNT:60*10,WRAP_MODE:0,SCALE_MODE:0,PRECISION_VERTEX:"highp",PRECISION_FRAGMENT:"mediump",CAN_UPLOAD_SAME_BUFFER:(0,_canUploadSameBuffer2.default)(),MESH_CANVAS_PADDING:0}},{"./utils/canUploadSameBuffer":167,"./utils/maxRecommendedTextures":172}],147:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _math=require("../math");var _utils=require("../utils");var _const=require("../const");var _Texture=require("../textures/Texture");var _Texture2=_interopRequireDefault(_Texture);var _Container2=require("../display/Container");var _Container3=_interopRequireDefault(_Container2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var tempPoint=new _math.Point;var Sprite=function(_Container){_inherits(Sprite,_Container);function Sprite(texture){_classCallCheck(this,Sprite);var _this=_possibleConstructorReturn(this,_Container.call(this));_this._anchor=new _math.ObservablePoint(_this._onAnchorUpdate,_this,texture?texture.defaultAnchor.x:0,texture?texture.defaultAnchor.y:0);_this._texture=null;_this._width=0;_this._height=0;_this._tint=null;_this._tintRGB=null;_this.tint=16777215;_this.blendMode=_const.BLEND_MODES.NORMAL;_this.shader=null;_this.cachedTint=16777215;_this.texture=texture||_Texture2.default.EMPTY;_this.vertexData=new Float32Array(8);_this.vertexTrimmedData=null;_this._transformID=-1;_this._textureID=-1;_this._transformTrimmedID=-1;_this._textureTrimmedID=-1;_this.pluginName="sprite";return _this}Sprite.prototype._onTextureUpdate=function _onTextureUpdate(){this._textureID=-1;this._textureTrimmedID=-1;this.cachedTint=16777215;if(this._width){this.scale.x=(0,_utils.sign)(this.scale.x)*this._width/this._texture.orig.width}if(this._height){this.scale.y=(0,_utils.sign)(this.scale.y)*this._height/this._texture.orig.height}};Sprite.prototype._onAnchorUpdate=function _onAnchorUpdate(){this._transformID=-1;this._transformTrimmedID=-1};Sprite.prototype.calculateVertices=function calculateVertices(){if(this._transformID===this.transform._worldID&&this._textureID===this._texture._updateID){return}this._transformID=this.transform._worldID;this._textureID=this._texture._updateID;var texture=this._texture;var wt=this.transform.worldTransform;var a=wt.a;var b=wt.b;var c=wt.c;var d=wt.d;var tx=wt.tx;var ty=wt.ty;var vertexData=this.vertexData;var trim=texture.trim;var orig=texture.orig;var anchor=this._anchor;var w0=0;var w1=0;var h0=0;var h1=0;if(trim){w1=trim.x-anchor._x*orig.width;w0=w1+trim.width;h1=trim.y-anchor._y*orig.height;h0=h1+trim.height}else{w1=-anchor._x*orig.width;w0=w1+orig.width;h1=-anchor._y*orig.height;h0=h1+orig.height}vertexData[0]=a*w1+c*h1+tx;vertexData[1]=d*h1+b*w1+ty;vertexData[2]=a*w0+c*h1+tx;vertexData[3]=d*h1+b*w0+ty;vertexData[4]=a*w0+c*h0+tx;vertexData[5]=d*h0+b*w0+ty;vertexData[6]=a*w1+c*h0+tx;vertexData[7]=d*h0+b*w1+ty};Sprite.prototype.calculateTrimmedVertices=function calculateTrimmedVertices(){if(!this.vertexTrimmedData){this.vertexTrimmedData=new Float32Array(8)}else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID){return}this._transformTrimmedID=this.transform._worldID;this._textureTrimmedID=this._texture._updateID;var texture=this._texture;var vertexData=this.vertexTrimmedData;var orig=texture.orig;var anchor=this._anchor;var wt=this.transform.worldTransform;var a=wt.a;var b=wt.b;var c=wt.c;var d=wt.d;var tx=wt.tx;var ty=wt.ty;var w1=-anchor._x*orig.width;var w0=w1+orig.width;var h1=-anchor._y*orig.height;var h0=h1+orig.height;vertexData[0]=a*w1+c*h1+tx;vertexData[1]=d*h1+b*w1+ty;vertexData[2]=a*w0+c*h1+tx;vertexData[3]=d*h1+b*w0+ty;vertexData[4]=a*w0+c*h0+tx;vertexData[5]=d*h0+b*w0+ty;vertexData[6]=a*w1+c*h0+tx;vertexData[7]=d*h0+b*w1+ty};Sprite.prototype._renderWebGL=function _renderWebGL(renderer){this.calculateVertices();renderer.setObjectRenderer(renderer.plugins[this.pluginName]);renderer.plugins[this.pluginName].render(this)};Sprite.prototype._renderCanvas=function _renderCanvas(renderer){renderer.plugins[this.pluginName].render(this)};Sprite.prototype._calculateBounds=function _calculateBounds(){var trim=this._texture.trim;var orig=this._texture.orig;if(!trim||trim.width===orig.width&&trim.height===orig.height){this.calculateVertices();this._bounds.addQuad(this.vertexData)}else{this.calculateTrimmedVertices();this._bounds.addQuad(this.vertexTrimmedData)}};Sprite.prototype.getLocalBounds=function getLocalBounds(rect){if(this.children.length===0){this._bounds.minX=this._texture.orig.width*-this._anchor._x;this._bounds.minY=this._texture.orig.height*-this._anchor._y;this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x);this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y);if(!rect){if(!this._localBoundsRect){this._localBoundsRect=new _math.Rectangle}rect=this._localBoundsRect}return this._bounds.getRectangle(rect)}return _Container.prototype.getLocalBounds.call(this,rect)};Sprite.prototype.containsPoint=function containsPoint(point){this.worldTransform.applyInverse(point,tempPoint);var width=this._texture.orig.width;var height=this._texture.orig.height;var x1=-width*this.anchor.x;var y1=0;if(tempPoint.x>=x1&&tempPoint.x<x1+width){y1=-height*this.anchor.y;if(tempPoint.y>=y1&&tempPoint.y<y1+height){return true}}return false};Sprite.prototype.destroy=function destroy(options){_Container.prototype.destroy.call(this,options);this._texture.off("update",this._onTextureUpdate,this);this._anchor=null;var destroyTexture=typeof options==="boolean"?options:options&&options.texture;if(destroyTexture){var destroyBaseTexture=typeof options==="boolean"?options:options&&options.baseTexture;this._texture.destroy(!!destroyBaseTexture)}this._texture=null;this.shader=null};Sprite.from=function from(source){return new Sprite(_Texture2.default.from(source))};Sprite.fromFrame=function fromFrame(frameId){var texture=_utils.TextureCache[frameId];if(!texture){throw new Error('The frameId "'+frameId+'" does not exist in the texture cache')}return new Sprite(texture)};Sprite.fromImage=function fromImage(imageId,crossorigin,scaleMode){return new Sprite(_Texture2.default.fromImage(imageId,crossorigin,scaleMode))};_createClass(Sprite,[{key:"width",get:function get(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function set(value){var s=(0,_utils.sign)(this.scale.x)||1;this.scale.x=s*value/this._texture.orig.width;this._width=value}},{key:"height",get:function get(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function set(value){var s=(0,_utils.sign)(this.scale.y)||1;this.scale.y=s*value/this._texture.orig.height;this._height=value}},{key:"anchor",get:function get(){return this._anchor},set:function set(value){this._anchor.copy(value)}},{key:"tint",get:function get(){return this._tint},set:function set(value){this._tint=value;this._tintRGB=(value>>16)+(value&65280)+((value&255)<<16)}},{key:"texture",get:function get(){return this._texture},set:function set(value){if(this._texture===value){return}this._texture=value||_Texture2.default.EMPTY;this.cachedTint=16777215;this._textureID=-1;this._textureTrimmedID=-1;if(value){if(value.baseTexture.hasLoaded){this._onTextureUpdate()}else{value.once("update",this._onTextureUpdate,this)}}}}]);return Sprite}(_Container3.default);exports.default=Sprite},{"../const":91,"../display/Container":93,"../math":115,"../textures/Texture":160,"../utils":170}],148:[function(require,module,exports){"use strict";exports.__esModule=true;var _CanvasRenderer=require("../../renderers/canvas/CanvasRenderer");var _CanvasRenderer2=_interopRequireDefault(_CanvasRenderer);var _const=require("../../const");var _math=require("../../math");var _CanvasTinter=require("./CanvasTinter");var _CanvasTinter2=_interopRequireDefault(_CanvasTinter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var canvasRenderWorldTransform=new _math.Matrix;var CanvasSpriteRenderer=function(){function CanvasSpriteRenderer(renderer){_classCallCheck(this,CanvasSpriteRenderer);this.renderer=renderer}CanvasSpriteRenderer.prototype.render=function render(sprite){var texture=sprite._texture;var renderer=this.renderer;var width=texture._frame.width;var height=texture._frame.height;var wt=sprite.transform.worldTransform;var dx=0;var dy=0;if(texture.orig.width<=0||texture.orig.height<=0||!texture.baseTexture.source){return}renderer.setBlendMode(sprite.blendMode);if(texture.valid){renderer.context.globalAlpha=sprite.worldAlpha;var smoothingEnabled=texture.baseTexture.scaleMode===_const.SCALE_MODES.LINEAR;if(renderer.smoothProperty&&renderer.context[renderer.smoothProperty]!==smoothingEnabled){renderer.context[renderer.smoothProperty]=smoothingEnabled}if(texture.trim){dx=texture.trim.width/2+texture.trim.x-sprite.anchor.x*texture.orig.width;dy=texture.trim.height/2+texture.trim.y-sprite.anchor.y*texture.orig.height}else{dx=(.5-sprite.anchor.x)*texture.orig.width;dy=(.5-sprite.anchor.y)*texture.orig.height}if(texture.rotate){wt.copy(canvasRenderWorldTransform);wt=canvasRenderWorldTransform;_math.GroupD8.matrixAppendRotationInv(wt,texture.rotate,dx,dy);dx=0;dy=0}dx-=width/2;dy-=height/2;if(renderer.roundPixels){renderer.context.setTransform(wt.a,wt.b,wt.c,wt.d,wt.tx*renderer.resolution|0,wt.ty*renderer.resolution|0);dx=dx|0;dy=dy|0}else{renderer.context.setTransform(wt.a,wt.b,wt.c,wt.d,wt.tx*renderer.resolution,wt.ty*renderer.resolution)}var resolution=texture.baseTexture.resolution;if(sprite.tint!==16777215){if(sprite.cachedTint!==sprite.tint||sprite.tintedTexture.tintId!==sprite._texture._updateID){sprite.cachedTint=sprite.tint;sprite.tintedTexture=_CanvasTinter2.default.getTintedTexture(sprite,sprite.tint)}renderer.context.drawImage(sprite.tintedTexture,0,0,width*resolution,height*resolution,dx*renderer.resolution,dy*renderer.resolution,width*renderer.resolution,height*renderer.resolution)}else{renderer.context.drawImage(texture.baseTexture.source,texture._frame.x*resolution,texture._frame.y*resolution,width*resolution,height*resolution,dx*renderer.resolution,dy*renderer.resolution,width*renderer.resolution,height*renderer.resolution)}}};CanvasSpriteRenderer.prototype.destroy=function destroy(){this.renderer=null};return CanvasSpriteRenderer}();exports.default=CanvasSpriteRenderer;_CanvasRenderer2.default.registerPlugin("sprite",CanvasSpriteRenderer)},{"../../const":91,"../../math":115,"../../renderers/canvas/CanvasRenderer":122,"./CanvasTinter":149}],149:[function(require,module,exports){"use strict";exports.__esModule=true;var _utils=require("../../utils");var _canUseNewCanvasBlendModes=require("../../renderers/canvas/utils/canUseNewCanvasBlendModes");var _canUseNewCanvasBlendModes2=_interopRequireDefault(_canUseNewCanvasBlendModes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var CanvasTinter={getTintedTexture:function getTintedTexture(sprite,color){var texture=sprite._texture;color=CanvasTinter.roundColor(color);var stringColor="#"+("00000"+(color|0).toString(16)).substr(-6);texture.tintCache=texture.tintCache||{};var cachedTexture=texture.tintCache[stringColor];var canvas=void 0;if(cachedTexture){if(cachedTexture.tintId===texture._updateID){return texture.tintCache[stringColor]}canvas=texture.tintCache[stringColor]}else{canvas=CanvasTinter.canvas||document.createElement("canvas")}CanvasTinter.tintMethod(texture,color,canvas);canvas.tintId=texture._updateID;if(CanvasTinter.convertTintToImage){var tintImage=new Image;tintImage.src=canvas.toDataURL();texture.tintCache[stringColor]=tintImage}else{texture.tintCache[stringColor]=canvas;CanvasTinter.canvas=null}return canvas},tintWithMultiply:function tintWithMultiply(texture,color,canvas){var context=canvas.getContext("2d");var crop=texture._frame.clone();var resolution=texture.baseTexture.resolution;crop.x*=resolution;crop.y*=resolution;crop.width*=resolution;crop.height*=resolution;canvas.width=Math.ceil(crop.width);canvas.height=Math.ceil(crop.height);context.save();context.fillStyle="#"+("00000"+(color|0).toString(16)).substr(-6);context.fillRect(0,0,crop.width,crop.height);context.globalCompositeOperation="multiply";context.drawImage(texture.baseTexture.source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height);context.globalCompositeOperation="destination-atop";context.drawImage(texture.baseTexture.source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height);context.restore()},tintWithOverlay:function tintWithOverlay(texture,color,canvas){var context=canvas.getContext("2d");var crop=texture._frame.clone();var resolution=texture.baseTexture.resolution;crop.x*=resolution;crop.y*=resolution;crop.width*=resolution;crop.height*=resolution;canvas.width=Math.ceil(crop.width);canvas.height=Math.ceil(crop.height);context.save();context.globalCompositeOperation="copy";context.fillStyle="#"+("00000"+(color|0).toString(16)).substr(-6);context.fillRect(0,0,crop.width,crop.height);context.globalCompositeOperation="destination-atop";context.drawImage(texture.baseTexture.source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height);context.restore()},tintWithPerPixel:function tintWithPerPixel(texture,color,canvas){var context=canvas.getContext("2d");var crop=texture._frame.clone();var resolution=texture.baseTexture.resolution;crop.x*=resolution;crop.y*=resolution;crop.width*=resolution;crop.height*=resolution;canvas.width=Math.ceil(crop.width);canvas.height=Math.ceil(crop.height);context.save();context.globalCompositeOperation="copy";context.drawImage(texture.baseTexture.source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height);context.restore();var rgbValues=(0,_utils.hex2rgb)(color);var r=rgbValues[0];var g=rgbValues[1];var b=rgbValues[2];var pixelData=context.getImageData(0,0,crop.width,crop.height);var pixels=pixelData.data;for(var i=0;i<pixels.length;i+=4){pixels[i+0]*=r;pixels[i+1]*=g;pixels[i+2]*=b}context.putImageData(pixelData,0,0)},roundColor:function roundColor(color){var step=CanvasTinter.cacheStepsPerColorChannel;var rgbValues=(0,_utils.hex2rgb)(color);rgbValues[0]=Math.min(255,rgbValues[0]/step*step);rgbValues[1]=Math.min(255,rgbValues[1]/step*step);rgbValues[2]=Math.min(255,rgbValues[2]/step*step);return(0,_utils.rgb2hex)(rgbValues)},cacheStepsPerColorChannel:8,convertTintToImage:false,canUseMultiply:(0,_canUseNewCanvasBlendModes2.default)(),tintMethod:0};CanvasTinter.tintMethod=CanvasTinter.canUseMultiply?CanvasTinter.tintWithMultiply:CanvasTinter.tintWithPerPixel;exports.default=CanvasTinter},{"../../renderers/canvas/utils/canUseNewCanvasBlendModes":125,"../../utils":170}],150:[function(require,module,exports){"use strict";exports.__esModule=true;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Buffer=function(){function Buffer(size){_classCallCheck(this,Buffer);this.vertices=new ArrayBuffer(size);this.float32View=new Float32Array(this.vertices);this.uint32View=new Uint32Array(this.vertices)}Buffer.prototype.destroy=function destroy(){this.vertices=null;this.positions=null;this.uvs=null;this.colors=null};return Buffer}();exports.default=Buffer},{}],151:[function(require,module,exports){"use strict";exports.__esModule=true;var _ObjectRenderer2=require("../../renderers/webgl/utils/ObjectRenderer");var _ObjectRenderer3=_interopRequireDefault(_ObjectRenderer2);var _WebGLRenderer=require("../../renderers/webgl/WebGLRenderer");var _WebGLRenderer2=_interopRequireDefault(_WebGLRenderer);var _createIndicesForQuads=require("../../utils/createIndicesForQuads");var _createIndicesForQuads2=_interopRequireDefault(_createIndicesForQuads);var _generateMultiTextureShader=require("./generateMultiTextureShader");var _generateMultiTextureShader2=_interopRequireDefault(_generateMultiTextureShader);var _checkMaxIfStatmentsInShader=require("../../renderers/webgl/utils/checkMaxIfStatmentsInShader");var _checkMaxIfStatmentsInShader2=_interopRequireDefault(_checkMaxIfStatmentsInShader);var _BatchBuffer=require("./BatchBuffer");var _BatchBuffer2=_interopRequireDefault(_BatchBuffer);var _settings=require("../../settings");var _settings2=_interopRequireDefault(_settings);var _utils=require("../../utils");var _pixiGlCore=require("pixi-gl-core");var _pixiGlCore2=_interopRequireDefault(_pixiGlCore);var _bitTwiddle=require("bit-twiddle");var _bitTwiddle2=_interopRequireDefault(_bitTwiddle);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var TICK=0;var TEXTURE_TICK=0;var SpriteRenderer=function(_ObjectRenderer){_inherits(SpriteRenderer,_ObjectRenderer);function SpriteRenderer(renderer){_classCallCheck(this,SpriteRenderer);var _this=_possibleConstructorReturn(this,_ObjectRenderer.call(this,renderer));_this.vertSize=5;_this.vertByteSize=_this.vertSize*4;_this.size=_settings2.default.SPRITE_BATCH_SIZE;_this.buffers=[];for(var i=1;i<=_bitTwiddle2.default.nextPow2(_this.size);i*=2){_this.buffers.push(new _BatchBuffer2.default(i*4*_this.vertByteSize))}_this.indices=(0,_createIndicesForQuads2.default)(_this.size);_this.shader=null;_this.currentIndex=0;_this.groups=[];for(var k=0;k<_this.size;k++){_this.groups[k]={textures:[],textureCount:0,ids:[],size:0,start:0,blend:0}}_this.sprites=[];_this.vertexBuffers=[];_this.vaos=[];_this.vaoMax=2;_this.vertexCount=0;_this.renderer.on("prerender",_this.onPrerender,_this);return _this}SpriteRenderer.prototype.onContextChange=function onContextChange(){var gl=this.renderer.gl;if(this.renderer.legacy){this.MAX_TEXTURES=1}else{this.MAX_TEXTURES=Math.min(gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS),_settings2.default.SPRITE_MAX_TEXTURES);this.MAX_TEXTURES=(0,_checkMaxIfStatmentsInShader2.default)(this.MAX_TEXTURES,gl)}this.shader=(0,_generateMultiTextureShader2.default)(gl,this.MAX_TEXTURES);this.indexBuffer=_pixiGlCore2.default.GLBuffer.createIndexBuffer(gl,this.indices,gl.STATIC_DRAW);this.renderer.bindVao(null);var attrs=this.shader.attributes;for(var i=0;i<this.vaoMax;i++){var vertexBuffer=this.vertexBuffers[i]=_pixiGlCore2.default.GLBuffer.createVertexBuffer(gl,null,gl.STREAM_DRAW);var vao=this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(vertexBuffer,attrs.aVertexPosition,gl.FLOAT,false,this.vertByteSize,0).addAttribute(vertexBuffer,attrs.aTextureCoord,gl.UNSIGNED_SHORT,true,this.vertByteSize,2*4).addAttribute(vertexBuffer,attrs.aColor,gl.UNSIGNED_BYTE,true,this.vertByteSize,3*4);if(attrs.aTextureId){vao.addAttribute(vertexBuffer,attrs.aTextureId,gl.FLOAT,false,this.vertByteSize,4*4)}this.vaos[i]=vao}this.vao=this.vaos[0];this.currentBlendMode=99999;this.boundTextures=new Array(this.MAX_TEXTURES)};SpriteRenderer.prototype.onPrerender=function onPrerender(){this.vertexCount=0};SpriteRenderer.prototype.render=function render(sprite){if(this.currentIndex>=this.size){this.flush()}if(!sprite._texture._uvs){return}this.sprites[this.currentIndex++]=sprite};SpriteRenderer.prototype.flush=function flush(){if(this.currentIndex===0){return}var gl=this.renderer.gl;var MAX_TEXTURES=this.MAX_TEXTURES;var np2=_bitTwiddle2.default.nextPow2(this.currentIndex);var log2=_bitTwiddle2.default.log2(np2);var buffer=this.buffers[log2];var sprites=this.sprites;var groups=this.groups;var float32View=buffer.float32View;var uint32View=buffer.uint32View;var boundTextures=this.boundTextures;var rendererBoundTextures=this.renderer.boundTextures;var touch=this.renderer.textureGC.count;var index=0;var nextTexture=void 0;var currentTexture=void 0;var groupCount=1;var textureCount=0;var currentGroup=groups[0];var vertexData=void 0;var uvs=void 0;var blendMode=_utils.premultiplyBlendMode[sprites[0]._texture.baseTexture.premultipliedAlpha?1:0][sprites[0].blendMode];currentGroup.textureCount=0;currentGroup.start=0;currentGroup.blend=blendMode;TICK++;var i=void 0;for(i=0;i<MAX_TEXTURES;++i){var bt=rendererBoundTextures[i];if(bt._enabled===TICK){boundTextures[i]=this.renderer.emptyTextures[i];continue}boundTextures[i]=bt;bt._virtalBoundId=i;bt._enabled=TICK}TICK++;for(i=0;i<this.currentIndex;++i){var sprite=sprites[i];sprites[i]=null;nextTexture=sprite._texture.baseTexture;var spriteBlendMode=_utils.premultiplyBlendMode[Number(nextTexture.premultipliedAlpha)][sprite.blendMode];if(blendMode!==spriteBlendMode){blendMode=spriteBlendMode;currentTexture=null;textureCount=MAX_TEXTURES;TICK++}if(currentTexture!==nextTexture){currentTexture=nextTexture;if(nextTexture._enabled!==TICK){if(textureCount===MAX_TEXTURES){TICK++;currentGroup.size=i-currentGroup.start;textureCount=0;currentGroup=groups[groupCount++];currentGroup.blend=blendMode;currentGroup.textureCount=0;currentGroup.start=i}nextTexture.touched=touch;if(nextTexture._virtalBoundId===-1){for(var j=0;j<MAX_TEXTURES;++j){var tIndex=(j+TEXTURE_TICK)%MAX_TEXTURES;var t=boundTextures[tIndex];if(t._enabled!==TICK){TEXTURE_TICK++;t._virtalBoundId=-1;nextTexture._virtalBoundId=tIndex;boundTextures[tIndex]=nextTexture;break}}}nextTexture._enabled=TICK;currentGroup.textureCount++;currentGroup.ids[textureCount]=nextTexture._virtalBoundId;currentGroup.textures[textureCount++]=nextTexture}}vertexData=sprite.vertexData;uvs=sprite._texture._uvs.uvsUint32;if(this.renderer.roundPixels){var resolution=this.renderer.resolution;float32View[index]=(vertexData[0]*resolution|0)/resolution;float32View[index+1]=(vertexData[1]*resolution|0)/resolution;float32View[index+5]=(vertexData[2]*resolution|0)/resolution;float32View[index+6]=(vertexData[3]*resolution|0)/resolution;float32View[index+10]=(vertexData[4]*resolution|0)/resolution;float32View[index+11]=(vertexData[5]*resolution|0)/resolution;float32View[index+15]=(vertexData[6]*resolution|0)/resolution;float32View[index+16]=(vertexData[7]*resolution|0)/resolution}else{float32View[index]=vertexData[0];float32View[index+1]=vertexData[1];float32View[index+5]=vertexData[2];float32View[index+6]=vertexData[3];float32View[index+10]=vertexData[4];float32View[index+11]=vertexData[5];float32View[index+15]=vertexData[6];float32View[index+16]=vertexData[7]}uint32View[index+2]=uvs[0];uint32View[index+7]=uvs[1];uint32View[index+12]=uvs[2];uint32View[index+17]=uvs[3];var alpha=Math.min(sprite.worldAlpha,1);var argb=alpha<1&&nextTexture.premultipliedAlpha?(0,_utils.premultiplyTint)(sprite._tintRGB,alpha):sprite._tintRGB+(alpha*255<<24);uint32View[index+3]=uint32View[index+8]=uint32View[index+13]=uint32View[index+18]=argb;float32View[index+4]=float32View[index+9]=float32View[index+14]=float32View[index+19]=nextTexture._virtalBoundId;index+=20}currentGroup.size=i-currentGroup.start;if(!_settings2.default.CAN_UPLOAD_SAME_BUFFER){if(this.vaoMax<=this.vertexCount){this.vaoMax++;var attrs=this.shader.attributes;var vertexBuffer=this.vertexBuffers[this.vertexCount]=_pixiGlCore2.default.GLBuffer.createVertexBuffer(gl,null,gl.STREAM_DRAW);var vao=this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(vertexBuffer,attrs.aVertexPosition,gl.FLOAT,false,this.vertByteSize,0).addAttribute(vertexBuffer,attrs.aTextureCoord,gl.UNSIGNED_SHORT,true,this.vertByteSize,2*4).addAttribute(vertexBuffer,attrs.aColor,gl.UNSIGNED_BYTE,true,this.vertByteSize,3*4);if(attrs.aTextureId){vao.addAttribute(vertexBuffer,attrs.aTextureId,gl.FLOAT,false,this.vertByteSize,4*4)}this.vaos[this.vertexCount]=vao}this.renderer.bindVao(this.vaos[this.vertexCount]);this.vertexBuffers[this.vertexCount].upload(buffer.vertices,0,false);this.vertexCount++}else{this.vertexBuffers[this.vertexCount].upload(buffer.vertices,0,true)}for(i=0;i<MAX_TEXTURES;++i){rendererBoundTextures[i]._virtalBoundId=-1}for(i=0;i<groupCount;++i){var group=groups[i];var groupTextureCount=group.textureCount;for(var _j=0;_j<groupTextureCount;_j++){currentTexture=group.textures[_j];if(rendererBoundTextures[group.ids[_j]]!==currentTexture){this.renderer.bindTexture(currentTexture,group.ids[_j],true)}currentTexture._virtalBoundId=-1}this.renderer.state.setBlendMode(group.blend);gl.drawElements(gl.TRIANGLES,group.size*6,gl.UNSIGNED_SHORT,group.start*6*2)}this.currentIndex=0};SpriteRenderer.prototype.start=function start(){this.renderer.bindShader(this.shader);if(_settings2.default.CAN_UPLOAD_SAME_BUFFER){this.renderer.bindVao(this.vaos[this.vertexCount]);this.vertexBuffers[this.vertexCount].bind()}};SpriteRenderer.prototype.stop=function stop(){this.flush()};SpriteRenderer.prototype.destroy=function destroy(){for(var i=0;i<this.vaoMax;i++){if(this.vertexBuffers[i]){this.vertexBuffers[i].destroy()}if(this.vaos[i]){this.vaos[i].destroy()}}if(this.indexBuffer){this.indexBuffer.destroy()}this.renderer.off("prerender",this.onPrerender,this);_ObjectRenderer.prototype.destroy.call(this);if(this.shader){this.shader.destroy();this.shader=null}this.vertexBuffers=null;this.vaos=null;this.indexBuffer=null;this.indices=null;this.sprites=null;for(var _i=0;_i<this.buffers.length;++_i){this.buffers[_i].destroy()}};return SpriteRenderer}(_ObjectRenderer3.default);exports.default=SpriteRenderer;_WebGLRenderer2.default.registerPlugin("sprite",SpriteRenderer)},{"../../renderers/webgl/WebGLRenderer":129,"../../renderers/webgl/utils/ObjectRenderer":139,"../../renderers/webgl/utils/checkMaxIfStatmentsInShader":142,"../../settings":146,"../../utils":170,"../../utils/createIndicesForQuads":168,"./BatchBuffer":150,"./generateMultiTextureShader":152,"bit-twiddle":26,"pixi-gl-core":60}],152:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=generateMultiTextureShader;var _Shader=require("../../Shader");var _Shader2=_interopRequireDefault(_Shader);var _path=require("path");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var fragTemplate=["varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureId;","uniform sampler2D uSamplers[%count%];","void main(void){","vec4 color;","%forloop%","gl_FragColor = color * vColor;","}"].join("\n");function generateMultiTextureShader(gl,maxTextures){var vertexSrc="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor;\n}\n";var fragmentSrc=fragTemplate;fragmentSrc=fragmentSrc.replace(/%count%/gi,maxTextures);fragmentSrc=fragmentSrc.replace(/%forloop%/gi,generateSampleSrc(maxTextures));var shader=new _Shader2.default(gl,vertexSrc,fragmentSrc);var sampleValues=[];for(var i=0;i<maxTextures;i++){sampleValues[i]=i}shader.bind();shader.uniforms.uSamplers=sampleValues;return shader}function generateSampleSrc(maxTextures){var src="";src+="\n";src+="\n";for(var i=0;i<maxTextures;i++){if(i>0){src+="\nelse "}if(i<maxTextures-1){src+="if(vTextureId < "+i+".5)"}src+="\n{";src+="\n\tcolor = texture2D(uSamplers["+i+"], vTextureCoord);";src+="\n}"}src+="\n";src+="\n";return src}},{"../../Shader":89,path:49}],153:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _Sprite2=require("../sprites/Sprite");var _Sprite3=_interopRequireDefault(_Sprite2);var _Texture=require("../textures/Texture");var _Texture2=_interopRequireDefault(_Texture);var _math=require("../math");var _utils=require("../utils");var _const=require("../const");var _settings=require("../settings");var _settings2=_interopRequireDefault(_settings);var _TextStyle=require("./TextStyle");var _TextStyle2=_interopRequireDefault(_TextStyle);var _TextMetrics=require("./TextMetrics");var _TextMetrics2=_interopRequireDefault(_TextMetrics);var _trimCanvas=require("../utils/trimCanvas");var _trimCanvas2=_interopRequireDefault(_trimCanvas);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var defaultDestroyOptions={texture:true,children:false,baseTexture:true};var Text=function(_Sprite){_inherits(Text,_Sprite);function Text(text,style,canvas){_classCallCheck(this,Text);canvas=canvas||document.createElement("canvas");canvas.width=3;canvas.height=3;var texture=_Texture2.default.fromCanvas(canvas,_settings2.default.SCALE_MODE,"text");texture.orig=new _math.Rectangle;texture.trim=new _math.Rectangle;var _this=_possibleConstructorReturn(this,_Sprite.call(this,texture));_Texture2.default.addToCache(_this._texture,_this._texture.baseTexture.textureCacheIds[0]);_this.canvas=canvas;_this.context=_this.canvas.getContext("2d");_this.resolution=_settings2.default.RESOLUTION;_this._text=null;_this._style=null;_this._styleListener=null;_this._font="";_this.text=text;_this.style=style;_this.localStyleID=-1;return _this}Text.prototype.updateText=function updateText(respectDirty){var style=this._style;if(this.localStyleID!==style.styleID){this.dirty=true;this.localStyleID=style.styleID}if(!this.dirty&&respectDirty){return}this._font=this._style.toFontString();var context=this.context;var measured=_TextMetrics2.default.measureText(this._text,this._style,this._style.wordWrap,this.canvas);var width=measured.width;var height=measured.height;var lines=measured.lines;var lineHeight=measured.lineHeight;var lineWidths=measured.lineWidths;var maxLineWidth=measured.maxLineWidth;var fontProperties=measured.fontProperties;this.canvas.width=Math.ceil((Math.max(1,width)+style.padding*2)*this.resolution);this.canvas.height=Math.ceil((Math.max(1,height)+style.padding*2)*this.resolution);context.scale(this.resolution,this.resolution);context.clearRect(0,0,this.canvas.width,this.canvas.height);context.font=this._font;context.strokeStyle=style.stroke;context.lineWidth=style.strokeThickness;context.textBaseline=style.textBaseline;context.lineJoin=style.lineJoin;context.miterLimit=style.miterLimit;var linePositionX=void 0;var linePositionY=void 0;if(style.dropShadow){context.fillStyle=style.dropShadowColor;context.globalAlpha=style.dropShadowAlpha;context.shadowBlur=style.dropShadowBlur;if(style.dropShadowBlur>0){context.shadowColor=style.dropShadowColor}var xShadowOffset=Math.cos(style.dropShadowAngle)*style.dropShadowDistance;var yShadowOffset=Math.sin(style.dropShadowAngle)*style.dropShadowDistance;for(var i=0;i<lines.length;i++){linePositionX=style.strokeThickness/2;linePositionY=style.strokeThickness/2+i*lineHeight+fontProperties.ascent;if(style.align==="right"){linePositionX+=maxLineWidth-lineWidths[i]}else if(style.align==="center"){linePositionX+=(maxLineWidth-lineWidths[i])/2}if(style.fill){this.drawLetterSpacing(lines[i],linePositionX+xShadowOffset+style.padding,linePositionY+yShadowOffset+style.padding);if(style.stroke&&style.strokeThickness){context.strokeStyle=style.dropShadowColor;this.drawLetterSpacing(lines[i],linePositionX+xShadowOffset+style.padding,linePositionY+yShadowOffset+style.padding,true);context.strokeStyle=style.stroke}}}}context.shadowBlur=0;context.globalAlpha=1;context.fillStyle=this._generateFillStyle(style,lines);for(var _i=0;_i<lines.length;_i++){linePositionX=style.strokeThickness/2;linePositionY=style.strokeThickness/2+_i*lineHeight+fontProperties.ascent;if(style.align==="right"){linePositionX+=maxLineWidth-lineWidths[_i]}else if(style.align==="center"){linePositionX+=(maxLineWidth-lineWidths[_i])/2}if(style.stroke&&style.strokeThickness){this.drawLetterSpacing(lines[_i],linePositionX+style.padding,linePositionY+style.padding,true)}if(style.fill){this.drawLetterSpacing(lines[_i],linePositionX+style.padding,linePositionY+style.padding)}}this.updateTexture()};Text.prototype.drawLetterSpacing=function drawLetterSpacing(text,x,y){var isStroke=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var style=this._style;var letterSpacing=style.letterSpacing;if(letterSpacing===0){if(isStroke){this.context.strokeText(text,x,y)}else{this.context.fillText(text,x,y)}return}var characters=String.prototype.split.call(text,"");var currentPosition=x;var index=0;var current="";while(index<text.length){current=characters[index++];if(isStroke){this.context.strokeText(current,currentPosition,y)}else{this.context.fillText(current,currentPosition,y)}currentPosition+=this.context.measureText(current).width+letterSpacing}};Text.prototype.updateTexture=function updateTexture(){var canvas=this.canvas;if(this._style.trim){var trimmed=(0,_trimCanvas2.default)(canvas);if(trimmed.data){canvas.width=trimmed.width;canvas.height=trimmed.height;this.context.putImageData(trimmed.data,0,0)}}var texture=this._texture;var style=this._style;var padding=style.trim?0:style.padding;var baseTexture=texture.baseTexture;baseTexture.hasLoaded=true;baseTexture.resolution=this.resolution;baseTexture.realWidth=canvas.width;baseTexture.realHeight=canvas.height;baseTexture.width=canvas.width/this.resolution;baseTexture.height=canvas.height/this.resolution;texture.trim.width=texture._frame.width=canvas.width/this.resolution;texture.trim.height=texture._frame.height=canvas.height/this.resolution;texture.trim.x=-padding;texture.trim.y=-padding;texture.orig.width=texture._frame.width-padding*2;texture.orig.height=texture._frame.height-padding*2;this._onTextureUpdate();baseTexture.emit("update",baseTexture);this.dirty=false};Text.prototype.renderWebGL=function renderWebGL(renderer){if(this.resolution!==renderer.resolution){this.resolution=renderer.resolution;this.dirty=true}this.updateText(true);_Sprite.prototype.renderWebGL.call(this,renderer)};Text.prototype._renderCanvas=function _renderCanvas(renderer){if(this.resolution!==renderer.resolution){this.resolution=renderer.resolution;this.dirty=true}this.updateText(true);_Sprite.prototype._renderCanvas.call(this,renderer)};Text.prototype.getLocalBounds=function getLocalBounds(rect){this.updateText(true);return _Sprite.prototype.getLocalBounds.call(this,rect)};Text.prototype._calculateBounds=function _calculateBounds(){this.updateText(true);this.calculateVertices();this._bounds.addQuad(this.vertexData)};Text.prototype._onStyleChange=function _onStyleChange(){this.dirty=true};Text.prototype._generateFillStyle=function _generateFillStyle(style,lines){if(!Array.isArray(style.fill)){return style.fill}if(navigator.isCocoonJS){return style.fill[0]}var gradient=void 0;var totalIterations=void 0;var currentIteration=void 0;var stop=void 0;var width=this.canvas.width/this.resolution;var height=this.canvas.height/this.resolution;var fill=style.fill.slice();var fillGradientStops=style.fillGradientStops.slice();if(!fillGradientStops.length){var lengthPlus1=fill.length+1;for(var i=1;i<lengthPlus1;++i){fillGradientStops.push(i/lengthPlus1)}}fill.unshift(style.fill[0]);fillGradientStops.unshift(0);fill.push(style.fill[style.fill.length-1]);fillGradientStops.push(1);if(style.fillGradientType===_const.TEXT_GRADIENT.LINEAR_VERTICAL){gradient=this.context.createLinearGradient(width/2,0,width/2,height);totalIterations=(fill.length+1)*lines.length;currentIteration=0;for(var _i2=0;_i2<lines.length;_i2++){currentIteration+=1;for(var j=0;j<fill.length;j++){if(typeof fillGradientStops[j]==="number"){stop=fillGradientStops[j]/lines.length+_i2/lines.length}else{stop=currentIteration/totalIterations}gradient.addColorStop(stop,fill[j]);currentIteration++}}}else{gradient=this.context.createLinearGradient(0,height/2,width,height/2);totalIterations=fill.length+1;currentIteration=1;for(var _i3=0;_i3<fill.length;_i3++){if(typeof fillGradientStops[_i3]==="number"){stop=fillGradientStops[_i3]}else{stop=currentIteration/totalIterations}gradient.addColorStop(stop,fill[_i3]);currentIteration++}}return gradient};Text.prototype.destroy=function destroy(options){if(typeof options==="boolean"){options={children:options}}options=Object.assign({},defaultDestroyOptions,options);_Sprite.prototype.destroy.call(this,options);this.context=null;this.canvas=null;this._style=null};_createClass(Text,[{key:"width",get:function get(){this.updateText(true);return Math.abs(this.scale.x)*this._texture.orig.width},set:function set(value){this.updateText(true);var s=(0,_utils.sign)(this.scale.x)||1;this.scale.x=s*value/this._texture.orig.width;this._width=value}},{key:"height",get:function get(){this.updateText(true);return Math.abs(this.scale.y)*this._texture.orig.height},set:function set(value){this.updateText(true);var s=(0,_utils.sign)(this.scale.y)||1;this.scale.y=s*value/this._texture.orig.height;this._height=value}},{key:"style",get:function get(){return this._style},set:function set(style){style=style||{};if(style instanceof _TextStyle2.default){this._style=style}else{this._style=new _TextStyle2.default(style)}this.localStyleID=-1;this.dirty=true}},{key:"text",get:function get(){return this._text},set:function set(text){text=String(text===""||text===null||text===undefined?" ":text);if(this._text===text){return}this._text=text;this.dirty=true}}]);return Text}(_Sprite3.default);exports.default=Text},{"../const":91,"../math":115,"../settings":146,"../sprites/Sprite":147,"../textures/Texture":160,"../utils":170,"../utils/trimCanvas":175,"./TextMetrics":154,"./TextStyle":155}],154:[function(require,module,exports){"use strict";exports.__esModule=true;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var TextMetrics=function(){function TextMetrics(text,style,width,height,lines,lineWidths,lineHeight,maxLineWidth,fontProperties){_classCallCheck(this,TextMetrics);this.text=text;this.style=style;this.width=width;this.height=height;this.lines=lines;this.lineWidths=lineWidths;this.lineHeight=lineHeight;this.maxLineWidth=maxLineWidth;this.fontProperties=fontProperties}TextMetrics.measureText=function measureText(text,style,wordWrap){var canvas=arguments.length>3&&arguments[3]!==undefined?arguments[3]:TextMetrics._canvas;wordWrap=wordWrap===undefined||wordWrap===null?style.wordWrap:wordWrap;var font=style.toFontString();var fontProperties=TextMetrics.measureFont(font);var context=canvas.getContext("2d");context.font=font;var outputText=wordWrap?TextMetrics.wordWrap(text,style,canvas):text;var lines=outputText.split(/(?:\r\n|\r|\n)/);var lineWidths=new Array(lines.length);var maxLineWidth=0;for(var i=0;i<lines.length;i++){var lineWidth=context.measureText(lines[i]).width+(lines[i].length-1)*style.letterSpacing;lineWidths[i]=lineWidth;maxLineWidth=Math.max(maxLineWidth,lineWidth)}var width=maxLineWidth+style.strokeThickness;if(style.dropShadow){width+=style.dropShadowDistance}var lineHeight=style.lineHeight||fontProperties.fontSize+style.strokeThickness;var height=Math.max(lineHeight,fontProperties.fontSize+style.strokeThickness)+(lines.length-1)*(lineHeight+style.leading);if(style.dropShadow){height+=style.dropShadowDistance}return new TextMetrics(text,style,width,height,lines,lineWidths,lineHeight+style.leading,maxLineWidth,fontProperties)};TextMetrics.wordWrap=function wordWrap(text,style){var canvas=arguments.length>2&&arguments[2]!==undefined?arguments[2]:TextMetrics._canvas;var context=canvas.getContext("2d");var width=0;var line="";var lines="";var cache={};var letterSpacing=style.letterSpacing,whiteSpace=style.whiteSpace;var collapseSpaces=TextMetrics.collapseSpaces(whiteSpace);var collapseNewlines=TextMetrics.collapseNewlines(whiteSpace);var canPrependSpaces=!collapseSpaces;var wordWrapWidth=style.wordWrapWidth+letterSpacing;var tokens=TextMetrics.tokenize(text);for(var i=0;i<tokens.length;i++){var token=tokens[i];if(TextMetrics.isNewline(token)){if(!collapseNewlines){lines+=TextMetrics.addLine(line);canPrependSpaces=!collapseSpaces;line="";width=0;continue}token=" "}if(collapseSpaces){var currIsBreakingSpace=TextMetrics.isBreakingSpace(token);var lastIsBreakingSpace=TextMetrics.isBreakingSpace(line[line.length-1]);if(currIsBreakingSpace&&lastIsBreakingSpace){continue}}var tokenWidth=TextMetrics.getFromCache(token,letterSpacing,cache,context);if(tokenWidth>wordWrapWidth){if(line!==""){lines+=TextMetrics.addLine(line);line="";width=0}if(TextMetrics.canBreakWords(token,style.breakWords)){var characters=token.split("");for(var j=0;j<characters.length;j++){var char=characters[j];var k=1;while(characters[j+k]){var nextChar=characters[j+k];var lastChar=char[char.length-1];if(!TextMetrics.canBreakChars(lastChar,nextChar,token,j,style.breakWords)){char+=nextChar}else{break}k++}j+=char.length-1;var characterWidth=TextMetrics.getFromCache(char,letterSpacing,cache,context);if(characterWidth+width>wordWrapWidth){lines+=TextMetrics.addLine(line);canPrependSpaces=false;line="";width=0}line+=char;width+=characterWidth}}else{if(line.length>0){lines+=TextMetrics.addLine(line);line="";width=0}var isLastToken=i===tokens.length-1;lines+=TextMetrics.addLine(token,!isLastToken);canPrependSpaces=false;line="";width=0}}else{if(tokenWidth+width>wordWrapWidth){canPrependSpaces=false;lines+=TextMetrics.addLine(line);line="";width=0}if(line.length>0||!TextMetrics.isBreakingSpace(token)||canPrependSpaces){line+=token;width+=tokenWidth}}}lines+=TextMetrics.addLine(line,false);return lines};TextMetrics.addLine=function addLine(line){var newLine=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;line=TextMetrics.trimRight(line);line=newLine?line+"\n":line;return line};TextMetrics.getFromCache=function getFromCache(key,letterSpacing,cache,context){var width=cache[key];if(width===undefined){var spacing=key.length*letterSpacing;width=context.measureText(key).width+spacing;cache[key]=width}return width};TextMetrics.collapseSpaces=function collapseSpaces(whiteSpace){return whiteSpace==="normal"||whiteSpace==="pre-line"};TextMetrics.collapseNewlines=function collapseNewlines(whiteSpace){return whiteSpace==="normal"};TextMetrics.trimRight=function trimRight(text){if(typeof text!=="string"){return""}for(var i=text.length-1;i>=0;i--){var char=text[i];if(!TextMetrics.isBreakingSpace(char)){break}text=text.slice(0,-1)}return text};TextMetrics.isNewline=function isNewline(char){if(typeof char!=="string"){return false}return TextMetrics._newlines.indexOf(char.charCodeAt(0))>=0};TextMetrics.isBreakingSpace=function isBreakingSpace(char){if(typeof char!=="string"){return false}return TextMetrics._breakingSpaces.indexOf(char.charCodeAt(0))>=0};TextMetrics.tokenize=function tokenize(text){var tokens=[];var token="";if(typeof text!=="string"){return tokens}for(var i=0;i<text.length;i++){var char=text[i];if(TextMetrics.isBreakingSpace(char)||TextMetrics.isNewline(char)){if(token!==""){tokens.push(token);token=""}tokens.push(char);continue}token+=char}if(token!==""){tokens.push(token)}return tokens};TextMetrics.canBreakWords=function canBreakWords(token,breakWords){return breakWords};TextMetrics.canBreakChars=function canBreakChars(char,nextChar,token,index,breakWords){return true};TextMetrics.measureFont=function measureFont(font){if(TextMetrics._fonts[font]){return TextMetrics._fonts[font]}var properties={};var canvas=TextMetrics._canvas;var context=TextMetrics._context;context.font=font;var metricsString=TextMetrics.METRICS_STRING+TextMetrics.BASELINE_SYMBOL;var width=Math.ceil(context.measureText(metricsString).width);var baseline=Math.ceil(context.measureText(TextMetrics.BASELINE_SYMBOL).width);var height=2*baseline;baseline=baseline*TextMetrics.BASELINE_MULTIPLIER|0;canvas.width=width;canvas.height=height;context.fillStyle="#f00";context.fillRect(0,0,width,height);context.font=font;context.textBaseline="alphabetic";context.fillStyle="#000";context.fillText(metricsString,0,baseline);var imagedata=context.getImageData(0,0,width,height).data;var pixels=imagedata.length;var line=width*4;var i=0;var idx=0;var stop=false;for(i=0;i<baseline;++i){for(var j=0;j<line;j+=4){if(imagedata[idx+j]!==255){stop=true;break}}if(!stop){idx+=line}else{break}}properties.ascent=baseline-i;idx=pixels-line;stop=false;for(i=height;i>baseline;--i){for(var _j=0;_j<line;_j+=4){if(imagedata[idx+_j]!==255){stop=true;break}}if(!stop){idx-=line}else{break}}properties.descent=i-baseline;properties.fontSize=properties.ascent+properties.descent;TextMetrics._fonts[font]=properties;return properties};TextMetrics.clearMetrics=function clearMetrics(){var font=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";if(font){delete TextMetrics._fonts[font]}else{TextMetrics._fonts={}}};return TextMetrics}();exports.default=TextMetrics;var canvas=document.createElement("canvas");canvas.width=canvas.height=10;TextMetrics._canvas=canvas;TextMetrics._context=canvas.getContext("2d");TextMetrics._fonts={};TextMetrics.METRICS_STRING="|q";TextMetrics.BASELINE_SYMBOL="M";TextMetrics.BASELINE_MULTIPLIER=1.4;TextMetrics._newlines=[10,13];TextMetrics._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288]},{}],155:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _const=require("../const");var _utils=require("../utils");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var defaultStyle={align:"left",breakWords:false,dropShadow:false,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:_const.TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:false,whiteSpace:"pre",wordWrap:false,wordWrapWidth:100,leading:0};var genericFontFamilies=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];var TextStyle=function(){function TextStyle(style){_classCallCheck(this,TextStyle);this.styleID=0;this.reset();deepCopyProperties(this,style,style)}TextStyle.prototype.clone=function clone(){var clonedProperties={};deepCopyProperties(clonedProperties,this,defaultStyle);return new TextStyle(clonedProperties)};TextStyle.prototype.reset=function reset(){deepCopyProperties(this,defaultStyle,defaultStyle)};TextStyle.prototype.toFontString=function toFontString(){var fontSizeString=typeof this.fontSize==="number"?this.fontSize+"px":this.fontSize;var fontFamilies=this.fontFamily;if(!Array.isArray(this.fontFamily)){fontFamilies=this.fontFamily.split(",")}for(var i=fontFamilies.length-1;i>=0;i--){var fontFamily=fontFamilies[i].trim();if(!/([\"\'])[^\'\"]+\1/.test(fontFamily)&&genericFontFamilies.indexOf(fontFamily)<0){fontFamily='"'+fontFamily+'"'}fontFamilies[i]=fontFamily}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+fontSizeString+" "+fontFamilies.join(",")};_createClass(TextStyle,[{key:"align",get:function get(){return this._align},set:function set(align){if(this._align!==align){this._align=align;this.styleID++}}},{key:"breakWords",get:function get(){return this._breakWords},set:function set(breakWords){if(this._breakWords!==breakWords){this._breakWords=breakWords;this.styleID++}}},{key:"dropShadow",get:function get(){return this._dropShadow},set:function set(dropShadow){if(this._dropShadow!==dropShadow){this._dropShadow=dropShadow;this.styleID++}}},{key:"dropShadowAlpha",get:function get(){return this._dropShadowAlpha},set:function set(dropShadowAlpha){if(this._dropShadowAlpha!==dropShadowAlpha){this._dropShadowAlpha=dropShadowAlpha;this.styleID++}}},{key:"dropShadowAngle",get:function get(){return this._dropShadowAngle},set:function set(dropShadowAngle){if(this._dropShadowAngle!==dropShadowAngle){this._dropShadowAngle=dropShadowAngle;this.styleID++}}},{key:"dropShadowBlur",get:function get(){return this._dropShadowBlur},set:function set(dropShadowBlur){if(this._dropShadowBlur!==dropShadowBlur){this._dropShadowBlur=dropShadowBlur;this.styleID++}}},{key:"dropShadowColor",get:function get(){return this._dropShadowColor},set:function set(dropShadowColor){var outputColor=getColor(dropShadowColor);if(this._dropShadowColor!==outputColor){this._dropShadowColor=outputColor;this.styleID++}}},{key:"dropShadowDistance",get:function get(){return this._dropShadowDistance},set:function set(dropShadowDistance){if(this._dropShadowDistance!==dropShadowDistance){this._dropShadowDistance=dropShadowDistance;this.styleID++}}},{key:"fill",get:function get(){return this._fill},set:function set(fill){var outputColor=getColor(fill);if(this._fill!==outputColor){this._fill=outputColor;this.styleID++}}},{key:"fillGradientType",get:function get(){return this._fillGradientType},set:function set(fillGradientType){if(this._fillGradientType!==fillGradientType){this._fillGradientType=fillGradientType;this.styleID++}}},{key:"fillGradientStops",get:function get(){return this._fillGradientStops},set:function set(fillGradientStops){if(!areArraysEqual(this._fillGradientStops,fillGradientStops)){this._fillGradientStops=fillGradientStops;this.styleID++}}},{key:"fontFamily",get:function get(){return this._fontFamily},set:function set(fontFamily){if(this.fontFamily!==fontFamily){this._fontFamily=fontFamily;this.styleID++}}},{key:"fontSize",get:function get(){return this._fontSize},set:function set(fontSize){if(this._fontSize!==fontSize){this._fontSize=fontSize;this.styleID++}}},{key:"fontStyle",get:function get(){return this._fontStyle},set:function set(fontStyle){if(this._fontStyle!==fontStyle){this._fontStyle=fontStyle;this.styleID++}}},{key:"fontVariant",get:function get(){return this._fontVariant},set:function set(fontVariant){if(this._fontVariant!==fontVariant){this._fontVariant=fontVariant;this.styleID++}}},{key:"fontWeight",get:function get(){return this._fontWeight},set:function set(fontWeight){if(this._fontWeight!==fontWeight){this._fontWeight=fontWeight;this.styleID++}}},{key:"letterSpacing",get:function get(){return this._letterSpacing},set:function set(letterSpacing){if(this._letterSpacing!==letterSpacing){this._letterSpacing=letterSpacing;this.styleID++}}},{key:"lineHeight",get:function get(){return this._lineHeight},set:function set(lineHeight){if(this._lineHeight!==lineHeight){this._lineHeight=lineHeight;this.styleID++}}},{key:"leading",get:function get(){return this._leading},set:function set(leading){if(this._leading!==leading){this._leading=leading;this.styleID++}}},{key:"lineJoin",get:function get(){return this._lineJoin},set:function set(lineJoin){if(this._lineJoin!==lineJoin){this._lineJoin=lineJoin;this.styleID++}}},{key:"miterLimit",get:function get(){return this._miterLimit},set:function set(miterLimit){if(this._miterLimit!==miterLimit){this._miterLimit=miterLimit;this.styleID++}}},{key:"padding",get:function get(){return this._padding},set:function set(padding){if(this._padding!==padding){this._padding=padding;this.styleID++}}},{key:"stroke",get:function get(){return this._stroke},set:function set(stroke){var outputColor=getColor(stroke);if(this._stroke!==outputColor){this._stroke=outputColor;this.styleID++}}},{key:"strokeThickness",get:function get(){return this._strokeThickness},set:function set(strokeThickness){if(this._strokeThickness!==strokeThickness){this._strokeThickness=strokeThickness;this.styleID++}}},{key:"textBaseline",get:function get(){return this._textBaseline},set:function set(textBaseline){if(this._textBaseline!==textBaseline){this._textBaseline=textBaseline;this.styleID++}}},{key:"trim",get:function get(){return this._trim},set:function set(trim){if(this._trim!==trim){this._trim=trim;this.styleID++}}},{key:"whiteSpace",get:function get(){return this._whiteSpace},set:function set(whiteSpace){if(this._whiteSpace!==whiteSpace){this._whiteSpace=whiteSpace;this.styleID++}}},{key:"wordWrap",get:function get(){return this._wordWrap},set:function set(wordWrap){if(this._wordWrap!==wordWrap){this._wordWrap=wordWrap;this.styleID++}}},{key:"wordWrapWidth",get:function get(){return this._wordWrapWidth},set:function set(wordWrapWidth){if(this._wordWrapWidth!==wordWrapWidth){this._wordWrapWidth=wordWrapWidth;this.styleID++}}}]);return TextStyle}();exports.default=TextStyle;function getSingleColor(color){if(typeof color==="number"){return(0,_utils.hex2string)(color)}else if(typeof color==="string"){if(color.indexOf("0x")===0){color=color.replace("0x","#")}}return color}function getColor(color){if(!Array.isArray(color)){return getSingleColor(color)}else{for(var i=0;i<color.length;++i){color[i]=getSingleColor(color[i])}return color}}function areArraysEqual(array1,array2){if(!Array.isArray(array1)||!Array.isArray(array2)){return false}if(array1.length!==array2.length){return false}for(var i=0;i<array1.length;++i){if(array1[i]!==array2[i]){return false}}return true}function deepCopyProperties(target,source,propertyObj){for(var prop in propertyObj){if(Array.isArray(source[prop])){target[prop]=source[prop].slice()}else{target[prop]=source[prop]}}}},{"../const":91,"../utils":170}],156:[function(require,module,exports){"use strict";exports.__esModule=true;var _BaseTexture2=require("./BaseTexture");var _BaseTexture3=_interopRequireDefault(_BaseTexture2);var _settings=require("../settings");var _settings2=_interopRequireDefault(_settings);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var BaseRenderTexture=function(_BaseTexture){_inherits(BaseRenderTexture,_BaseTexture);function BaseRenderTexture(){var width=arguments.length>0&&arguments[0]!==undefined?arguments[0]:100;var height=arguments.length>1&&arguments[1]!==undefined?arguments[1]:100;var scaleMode=arguments[2];var resolution=arguments[3];_classCallCheck(this,BaseRenderTexture);var _this=_possibleConstructorReturn(this,_BaseTexture.call(this,null,scaleMode));_this.resolution=resolution||_settings2.default.RESOLUTION;_this.width=Math.ceil(width);_this.height=Math.ceil(height);_this.realWidth=_this.width*_this.resolution;_this.realHeight=_this.height*_this.resolution;_this.scaleMode=scaleMode!==undefined?scaleMode:_settings2.default.SCALE_MODE;_this.hasLoaded=true;_this._glRenderTargets={};_this._canvasRenderTarget=null;_this.valid=false;return _this}BaseRenderTexture.prototype.resize=function resize(width,height){width=Math.ceil(width);height=Math.ceil(height);if(width===this.width&&height===this.height){return}this.valid=width>0&&height>0;this.width=width;this.height=height;this.realWidth=this.width*this.resolution;this.realHeight=this.height*this.resolution;if(!this.valid){return}this.emit("update",this)};BaseRenderTexture.prototype.destroy=function destroy(){_BaseTexture.prototype.destroy.call(this,true);this.renderer=null};return BaseRenderTexture}(_BaseTexture3.default);exports.default=BaseRenderTexture},{"../settings":146,"./BaseTexture":157}],157:[function(require,module,exports){"use strict";exports.__esModule=true;var _utils=require("../utils");var _settings=require("../settings");var _settings2=_interopRequireDefault(_settings);var _eventemitter=require("eventemitter3");var _eventemitter2=_interopRequireDefault(_eventemitter);var _determineCrossOrigin=require("../utils/determineCrossOrigin");var _determineCrossOrigin2=_interopRequireDefault(_determineCrossOrigin);var _bitTwiddle=require("bit-twiddle");var _bitTwiddle2=_interopRequireDefault(_bitTwiddle);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var BaseTexture=function(_EventEmitter){_inherits(BaseTexture,_EventEmitter);function BaseTexture(source,scaleMode,resolution){_classCallCheck(this,BaseTexture);var _this=_possibleConstructorReturn(this,_EventEmitter.call(this));_this.uid=(0,_utils.uid)();_this.touched=0;_this.resolution=resolution||_settings2.default.RESOLUTION;_this.width=100;_this.height=100;_this.realWidth=100;_this.realHeight=100;_this.scaleMode=scaleMode!==undefined?scaleMode:_settings2.default.SCALE_MODE;_this.hasLoaded=false;_this.isLoading=false;_this.source=null;_this.origSource=null;_this.imageType=null;_this.sourceScale=1;_this.premultipliedAlpha=true;_this.imageUrl=null;_this.isPowerOfTwo=false;_this.mipmap=_settings2.default.MIPMAP_TEXTURES;_this.wrapMode=_settings2.default.WRAP_MODE;_this._glTextures={};_this._enabled=0;_this._virtalBoundId=-1;_this._destroyed=false;_this.textureCacheIds=[];if(source){_this.loadSource(source)}return _this}BaseTexture.prototype.update=function update(){if(this.imageType!=="svg"){this.realWidth=this.source.naturalWidth||this.source.videoWidth||this.source.width;this.realHeight=this.source.naturalHeight||this.source.videoHeight||this.source.height;this._updateDimensions()}this.emit("update",this)};BaseTexture.prototype._updateDimensions=function _updateDimensions(){this.width=this.realWidth/this.resolution;this.height=this.realHeight/this.resolution;this.isPowerOfTwo=_bitTwiddle2.default.isPow2(this.realWidth)&&_bitTwiddle2.default.isPow2(this.realHeight)};BaseTexture.prototype.loadSource=function loadSource(source){var wasLoading=this.isLoading;this.hasLoaded=false;this.isLoading=false;if(wasLoading&&this.source){this.source.onload=null;this.source.onerror=null}var firstSourceLoaded=!this.source;this.source=source;if((source.src&&source.complete||source.getContext)&&source.width&&source.height){this._updateImageType();if(this.imageType==="svg"){this._loadSvgSource()}else{this._sourceLoaded()}if(firstSourceLoaded){this.emit("loaded",this)}}else if(!source.getContext){this.isLoading=true;var scope=this;source.onload=function(){scope._updateImageType();source.onload=null;source.onerror=null;if(!scope.isLoading){return}scope.isLoading=false;scope._sourceLoaded();if(scope.imageType==="svg"){scope._loadSvgSource();return}scope.emit("loaded",scope)};source.onerror=function(){source.onload=null;source.onerror=null;if(!scope.isLoading){return}scope.isLoading=false;scope.emit("error",scope)};if(source.complete&&source.src){source.onload=null;source.onerror=null;if(scope.imageType==="svg"){scope._loadSvgSource();return}this.isLoading=false;if(source.width&&source.height){this._sourceLoaded();if(wasLoading){this.emit("loaded",this)}}else if(wasLoading){this.emit("error",this)}}}};BaseTexture.prototype._updateImageType=function _updateImageType(){if(!this.imageUrl){return}var dataUri=(0,_utils.decomposeDataUri)(this.imageUrl);var imageType=void 0;if(dataUri&&dataUri.mediaType==="image"){var firstSubType=dataUri.subType.split("+")[0];imageType=(0,_utils.getUrlFileExtension)("."+firstSubType);if(!imageType){throw new Error("Invalid image type in data URI.")}}else{imageType=(0,_utils.getUrlFileExtension)(this.imageUrl);if(!imageType){imageType="png"}}this.imageType=imageType};BaseTexture.prototype._loadSvgSource=function _loadSvgSource(){if(this.imageType!=="svg"){return}var dataUri=(0,_utils.decomposeDataUri)(this.imageUrl);if(dataUri){this._loadSvgSourceUsingDataUri(dataUri)}else{this._loadSvgSourceUsingXhr()}};BaseTexture.prototype._loadSvgSourceUsingDataUri=function _loadSvgSourceUsingDataUri(dataUri){var svgString=void 0;if(dataUri.encoding==="base64"){if(!atob){throw new Error("Your browser doesn't support base64 conversions.")}svgString=atob(dataUri.data)}else{svgString=dataUri.data}this._loadSvgSourceUsingString(svgString)};BaseTexture.prototype._loadSvgSourceUsingXhr=function _loadSvgSourceUsingXhr(){var _this2=this;var svgXhr=new XMLHttpRequest;svgXhr.onload=function(){if(svgXhr.readyState!==svgXhr.DONE||svgXhr.status!==200){throw new Error("Failed to load SVG using XHR.")}_this2._loadSvgSourceUsingString(svgXhr.response)};svgXhr.onerror=function(){return _this2.emit("error",_this2)};svgXhr.open("GET",this.imageUrl,true);svgXhr.send()};BaseTexture.prototype._loadSvgSourceUsingString=function _loadSvgSourceUsingString(svgString){var svgSize=(0,_utils.getSvgSize)(svgString);var svgWidth=svgSize.width;var svgHeight=svgSize.height;if(!svgWidth||!svgHeight){throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.")}this.realWidth=Math.round(svgWidth*this.sourceScale);this.realHeight=Math.round(svgHeight*this.sourceScale);this._updateDimensions();var canvas=document.createElement("canvas");canvas.width=this.realWidth;canvas.height=this.realHeight;canvas._pixiId="canvas_"+(0,_utils.uid)();canvas.getContext("2d").drawImage(this.source,0,0,svgWidth,svgHeight,0,0,this.realWidth,this.realHeight);this.origSource=this.source;this.source=canvas;BaseTexture.addToCache(this,canvas._pixiId);this.isLoading=false;this._sourceLoaded();this.emit("loaded",this)};BaseTexture.prototype._sourceLoaded=function _sourceLoaded(){this.hasLoaded=true;this.update()};BaseTexture.prototype.destroy=function destroy(){if(this.imageUrl){delete _utils.TextureCache[this.imageUrl];this.imageUrl=null;if(!navigator.isCocoonJS){this.source.src=""}}this.source=null;this.dispose();BaseTexture.removeFromCache(this);this.textureCacheIds=null;this._destroyed=true};BaseTexture.prototype.dispose=function dispose(){this.emit("dispose",this)};BaseTexture.prototype.updateSourceImage=function updateSourceImage(newSrc){this.source.src=newSrc;this.loadSource(this.source)};BaseTexture.fromImage=function fromImage(imageUrl,crossorigin,scaleMode,sourceScale){var baseTexture=_utils.BaseTextureCache[imageUrl];if(!baseTexture){var image=new Image;if(crossorigin===undefined&&imageUrl.indexOf("data:")!==0){image.crossOrigin=(0,_determineCrossOrigin2.default)(imageUrl)}else if(crossorigin){image.crossOrigin=typeof crossorigin==="string"?crossorigin:"anonymous"}baseTexture=new BaseTexture(image,scaleMode);baseTexture.imageUrl=imageUrl;if(sourceScale){baseTexture.sourceScale=sourceScale}baseTexture.resolution=(0,_utils.getResolutionOfUrl)(imageUrl);image.src=imageUrl;BaseTexture.addToCache(baseTexture,imageUrl)}return baseTexture};BaseTexture.fromCanvas=function fromCanvas(canvas,scaleMode){var origin=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"canvas";if(!canvas._pixiId){canvas._pixiId=origin+"_"+(0,_utils.uid)()}var baseTexture=_utils.BaseTextureCache[canvas._pixiId];if(!baseTexture){baseTexture=new BaseTexture(canvas,scaleMode);BaseTexture.addToCache(baseTexture,canvas._pixiId)}return baseTexture};BaseTexture.from=function from(source,scaleMode,sourceScale){if(typeof source==="string"){return BaseTexture.fromImage(source,undefined,scaleMode,sourceScale)}else if(source instanceof HTMLImageElement){var imageUrl=source.src;var baseTexture=_utils.BaseTextureCache[imageUrl];if(!baseTexture){baseTexture=new BaseTexture(source,scaleMode);baseTexture.imageUrl=imageUrl;if(sourceScale){baseTexture.sourceScale=sourceScale}baseTexture.resolution=(0,_utils.getResolutionOfUrl)(imageUrl);BaseTexture.addToCache(baseTexture,imageUrl)}return baseTexture}else if(source instanceof HTMLCanvasElement){return BaseTexture.fromCanvas(source,scaleMode)}return source};BaseTexture.addToCache=function addToCache(baseTexture,id){if(id){if(baseTexture.textureCacheIds.indexOf(id)===-1){baseTexture.textureCacheIds.push(id)}if(_utils.BaseTextureCache[id]){console.warn("BaseTexture added to the cache with an id ["+id+"] that already had an entry")}_utils.BaseTextureCache[id]=baseTexture}};BaseTexture.removeFromCache=function removeFromCache(baseTexture){if(typeof baseTexture==="string"){var baseTextureFromCache=_utils.BaseTextureCache[baseTexture];if(baseTextureFromCache){var index=baseTextureFromCache.textureCacheIds.indexOf(baseTexture);if(index>-1){baseTextureFromCache.textureCacheIds.splice(index,1)}delete _utils.BaseTextureCache[baseTexture];return baseTextureFromCache}}else if(baseTexture&&baseTexture.textureCacheIds){for(var i=0;i<baseTexture.textureCacheIds.length;++i){delete _utils.BaseTextureCache[baseTexture.textureCacheIds[i]]}baseTexture.textureCacheIds.length=0;return baseTexture}return null};return BaseTexture}(_eventemitter2.default);exports.default=BaseTexture},{"../settings":146,"../utils":170,"../utils/determineCrossOrigin":169,"bit-twiddle":26,eventemitter3:235}],158:[function(require,module,exports){"use strict";exports.__esModule=true;var _BaseRenderTexture=require("./BaseRenderTexture");var _BaseRenderTexture2=_interopRequireDefault(_BaseRenderTexture);var _Texture2=require("./Texture");var _Texture3=_interopRequireDefault(_Texture2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var RenderTexture=function(_Texture){_inherits(RenderTexture,_Texture);function RenderTexture(baseRenderTexture,frame){_classCallCheck(this,RenderTexture);var _legacyRenderer=null;if(!(baseRenderTexture instanceof _BaseRenderTexture2.default)){var width=arguments[1];var height=arguments[2];var scaleMode=arguments[3];var resolution=arguments[4];console.warn("Please use RenderTexture.create("+width+", "+height+") instead of the ctor directly.");_legacyRenderer=arguments[0];frame=null;baseRenderTexture=new _BaseRenderTexture2.default(width,height,scaleMode,resolution)}var _this=_possibleConstructorReturn(this,_Texture.call(this,baseRenderTexture,frame));_this.legacyRenderer=_legacyRenderer;_this.valid=true;_this._updateUvs();return _this}RenderTexture.prototype.resize=function resize(width,height,doNotResizeBaseTexture){width=Math.ceil(width);height=Math.ceil(height);this.valid=width>0&&height>0;this._frame.width=this.orig.width=width;this._frame.height=this.orig.height=height;if(!doNotResizeBaseTexture){this.baseTexture.resize(width,height)}this._updateUvs()};RenderTexture.create=function create(width,height,scaleMode,resolution){return new RenderTexture(new _BaseRenderTexture2.default(width,height,scaleMode,resolution))};return RenderTexture}(_Texture3.default);exports.default=RenderTexture},{"./BaseRenderTexture":156,"./Texture":160}],159:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _=require("../");var _utils=require("../utils");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Spritesheet=function(){_createClass(Spritesheet,null,[{key:"BATCH_SIZE",get:function get(){return 1e3}}]);function Spritesheet(baseTexture,data){var resolutionFilename=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;_classCallCheck(this,Spritesheet);this.baseTexture=baseTexture;this.textures={};this.animations={};this.data=data;this.resolution=this._updateResolution(resolutionFilename||this.baseTexture.imageUrl);this._frames=this.data.frames;this._frameKeys=Object.keys(this._frames);this._batchIndex=0;this._callback=null}Spritesheet.prototype._updateResolution=function _updateResolution(resolutionFilename){var scale=this.data.meta.scale;var resolution=(0,_utils.getResolutionOfUrl)(resolutionFilename,null);if(resolution===null){resolution=scale!==undefined?parseFloat(scale):1}if(resolution!==1){this.baseTexture.resolution=resolution;this.baseTexture.update()}return resolution};Spritesheet.prototype.parse=function parse(callback){this._batchIndex=0;this._callback=callback;if(this._frameKeys.length<=Spritesheet.BATCH_SIZE){this._processFrames(0);this._processAnimations();this._parseComplete()}else{this._nextBatch()}};Spritesheet.prototype._processFrames=function _processFrames(initialFrameIndex){var frameIndex=initialFrameIndex;var maxFrames=Spritesheet.BATCH_SIZE;var sourceScale=this.baseTexture.sourceScale;while(frameIndex-initialFrameIndex<maxFrames&&frameIndex<this._frameKeys.length){var i=this._frameKeys[frameIndex];var data=this._frames[i];var rect=data.frame;if(rect){var frame=null;var trim=null;var sourceSize=data.trimmed!==false&&data.sourceSize?data.sourceSize:data.frame;var orig=new _.Rectangle(0,0,Math.floor(sourceSize.w*sourceScale)/this.resolution,Math.floor(sourceSize.h*sourceScale)/this.resolution);if(data.rotated){frame=new _.Rectangle(Math.floor(rect.x*sourceScale)/this.resolution,Math.floor(rect.y*sourceScale)/this.resolution,Math.floor(rect.h*sourceScale)/this.resolution,Math.floor(rect.w*sourceScale)/this.resolution)}else{frame=new _.Rectangle(Math.floor(rect.x*sourceScale)/this.resolution,Math.floor(rect.y*sourceScale)/this.resolution,Math.floor(rect.w*sourceScale)/this.resolution,Math.floor(rect.h*sourceScale)/this.resolution)}if(data.trimmed!==false&&data.spriteSourceSize){trim=new _.Rectangle(Math.floor(data.spriteSourceSize.x*sourceScale)/this.resolution,Math.floor(data.spriteSourceSize.y*sourceScale)/this.resolution,Math.floor(rect.w*sourceScale)/this.resolution,Math.floor(rect.h*sourceScale)/this.resolution)}this.textures[i]=new _.Texture(this.baseTexture,frame,orig,trim,data.rotated?2:0,data.anchor);_.Texture.addToCache(this.textures[i],i)}frameIndex++}};Spritesheet.prototype._processAnimations=function _processAnimations(){var animations=this.data.animations||{};for(var animName in animations){this.animations[animName]=[];for(var _iterator=animations[animName],_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{_i=_iterator.next();if(_i.done)break;_ref=_i.value}var frameName=_ref;this.animations[animName].push(this.textures[frameName])}}};Spritesheet.prototype._parseComplete=function _parseComplete(){var callback=this._callback;this._callback=null;this._batchIndex=0;callback.call(this,this.textures)};Spritesheet.prototype._nextBatch=function _nextBatch(){var _this=this;this._processFrames(this._batchIndex*Spritesheet.BATCH_SIZE);this._batchIndex++;setTimeout(function(){if(_this._batchIndex*Spritesheet.BATCH_SIZE<_this._frameKeys.length){_this._nextBatch()}else{_this._processAnimations();_this._parseComplete()}},0)};Spritesheet.prototype.destroy=function destroy(){var destroyBase=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;for(var i in this.textures){this.textures[i].destroy()}this._frames=null;this._frameKeys=null;this.data=null;this.textures=null;if(destroyBase){this.baseTexture.destroy()}this.baseTexture=null};return Spritesheet}();exports.default=Spritesheet},{"../":110,"../utils":170}],160:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _BaseTexture=require("./BaseTexture");var _BaseTexture2=_interopRequireDefault(_BaseTexture);var _VideoBaseTexture=require("./VideoBaseTexture");var _VideoBaseTexture2=_interopRequireDefault(_VideoBaseTexture);var _TextureUvs=require("./TextureUvs");var _TextureUvs2=_interopRequireDefault(_TextureUvs);var _eventemitter=require("eventemitter3");var _eventemitter2=_interopRequireDefault(_eventemitter);var _math=require("../math");var _utils=require("../utils");var _settings=require("../settings");var _settings2=_interopRequireDefault(_settings);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Texture=function(_EventEmitter){_inherits(Texture,_EventEmitter);function Texture(baseTexture,frame,orig,trim,rotate,anchor){_classCallCheck(this,Texture);var _this=_possibleConstructorReturn(this,_EventEmitter.call(this));_this.noFrame=false;if(!frame){_this.noFrame=true;frame=new _math.Rectangle(0,0,1,1)}if(baseTexture instanceof Texture){baseTexture=baseTexture.baseTexture}_this.baseTexture=baseTexture;_this._frame=frame;_this.trim=trim;_this.valid=false;_this.requiresUpdate=false;_this._uvs=null;_this.orig=orig||frame;_this._rotate=Number(rotate||0);if(rotate===true){_this._rotate=2}else if(_this._rotate%2!==0){throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually")}if(baseTexture.hasLoaded){if(_this.noFrame){frame=new _math.Rectangle(0,0,baseTexture.width,baseTexture.height);baseTexture.on("update",_this.onBaseTextureUpdated,_this)}_this.frame=frame}else{baseTexture.once("loaded",_this.onBaseTextureLoaded,_this)}_this.defaultAnchor=anchor?new _math.Point(anchor.x,anchor.y):new _math.Point(0,0);_this._updateID=0;_this.transform=null;_this.textureCacheIds=[];return _this}Texture.prototype.update=function update(){this.baseTexture.update()};Texture.prototype.onBaseTextureLoaded=function onBaseTextureLoaded(baseTexture){this._updateID++;if(this.noFrame){this.frame=new _math.Rectangle(0,0,baseTexture.width,baseTexture.height)}else{this.frame=this._frame}this.baseTexture.on("update",this.onBaseTextureUpdated,this);this.emit("update",this)};Texture.prototype.onBaseTextureUpdated=function onBaseTextureUpdated(baseTexture){this._updateID++;this._frame.width=baseTexture.width;this._frame.height=baseTexture.height;this.emit("update",this)};Texture.prototype.destroy=function destroy(destroyBase){if(this.baseTexture){if(destroyBase){if(_utils.TextureCache[this.baseTexture.imageUrl]){Texture.removeFromCache(this.baseTexture.imageUrl)}this.baseTexture.destroy()}this.baseTexture.off("update",this.onBaseTextureUpdated,this);this.baseTexture.off("loaded",this.onBaseTextureLoaded,this);this.baseTexture=null}this._frame=null;this._uvs=null;this.trim=null;this.orig=null;this.valid=false;Texture.removeFromCache(this);this.textureCacheIds=null};Texture.prototype.clone=function clone(){return new Texture(this.baseTexture,this.frame,this.orig,this.trim,this.rotate,this.defaultAnchor)};Texture.prototype._updateUvs=function _updateUvs(){if(!this._uvs){this._uvs=new _TextureUvs2.default}this._uvs.set(this._frame,this.baseTexture,this.rotate);this._updateID++};Texture.fromImage=function fromImage(imageUrl,crossorigin,scaleMode,sourceScale){var texture=_utils.TextureCache[imageUrl];if(!texture){texture=new Texture(_BaseTexture2.default.fromImage(imageUrl,crossorigin,scaleMode,sourceScale));Texture.addToCache(texture,imageUrl)}return texture};Texture.fromFrame=function fromFrame(frameId){var texture=_utils.TextureCache[frameId];if(!texture){throw new Error('The frameId "'+frameId+'" does not exist in the texture cache')}return texture};Texture.fromCanvas=function fromCanvas(canvas,scaleMode){var origin=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"canvas";return new Texture(_BaseTexture2.default.fromCanvas(canvas,scaleMode,origin))};Texture.fromVideo=function fromVideo(video,scaleMode,crossorigin,autoPlay){if(typeof video==="string"){return Texture.fromVideoUrl(video,scaleMode,crossorigin,autoPlay)}return new Texture(_VideoBaseTexture2.default.fromVideo(video,scaleMode,autoPlay))};Texture.fromVideoUrl=function fromVideoUrl(videoUrl,scaleMode,crossorigin,autoPlay){return new Texture(_VideoBaseTexture2.default.fromUrl(videoUrl,scaleMode,crossorigin,autoPlay))};Texture.from=function from(source){if(typeof source==="string"){var texture=_utils.TextureCache[source];if(!texture){var isVideo=source.match(/\.(mp4|webm|ogg|h264|avi|mov)$/)!==null;if(isVideo){return Texture.fromVideoUrl(source)}return Texture.fromImage(source)}return texture}else if(source instanceof HTMLImageElement){return new Texture(_BaseTexture2.default.from(source))}else if(source instanceof HTMLCanvasElement){return Texture.fromCanvas(source,_settings2.default.SCALE_MODE,"HTMLCanvasElement")}else if(source instanceof HTMLVideoElement){return Texture.fromVideo(source)}else if(source instanceof _BaseTexture2.default){return new Texture(source)}return source};Texture.fromLoader=function fromLoader(source,imageUrl,name){var baseTexture=new _BaseTexture2.default(source,undefined,(0,_utils.getResolutionOfUrl)(imageUrl));var texture=new Texture(baseTexture);baseTexture.imageUrl=imageUrl;if(!name){name=imageUrl}_BaseTexture2.default.addToCache(texture.baseTexture,name);Texture.addToCache(texture,name);if(name!==imageUrl){_BaseTexture2.default.addToCache(texture.baseTexture,imageUrl);Texture.addToCache(texture,imageUrl)}return texture};Texture.addToCache=function addToCache(texture,id){if(id){if(texture.textureCacheIds.indexOf(id)===-1){texture.textureCacheIds.push(id)}if(_utils.TextureCache[id]){console.warn("Texture added to the cache with an id ["+id+"] that already had an entry")}_utils.TextureCache[id]=texture}};Texture.removeFromCache=function removeFromCache(texture){if(typeof texture==="string"){var textureFromCache=_utils.TextureCache[texture];if(textureFromCache){var index=textureFromCache.textureCacheIds.indexOf(texture);if(index>-1){textureFromCache.textureCacheIds.splice(index,1)}delete _utils.TextureCache[texture];return textureFromCache}}else if(texture&&texture.textureCacheIds){for(var i=0;i<texture.textureCacheIds.length;++i){if(_utils.TextureCache[texture.textureCacheIds[i]]===texture){delete _utils.TextureCache[texture.textureCacheIds[i]]}}texture.textureCacheIds.length=0;return texture}return null};_createClass(Texture,[{key:"frame",get:function get(){return this._frame},set:function set(frame){this._frame=frame;this.noFrame=false;var x=frame.x,y=frame.y,width=frame.width,height=frame.height;var xNotFit=x+width>this.baseTexture.width;var yNotFit=y+height>this.baseTexture.height;if(xNotFit||yNotFit){var relationship=xNotFit&&yNotFit?"and":"or";var errorX="X: "+x+" + "+width+" = "+(x+width)+" > "+this.baseTexture.width;var errorY="Y: "+y+" + "+height+" = "+(y+height)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+(errorX+" "+relationship+" "+errorY))}this.valid=width&&height&&this.baseTexture.hasLoaded;if(!this.trim&&!this.rotate){this.orig=frame}if(this.valid){this._updateUvs()}}},{key:"rotate",get:function get(){return this._rotate},set:function set(rotate){this._rotate=rotate;if(this.valid){this._updateUvs()}}},{key:"width",get:function get(){return this.orig.width}},{key:"height",get:function get(){return this.orig.height}}]);return Texture}(_eventemitter2.default);exports.default=Texture;function createWhiteTexture(){var canvas=document.createElement("canvas");canvas.width=10;canvas.height=10;var context=canvas.getContext("2d");context.fillStyle="white";context.fillRect(0,0,10,10);return new Texture(new _BaseTexture2.default(canvas))}function removeAllHandlers(tex){tex.destroy=function _emptyDestroy(){};tex.on=function _emptyOn(){};tex.once=function _emptyOnce(){};tex.emit=function _emptyEmit(){}}Texture.EMPTY=new Texture(new _BaseTexture2.default);removeAllHandlers(Texture.EMPTY);removeAllHandlers(Texture.EMPTY.baseTexture);Texture.WHITE=createWhiteTexture();removeAllHandlers(Texture.WHITE);removeAllHandlers(Texture.WHITE.baseTexture)},{"../math":115,"../settings":146,"../utils":170,"./BaseTexture":157,"./TextureUvs":162,"./VideoBaseTexture":163,eventemitter3:235}],161:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _Matrix=require("../math/Matrix");var _Matrix2=_interopRequireDefault(_Matrix);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var tempMat=new _Matrix2.default;var TextureMatrix=function(){function TextureMatrix(texture,clampMargin){_classCallCheck(this,TextureMatrix);this._texture=texture;this.mapCoord=new _Matrix2.default;this.uClampFrame=new Float32Array(4);this.uClampOffset=new Float32Array(2);this._lastTextureID=-1;this.clampOffset=0;this.clampMargin=typeof clampMargin==="undefined"?.5:clampMargin}TextureMatrix.prototype.multiplyUvs=function multiplyUvs(uvs,out){if(out===undefined){out=uvs}var mat=this.mapCoord;for(var i=0;i<uvs.length;i+=2){var x=uvs[i];var y=uvs[i+1];out[i]=x*mat.a+y*mat.c+mat.tx;out[i+1]=x*mat.b+y*mat.d+mat.ty}return out};TextureMatrix.prototype.update=function update(forceUpdate){var tex=this._texture;if(!tex||!tex.valid){return false}if(!forceUpdate&&this._lastTextureID===tex._updateID){return false}this._lastTextureID=tex._updateID;var uvs=tex._uvs;this.mapCoord.set(uvs.x1-uvs.x0,uvs.y1-uvs.y0,uvs.x3-uvs.x0,uvs.y3-uvs.y0,uvs.x0,uvs.y0);var orig=tex.orig;var trim=tex.trim;if(trim){tempMat.set(orig.width/trim.width,0,0,orig.height/trim.height,-trim.x/trim.width,-trim.y/trim.height);this.mapCoord.append(tempMat)}var texBase=tex.baseTexture;var frame=this.uClampFrame;var margin=this.clampMargin/texBase.resolution;var offset=this.clampOffset;frame[0]=(tex._frame.x+margin+offset)/texBase.width;frame[1]=(tex._frame.y+margin+offset)/texBase.height;frame[2]=(tex._frame.x+tex._frame.width-margin+offset)/texBase.width;frame[3]=(tex._frame.y+tex._frame.height-margin+offset)/texBase.height;this.uClampOffset[0]=offset/texBase.realWidth;this.uClampOffset[1]=offset/texBase.realHeight;return true};_createClass(TextureMatrix,[{key:"texture",get:function get(){return this._texture},set:function set(value){this._texture=value;this._lastTextureID=-1}}]);return TextureMatrix}();exports.default=TextureMatrix},{"../math/Matrix":112}],162:[function(require,module,exports){"use strict";exports.__esModule=true;var _GroupD=require("../math/GroupD8");var _GroupD2=_interopRequireDefault(_GroupD);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var TextureUvs=function(){function TextureUvs(){_classCallCheck(this,TextureUvs);this.x0=0;this.y0=0;this.x1=1;this.y1=0;this.x2=1;this.y2=1;this.x3=0;this.y3=1;this.uvsUint32=new Uint32Array(4)}TextureUvs.prototype.set=function set(frame,baseFrame,rotate){var tw=baseFrame.width;var th=baseFrame.height;if(rotate){var w2=frame.width/2/tw;var h2=frame.height/2/th;var cX=frame.x/tw+w2;var cY=frame.y/th+h2;rotate=_GroupD2.default.add(rotate,_GroupD2.default.NW);this.x0=cX+w2*_GroupD2.default.uX(rotate);this.y0=cY+h2*_GroupD2.default.uY(rotate);rotate=_GroupD2.default.add(rotate,2);this.x1=cX+w2*_GroupD2.default.uX(rotate);this.y1=cY+h2*_GroupD2.default.uY(rotate);rotate=_GroupD2.default.add(rotate,2);this.x2=cX+w2*_GroupD2.default.uX(rotate);this.y2=cY+h2*_GroupD2.default.uY(rotate);rotate=_GroupD2.default.add(rotate,2);this.x3=cX+w2*_GroupD2.default.uX(rotate);this.y3=cY+h2*_GroupD2.default.uY(rotate)}else{this.x0=frame.x/tw;this.y0=frame.y/th;this.x1=(frame.x+frame.width)/tw;this.y1=frame.y/th;this.x2=(frame.x+frame.width)/tw;this.y2=(frame.y+frame.height)/th;this.x3=frame.x/tw;this.y3=(frame.y+frame.height)/th}this.uvsUint32[0]=(Math.round(this.y0*65535)&65535)<<16|Math.round(this.x0*65535)&65535;this.uvsUint32[1]=(Math.round(this.y1*65535)&65535)<<16|Math.round(this.x1*65535)&65535;this.uvsUint32[2]=(Math.round(this.y2*65535)&65535)<<16|Math.round(this.x2*65535)&65535;this.uvsUint32[3]=(Math.round(this.y3*65535)&65535)<<16|Math.round(this.x3*65535)&65535};return TextureUvs}();exports.default=TextureUvs},{"../math/GroupD8":111}],163:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _BaseTexture2=require("./BaseTexture");var _BaseTexture3=_interopRequireDefault(_BaseTexture2);var _utils=require("../utils");var _ticker=require("../ticker");var _const=require("../const");var _determineCrossOrigin=require("../utils/determineCrossOrigin");var _determineCrossOrigin2=_interopRequireDefault(_determineCrossOrigin);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var VideoBaseTexture=function(_BaseTexture){_inherits(VideoBaseTexture,_BaseTexture);function VideoBaseTexture(source,scaleMode){var autoPlay=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;_classCallCheck(this,VideoBaseTexture);if(!source){throw new Error("No video source element specified.")}if((source.readyState===source.HAVE_ENOUGH_DATA||source.readyState===source.HAVE_FUTURE_DATA)&&source.width&&source.height){source.complete=true}var _this=_possibleConstructorReturn(this,_BaseTexture.call(this,source,scaleMode));_this.width=source.videoWidth;_this.height=source.videoHeight;_this._autoUpdate=true;_this._isAutoUpdating=false;_this.autoPlay=autoPlay;_this.update=_this.update.bind(_this);_this._onCanPlay=_this._onCanPlay.bind(_this);source.addEventListener("play",_this._onPlayStart.bind(_this));source.addEventListener("pause",_this._onPlayStop.bind(_this));_this.hasLoaded=false;_this.__loaded=false;if(!_this._isSourceReady()){source.addEventListener("canplay",_this._onCanPlay);source.addEventListener("canplaythrough",_this._onCanPlay)}else{_this._onCanPlay()}return _this}VideoBaseTexture.prototype._isSourcePlaying=function _isSourcePlaying(){var source=this.source;return source.currentTime>0&&source.paused===false&&source.ended===false&&source.readyState>2};VideoBaseTexture.prototype._isSourceReady=function _isSourceReady(){return this.source.readyState===3||this.source.readyState===4};VideoBaseTexture.prototype._onPlayStart=function _onPlayStart(){if(!this.hasLoaded){this._onCanPlay()}if(!this._isAutoUpdating&&this.autoUpdate){_ticker.shared.add(this.update,this,_const.UPDATE_PRIORITY.HIGH);this._isAutoUpdating=true}};VideoBaseTexture.prototype._onPlayStop=function _onPlayStop(){if(this._isAutoUpdating){_ticker.shared.remove(this.update,this);this._isAutoUpdating=false}};VideoBaseTexture.prototype._onCanPlay=function _onCanPlay(){this.hasLoaded=true;if(this.source){this.source.removeEventListener("canplay",this._onCanPlay);this.source.removeEventListener("canplaythrough",this._onCanPlay);this.width=this.source.videoWidth;this.height=this.source.videoHeight;if(!this.__loaded){this.__loaded=true;this.emit("loaded",this)}if(this._isSourcePlaying()){this._onPlayStart()}else if(this.autoPlay){this.source.play()}}};VideoBaseTexture.prototype.destroy=function destroy(){if(this._isAutoUpdating){_ticker.shared.remove(this.update,this)}if(this.source&&this.source._pixiId){_BaseTexture3.default.removeFromCache(this.source._pixiId);delete this.source._pixiId;this.source.pause();this.source.src="";this.source.load()}_BaseTexture.prototype.destroy.call(this)};VideoBaseTexture.fromVideo=function fromVideo(video,scaleMode,autoPlay){if(!video._pixiId){video._pixiId="video_"+(0,_utils.uid)()}var baseTexture=_utils.BaseTextureCache[video._pixiId];if(!baseTexture){baseTexture=new VideoBaseTexture(video,scaleMode,autoPlay);_BaseTexture3.default.addToCache(baseTexture,video._pixiId)}return baseTexture};VideoBaseTexture.fromUrl=function fromUrl(videoSrc,scaleMode,crossorigin,autoPlay){var video=document.createElement("video");video.setAttribute("webkit-playsinline","");video.setAttribute("playsinline","");var url=Array.isArray(videoSrc)?videoSrc[0].src||videoSrc[0]:videoSrc.src||videoSrc;if(crossorigin===undefined&&url.indexOf("data:")!==0){video.crossOrigin=(0,_determineCrossOrigin2.default)(url)}else if(crossorigin){video.crossOrigin=typeof crossorigin==="string"?crossorigin:"anonymous"}if(Array.isArray(videoSrc)){for(var i=0;i<videoSrc.length;++i){video.appendChild(createSource(videoSrc[i].src||videoSrc[i],videoSrc[i].mime))}}else{video.appendChild(createSource(url,videoSrc.mime))}video.load();return VideoBaseTexture.fromVideo(video,scaleMode,autoPlay)};_createClass(VideoBaseTexture,[{key:"autoUpdate",get:function get(){return this._autoUpdate},set:function set(value){if(value!==this._autoUpdate){this._autoUpdate=value;if(!this._autoUpdate&&this._isAutoUpdating){_ticker.shared.remove(this.update,this);this._isAutoUpdating=false}else if(this._autoUpdate&&!this._isAutoUpdating){_ticker.shared.add(this.update,this,_const.UPDATE_PRIORITY.HIGH);this._isAutoUpdating=true}}}}]);return VideoBaseTexture}(_BaseTexture3.default);exports.default=VideoBaseTexture;VideoBaseTexture.fromUrls=VideoBaseTexture.fromUrl;function createSource(path,type){if(!type){var purePath=path.split("?").shift().toLowerCase();type="video/"+purePath.substr(purePath.lastIndexOf(".")+1)}var source=document.createElement("source");source.src=path;source.type=type;return source}},{"../const":91,"../ticker":166,"../utils":170,"../utils/determineCrossOrigin":169,"./BaseTexture":157}],164:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _settings=require("../settings");var _settings2=_interopRequireDefault(_settings);var _const=require("../const");var _TickerListener=require("./TickerListener");var _TickerListener2=_interopRequireDefault(_TickerListener);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Ticker=function(){function Ticker(){var _this=this;_classCallCheck(this,Ticker);this._head=new _TickerListener2.default(null,null,Infinity);this._requestId=null;this._maxElapsedMS=100;this.autoStart=false;this.deltaTime=1;this.elapsedMS=1/_settings2.default.TARGET_FPMS;this.lastTime=-1;this.speed=1;this.started=false;this._tick=function(time){_this._requestId=null;if(_this.started){_this.update(time);if(_this.started&&_this._requestId===null&&_this._head.next){_this._requestId=requestAnimationFrame(_this._tick)}}}}Ticker.prototype._requestIfNeeded=function _requestIfNeeded(){if(this._requestId===null&&this._head.next){this.lastTime=performance.now();this._requestId=requestAnimationFrame(this._tick)}};Ticker.prototype._cancelIfNeeded=function _cancelIfNeeded(){if(this._requestId!==null){cancelAnimationFrame(this._requestId);this._requestId=null}};Ticker.prototype._startIfPossible=function _startIfPossible(){if(this.started){this._requestIfNeeded()}else if(this.autoStart){this.start()}};Ticker.prototype.add=function add(fn,context){var priority=arguments.length>2&&arguments[2]!==undefined?arguments[2]:_const.UPDATE_PRIORITY.NORMAL;return this._addListener(new _TickerListener2.default(fn,context,priority))};Ticker.prototype.addOnce=function addOnce(fn,context){var priority=arguments.length>2&&arguments[2]!==undefined?arguments[2]:_const.UPDATE_PRIORITY.NORMAL;return this._addListener(new _TickerListener2.default(fn,context,priority,true))};Ticker.prototype._addListener=function _addListener(listener){var current=this._head.next;var previous=this._head;if(!current){listener.connect(previous)}else{while(current){if(listener.priority>current.priority){listener.connect(previous);break}previous=current;current=current.next}if(!listener.previous){listener.connect(previous)}}this._startIfPossible();return this};Ticker.prototype.remove=function remove(fn,context){var listener=this._head.next;while(listener){if(listener.match(fn,context)){listener=listener.destroy()}else{listener=listener.next}}if(!this._head.next){this._cancelIfNeeded()}return this};Ticker.prototype.start=function start(){if(!this.started){this.started=true;this._requestIfNeeded()}};Ticker.prototype.stop=function stop(){if(this.started){this.started=false;this._cancelIfNeeded()}};Ticker.prototype.destroy=function destroy(){this.stop();var listener=this._head.next;while(listener){listener=listener.destroy(true)}this._head.destroy();this._head=null};Ticker.prototype.update=function update(){var currentTime=arguments.length>0&&arguments[0]!==undefined?arguments[0]:performance.now();var elapsedMS=void 0;if(currentTime>this.lastTime){elapsedMS=this.elapsedMS=currentTime-this.lastTime;if(elapsedMS>this._maxElapsedMS){elapsedMS=this._maxElapsedMS}this.deltaTime=elapsedMS*_settings2.default.TARGET_FPMS*this.speed;var head=this._head;var listener=head.next;while(listener){listener=listener.emit(this.deltaTime)}if(!head.next){this._cancelIfNeeded()}}else{this.deltaTime=this.elapsedMS=0}this.lastTime=currentTime};_createClass(Ticker,[{key:"FPS",get:function get(){return 1e3/this.elapsedMS}},{key:"minFPS",get:function get(){return 1e3/this._maxElapsedMS},set:function set(fps){var minFPMS=Math.min(Math.max(0,fps)/1e3,_settings2.default.TARGET_FPMS);this._maxElapsedMS=1/minFPMS}}]);return Ticker}();exports.default=Ticker},{"../const":91,"../settings":146,"./TickerListener":165}],165:[function(require,module,exports){"use strict";exports.__esModule=true;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var TickerListener=function(){function TickerListener(fn){var context=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var priority=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var once=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;_classCallCheck(this,TickerListener);this.fn=fn;this.context=context;this.priority=priority;this.once=once;this.next=null;this.previous=null;this._destroyed=false}TickerListener.prototype.match=function match(fn,context){context=context||null;return this.fn===fn&&this.context===context};TickerListener.prototype.emit=function emit(deltaTime){if(this.fn){if(this.context){this.fn.call(this.context,deltaTime)}else{this.fn(deltaTime)}}var redirect=this.next;if(this.once){this.destroy(true)}if(this._destroyed){this.next=null}return redirect};TickerListener.prototype.connect=function connect(previous){this.previous=previous;if(previous.next){previous.next.previous=this}this.next=previous.next;previous.next=this};TickerListener.prototype.destroy=function destroy(){var hard=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this._destroyed=true;this.fn=null;this.context=null;if(this.previous){this.previous.next=this.next}if(this.next){this.next.previous=this.previous}var redirect=this.next;this.next=hard?null:redirect;this.previous=null;return redirect};return TickerListener}();exports.default=TickerListener},{}],166:[function(require,module,exports){"use strict";exports.__esModule=true;exports.Ticker=exports.shared=undefined;var _Ticker=require("./Ticker");var _Ticker2=_interopRequireDefault(_Ticker);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var shared=new _Ticker2.default;shared.autoStart=true;shared.destroy=function(){};exports.shared=shared;exports.Ticker=_Ticker2.default},{"./Ticker":164}],167:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=canUploadSameBuffer;function canUploadSameBuffer(){var ios=!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform);return!ios}},{}],168:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=createIndicesForQuads;function createIndicesForQuads(size){var totalIndices=size*6;var indices=new Uint16Array(totalIndices);for(var i=0,j=0;i<totalIndices;i+=6,j+=4){indices[i+0]=j+0;indices[i+1]=j+1;indices[i+2]=j+2;indices[i+3]=j+0;indices[i+4]=j+2;indices[i+5]=j+3}return indices}},{}],169:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=determineCrossOrigin;var _url2=require("url");var _url3=_interopRequireDefault(_url2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var tempAnchor=void 0;function determineCrossOrigin(url){var loc=arguments.length>1&&arguments[1]!==undefined?arguments[1]:window.location;if(url.indexOf("data:")===0){return""}loc=loc||window.location;if(!tempAnchor){tempAnchor=document.createElement("a")}tempAnchor.href=url;url=_url3.default.parse(tempAnchor.href);var samePort=!url.port&&loc.port===""||url.port===loc.port;if(url.hostname!==loc.hostname||!samePort||url.protocol!==loc.protocol){return"anonymous"}return""}},{url:248}],170:[function(require,module,exports){"use strict";exports.__esModule=true;exports.premultiplyBlendMode=exports.BaseTextureCache=exports.TextureCache=exports.earcut=exports.mixins=exports.pluginTarget=exports.EventEmitter=exports.removeItems=exports.isMobile=undefined;exports.uid=uid;exports.hex2rgb=hex2rgb;exports.hex2string=hex2string;exports.rgb2hex=rgb2hex;exports.getResolutionOfUrl=getResolutionOfUrl;exports.decomposeDataUri=decomposeDataUri;exports.getUrlFileExtension=getUrlFileExtension;exports.getSvgSize=getSvgSize;exports.skipHello=skipHello;exports.sayHello=sayHello;exports.isWebGLSupported=isWebGLSupported;exports.sign=sign;exports.destroyTextureCache=destroyTextureCache;exports.clearTextureCache=clearTextureCache;exports.correctBlendMode=correctBlendMode;exports.premultiplyTint=premultiplyTint;exports.premultiplyRgba=premultiplyRgba;exports.premultiplyTintToRgba=premultiplyTintToRgba;var _const=require("../const");var _settings=require("../settings");var _settings2=_interopRequireDefault(_settings);var _eventemitter=require("eventemitter3");var _eventemitter2=_interopRequireDefault(_eventemitter);var _pluginTarget=require("./pluginTarget");var _pluginTarget2=_interopRequireDefault(_pluginTarget);var _mixin=require("./mixin");var mixins=_interopRequireWildcard(_mixin);var _ismobilejs=require("ismobilejs");var isMobile=_interopRequireWildcard(_ismobilejs);var _removeArrayItems=require("remove-array-items");var _removeArrayItems2=_interopRequireDefault(_removeArrayItems);var _mapPremultipliedBlendModes=require("./mapPremultipliedBlendModes");var _mapPremultipliedBlendModes2=_interopRequireDefault(_mapPremultipliedBlendModes);var _earcut=require("earcut");var _earcut2=_interopRequireDefault(_earcut);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var nextUid=0;var saidHello=false;exports.isMobile=isMobile;exports.removeItems=_removeArrayItems2.default;exports.EventEmitter=_eventemitter2.default;exports.pluginTarget=_pluginTarget2.default;exports.mixins=mixins;exports.earcut=_earcut2.default;function uid(){return++nextUid}function hex2rgb(hex,out){out=out||[];out[0]=(hex>>16&255)/255;out[1]=(hex>>8&255)/255;out[2]=(hex&255)/255;return out}function hex2string(hex){hex=hex.toString(16);hex="000000".substr(0,6-hex.length)+hex;return"#"+hex}function rgb2hex(rgb){return(rgb[0]*255<<16)+(rgb[1]*255<<8)+(rgb[2]*255|0)}function getResolutionOfUrl(url,defaultValue){var resolution=_settings2.default.RETINA_PREFIX.exec(url);if(resolution){return parseFloat(resolution[1])}return defaultValue!==undefined?defaultValue:1}function decomposeDataUri(dataUri){var dataUriMatch=_const.DATA_URI.exec(dataUri);if(dataUriMatch){return{mediaType:dataUriMatch[1]?dataUriMatch[1].toLowerCase():undefined,subType:dataUriMatch[2]?dataUriMatch[2].toLowerCase():undefined,charset:dataUriMatch[3]?dataUriMatch[3].toLowerCase():undefined,encoding:dataUriMatch[4]?dataUriMatch[4].toLowerCase():undefined,data:dataUriMatch[5]}}return undefined}function getUrlFileExtension(url){var extension=_const.URL_FILE_EXTENSION.exec(url);if(extension){return extension[1].toLowerCase()}return undefined}function getSvgSize(svgString){var sizeMatch=_const.SVG_SIZE.exec(svgString);var size={};if(sizeMatch){size[sizeMatch[1]]=Math.round(parseFloat(sizeMatch[3]));size[sizeMatch[5]]=Math.round(parseFloat(sizeMatch[7]))}return size}function skipHello(){saidHello=true}function sayHello(type){if(saidHello){return}if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var args=["\n %c %c %c PixiJS "+_const.VERSION+" -  "+type+"   %c  %c  http://www.pixijs.com/  %c %c %c%c \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];window.console.log.apply(console,args)}else if(window.console){window.console.log("PixiJS "+_const.VERSION+" - "+type+" - http://www.pixijs.com/")}saidHello=true}function isWebGLSupported(){var contextOptions={stencil:true,failIfMajorPerformanceCaveat:true};try{if(!window.WebGLRenderingContext){return false}var canvas=document.createElement("canvas");var gl=canvas.getContext("webgl",contextOptions)||canvas.getContext("experimental-webgl",contextOptions);var success=!!(gl&&gl.getContextAttributes().stencil);if(gl){var loseContext=gl.getExtension("WEBGL_lose_context");if(loseContext){loseContext.loseContext()}}gl=null;return success}catch(e){return false}}function sign(n){if(n===0)return 0;return n<0?-1:1}var TextureCache=exports.TextureCache=Object.create(null);var BaseTextureCache=exports.BaseTextureCache=Object.create(null);function destroyTextureCache(){var key=void 0;for(key in TextureCache){TextureCache[key].destroy()}for(key in BaseTextureCache){BaseTextureCache[key].destroy()}}function clearTextureCache(){var key=void 0;for(key in TextureCache){delete TextureCache[key]}for(key in BaseTextureCache){delete BaseTextureCache[key]}}var premultiplyBlendMode=exports.premultiplyBlendMode=(0,_mapPremultipliedBlendModes2.default)();function correctBlendMode(blendMode,premultiplied){return premultiplyBlendMode[premultiplied?1:0][blendMode]}function premultiplyTint(tint,alpha){if(alpha===1){return(alpha*255<<24)+tint}if(alpha===0){return 0}var R=tint>>16&255;var G=tint>>8&255;var B=tint&255;R=R*alpha+.5|0;G=G*alpha+.5|0;B=B*alpha+.5|0;return(alpha*255<<24)+(R<<16)+(G<<8)+B}function premultiplyRgba(rgb,alpha,out,premultiply){out=out||new Float32Array(4);if(premultiply||premultiply===undefined){out[0]=rgb[0]*alpha;out[1]=rgb[1]*alpha;out[2]=rgb[2]*alpha}else{out[0]=rgb[0];out[1]=rgb[1];out[2]=rgb[2]}out[3]=alpha;return out}function premultiplyTintToRgba(tint,alpha,out,premultiply){out=out||new Float32Array(4);out[0]=(tint>>16&255)/255;out[1]=(tint>>8&255)/255;out[2]=(tint&255)/255;if(premultiply||premultiply===undefined){out[0]*=alpha;out[1]*=alpha;out[2]*=alpha}out[3]=alpha;return out}},{"../const":91,"../settings":146,"./mapPremultipliedBlendModes":171,"./mixin":173,"./pluginTarget":174,earcut:39,eventemitter3:235,ismobilejs:43,"remove-array-items":241}],171:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=mapPremultipliedBlendModes;var _const=require("../const");function mapPremultipliedBlendModes(){var pm=[];var npm=[];for(var i=0;i<32;i++){pm[i]=i;npm[i]=i}pm[_const.BLEND_MODES.NORMAL_NPM]=_const.BLEND_MODES.NORMAL;pm[_const.BLEND_MODES.ADD_NPM]=_const.BLEND_MODES.ADD;pm[_const.BLEND_MODES.SCREEN_NPM]=_const.BLEND_MODES.SCREEN;npm[_const.BLEND_MODES.NORMAL]=_const.BLEND_MODES.NORMAL_NPM;npm[_const.BLEND_MODES.ADD]=_const.BLEND_MODES.ADD_NPM;npm[_const.BLEND_MODES.SCREEN]=_const.BLEND_MODES.SCREEN_NPM;var array=[];array.push(npm);array.push(pm);return array}},{"../const":91}],172:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=maxRecommendedTextures;var _ismobilejs=require("ismobilejs");var _ismobilejs2=_interopRequireDefault(_ismobilejs);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function maxRecommendedTextures(max){if(_ismobilejs2.default.tablet||_ismobilejs2.default.phone){return 4}return max}},{ismobilejs:43}],173:[function(require,module,exports){"use strict";exports.__esModule=true;exports.mixin=mixin;exports.delayMixin=delayMixin;exports.performMixins=performMixins;function mixin(target,source){if(!target||!source)return;var keys=Object.keys(source);for(var i=0;i<keys.length;++i){var propertyName=keys[i];Object.defineProperty(target,propertyName,Object.getOwnPropertyDescriptor(source,propertyName))}}var mixins=[];function delayMixin(target,source){mixins.push(target,source)}function performMixins(){for(var i=0;i<mixins.length;i+=2){mixin(mixins[i],mixins[i+1])}mixins.length=0}},{}],174:[function(require,module,exports){"use strict";exports.__esModule=true;function pluginTarget(obj){obj.__plugins={};obj.registerPlugin=function registerPlugin(pluginName,ctor){obj.__plugins[pluginName]=ctor};obj.prototype.initPlugins=function initPlugins(){this.plugins=this.plugins||{};for(var o in obj.__plugins){this.plugins[o]=new obj.__plugins[o](this)}};obj.prototype.destroyPlugins=function destroyPlugins(){for(var o in this.plugins){this.plugins[o].destroy();this.plugins[o]=null}this.plugins=null}}exports.default={mixin:function mixin(obj){pluginTarget(obj)}}},{}],175:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=trimCanvas;function trimCanvas(canvas){var width=canvas.width;var height=canvas.height;var context=canvas.getContext("2d");var imageData=context.getImageData(0,0,width,height);var pixels=imageData.data;var len=pixels.length;var bound={top:null,left:null,right:null,bottom:null};var data=null;var i=void 0;var x=void 0;var y=void 0;for(i=0;i<len;i+=4){if(pixels[i+3]!==0){x=i/4%width;y=~~(i/4/width);if(bound.top===null){bound.top=y}if(bound.left===null){bound.left=x}else if(x<bound.left){bound.left=x}if(bound.right===null){bound.right=x+1}else if(bound.right<x){bound.right=x+1}if(bound.bottom===null){bound.bottom=y}else if(bound.bottom<y){bound.bottom=y}}}if(bound.top!==null){width=bound.right-bound.left;height=bound.bottom-bound.top+1;data=context.getImageData(bound.left,bound.top,width,height)}return{height:height,width:width,data:data}}},{}],176:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=deprecation;var warnings={};function warn(msg){if(warnings[msg]){return}var stack=(new Error).stack;if(typeof stack==="undefined"){console.warn("Deprecation Warning: ",msg)}else{stack=stack.split("\n").splice(3).join("\n");if(console.groupCollapsed){console.groupCollapsed("%cDeprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",msg);console.warn(stack);console.groupEnd()}else{console.warn("Deprecation Warning: ",msg);console.warn(stack)}}warnings[msg]=true}function deprecation(core){var mesh=core.mesh,particles=core.particles,extras=core.extras,filters=core.filters,prepare=core.prepare,loaders=core.loaders,interaction=core.interaction;Object.defineProperties(core,{SpriteBatch:{get:function get(){throw new ReferenceError("SpriteBatch does not exist any more, "+"please use the new ParticleContainer instead.")}},AssetLoader:{get:function get(){throw new ReferenceError("The loader system was overhauled in PixiJS v3, "+"please see the new PIXI.loaders.Loader class.")}},Stage:{get:function get(){warn("You do not need to use a PIXI Stage any more, you can simply render any container.");return core.Container}},DisplayObjectContainer:{get:function get(){warn("DisplayObjectContainer has been shortened to Container, please use Container from now on.");return core.Container}},Strip:{get:function get(){warn("The Strip class has been renamed to Mesh and moved to mesh.Mesh, please use mesh.Mesh from now on.");return mesh.Mesh}},Rope:{get:function get(){warn("The Rope class has been moved to mesh.Rope, please use mesh.Rope from now on.");return mesh.Rope}},ParticleContainer:{get:function get(){warn("The ParticleContainer class has been moved to particles.ParticleContainer, "+"please use particles.ParticleContainer from now on.");return particles.ParticleContainer}},MovieClip:{get:function get(){warn("The MovieClip class has been moved to extras.AnimatedSprite, please use extras.AnimatedSprite.");return extras.AnimatedSprite}},TilingSprite:{get:function get(){warn("The TilingSprite class has been moved to extras.TilingSprite, "+"please use extras.TilingSprite from now on.");return extras.TilingSprite}},BitmapText:{get:function get(){warn("The BitmapText class has been moved to extras.BitmapText, "+"please use extras.BitmapText from now on.");return extras.BitmapText}},blendModes:{get:function get(){warn("The blendModes has been moved to BLEND_MODES, please use BLEND_MODES from now on.");return core.BLEND_MODES}},scaleModes:{get:function get(){warn("The scaleModes has been moved to SCALE_MODES, please use SCALE_MODES from now on.");return core.SCALE_MODES}},BaseTextureCache:{get:function get(){warn("The BaseTextureCache class has been moved to utils.BaseTextureCache, "+"please use utils.BaseTextureCache from now on.");return core.utils.BaseTextureCache}},TextureCache:{get:function get(){warn("The TextureCache class has been moved to utils.TextureCache, "+"please use utils.TextureCache from now on.");return core.utils.TextureCache}},math:{get:function get(){warn("The math namespace is deprecated, please access members already accessible on PIXI.");return core}},AbstractFilter:{get:function get(){warn("AstractFilter has been renamed to Filter, please use PIXI.Filter");return core.Filter}},TransformManual:{get:function get(){warn("TransformManual has been renamed to TransformBase, please update your pixi-spine");return core.TransformBase}},TARGET_FPMS:{get:function get(){warn("PIXI.TARGET_FPMS has been deprecated, please use PIXI.settings.TARGET_FPMS");return core.settings.TARGET_FPMS},set:function set(value){warn("PIXI.TARGET_FPMS has been deprecated, please use PIXI.settings.TARGET_FPMS");core.settings.TARGET_FPMS=value}},FILTER_RESOLUTION:{get:function get(){warn("PIXI.FILTER_RESOLUTION has been deprecated, please use PIXI.settings.FILTER_RESOLUTION");return core.settings.FILTER_RESOLUTION},set:function set(value){warn("PIXI.FILTER_RESOLUTION has been deprecated, please use PIXI.settings.FILTER_RESOLUTION");core.settings.FILTER_RESOLUTION=value}},RESOLUTION:{get:function get(){warn("PIXI.RESOLUTION has been deprecated, please use PIXI.settings.RESOLUTION");return core.settings.RESOLUTION},set:function set(value){warn("PIXI.RESOLUTION has been deprecated, please use PIXI.settings.RESOLUTION");core.settings.RESOLUTION=value}},MIPMAP_TEXTURES:{get:function get(){warn("PIXI.MIPMAP_TEXTURES has been deprecated, please use PIXI.settings.MIPMAP_TEXTURES");return core.settings.MIPMAP_TEXTURES},set:function set(value){warn("PIXI.MIPMAP_TEXTURES has been deprecated, please use PIXI.settings.MIPMAP_TEXTURES");core.settings.MIPMAP_TEXTURES=value}},SPRITE_BATCH_SIZE:{get:function get(){warn("PIXI.SPRITE_BATCH_SIZE has been deprecated, please use PIXI.settings.SPRITE_BATCH_SIZE");return core.settings.SPRITE_BATCH_SIZE},set:function set(value){warn("PIXI.SPRITE_BATCH_SIZE has been deprecated, please use PIXI.settings.SPRITE_BATCH_SIZE");core.settings.SPRITE_BATCH_SIZE=value}},SPRITE_MAX_TEXTURES:{get:function get(){warn("PIXI.SPRITE_MAX_TEXTURES has been deprecated, please use PIXI.settings.SPRITE_MAX_TEXTURES");return core.settings.SPRITE_MAX_TEXTURES},set:function set(value){warn("PIXI.SPRITE_MAX_TEXTURES has been deprecated, please use PIXI.settings.SPRITE_MAX_TEXTURES");core.settings.SPRITE_MAX_TEXTURES=value}},RETINA_PREFIX:{get:function get(){warn("PIXI.RETINA_PREFIX has been deprecated, please use PIXI.settings.RETINA_PREFIX");return core.settings.RETINA_PREFIX},set:function set(value){warn("PIXI.RETINA_PREFIX has been deprecated, please use PIXI.settings.RETINA_PREFIX");core.settings.RETINA_PREFIX=value}},DEFAULT_RENDER_OPTIONS:{get:function get(){warn("PIXI.DEFAULT_RENDER_OPTIONS has been deprecated, please use PIXI.settings.DEFAULT_RENDER_OPTIONS");return core.settings.RENDER_OPTIONS}}});var defaults=[{parent:"TRANSFORM_MODE",target:"TRANSFORM_MODE"},{parent:"GC_MODES",target:"GC_MODE"},{parent:"WRAP_MODES",target:"WRAP_MODE"},{parent:"SCALE_MODES",target:"SCALE_MODE"},{parent:"PRECISION",target:"PRECISION_FRAGMENT"}];var _loop=function _loop(i){var deprecation=defaults[i];Object.defineProperty(core[deprecation.parent],"DEFAULT",{get:function get(){warn("PIXI."+deprecation.parent+".DEFAULT has been deprecated, "+("please use PIXI.settings."+deprecation.target));return core.settings[deprecation.target]},set:function set(value){warn("PIXI."+deprecation.parent+".DEFAULT has been deprecated, "+("please use PIXI.settings."+deprecation.target));core.settings[deprecation.target]=value}})};for(var i=0;i<defaults.length;i++){_loop(i)}Object.defineProperties(core.settings,{PRECISION:{get:function get(){warn("PIXI.settings.PRECISION has been deprecated, please use PIXI.settings.PRECISION_FRAGMENT");return core.settings.PRECISION_FRAGMENT},set:function set(value){warn("PIXI.settings.PRECISION has been deprecated, please use PIXI.settings.PRECISION_FRAGMENT");core.settings.PRECISION_FRAGMENT=value}}});if(extras.AnimatedSprite){Object.defineProperties(extras,{MovieClip:{get:function get(){warn("The MovieClip class has been renamed to AnimatedSprite, please use AnimatedSprite from now on.");return extras.AnimatedSprite}}})}if(extras){Object.defineProperties(extras,{TextureTransform:{get:function get(){warn("The TextureTransform class has been renamed to TextureMatrix, "+"please use PIXI.TextureMatrix from now on.");return core.TextureMatrix}}})}core.DisplayObject.prototype.generateTexture=function generateTexture(renderer,scaleMode,resolution){warn("generateTexture has moved to the renderer, please use renderer.generateTexture(displayObject)");return renderer.generateTexture(this,scaleMode,resolution)};core.Graphics.prototype.generateTexture=function generateTexture(scaleMode,resolution){warn("graphics generate texture has moved to the renderer. "+"Or to render a graphics to a texture using canvas please use generateCanvasTexture");return this.generateCanvasTexture(scaleMode,resolution)};core.GroupD8.isSwapWidthHeight=function isSwapWidthHeight(rotation){warn("GroupD8.isSwapWidthHeight was renamed to GroupD8.isVertical");return core.GroupD8.isVertical(rotation)};core.RenderTexture.prototype.render=function render(displayObject,matrix,clear,updateTransform){this.legacyRenderer.render(displayObject,this,clear,matrix,!updateTransform);warn("RenderTexture.render is now deprecated, please use renderer.render(displayObject, renderTexture)")};core.RenderTexture.prototype.getImage=function getImage(target){warn("RenderTexture.getImage is now deprecated, please use renderer.extract.image(target)");return this.legacyRenderer.extract.image(target)};core.RenderTexture.prototype.getBase64=function getBase64(target){warn("RenderTexture.getBase64 is now deprecated, please use renderer.extract.base64(target)");return this.legacyRenderer.extract.base64(target)};core.RenderTexture.prototype.getCanvas=function getCanvas(target){warn("RenderTexture.getCanvas is now deprecated, please use renderer.extract.canvas(target)");return this.legacyRenderer.extract.canvas(target)};core.RenderTexture.prototype.getPixels=function getPixels(target){warn("RenderTexture.getPixels is now deprecated, please use renderer.extract.pixels(target)");return this.legacyRenderer.pixels(target)};core.Sprite.prototype.setTexture=function setTexture(texture){this.texture=texture;warn("setTexture is now deprecated, please use the texture property, e.g : sprite.texture = texture;")};if(extras.BitmapText){extras.BitmapText.prototype.setText=function setText(text){this.text=text;warn("setText is now deprecated, please use the text property, e.g : myBitmapText.text = 'my text';")}}core.Text.prototype.setText=function setText(text){this.text=text;warn("setText is now deprecated, please use the text property, e.g : myText.text = 'my text';")};core.Text.calculateFontProperties=function calculateFontProperties(font){warn("Text.calculateFontProperties is now deprecated, please use the TextMetrics.measureFont");return core.TextMetrics.measureFont(font)};Object.defineProperties(core.Text,{fontPropertiesCache:{get:function get(){warn("Text.fontPropertiesCache is deprecated");return core.TextMetrics._fonts}},fontPropertiesCanvas:{get:function get(){warn("Text.fontPropertiesCanvas is deprecated");return core.TextMetrics._canvas}},fontPropertiesContext:{get:function get(){warn("Text.fontPropertiesContext is deprecated");return core.TextMetrics._context}}});core.Text.prototype.setStyle=function setStyle(style){this.style=style;warn("setStyle is now deprecated, please use the style property, e.g : myText.style = style;")};core.Text.prototype.determineFontProperties=function determineFontProperties(fontStyle){warn("determineFontProperties is now deprecated, please use TextMetrics.measureFont method");return core.TextMetrics.measureFont(fontStyle)};core.Text.getFontStyle=function getFontStyle(style){warn("getFontStyle is now deprecated, please use TextStyle.toFontString() instead");style=style||{};if(!(style instanceof core.TextStyle)){style=new core.TextStyle(style)}return style.toFontString()};Object.defineProperties(core.TextStyle.prototype,{font:{get:function get(){warn("text style property 'font' is now deprecated, please use the "+"'fontFamily', 'fontSize', 'fontStyle', 'fontVariant' and 'fontWeight' properties from now on");var fontSizeString=typeof this._fontSize==="number"?this._fontSize+"px":this._fontSize;return this._fontStyle+" "+this._fontVariant+" "+this._fontWeight+" "+fontSizeString+" "+this._fontFamily},set:function set(font){warn("text style property 'font' is now deprecated, please use the "+"'fontFamily','fontSize',fontStyle','fontVariant' and 'fontWeight' properties from now on");if(font.indexOf("italic")>1){this._fontStyle="italic"}else if(font.indexOf("oblique")>-1){this._fontStyle="oblique"}else{this._fontStyle="normal"}if(font.indexOf("small-caps")>-1){this._fontVariant="small-caps"}else{this._fontVariant="normal"}var splits=font.split(" ");var fontSizeIndex=-1;this._fontSize=26;for(var i=0;i<splits.length;++i){if(splits[i].match(/(px|pt|em|%)/)){fontSizeIndex=i;this._fontSize=splits[i];break}}this._fontWeight="normal";for(var _i=0;_i<fontSizeIndex;++_i){if(splits[_i].match(/(bold|bolder|lighter|100|200|300|400|500|600|700|800|900)/)){this._fontWeight=splits[_i];break}}if(fontSizeIndex>-1&&fontSizeIndex<splits.length-1){this._fontFamily="";for(var _i2=fontSizeIndex+1;_i2<splits.length;++_i2){this._fontFamily+=splits[_i2]+" "}this._fontFamily=this._fontFamily.slice(0,-1)}else{this._fontFamily="Arial"}this.styleID++}}});core.Texture.prototype.setFrame=function setFrame(frame){this.frame=frame;warn("setFrame is now deprecated, please use the frame property, e.g: myTexture.frame = frame;")};core.Texture.addTextureToCache=function addTextureToCache(texture,id){core.Texture.addToCache(texture,id);warn("Texture.addTextureToCache is deprecated, please use Texture.addToCache from now on.")};core.Texture.removeTextureFromCache=function removeTextureFromCache(id){warn("Texture.removeTextureFromCache is deprecated, please use Texture.removeFromCache from now on. "+"Be aware that Texture.removeFromCache does not automatically its BaseTexture from the BaseTextureCache. "+"For that, use BaseTexture.removeFromCache");core.BaseTexture.removeFromCache(id);return core.Texture.removeFromCache(id)};Object.defineProperties(filters,{AbstractFilter:{get:function get(){warn("AstractFilter has been renamed to Filter, please use PIXI.Filter");return core.AbstractFilter}},SpriteMaskFilter:{get:function get(){warn("filters.SpriteMaskFilter is an undocumented alias, please use SpriteMaskFilter from now on.");return core.SpriteMaskFilter}},VoidFilter:{get:function get(){warn("VoidFilter has been renamed to AlphaFilter, please use PIXI.filters.AlphaFilter");return filters.AlphaFilter}}});core.utils.uuid=function(){warn("utils.uuid() is deprecated, please use utils.uid() from now on.");return core.utils.uid()};core.utils.canUseNewCanvasBlendModes=function(){warn("utils.canUseNewCanvasBlendModes() is deprecated, please use CanvasTinter.canUseMultiply from now on");return core.CanvasTinter.canUseMultiply};var saidHello=true;Object.defineProperty(core.utils,"_saidHello",{set:function set(bool){if(bool){warn("PIXI.utils._saidHello is deprecated, please use PIXI.utils.skipHello()");this.skipHello()}saidHello=bool},get:function get(){return saidHello}});if(prepare.BasePrepare){prepare.BasePrepare.prototype.register=function register(addHook,uploadHook){warn("renderer.plugins.prepare.register is now deprecated, "+"please use renderer.plugins.prepare.registerFindHook & renderer.plugins.prepare.registerUploadHook");if(addHook){this.registerFindHook(addHook)}if(uploadHook){this.registerUploadHook(uploadHook)}return this}}if(prepare.canvas){Object.defineProperty(prepare.canvas,"UPLOADS_PER_FRAME",{set:function set(){warn("PIXI.CanvasPrepare.UPLOADS_PER_FRAME has been removed. Please set "+"renderer.plugins.prepare.limiter.maxItemsPerFrame on your renderer")},get:function get(){warn("PIXI.CanvasPrepare.UPLOADS_PER_FRAME has been removed. Please use "+"renderer.plugins.prepare.limiter");return NaN}})}if(prepare.webgl){Object.defineProperty(prepare.webgl,"UPLOADS_PER_FRAME",{set:function set(){warn("PIXI.WebGLPrepare.UPLOADS_PER_FRAME has been removed. Please set "+"renderer.plugins.prepare.limiter.maxItemsPerFrame on your renderer")},get:function get(){warn("PIXI.WebGLPrepare.UPLOADS_PER_FRAME has been removed. Please use "+"renderer.plugins.prepare.limiter");return NaN}})}if(loaders.Loader){var Resource=loaders.Resource;var Loader=loaders.Loader;Object.defineProperties(Resource.prototype,{isJson:{get:function get(){warn("The isJson property is deprecated, please use `resource.type === Resource.TYPE.JSON`.");return this.type===Resource.TYPE.JSON}},isXml:{get:function get(){warn("The isXml property is deprecated, please use `resource.type === Resource.TYPE.XML`.");return this.type===Resource.TYPE.XML}},isImage:{get:function get(){warn("The isImage property is deprecated, please use `resource.type === Resource.TYPE.IMAGE`.");return this.type===Resource.TYPE.IMAGE}},isAudio:{get:function get(){warn("The isAudio property is deprecated, please use `resource.type === Resource.TYPE.AUDIO`.");return this.type===Resource.TYPE.AUDIO}},isVideo:{get:function get(){warn("The isVideo property is deprecated, please use `resource.type === Resource.TYPE.VIDEO`.");return this.type===Resource.TYPE.VIDEO}}});Object.defineProperties(Loader.prototype,{before:{get:function get(){warn("The before() method is deprecated, please use pre().");return this.pre}},after:{get:function get(){warn("The after() method is deprecated, please use use().");return this.use}}})}if(interaction.interactiveTarget){Object.defineProperty(interaction.interactiveTarget,"defaultCursor",{set:function set(value){warn("Property defaultCursor has been replaced with 'cursor'. ");this.cursor=value},get:function get(){warn("Property defaultCursor has been replaced with 'cursor'. ");return this.cursor}})}if(interaction.InteractionManager){Object.defineProperty(interaction.InteractionManager,"defaultCursorStyle",{set:function set(value){warn("Property defaultCursorStyle has been replaced with 'cursorStyles.default'. ");this.cursorStyles.default=value},get:function get(){warn("Property defaultCursorStyle has been replaced with 'cursorStyles.default'. ");return this.cursorStyles.default}});Object.defineProperty(interaction.InteractionManager,"currentCursorStyle",{set:function set(value){warn("Property currentCursorStyle has been removed."+"See the currentCursorMode property, which works differently.");this.currentCursorMode=value},get:function get(){warn("Property currentCursorStyle has been removed."+"See the currentCursorMode property, which works differently.");return this.currentCursorMode}})}}},{}],177:[function(require,module,exports){"use strict";exports.__esModule=true;var _core=require("../../core");var core=_interopRequireWildcard(_core);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var TEMP_RECT=new core.Rectangle;var CanvasExtract=function(){function CanvasExtract(renderer){_classCallCheck(this,CanvasExtract);this.renderer=renderer;renderer.extract=this}CanvasExtract.prototype.image=function image(target){var image=new Image;image.src=this.base64(target);return image};CanvasExtract.prototype.base64=function base64(target){return this.canvas(target).toDataURL()};CanvasExtract.prototype.canvas=function canvas(target){var renderer=this.renderer;var context=void 0;var resolution=void 0;var frame=void 0;var renderTexture=void 0;if(target){if(target instanceof core.RenderTexture){renderTexture=target}else{renderTexture=renderer.generateTexture(target)}}if(renderTexture){context=renderTexture.baseTexture._canvasRenderTarget.context;resolution=renderTexture.baseTexture._canvasRenderTarget.resolution;frame=renderTexture.frame}else{context=renderer.rootContext;resolution=renderer.resolution;frame=TEMP_RECT;frame.width=this.renderer.width;frame.height=this.renderer.height}var width=frame.width*resolution;var height=frame.height*resolution;var canvasBuffer=new core.CanvasRenderTarget(width,height,1);var canvasData=context.getImageData(frame.x*resolution,frame.y*resolution,width,height);canvasBuffer.context.putImageData(canvasData,0,0);return canvasBuffer.canvas};CanvasExtract.prototype.pixels=function pixels(target){var renderer=this.renderer;var context=void 0;var resolution=void 0;var frame=void 0;var renderTexture=void 0;if(target){if(target instanceof core.RenderTexture){renderTexture=target}else{renderTexture=renderer.generateTexture(target)}}if(renderTexture){context=renderTexture.baseTexture._canvasRenderTarget.context;resolution=renderTexture.baseTexture._canvasRenderTarget.resolution;frame=renderTexture.frame}else{context=renderer.rootContext;frame=TEMP_RECT;frame.width=renderer.width;frame.height=renderer.height}return context.getImageData(0,0,frame.width*resolution,frame.height*resolution).data};CanvasExtract.prototype.destroy=function destroy(){this.renderer.extract=null;this.renderer=null};return CanvasExtract}();exports.default=CanvasExtract;core.CanvasRenderer.registerPlugin("extract",CanvasExtract)},{"../../core":110}],178:[function(require,module,exports){"use strict";exports.__esModule=true;var _WebGLExtract=require("./webgl/WebGLExtract");Object.defineProperty(exports,"webgl",{enumerable:true,get:function get(){return _interopRequireDefault(_WebGLExtract).default}});var _CanvasExtract=require("./canvas/CanvasExtract");Object.defineProperty(exports,"canvas",{enumerable:true,get:function get(){return _interopRequireDefault(_CanvasExtract).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./canvas/CanvasExtract":177,"./webgl/WebGLExtract":179}],179:[function(require,module,exports){"use strict";exports.__esModule=true;var _core=require("../../core");var core=_interopRequireWildcard(_core);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var TEMP_RECT=new core.Rectangle;var BYTES_PER_PIXEL=4;var WebGLExtract=function(){function WebGLExtract(renderer){_classCallCheck(this,WebGLExtract);this.renderer=renderer;renderer.extract=this}WebGLExtract.prototype.image=function image(target){var image=new Image;image.src=this.base64(target);return image};WebGLExtract.prototype.base64=function base64(target){return this.canvas(target).toDataURL()};WebGLExtract.prototype.canvas=function canvas(target){var renderer=this.renderer;var textureBuffer=void 0;var resolution=void 0;var frame=void 0;var flipY=false;var renderTexture=void 0;var generated=false;if(target){if(target instanceof core.RenderTexture){renderTexture=target}else{renderTexture=this.renderer.generateTexture(target);generated=true}}if(renderTexture){textureBuffer=renderTexture.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID];resolution=textureBuffer.resolution;frame=renderTexture.frame;flipY=false}else{textureBuffer=this.renderer.rootRenderTarget;resolution=textureBuffer.resolution;flipY=true;frame=TEMP_RECT;frame.width=textureBuffer.size.width;frame.height=textureBuffer.size.height}var width=frame.width*resolution;var height=frame.height*resolution;var canvasBuffer=new core.CanvasRenderTarget(width,height,1);if(textureBuffer){renderer.bindRenderTarget(textureBuffer);var webglPixels=new Uint8Array(BYTES_PER_PIXEL*width*height);var gl=renderer.gl;gl.readPixels(frame.x*resolution,frame.y*resolution,width,height,gl.RGBA,gl.UNSIGNED_BYTE,webglPixels);var canvasData=canvasBuffer.context.getImageData(0,0,width,height);canvasData.data.set(webglPixels);canvasBuffer.context.putImageData(canvasData,0,0);if(flipY){canvasBuffer.context.scale(1,-1);canvasBuffer.context.drawImage(canvasBuffer.canvas,0,-height)}}if(generated){renderTexture.destroy(true)}return canvasBuffer.canvas};WebGLExtract.prototype.pixels=function pixels(target){var renderer=this.renderer;var textureBuffer=void 0;var resolution=void 0;var frame=void 0;var renderTexture=void 0;var generated=false;if(target){if(target instanceof core.RenderTexture){renderTexture=target}else{renderTexture=this.renderer.generateTexture(target);generated=true}}if(renderTexture){textureBuffer=renderTexture.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID];resolution=textureBuffer.resolution;frame=renderTexture.frame}else{textureBuffer=this.renderer.rootRenderTarget;resolution=textureBuffer.resolution;frame=TEMP_RECT;frame.width=textureBuffer.size.width;frame.height=textureBuffer.size.height}var width=frame.width*resolution;var height=frame.height*resolution;var webglPixels=new Uint8Array(BYTES_PER_PIXEL*width*height);if(textureBuffer){renderer.bindRenderTarget(textureBuffer);var gl=renderer.gl;gl.readPixels(frame.x*resolution,frame.y*resolution,width,height,gl.RGBA,gl.UNSIGNED_BYTE,webglPixels)}if(generated){renderTexture.destroy(true)}return webglPixels};WebGLExtract.prototype.destroy=function destroy(){this.renderer.extract=null;this.renderer=null};return WebGLExtract}();exports.default=WebGLExtract;core.WebGLRenderer.registerPlugin("extract",WebGLExtract)},{"../../core":110}],180:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../core");var core=_interopRequireWildcard(_core);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var AnimatedSprite=function(_core$Sprite){_inherits(AnimatedSprite,_core$Sprite);function AnimatedSprite(textures,autoUpdate){_classCallCheck(this,AnimatedSprite);var _this=_possibleConstructorReturn(this,_core$Sprite.call(this,textures[0]instanceof core.Texture?textures[0]:textures[0].texture));_this._textures=null;_this._durations=null;_this.textures=textures;_this._autoUpdate=autoUpdate!==false;_this.animationSpeed=1;_this.loop=true;_this.updateAnchor=false;_this.onComplete=null;_this.onFrameChange=null;_this.onLoop=null;_this._currentTime=0;_this.playing=false;return _this}AnimatedSprite.prototype.stop=function stop(){if(!this.playing){return}this.playing=false;if(this._autoUpdate){core.ticker.shared.remove(this.update,this)}};AnimatedSprite.prototype.play=function play(){if(this.playing){return}this.playing=true;if(this._autoUpdate){core.ticker.shared.add(this.update,this,core.UPDATE_PRIORITY.HIGH)}};AnimatedSprite.prototype.gotoAndStop=function gotoAndStop(frameNumber){this.stop();var previousFrame=this.currentFrame;this._currentTime=frameNumber;if(previousFrame!==this.currentFrame){this.updateTexture()}};AnimatedSprite.prototype.gotoAndPlay=function gotoAndPlay(frameNumber){var previousFrame=this.currentFrame;this._currentTime=frameNumber;if(previousFrame!==this.currentFrame){this.updateTexture()}this.play()};AnimatedSprite.prototype.update=function update(deltaTime){var elapsed=this.animationSpeed*deltaTime;var previousFrame=this.currentFrame;if(this._durations!==null){var lag=this._currentTime%1*this._durations[this.currentFrame];lag+=elapsed/60*1e3;while(lag<0){this._currentTime--;lag+=this._durations[this.currentFrame]}var sign=Math.sign(this.animationSpeed*deltaTime);this._currentTime=Math.floor(this._currentTime);while(lag>=this._durations[this.currentFrame]){lag-=this._durations[this.currentFrame]*sign;this._currentTime+=sign}this._currentTime+=lag/this._durations[this.currentFrame]}else{this._currentTime+=elapsed}if(this._currentTime<0&&!this.loop){this.gotoAndStop(0);if(this.onComplete){this.onComplete()}}else if(this._currentTime>=this._textures.length&&!this.loop){this.gotoAndStop(this._textures.length-1);if(this.onComplete){this.onComplete()}}else if(previousFrame!==this.currentFrame){if(this.loop&&this.onLoop){if(this.animationSpeed>0&&this.currentFrame<previousFrame){this.onLoop()}else if(this.animationSpeed<0&&this.currentFrame>previousFrame){this.onLoop()}}this.updateTexture()}};AnimatedSprite.prototype.updateTexture=function updateTexture(){this._texture=this._textures[this.currentFrame];this._textureID=-1;this.cachedTint=16777215;if(this.updateAnchor){this._anchor.copy(this._texture.defaultAnchor)}if(this.onFrameChange){this.onFrameChange(this.currentFrame)}};AnimatedSprite.prototype.destroy=function destroy(options){this.stop();_core$Sprite.prototype.destroy.call(this,options)};AnimatedSprite.fromFrames=function fromFrames(frames){var textures=[];for(var i=0;i<frames.length;++i){textures.push(core.Texture.fromFrame(frames[i]))}return new AnimatedSprite(textures)};AnimatedSprite.fromImages=function fromImages(images){var textures=[];for(var i=0;i<images.length;++i){textures.push(core.Texture.fromImage(images[i]))}return new AnimatedSprite(textures)};_createClass(AnimatedSprite,[{key:"totalFrames",get:function get(){return this._textures.length}},{key:"textures",get:function get(){return this._textures},set:function set(value){if(value[0]instanceof core.Texture){this._textures=value;this._durations=null}else{this._textures=[];this._durations=[];for(var i=0;i<value.length;i++){this._textures.push(value[i].texture);this._durations.push(value[i].time)}}this.gotoAndStop(0);this.updateTexture()}},{key:"currentFrame",get:function get(){var currentFrame=Math.floor(this._currentTime)%this._textures.length;if(currentFrame<0){currentFrame+=this._textures.length}return currentFrame}}]);return AnimatedSprite}(core.Sprite);exports.default=AnimatedSprite},{"../core":110}],181:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../core");var core=_interopRequireWildcard(_core);var _ObservablePoint=require("../core/math/ObservablePoint");var _ObservablePoint2=_interopRequireDefault(_ObservablePoint);var _utils=require("../core/utils");var _settings=require("../core/settings");var _settings2=_interopRequireDefault(_settings);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var BitmapText=function(_core$Container){_inherits(BitmapText,_core$Container);function BitmapText(text){var style=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,BitmapText);var _this=_possibleConstructorReturn(this,_core$Container.call(this));_this._textWidth=0;_this._textHeight=0;_this._glyphs=[];_this._font={tint:style.tint!==undefined?style.tint:16777215,align:style.align||"left",name:null,size:0};_this.font=style.font;_this._text=text;_this._maxWidth=0;_this._maxLineHeight=0;_this._letterSpacing=0;_this._anchor=new _ObservablePoint2.default(function(){_this.dirty=true},_this,0,0);_this.dirty=false;_this.updateText();return _this}BitmapText.prototype.updateText=function updateText(){var data=BitmapText.fonts[this._font.name];var scale=this._font.size/data.size;var pos=new core.Point;var chars=[];var lineWidths=[];var text=this.text.replace(/(?:\r\n|\r)/g,"\n");var textLength=text.length;var maxWidth=this._maxWidth*data.size/this._font.size;var prevCharCode=null;var lastLineWidth=0;var maxLineWidth=0;var line=0;var lastBreakPos=-1;var lastBreakWidth=0;var spacesRemoved=0;var maxLineHeight=0;for(var i=0;i<textLength;i++){var charCode=text.charCodeAt(i);var char=text.charAt(i);if(/(?:\s)/.test(char)){lastBreakPos=i;lastBreakWidth=lastLineWidth}if(char==="\r"||char==="\n"){lineWidths.push(lastLineWidth);maxLineWidth=Math.max(maxLineWidth,lastLineWidth);++line;++spacesRemoved;pos.x=0;pos.y+=data.lineHeight;prevCharCode=null;continue}var charData=data.chars[charCode];if(!charData){continue}if(prevCharCode&&charData.kerning[prevCharCode]){pos.x+=charData.kerning[prevCharCode]}chars.push({texture:charData.texture,line:line,charCode:charCode,position:new core.Point(pos.x+charData.xOffset+this._letterSpacing/2,pos.y+charData.yOffset)});pos.x+=charData.xAdvance+this._letterSpacing;lastLineWidth=pos.x;maxLineHeight=Math.max(maxLineHeight,charData.yOffset+charData.texture.height);prevCharCode=charCode;if(lastBreakPos!==-1&&maxWidth>0&&pos.x>maxWidth){++spacesRemoved;core.utils.removeItems(chars,1+lastBreakPos-spacesRemoved,1+i-lastBreakPos);i=lastBreakPos;lastBreakPos=-1;lineWidths.push(lastBreakWidth);maxLineWidth=Math.max(maxLineWidth,lastBreakWidth);line++;pos.x=0;pos.y+=data.lineHeight;prevCharCode=null}}var lastChar=text.charAt(text.length-1);if(lastChar!=="\r"&&lastChar!=="\n"){if(/(?:\s)/.test(lastChar)){lastLineWidth=lastBreakWidth}lineWidths.push(lastLineWidth);maxLineWidth=Math.max(maxLineWidth,lastLineWidth)}var lineAlignOffsets=[];for(var _i=0;_i<=line;_i++){var alignOffset=0;if(this._font.align==="right"){alignOffset=maxLineWidth-lineWidths[_i]}else if(this._font.align==="center"){alignOffset=(maxLineWidth-lineWidths[_i])/2}lineAlignOffsets.push(alignOffset)}var lenChars=chars.length;var tint=this.tint;for(var _i2=0;_i2<lenChars;_i2++){var c=this._glyphs[_i2];if(c){c.texture=chars[_i2].texture}else{c=new core.Sprite(chars[_i2].texture);this._glyphs.push(c)}c.position.x=(chars[_i2].position.x+lineAlignOffsets[chars[_i2].line])*scale;c.position.y=chars[_i2].position.y*scale;c.scale.x=c.scale.y=scale;c.tint=tint;if(!c.parent){this.addChild(c)}}for(var _i3=lenChars;_i3<this._glyphs.length;++_i3){this.removeChild(this._glyphs[_i3])}this._textWidth=maxLineWidth*scale;this._textHeight=(pos.y+data.lineHeight)*scale;if(this.anchor.x!==0||this.anchor.y!==0){for(var _i4=0;_i4<lenChars;_i4++){this._glyphs[_i4].x-=this._textWidth*this.anchor.x;this._glyphs[_i4].y-=this._textHeight*this.anchor.y}}this._maxLineHeight=maxLineHeight*scale};BitmapText.prototype.updateTransform=function updateTransform(){this.validate();this.containerUpdateTransform()};BitmapText.prototype.getLocalBounds=function getLocalBounds(){this.validate();return _core$Container.prototype.getLocalBounds.call(this)};BitmapText.prototype.validate=function validate(){if(this.dirty){this.updateText();this.dirty=false}};BitmapText.registerFont=function registerFont(xml,textures){var data={};var info=xml.getElementsByTagName("info")[0];var common=xml.getElementsByTagName("common")[0];var pages=xml.getElementsByTagName("page");var res=(0,_utils.getResolutionOfUrl)(pages[0].getAttribute("file"),_settings2.default.RESOLUTION);var pagesTextures={};data.font=info.getAttribute("face");data.size=parseInt(info.getAttribute("size"),10);data.lineHeight=parseInt(common.getAttribute("lineHeight"),10)/res;data.chars={};if(textures instanceof core.Texture){textures=[textures]}for(var i=0;i<pages.length;i++){var id=pages[i].getAttribute("id");var file=pages[i].getAttribute("file");pagesTextures[id]=textures instanceof Array?textures[i]:textures[file]}var letters=xml.getElementsByTagName("char");for(var _i5=0;_i5<letters.length;_i5++){var letter=letters[_i5];var charCode=parseInt(letter.getAttribute("id"),10);var page=letter.getAttribute("page")||0;var textureRect=new core.Rectangle(parseInt(letter.getAttribute("x"),10)/res+pagesTextures[page].frame.x/res,parseInt(letter.getAttribute("y"),10)/res+pagesTextures[page].frame.y/res,parseInt(letter.getAttribute("width"),10)/res,parseInt(letter.getAttribute("height"),10)/res);data.chars[charCode]={xOffset:parseInt(letter.getAttribute("xoffset"),10)/res,yOffset:parseInt(letter.getAttribute("yoffset"),10)/res,xAdvance:parseInt(letter.getAttribute("xadvance"),10)/res,kerning:{},texture:new core.Texture(pagesTextures[page].baseTexture,textureRect),page:page}}var kernings=xml.getElementsByTagName("kerning");for(var _i6=0;_i6<kernings.length;_i6++){var kerning=kernings[_i6];var first=parseInt(kerning.getAttribute("first"),10)/res;var second=parseInt(kerning.getAttribute("second"),10)/res;var amount=parseInt(kerning.getAttribute("amount"),10)/res;if(data.chars[second]){data.chars[second].kerning[first]=amount}}BitmapText.fonts[data.font]=data;return data};_createClass(BitmapText,[{key:"tint",get:function get(){return this._font.tint},set:function set(value){this._font.tint=typeof value==="number"&&value>=0?value:16777215;this.dirty=true}},{key:"align",get:function get(){return this._font.align},set:function set(value){this._font.align=value||"left";this.dirty=true}},{key:"anchor",get:function get(){return this._anchor},set:function set(value){if(typeof value==="number"){this._anchor.set(value)}else{this._anchor.copy(value)}}},{key:"font",get:function get(){return this._font},set:function set(value){if(!value){return}if(typeof value==="string"){value=value.split(" ");this._font.name=value.length===1?value[0]:value.slice(1).join(" ");this._font.size=value.length>=2?parseInt(value[0],10):BitmapText.fonts[this._font.name].size}else{this._font.name=value.name;this._font.size=typeof value.size==="number"?value.size:parseInt(value.size,10)}this.dirty=true}},{key:"text",get:function get(){return this._text},set:function set(value){value=value.toString()||" ";if(this._text===value){return}this._text=value;this.dirty=true}},{key:"maxWidth",get:function get(){return this._maxWidth},set:function set(value){if(this._maxWidth===value){return}this._maxWidth=value;this.dirty=true}},{key:"maxLineHeight",get:function get(){this.validate();return this._maxLineHeight}},{key:"textWidth",get:function get(){this.validate();return this._textWidth}},{key:"letterSpacing",get:function get(){return this._letterSpacing},set:function set(value){if(this._letterSpacing!==value){this._letterSpacing=value;this.dirty=true}}},{key:"textHeight",get:function get(){this.validate();return this._textHeight}}]);return BitmapText}(core.Container);exports.default=BitmapText;BitmapText.fonts={}},{"../core":110,"../core/math/ObservablePoint":113,"../core/settings":146,"../core/utils":170}],182:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../core");var core=_interopRequireWildcard(_core);var _CanvasTinter=require("../core/sprites/canvas/CanvasTinter");var _CanvasTinter2=_interopRequireDefault(_CanvasTinter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var tempPoint=new core.Point;var TilingSprite=function(_core$Sprite){_inherits(TilingSprite,_core$Sprite);function TilingSprite(texture){var width=arguments.length>1&&arguments[1]!==undefined?arguments[1]:100;var height=arguments.length>2&&arguments[2]!==undefined?arguments[2]:100;_classCallCheck(this,TilingSprite);var _this=_possibleConstructorReturn(this,_core$Sprite.call(this,texture));_this.tileTransform=new core.TransformStatic;_this._width=width;_this._height=height;_this._canvasPattern=null;_this.uvTransform=texture.transform||new core.TextureMatrix(texture);_this.pluginName="tilingSprite";_this.uvRespectAnchor=false;return _this}TilingSprite.prototype._onTextureUpdate=function _onTextureUpdate(){if(this.uvTransform){this.uvTransform.texture=this._texture}this.cachedTint=16777215};TilingSprite.prototype._renderWebGL=function _renderWebGL(renderer){var texture=this._texture;if(!texture||!texture.valid){return}this.tileTransform.updateLocalTransform();this.uvTransform.update();renderer.setObjectRenderer(renderer.plugins[this.pluginName]);renderer.plugins[this.pluginName].render(this)};TilingSprite.prototype._renderCanvas=function _renderCanvas(renderer){var texture=this._texture;if(!texture.baseTexture.hasLoaded){return}var context=renderer.context;var transform=this.worldTransform;var resolution=renderer.resolution;var isTextureRotated=texture.rotate===2;var baseTexture=texture.baseTexture;var baseTextureResolution=baseTexture.resolution;var modX=this.tilePosition.x/this.tileScale.x%texture.orig.width*baseTextureResolution;var modY=this.tilePosition.y/this.tileScale.y%texture.orig.height*baseTextureResolution;if(this._textureID!==this._texture._updateID||this.cachedTint!==this.tint){this._textureID=this._texture._updateID;var tempCanvas=new core.CanvasRenderTarget(texture.orig.width,texture.orig.height,baseTextureResolution);if(this.tint!==16777215){this.tintedTexture=_CanvasTinter2.default.getTintedTexture(this,this.tint);tempCanvas.context.drawImage(this.tintedTexture,0,0)}else{var sx=texture._frame.x*baseTextureResolution;var sy=texture._frame.y*baseTextureResolution;var sWidth=texture._frame.width*baseTextureResolution;var sHeight=texture._frame.height*baseTextureResolution;var dWidth=(texture.trim?texture.trim.width:texture.orig.width)*baseTextureResolution;var dHeight=(texture.trim?texture.trim.height:texture.orig.height)*baseTextureResolution;var dx=(texture.trim?texture.trim.x:0)*baseTextureResolution;var dy=(texture.trim?texture.trim.y:0)*baseTextureResolution;if(isTextureRotated){tempCanvas.context.rotate(-Math.PI/2);tempCanvas.context.translate(-dHeight,0);tempCanvas.context.drawImage(baseTexture.source,sx,sy,sWidth,sHeight,-dy,dx,dHeight,dWidth)}else{tempCanvas.context.drawImage(baseTexture.source,sx,sy,sWidth,sHeight,dx,dy,dWidth,dHeight)}}this.cachedTint=this.tint;this._canvasPattern=tempCanvas.context.createPattern(tempCanvas.canvas,"repeat")}context.globalAlpha=this.worldAlpha;context.setTransform(transform.a*resolution,transform.b*resolution,transform.c*resolution,transform.d*resolution,transform.tx*resolution,transform.ty*resolution);renderer.setBlendMode(this.blendMode);context.fillStyle=this._canvasPattern;context.scale(this.tileScale.x/baseTextureResolution,this.tileScale.y/baseTextureResolution);var anchorX=this.anchor.x*-this._width*baseTextureResolution;var anchorY=this.anchor.y*-this._height*baseTextureResolution;if(this.uvRespectAnchor){context.translate(modX,modY);context.fillRect(-modX+anchorX,-modY+anchorY,this._width/this.tileScale.x*baseTextureResolution,this._height/this.tileScale.y*baseTextureResolution)}else{context.translate(modX+anchorX,modY+anchorY);context.fillRect(-modX,-modY,this._width/this.tileScale.x*baseTextureResolution,this._height/this.tileScale.y*baseTextureResolution)}};TilingSprite.prototype._calculateBounds=function _calculateBounds(){var minX=this._width*-this._anchor._x;var minY=this._height*-this._anchor._y;var maxX=this._width*(1-this._anchor._x);var maxY=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,minX,minY,maxX,maxY)};TilingSprite.prototype.getLocalBounds=function getLocalBounds(rect){if(this.children.length===0){this._bounds.minX=this._width*-this._anchor._x;this._bounds.minY=this._height*-this._anchor._y;this._bounds.maxX=this._width*(1-this._anchor._x);this._bounds.maxY=this._height*(1-this._anchor._y);if(!rect){if(!this._localBoundsRect){this._localBoundsRect=new core.Rectangle}rect=this._localBoundsRect}return this._bounds.getRectangle(rect)}return _core$Sprite.prototype.getLocalBounds.call(this,rect)};TilingSprite.prototype.containsPoint=function containsPoint(point){this.worldTransform.applyInverse(point,tempPoint);var width=this._width;var height=this._height;var x1=-width*this.anchor._x;if(tempPoint.x>=x1&&tempPoint.x<x1+width){var y1=-height*this.anchor._y;if(tempPoint.y>=y1&&tempPoint.y<y1+height){return true}}return false};TilingSprite.prototype.destroy=function destroy(options){_core$Sprite.prototype.destroy.call(this,options);this.tileTransform=null;this.uvTransform=null};TilingSprite.from=function from(source,width,height){return new TilingSprite(core.Texture.from(source),width,height)};TilingSprite.fromFrame=function fromFrame(frameId,width,height){var texture=core.utils.TextureCache[frameId];if(!texture){throw new Error('The frameId "'+frameId+'" does not exist in the texture cache '+this)}return new TilingSprite(texture,width,height)};TilingSprite.fromImage=function fromImage(imageId,width,height,crossorigin,scaleMode){return new TilingSprite(core.Texture.fromImage(imageId,crossorigin,scaleMode),width,height)};_createClass(TilingSprite,[{key:"clampMargin",get:function get(){return this.uvTransform.clampMargin},set:function set(value){this.uvTransform.clampMargin=value;this.uvTransform.update(true)}},{key:"tileScale",get:function get(){return this.tileTransform.scale},set:function set(value){this.tileTransform.scale.copy(value)}},{key:"tilePosition",get:function get(){return this.tileTransform.position},set:function set(value){this.tileTransform.position.copy(value)}},{key:"width",get:function get(){return this._width},set:function set(value){this._width=value}},{key:"height",get:function get(){return this._height},set:function set(value){this._height=value}}]);return TilingSprite}(core.Sprite);exports.default=TilingSprite},{"../core":110,"../core/sprites/canvas/CanvasTinter":149}],183:[function(require,module,exports){"use strict";var _core=require("../core");var core=_interopRequireWildcard(_core);var _Texture=require("../core/textures/Texture");var _Texture2=_interopRequireDefault(_Texture);var _BaseTexture=require("../core/textures/BaseTexture");var _BaseTexture2=_interopRequireDefault(_BaseTexture);var _utils=require("../core/utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var DisplayObject=core.DisplayObject;var _tempMatrix=new core.Matrix;DisplayObject.prototype._cacheAsBitmap=false;DisplayObject.prototype._cacheData=false;var CacheData=function CacheData(){_classCallCheck(this,CacheData);this.textureCacheId=null;this.originalRenderWebGL=null;this.originalRenderCanvas=null;this.originalCalculateBounds=null;this.originalGetLocalBounds=null;this.originalUpdateTransform=null;this.originalHitTest=null;this.originalDestroy=null;this.originalMask=null;this.originalFilterArea=null;this.sprite=null};Object.defineProperties(DisplayObject.prototype,{cacheAsBitmap:{get:function get(){return this._cacheAsBitmap},set:function set(value){if(this._cacheAsBitmap===value){return}this._cacheAsBitmap=value;var data=void 0;if(value){if(!this._cacheData){this._cacheData=new CacheData}data=this._cacheData;data.originalRenderWebGL=this.renderWebGL;data.originalRenderCanvas=this.renderCanvas;data.originalUpdateTransform=this.updateTransform;data.originalCalculateBounds=this.calculateBounds;data.originalGetLocalBounds=this.getLocalBounds;data.originalDestroy=this.destroy;data.originalContainsPoint=this.containsPoint;data.originalMask=this._mask;data.originalFilterArea=this.filterArea;this.renderWebGL=this._renderCachedWebGL;this.renderCanvas=this._renderCachedCanvas;this.destroy=this._cacheAsBitmapDestroy}else{data=this._cacheData;if(data.sprite){this._destroyCachedDisplayObject()}this.renderWebGL=data.originalRenderWebGL;this.renderCanvas=data.originalRenderCanvas;this.calculateBounds=data.originalCalculateBounds;this.getLocalBounds=data.originalGetLocalBounds;this.destroy=data.originalDestroy;this.updateTransform=data.originalUpdateTransform;this.containsPoint=data.originalContainsPoint;this._mask=data.originalMask;this.filterArea=data.originalFilterArea}}}});DisplayObject.prototype._renderCachedWebGL=function _renderCachedWebGL(renderer){if(!this.visible||this.worldAlpha<=0||!this.renderable){return}this._initCachedDisplayObject(renderer);this._cacheData.sprite.transform._worldID=this.transform._worldID;this._cacheData.sprite.worldAlpha=this.worldAlpha;this._cacheData.sprite._renderWebGL(renderer)};DisplayObject.prototype._initCachedDisplayObject=function _initCachedDisplayObject(renderer){if(this._cacheData&&this._cacheData.sprite){return}var cacheAlpha=this.alpha;this.alpha=1;renderer.currentRenderer.flush();var bounds=this.getLocalBounds().clone();if(this._filters&&this._filters.length){var padding=this._filters[0].padding;bounds.pad(padding)}bounds.ceil(core.settings.RESOLUTION);var cachedRenderTarget=renderer._activeRenderTarget;var stack=renderer.filterManager.filterStack;var renderTexture=core.RenderTexture.create(bounds.width,bounds.height);var textureCacheId="cacheAsBitmap_"+(0,_utils.uid)();this._cacheData.textureCacheId=textureCacheId;_BaseTexture2.default.addToCache(renderTexture.baseTexture,textureCacheId);_Texture2.default.addToCache(renderTexture,textureCacheId);var m=_tempMatrix;m.tx=-bounds.x;m.ty=-bounds.y;this.transform.worldTransform.identity();this.renderWebGL=this._cacheData.originalRenderWebGL;renderer.render(this,renderTexture,true,m,true);renderer.bindRenderTarget(cachedRenderTarget);renderer.filterManager.filterStack=stack;this.renderWebGL=this._renderCachedWebGL;this.updateTransform=this.displayObjectUpdateTransform;this.calculateBounds=this._calculateCachedBounds;this.getLocalBounds=this._getCachedLocalBounds;this._mask=null;this.filterArea=null;var cachedSprite=new core.Sprite(renderTexture);cachedSprite.transform.worldTransform=this.transform.worldTransform;cachedSprite.anchor.x=-(bounds.x/bounds.width);cachedSprite.anchor.y=-(bounds.y/bounds.height);cachedSprite.alpha=cacheAlpha;cachedSprite._bounds=this._bounds;this._cacheData.sprite=cachedSprite;this.transform._parentID=-1;if(!this.parent){this.parent=renderer._tempDisplayObjectParent;this.updateTransform();this.parent=null}else{this.updateTransform()}this.containsPoint=cachedSprite.containsPoint.bind(cachedSprite)};DisplayObject.prototype._renderCachedCanvas=function _renderCachedCanvas(renderer){if(!this.visible||this.worldAlpha<=0||!this.renderable){return}this._initCachedDisplayObjectCanvas(renderer);this._cacheData.sprite.worldAlpha=this.worldAlpha;this._cacheData.sprite._renderCanvas(renderer)};DisplayObject.prototype._initCachedDisplayObjectCanvas=function _initCachedDisplayObjectCanvas(renderer){if(this._cacheData&&this._cacheData.sprite){return}var bounds=this.getLocalBounds();var cacheAlpha=this.alpha;this.alpha=1;var cachedRenderTarget=renderer.context;bounds.ceil(core.settings.RESOLUTION);var renderTexture=core.RenderTexture.create(bounds.width,bounds.height);var textureCacheId="cacheAsBitmap_"+(0,_utils.uid)();this._cacheData.textureCacheId=textureCacheId;_BaseTexture2.default.addToCache(renderTexture.baseTexture,textureCacheId);_Texture2.default.addToCache(renderTexture,textureCacheId);var m=_tempMatrix;this.transform.localTransform.copy(m);m.invert();m.tx-=bounds.x;m.ty-=bounds.y;this.renderCanvas=this._cacheData.originalRenderCanvas;renderer.render(this,renderTexture,true,m,false);renderer.context=cachedRenderTarget;this.renderCanvas=this._renderCachedCanvas;this.updateTransform=this.displayObjectUpdateTransform;this.calculateBounds=this._calculateCachedBounds;this.getLocalBounds=this._getCachedLocalBounds;this._mask=null;this.filterArea=null;var cachedSprite=new core.Sprite(renderTexture);cachedSprite.transform.worldTransform=this.transform.worldTransform;cachedSprite.anchor.x=-(bounds.x/bounds.width);cachedSprite.anchor.y=-(bounds.y/bounds.height);cachedSprite.alpha=cacheAlpha;cachedSprite._bounds=this._bounds;this._cacheData.sprite=cachedSprite;this.transform._parentID=-1;if(!this.parent){this.parent=renderer._tempDisplayObjectParent;this.updateTransform();this.parent=null}else{this.updateTransform()}this.containsPoint=cachedSprite.containsPoint.bind(cachedSprite)};DisplayObject.prototype._calculateCachedBounds=function _calculateCachedBounds(){this._bounds.clear();this._cacheData.sprite.transform._worldID=this.transform._worldID;this._cacheData.sprite._calculateBounds();this._lastBoundsID=this._boundsID};DisplayObject.prototype._getCachedLocalBounds=function _getCachedLocalBounds(){return this._cacheData.sprite.getLocalBounds()};DisplayObject.prototype._destroyCachedDisplayObject=function _destroyCachedDisplayObject(){this._cacheData.sprite._texture.destroy(true);this._cacheData.sprite=null;_BaseTexture2.default.removeFromCache(this._cacheData.textureCacheId);_Texture2.default.removeFromCache(this._cacheData.textureCacheId);this._cacheData.textureCacheId=null};DisplayObject.prototype._cacheAsBitmapDestroy=function _cacheAsBitmapDestroy(options){this.cacheAsBitmap=false;this.destroy(options)}},{"../core":110,"../core/textures/BaseTexture":157,"../core/textures/Texture":160,"../core/utils":170}],184:[function(require,module,exports){"use strict";var _core=require("../core");var core=_interopRequireWildcard(_core);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}core.DisplayObject.prototype.name=null;core.Container.prototype.getChildByName=function getChildByName(name){for(var i=0;i<this.children.length;i++){if(this.children[i].name===name){return this.children[i]}}return null}},{"../core":110}],185:[function(require,module,exports){"use strict";var _core=require("../core");var core=_interopRequireWildcard(_core);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}core.DisplayObject.prototype.getGlobalPosition=function getGlobalPosition(){var point=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new core.Point;var skipUpdate=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(this.parent){this.parent.toGlobal(this.position,point,skipUpdate)}else{point.x=this.position.x;point.y=this.position.y}return point}},{"../core":110}],186:[function(require,module,exports){"use strict";exports.__esModule=true;exports.BitmapText=exports.TilingSpriteRenderer=exports.TilingSprite=exports.AnimatedSprite=undefined;var _AnimatedSprite=require("./AnimatedSprite");Object.defineProperty(exports,"AnimatedSprite",{enumerable:true,get:function get(){return _interopRequireDefault(_AnimatedSprite).default}});var _TilingSprite=require("./TilingSprite");Object.defineProperty(exports,"TilingSprite",{enumerable:true,get:function get(){return _interopRequireDefault(_TilingSprite).default}});var _TilingSpriteRenderer=require("./webgl/TilingSpriteRenderer");Object.defineProperty(exports,"TilingSpriteRenderer",{enumerable:true,get:function get(){return _interopRequireDefault(_TilingSpriteRenderer).default}});var _BitmapText=require("./BitmapText");Object.defineProperty(exports,"BitmapText",{enumerable:true,get:function get(){return _interopRequireDefault(_BitmapText).default}});require("./cacheAsBitmap");require("./getChildByName");require("./getGlobalPosition");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./AnimatedSprite":180,"./BitmapText":181,"./TilingSprite":182,"./cacheAsBitmap":183,"./getChildByName":184,"./getGlobalPosition":185,"./webgl/TilingSpriteRenderer":187}],187:[function(require,module,exports){"use strict";exports.__esModule=true;var _core=require("../../core");var core=_interopRequireWildcard(_core);var _const=require("../../core/const");var _path=require("path");function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var tempMat=new core.Matrix;var TilingSpriteRenderer=function(_core$ObjectRenderer){_inherits(TilingSpriteRenderer,_core$ObjectRenderer);function TilingSpriteRenderer(renderer){_classCallCheck(this,TilingSpriteRenderer);var _this=_possibleConstructorReturn(this,_core$ObjectRenderer.call(this,renderer));_this.shader=null;_this.simpleShader=null;_this.quad=null;return _this}TilingSpriteRenderer.prototype.onContextChange=function onContextChange(){var gl=this.renderer.gl;this.shader=new core.Shader(gl,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = mod(vTextureCoord - uClampOffset, vec2(1.0, 1.0)) + uClampOffset;\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 sample = texture2D(uSampler, coord);\n    gl_FragColor = sample * uColor;\n}\n");this.simpleShader=new core.Shader(gl,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 sample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = sample * uColor;\n}\n");this.renderer.bindVao(null);this.quad=new core.Quad(gl,this.renderer.state.attribState);this.quad.initVao(this.shader)};TilingSpriteRenderer.prototype.render=function render(ts){var renderer=this.renderer;var quad=this.quad;renderer.bindVao(quad.vao);var vertices=quad.vertices;vertices[0]=vertices[6]=ts._width*-ts.anchor.x;vertices[1]=vertices[3]=ts._height*-ts.anchor.y;vertices[2]=vertices[4]=ts._width*(1-ts.anchor.x);vertices[5]=vertices[7]=ts._height*(1-ts.anchor.y);if(ts.uvRespectAnchor){vertices=quad.uvs;vertices[0]=vertices[6]=-ts.anchor.x;vertices[1]=vertices[3]=-ts.anchor.y;vertices[2]=vertices[4]=1-ts.anchor.x;vertices[5]=vertices[7]=1-ts.anchor.y}quad.upload();var tex=ts._texture;var baseTex=tex.baseTexture;var lt=ts.tileTransform.localTransform;var uv=ts.uvTransform;var isSimple=baseTex.isPowerOfTwo&&tex.frame.width===baseTex.width&&tex.frame.height===baseTex.height;if(isSimple){if(!baseTex._glTextures[renderer.CONTEXT_UID]){if(baseTex.wrapMode===_const.WRAP_MODES.CLAMP){baseTex.wrapMode=_const.WRAP_MODES.REPEAT}}else{isSimple=baseTex.wrapMode!==_const.WRAP_MODES.CLAMP}}var shader=isSimple?this.simpleShader:this.shader;renderer.bindShader(shader);var w=tex.width;var h=tex.height;var W=ts._width;var H=ts._height;tempMat.set(lt.a*w/W,lt.b*w/H,lt.c*h/W,lt.d*h/H,lt.tx/W,lt.ty/H);tempMat.invert();if(isSimple){tempMat.prepend(uv.mapCoord)}else{shader.uniforms.uMapCoord=uv.mapCoord.toArray(true);shader.uniforms.uClampFrame=uv.uClampFrame;shader.uniforms.uClampOffset=uv.uClampOffset}shader.uniforms.uTransform=tempMat.toArray(true);shader.uniforms.uColor=core.utils.premultiplyTintToRgba(ts.tint,ts.worldAlpha,shader.uniforms.uColor,baseTex.premultipliedAlpha);shader.uniforms.translationMatrix=ts.transform.worldTransform.toArray(true);shader.uniforms.uSampler=renderer.bindTexture(tex);renderer.setBlendMode(core.utils.correctBlendMode(ts.blendMode,baseTex.premultipliedAlpha));quad.vao.draw(this.renderer.gl.TRIANGLES,6,0)};return TilingSpriteRenderer}(core.ObjectRenderer);exports.default=TilingSpriteRenderer;core.WebGLRenderer.registerPlugin("tilingSprite",TilingSpriteRenderer)},{"../../core":110,"../../core/const":91,path:49}],188:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../../core");var core=_interopRequireWildcard(_core);var _path=require("path");function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var AlphaFilter=function(_core$Filter){_inherits(AlphaFilter,_core$Filter);function AlphaFilter(){var alpha=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;_classCallCheck(this,AlphaFilter);var _this=_possibleConstructorReturn(this,_core$Filter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n"));_this.alpha=alpha;_this.glShaderKey="alpha";return _this}_createClass(AlphaFilter,[{key:"alpha",get:function get(){return this.uniforms.uAlpha},set:function set(value){this.uniforms.uAlpha=value}}]);return AlphaFilter}(core.Filter);exports.default=AlphaFilter},{"../../core":110,path:49}],189:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../../core");var core=_interopRequireWildcard(_core);var _BlurXFilter=require("./BlurXFilter");var _BlurXFilter2=_interopRequireDefault(_BlurXFilter);var _BlurYFilter=require("./BlurYFilter");var _BlurYFilter2=_interopRequireDefault(_BlurYFilter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var BlurFilter=function(_core$Filter){_inherits(BlurFilter,_core$Filter);function BlurFilter(strength,quality,resolution,kernelSize){_classCallCheck(this,BlurFilter);var _this=_possibleConstructorReturn(this,_core$Filter.call(this));_this.blurXFilter=new _BlurXFilter2.default(strength,quality,resolution,kernelSize);_this.blurYFilter=new _BlurYFilter2.default(strength,quality,resolution,kernelSize);_this.padding=0;_this.resolution=resolution||core.settings.RESOLUTION;_this.quality=quality||4;_this.blur=strength||8;return _this}BlurFilter.prototype.apply=function apply(filterManager,input,output){var renderTarget=filterManager.getRenderTarget(true);this.blurXFilter.apply(filterManager,input,renderTarget,true);this.blurYFilter.apply(filterManager,renderTarget,output,false);filterManager.returnRenderTarget(renderTarget)};_createClass(BlurFilter,[{key:"blur",get:function get(){return this.blurXFilter.blur},set:function set(value){this.blurXFilter.blur=this.blurYFilter.blur=value;this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}},{key:"quality",get:function get(){return this.blurXFilter.quality},set:function set(value){this.blurXFilter.quality=this.blurYFilter.quality=value}},{key:"blurX",get:function get(){return this.blurXFilter.blur},set:function set(value){this.blurXFilter.blur=value;this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}},{key:"blurY",get:function get(){return this.blurYFilter.blur},set:function set(value){this.blurYFilter.blur=value;this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}},{key:"blendMode",get:function get(){return this.blurYFilter._blendMode},set:function set(value){this.blurYFilter._blendMode=value}}]);return BlurFilter}(core.Filter);exports.default=BlurFilter},{"../../core":110,"./BlurXFilter":190,"./BlurYFilter":191}],190:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../../core");var core=_interopRequireWildcard(_core);var _generateBlurVertSource=require("./generateBlurVertSource");var _generateBlurVertSource2=_interopRequireDefault(_generateBlurVertSource);var _generateBlurFragSource=require("./generateBlurFragSource");var _generateBlurFragSource2=_interopRequireDefault(_generateBlurFragSource);var _getMaxBlurKernelSize=require("./getMaxBlurKernelSize");var _getMaxBlurKernelSize2=_interopRequireDefault(_getMaxBlurKernelSize);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var BlurXFilter=function(_core$Filter){_inherits(BlurXFilter,_core$Filter);function BlurXFilter(strength,quality,resolution,kernelSize){_classCallCheck(this,BlurXFilter);kernelSize=kernelSize||5;var vertSrc=(0,_generateBlurVertSource2.default)(kernelSize,true);var fragSrc=(0,_generateBlurFragSource2.default)(kernelSize);var _this=_possibleConstructorReturn(this,_core$Filter.call(this,vertSrc,fragSrc));_this.resolution=resolution||core.settings.RESOLUTION;_this._quality=0;_this.quality=quality||4;_this.strength=strength||8;_this.firstRun=true;return _this}BlurXFilter.prototype.apply=function apply(filterManager,input,output,clear){if(this.firstRun){var gl=filterManager.renderer.gl;var kernelSize=(0,_getMaxBlurKernelSize2.default)(gl);this.vertexSrc=(0,_generateBlurVertSource2.default)(kernelSize,true);this.fragmentSrc=(0,_generateBlurFragSource2.default)(kernelSize);this.firstRun=false}this.uniforms.strength=1/output.size.width*(output.size.width/input.size.width);this.uniforms.strength*=this.strength;this.uniforms.strength/=this.passes;if(this.passes===1){filterManager.applyFilter(this,input,output,clear)}else{var renderTarget=filterManager.getRenderTarget(true);var flip=input;var flop=renderTarget;for(var i=0;i<this.passes-1;i++){filterManager.applyFilter(this,flip,flop,true);var temp=flop;flop=flip;flip=temp}filterManager.applyFilter(this,flip,output,clear);filterManager.returnRenderTarget(renderTarget)}};_createClass(BlurXFilter,[{key:"blur",get:function get(){return this.strength},set:function set(value){this.padding=Math.abs(value)*2;this.strength=value}},{key:"quality",get:function get(){return this._quality},set:function set(value){this._quality=value;this.passes=value}}]);return BlurXFilter}(core.Filter);exports.default=BlurXFilter},{"../../core":110,"./generateBlurFragSource":192,"./generateBlurVertSource":193,"./getMaxBlurKernelSize":194}],191:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../../core");var core=_interopRequireWildcard(_core);var _generateBlurVertSource=require("./generateBlurVertSource");var _generateBlurVertSource2=_interopRequireDefault(_generateBlurVertSource);var _generateBlurFragSource=require("./generateBlurFragSource");var _generateBlurFragSource2=_interopRequireDefault(_generateBlurFragSource);var _getMaxBlurKernelSize=require("./getMaxBlurKernelSize");var _getMaxBlurKernelSize2=_interopRequireDefault(_getMaxBlurKernelSize);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var BlurYFilter=function(_core$Filter){_inherits(BlurYFilter,_core$Filter);function BlurYFilter(strength,quality,resolution,kernelSize){_classCallCheck(this,BlurYFilter);kernelSize=kernelSize||5;var vertSrc=(0,_generateBlurVertSource2.default)(kernelSize,false);var fragSrc=(0,_generateBlurFragSource2.default)(kernelSize);var _this=_possibleConstructorReturn(this,_core$Filter.call(this,vertSrc,fragSrc));_this.resolution=resolution||core.settings.RESOLUTION;_this._quality=0;_this.quality=quality||4;_this.strength=strength||8;_this.firstRun=true;return _this}BlurYFilter.prototype.apply=function apply(filterManager,input,output,clear){if(this.firstRun){var gl=filterManager.renderer.gl;var kernelSize=(0,_getMaxBlurKernelSize2.default)(gl);this.vertexSrc=(0,_generateBlurVertSource2.default)(kernelSize,false);this.fragmentSrc=(0,_generateBlurFragSource2.default)(kernelSize);this.firstRun=false}this.uniforms.strength=1/output.size.height*(output.size.height/input.size.height);this.uniforms.strength*=this.strength;this.uniforms.strength/=this.passes;if(this.passes===1){filterManager.applyFilter(this,input,output,clear)}else{var renderTarget=filterManager.getRenderTarget(true);var flip=input;var flop=renderTarget;for(var i=0;i<this.passes-1;i++){filterManager.applyFilter(this,flip,flop,true);var temp=flop;flop=flip;flip=temp}filterManager.applyFilter(this,flip,output,clear);filterManager.returnRenderTarget(renderTarget)}};_createClass(BlurYFilter,[{key:"blur",get:function get(){return this.strength},set:function set(value){this.padding=Math.abs(value)*2;this.strength=value}},{key:"quality",get:function get(){return this._quality},set:function set(value){this._quality=value;this.passes=value}}]);return BlurYFilter}(core.Filter);exports.default=BlurYFilter},{"../../core":110,"./generateBlurFragSource":192,"./generateBlurVertSource":193,"./getMaxBlurKernelSize":194}],192:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=generateFragBlurSource;var GAUSSIAN_VALUES={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]};var fragTemplate=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");function generateFragBlurSource(kernelSize){var kernel=GAUSSIAN_VALUES[kernelSize];var halfLength=kernel.length;var fragSource=fragTemplate;var blurLoop="";var template="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";var value=void 0;for(var i=0;i<kernelSize;i++){var blur=template.replace("%index%",i);value=i;if(i>=halfLength){value=kernelSize-i-1}blur=blur.replace("%value%",kernel[value]);blurLoop+=blur;blurLoop+="\n"}fragSource=fragSource.replace("%blur%",blurLoop);fragSource=fragSource.replace("%size%",kernelSize);return fragSource}},{}],193:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=generateVertBlurSource;var vertTemplate=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform float strength;","uniform mat3 projectionMatrix;","varying vec2 vBlurTexCoords[%size%];","void main(void)","{","gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);","%blur%","}"].join("\n");function generateVertBlurSource(kernelSize,x){var halfLength=Math.ceil(kernelSize/2);var vertSource=vertTemplate;var blurLoop="";var template=void 0;if(x){template="vBlurTexCoords[%index%] = aTextureCoord + vec2(%sampleIndex% * strength, 0.0);"}else{template="vBlurTexCoords[%index%] = aTextureCoord + vec2(0.0, %sampleIndex% * strength);"}for(var i=0;i<kernelSize;i++){var blur=template.replace("%index%",i);blur=blur.replace("%sampleIndex%",i-(halfLength-1)+".0");blurLoop+=blur;blurLoop+="\n"}vertSource=vertSource.replace("%blur%",blurLoop);vertSource=vertSource.replace("%size%",kernelSize);return vertSource}},{}],194:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=getMaxKernelSize;function getMaxKernelSize(gl){var maxVaryings=gl.getParameter(gl.MAX_VARYING_VECTORS);var kernelSize=15;while(kernelSize>maxVaryings){kernelSize-=2}return kernelSize}},{}],195:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../../core");var core=_interopRequireWildcard(_core);var _path=require("path");function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ColorMatrixFilter=function(_core$Filter){_inherits(ColorMatrixFilter,_core$Filter);function ColorMatrixFilter(){_classCallCheck(this,ColorMatrixFilter);var _this=_possibleConstructorReturn(this,_core$Filter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n"));_this.uniforms.m=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];_this.alpha=1;return _this}ColorMatrixFilter.prototype._loadMatrix=function _loadMatrix(matrix){var multiply=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var newMatrix=matrix;if(multiply){this._multiply(newMatrix,this.uniforms.m,matrix);newMatrix=this._colorMatrix(newMatrix)}this.uniforms.m=newMatrix};ColorMatrixFilter.prototype._multiply=function _multiply(out,a,b){out[0]=a[0]*b[0]+a[1]*b[5]+a[2]*b[10]+a[3]*b[15];out[1]=a[0]*b[1]+a[1]*b[6]+a[2]*b[11]+a[3]*b[16];out[2]=a[0]*b[2]+a[1]*b[7]+a[2]*b[12]+a[3]*b[17];out[3]=a[0]*b[3]+a[1]*b[8]+a[2]*b[13]+a[3]*b[18];out[4]=a[0]*b[4]+a[1]*b[9]+a[2]*b[14]+a[3]*b[19]+a[4];out[5]=a[5]*b[0]+a[6]*b[5]+a[7]*b[10]+a[8]*b[15];out[6]=a[5]*b[1]+a[6]*b[6]+a[7]*b[11]+a[8]*b[16];out[7]=a[5]*b[2]+a[6]*b[7]+a[7]*b[12]+a[8]*b[17];out[8]=a[5]*b[3]+a[6]*b[8]+a[7]*b[13]+a[8]*b[18];out[9]=a[5]*b[4]+a[6]*b[9]+a[7]*b[14]+a[8]*b[19]+a[9];out[10]=a[10]*b[0]+a[11]*b[5]+a[12]*b[10]+a[13]*b[15];out[11]=a[10]*b[1]+a[11]*b[6]+a[12]*b[11]+a[13]*b[16];out[12]=a[10]*b[2]+a[11]*b[7]+a[12]*b[12]+a[13]*b[17];out[13]=a[10]*b[3]+a[11]*b[8]+a[12]*b[13]+a[13]*b[18];out[14]=a[10]*b[4]+a[11]*b[9]+a[12]*b[14]+a[13]*b[19]+a[14];out[15]=a[15]*b[0]+a[16]*b[5]+a[17]*b[10]+a[18]*b[15];out[16]=a[15]*b[1]+a[16]*b[6]+a[17]*b[11]+a[18]*b[16];out[17]=a[15]*b[2]+a[16]*b[7]+a[17]*b[12]+a[18]*b[17];out[18]=a[15]*b[3]+a[16]*b[8]+a[17]*b[13]+a[18]*b[18];out[19]=a[15]*b[4]+a[16]*b[9]+a[17]*b[14]+a[18]*b[19]+a[19];return out};ColorMatrixFilter.prototype._colorMatrix=function _colorMatrix(matrix){var m=new Float32Array(matrix);m[4]/=255;m[9]/=255;m[14]/=255;m[19]/=255;return m};ColorMatrixFilter.prototype.brightness=function brightness(b,multiply){var matrix=[b,0,0,0,0,0,b,0,0,0,0,0,b,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.greyscale=function greyscale(scale,multiply){var matrix=[scale,scale,scale,0,0,scale,scale,scale,0,0,scale,scale,scale,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.blackAndWhite=function blackAndWhite(multiply){var matrix=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.hue=function hue(rotation,multiply){rotation=(rotation||0)/180*Math.PI;var cosR=Math.cos(rotation);var sinR=Math.sin(rotation);var sqrt=Math.sqrt;var w=1/3;var sqrW=sqrt(w);var a00=cosR+(1-cosR)*w;var a01=w*(1-cosR)-sqrW*sinR;var a02=w*(1-cosR)+sqrW*sinR;var a10=w*(1-cosR)+sqrW*sinR;var a11=cosR+w*(1-cosR);var a12=w*(1-cosR)-sqrW*sinR;var a20=w*(1-cosR)-sqrW*sinR;var a21=w*(1-cosR)+sqrW*sinR;var a22=cosR+w*(1-cosR);var matrix=[a00,a01,a02,0,0,a10,a11,a12,0,0,a20,a21,a22,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.contrast=function contrast(amount,multiply){var v=(amount||0)+1;var o=-.5*(v-1);var matrix=[v,0,0,0,o,0,v,0,0,o,0,0,v,0,o,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.saturate=function saturate(){var amount=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var multiply=arguments[1];var x=amount*2/3+1;var y=(x-1)*-.5;var matrix=[x,y,y,0,0,y,x,y,0,0,y,y,x,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.desaturate=function desaturate(){this.saturate(-1)};ColorMatrixFilter.prototype.negative=function negative(multiply){var matrix=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.sepia=function sepia(multiply){var matrix=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.technicolor=function technicolor(multiply){var matrix=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.polaroid=function polaroid(multiply){var matrix=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.toBGR=function toBGR(multiply){var matrix=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.kodachrome=function kodachrome(multiply){var matrix=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.browni=function browni(multiply){var matrix=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.vintage=function vintage(multiply){var matrix=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.colorTone=function colorTone(desaturation,toned,lightColor,darkColor,multiply){desaturation=desaturation||.2;toned=toned||.15;lightColor=lightColor||16770432;darkColor=darkColor||3375104;var lR=(lightColor>>16&255)/255;var lG=(lightColor>>8&255)/255;var lB=(lightColor&255)/255;var dR=(darkColor>>16&255)/255;var dG=(darkColor>>8&255)/255;var dB=(darkColor&255)/255;var matrix=[.3,.59,.11,0,0,lR,lG,lB,desaturation,0,dR,dG,dB,toned,0,lR-dR,lG-dG,lB-dB,0,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.night=function night(intensity,multiply){intensity=intensity||.1;var matrix=[intensity*-2,-intensity,0,0,0,-intensity,0,intensity,0,0,0,intensity,intensity*2,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.predator=function predator(amount,multiply){var matrix=[11.224130630493164*amount,-4.794486999511719*amount,-2.8746118545532227*amount,0*amount,.40342438220977783*amount,-3.6330697536468506*amount,9.193157196044922*amount,-2.951810836791992*amount,0*amount,-1.316135048866272*amount,-3.2184197902679443*amount,-4.2375030517578125*amount,7.476448059082031*amount,0*amount,.8044459223747253*amount,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.lsd=function lsd(multiply){var matrix=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.reset=function reset(){var matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(matrix,false)};_createClass(ColorMatrixFilter,[{key:"matrix",get:function get(){return this.uniforms.m},set:function set(value){this.uniforms.m=value}},{key:"alpha",get:function get(){return this.uniforms.uAlpha},set:function set(value){this.uniforms.uAlpha=value}}]);return ColorMatrixFilter}(core.Filter);exports.default=ColorMatrixFilter;ColorMatrixFilter.prototype.grayscale=ColorMatrixFilter.prototype.greyscale},{"../../core":110,path:49}],196:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../../core");var core=_interopRequireWildcard(_core);var _path=require("path");function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DisplacementFilter=function(_core$Filter){_inherits(DisplacementFilter,_core$Filter);function DisplacementFilter(sprite,scale){_classCallCheck(this,DisplacementFilter);var maskMatrix=new core.Matrix;sprite.renderable=false;var _this=_possibleConstructorReturn(this,_core$Filter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nvoid main(void)\n{\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n   vTextureCoord = aTextureCoord;\n}","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\n\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy *= scale / filterArea.xy;\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), filterClamp.xy, filterClamp.zw));\n}\n"));_this.maskSprite=sprite;_this.maskMatrix=maskMatrix;_this.uniforms.mapSampler=sprite._texture;_this.uniforms.filterMatrix=maskMatrix;_this.uniforms.scale={x:1,y:1};if(scale===null||scale===undefined){scale=20}_this.scale=new core.Point(scale,scale);return _this}DisplacementFilter.prototype.apply=function apply(filterManager,input,output){this.uniforms.filterMatrix=filterManager.calculateSpriteMatrix(this.maskMatrix,this.maskSprite);this.uniforms.scale.x=this.scale.x;this.uniforms.scale.y=this.scale.y;filterManager.applyFilter(this,input,output)};_createClass(DisplacementFilter,[{key:"map",get:function get(){return this.uniforms.mapSampler},set:function set(value){this.uniforms.mapSampler=value}}]);return DisplacementFilter}(core.Filter);exports.default=DisplacementFilter},{"../../core":110,path:49}],197:[function(require,module,exports){"use strict";exports.__esModule=true;var _core=require("../../core");var core=_interopRequireWildcard(_core);var _path=require("path");function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var FXAAFilter=function(_core$Filter){_inherits(FXAAFilter,_core$Filter);function FXAAFilter(){_classCallCheck(this,FXAAFilter);return _possibleConstructorReturn(this,_core$Filter.call(this,"\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nuniform vec4 filterArea;\n\nvarying vec2 vTextureCoord;\n\nvec2 mapCoord( vec2 coord )\n{\n    coord *= filterArea.xy;\n    coord += filterArea.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord )\n{\n    coord -= filterArea.zw;\n    coord /= filterArea.xy;\n\n    return coord;\n}\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    vec2 inverseVP = 1.0 / resolution.xy;\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n   vTextureCoord = aTextureCoord;\n\n   vec2 fragCoord = vTextureCoord * filterArea.xy;\n\n   texcoords(fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n \n --\n \n From:\n https://github.com/mitsuhiko/webgl-meincraft\n \n Copyright (c) 2011 by Armin Ronacher.\n \n Some rights reserved.\n \n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n \n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n \n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n \n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n \n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n    \n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n    \n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n    \n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n    \n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n    \n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec2 fragCoord = vTextureCoord * filterArea.xy;\n\n      vec4 color;\n\n    color = fxaa(uSampler, fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n'))}return FXAAFilter}(core.Filter);exports.default=FXAAFilter},{"../../core":110,path:49}],198:[function(require,module,exports){"use strict";exports.__esModule=true;var _FXAAFilter=require("./fxaa/FXAAFilter");Object.defineProperty(exports,"FXAAFilter",{enumerable:true,get:function get(){return _interopRequireDefault(_FXAAFilter).default}});var _NoiseFilter=require("./noise/NoiseFilter");Object.defineProperty(exports,"NoiseFilter",{enumerable:true,get:function get(){return _interopRequireDefault(_NoiseFilter).default}});var _DisplacementFilter=require("./displacement/DisplacementFilter");Object.defineProperty(exports,"DisplacementFilter",{enumerable:true,get:function get(){return _interopRequireDefault(_DisplacementFilter).default}});var _BlurFilter=require("./blur/BlurFilter");Object.defineProperty(exports,"BlurFilter",{enumerable:true,get:function get(){return _interopRequireDefault(_BlurFilter).default}});var _BlurXFilter=require("./blur/BlurXFilter");Object.defineProperty(exports,"BlurXFilter",{enumerable:true,get:function get(){return _interopRequireDefault(_BlurXFilter).default}});var _BlurYFilter=require("./blur/BlurYFilter");Object.defineProperty(exports,"BlurYFilter",{enumerable:true,get:function get(){return _interopRequireDefault(_BlurYFilter).default}});var _ColorMatrixFilter=require("./colormatrix/ColorMatrixFilter");Object.defineProperty(exports,"ColorMatrixFilter",{enumerable:true,get:function get(){return _interopRequireDefault(_ColorMatrixFilter).default}});var _AlphaFilter=require("./alpha/AlphaFilter");Object.defineProperty(exports,"AlphaFilter",{enumerable:true,get:function get(){return _interopRequireDefault(_AlphaFilter).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./alpha/AlphaFilter":188,"./blur/BlurFilter":189,"./blur/BlurXFilter":190,"./blur/BlurYFilter":191,"./colormatrix/ColorMatrixFilter":195,"./displacement/DisplacementFilter":196,"./fxaa/FXAAFilter":197,"./noise/NoiseFilter":199}],199:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../../core");var core=_interopRequireWildcard(_core);var _path=require("path");function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var NoiseFilter=function(_core$Filter){_inherits(NoiseFilter,_core$Filter);function NoiseFilter(){var noise=arguments.length>0&&arguments[0]!==undefined?arguments[0]:.5;var seed=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Math.random();_classCallCheck(this,NoiseFilter);var _this=_possibleConstructorReturn(this,_core$Filter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n"));_this.noise=noise;_this.seed=seed;return _this}_createClass(NoiseFilter,[{key:"noise",get:function get(){return this.uniforms.uNoise},set:function set(value){this.uniforms.uNoise=value}},{key:"seed",get:function get(){return this.uniforms.uSeed},set:function set(value){this.uniforms.uSeed=value}}]);return NoiseFilter}(core.Filter);exports.default=NoiseFilter},{"../../core":110,path:49}],200:[function(require,module,exports){(function(global){"use strict";exports.__esModule=true;exports.loader=exports.prepare=exports.particles=exports.mesh=exports.loaders=exports.interaction=exports.filters=exports.extras=exports.extract=exports.accessibility=undefined;var _polyfill=require("./polyfill");Object.keys(_polyfill).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _polyfill[key]}})});var _core=require("./core");Object.keys(_core).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _core[key]}})});var _deprecation=require("./deprecation");var _deprecation2=_interopRequireDefault(_deprecation);var _accessibility=require("./accessibility");var accessibility=_interopRequireWildcard(_accessibility);var _extract=require("./extract");var extract=_interopRequireWildcard(_extract);var _extras=require("./extras");var extras=_interopRequireWildcard(_extras);var _filters=require("./filters");var filters=_interopRequireWildcard(_filters);var _interaction=require("./interaction");var interaction=_interopRequireWildcard(_interaction);var _loaders=require("./loaders");var loaders=_interopRequireWildcard(_loaders);var _mesh=require("./mesh");var mesh=_interopRequireWildcard(_mesh);var _particles=require("./particles");var particles=_interopRequireWildcard(_particles);var _prepare=require("./prepare");var prepare=_interopRequireWildcard(_prepare);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_core.utils.mixins.performMixins();var loader=loaders.shared||null;exports.accessibility=accessibility;exports.extract=extract;exports.extras=extras;exports.filters=filters;exports.interaction=interaction;exports.loaders=loaders;exports.mesh=mesh;exports.particles=particles;exports.prepare=prepare;exports.loader=loader;if(typeof _deprecation2.default==="function"){(0,_deprecation2.default)(exports)}global.PIXI=exports}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./accessibility":87,"./core":110,"./deprecation":176,"./extract":178,"./extras":186,"./filters":198,"./interaction":205,"./loaders":208,"./mesh":217,"./particles":220,"./polyfill":227,"./prepare":231}],201:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../core");var core=_interopRequireWildcard(_core);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var InteractionData=function(){function InteractionData(){_classCallCheck(this,InteractionData);this.global=new core.Point;this.target=null;this.originalEvent=null;this.identifier=null;this.isPrimary=false;this.button=0;this.buttons=0;this.width=0;this.height=0;this.tiltX=0;this.tiltY=0;this.pointerType=null;this.pressure=0;this.rotationAngle=0;this.twist=0;this.tangentialPressure=0}InteractionData.prototype.getLocalPosition=function getLocalPosition(displayObject,point,globalPos){return displayObject.worldTransform.applyInverse(globalPos||this.global,point)};InteractionData.prototype.copyEvent=function copyEvent(event){if(event.isPrimary){this.isPrimary=true}this.button=event.button;this.buttons=Number.isInteger(event.buttons)?event.buttons:event.which;this.width=event.width;this.height=event.height;this.tiltX=event.tiltX;this.tiltY=event.tiltY;this.pointerType=event.pointerType;this.pressure=event.pressure;this.rotationAngle=event.rotationAngle;this.twist=event.twist||0;this.tangentialPressure=event.tangentialPressure||0};InteractionData.prototype.reset=function reset(){this.isPrimary=false};_createClass(InteractionData,[{key:"pointerId",get:function get(){return this.identifier}}]);return InteractionData}();exports.default=InteractionData},{"../core":110}],202:[function(require,module,exports){"use strict";exports.__esModule=true;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var InteractionEvent=function(){function InteractionEvent(){_classCallCheck(this,InteractionEvent);this.stopped=false;this.target=null;this.currentTarget=null;this.type=null;this.data=null}InteractionEvent.prototype.stopPropagation=function stopPropagation(){this.stopped=true};InteractionEvent.prototype.reset=function reset(){this.stopped=false;this.currentTarget=null;this.target=null};return InteractionEvent}();exports.default=InteractionEvent},{}],203:[function(require,module,exports){"use strict";exports.__esModule=true;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _core=require("../core");var core=_interopRequireWildcard(_core);var _InteractionData=require("./InteractionData");var _InteractionData2=_interopRequireDefault(_InteractionData);var _InteractionEvent=require("./InteractionEvent");var _InteractionEvent2=_interopRequireDefault(_InteractionEvent);var _InteractionTrackingData=require("./InteractionTrackingData");var _InteractionTrackingData2=_interopRequireDefault(_InteractionTrackingData);var _eventemitter=require("eventemitter3");var _eventemitter2=_interopRequireDefault(_eventemitter);var _interactiveTarget=require("./interactiveTarget");var _interactiveTarget2=_interopRequireDefault(_interactiveTarget);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}core.utils.mixins.delayMixin(core.DisplayObject.prototype,_interactiveTarget2.default);var MOUSE_POINTER_ID=1;var hitTestEvent={target:null,data:{global:null}};var InteractionManager=function(_EventEmitter){_inherits(InteractionManager,_EventEmitter);function InteractionManager(renderer,options){_classCallCheck(this,InteractionManager);var _this=_possibleConstructorReturn(this,_EventEmitter.call(this));options=options||{};_this.renderer=renderer;_this.autoPreventDefault=options.autoPreventDefault!==undefined?options.autoPreventDefault:true;_this.interactionFrequency=options.interactionFrequency||10;_this.mouse=new _InteractionData2.default;_this.mouse.identifier=MOUSE_POINTER_ID;_this.mouse.global.set(-999999);_this.activeInteractionData={};_this.activeInteractionData[MOUSE_POINTER_ID]=_this.mouse;_this.interactionDataPool=[];_this.eventData=new _InteractionEvent2.default;_this.interactionDOMElement=null;_this.moveWhenInside=false;_this.eventsAdded=false;_this.mouseOverRenderer=false;_this.supportsTouchEvents="ontouchstart"in window;_this.supportsPointerEvents=!!window.PointerEvent;_this.onPointerUp=_this.onPointerUp.bind(_this);_this.processPointerUp=_this.processPointerUp.bind(_this);_this.onPointerCancel=_this.onPointerCancel.bind(_this);_this.processPointerCancel=_this.processPointerCancel.bind(_this);_this.onPointerDown=_this.onPointerDown.bind(_this);_this.processPointerDown=_this.processPointerDown.bind(_this);_this.onPointerMove=_this.onPointerMove.bind(_this);_this.processPointerMove=_this.processPointerMove.bind(_this);_this.onPointerOut=_this.onPointerOut.bind(_this);_this.processPointerOverOut=_this.processPointerOverOut.bind(_this);_this.onPointerOver=_this.onPointerOver.bind(_this);_this.cursorStyles={default:"inherit",pointer:"pointer"};_this.currentCursorMode=null;_this.cursor=null;_this._tempPoint=new core.Point;_this.resolution=1;_this.setTargetElement(_this.renderer.view,_this.renderer.resolution);return _this}InteractionManager.prototype.hitTest=function hitTest(globalPoint,root){hitTestEvent.target=null;hitTestEvent.data.global=globalPoint;if(!root){root=this.renderer._lastObjectRendered}this.processInteractive(hitTestEvent,root,null,true);return hitTestEvent.target};InteractionManager.prototype.setTargetElement=function setTargetElement(element){var resolution=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;this.removeEvents();this.interactionDOMElement=element;this.resolution=resolution;this.addEvents()};InteractionManager.prototype.addEvents=function addEvents(){if(!this.interactionDOMElement){return}core.ticker.shared.add(this.update,this,core.UPDATE_PRIORITY.INTERACTION);if(window.navigator.msPointerEnabled){this.interactionDOMElement.style["-ms-content-zooming"]="none";this.interactionDOMElement.style["-ms-touch-action"]="none"}else if(this.supportsPointerEvents){this.interactionDOMElement.style["touch-action"]="none"}if(this.supportsPointerEvents){window.document.addEventListener("pointermove",this.onPointerMove,true);this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,true);this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,true);this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,true);window.addEventListener("pointercancel",this.onPointerCancel,true);window.addEventListener("pointerup",this.onPointerUp,true)}else{window.document.addEventListener("mousemove",this.onPointerMove,true);this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,true);this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,true);this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,true);window.addEventListener("mouseup",this.onPointerUp,true)}if(this.supportsTouchEvents){this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,true);this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,true);this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,true);this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,true)}this.eventsAdded=true};InteractionManager.prototype.removeEvents=function removeEvents(){if(!this.interactionDOMElement){return}core.ticker.shared.remove(this.update,this);if(window.navigator.msPointerEnabled){this.interactionDOMElement.style["-ms-content-zooming"]="";this.interactionDOMElement.style["-ms-touch-action"]=""}else if(this.supportsPointerEvents){this.interactionDOMElement.style["touch-action"]=""}if(this.supportsPointerEvents){window.document.removeEventListener("pointermove",this.onPointerMove,true);this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,true);this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,true);this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,true);window.removeEventListener("pointercancel",this.onPointerCancel,true);window.removeEventListener("pointerup",this.onPointerUp,true)}else{window.document.removeEventListener("mousemove",this.onPointerMove,true);this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,true);this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,true);this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,true);window.removeEventListener("mouseup",this.onPointerUp,true)}if(this.supportsTouchEvents){this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,true);this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,true);this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,true);this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,true)}this.interactionDOMElement=null;this.eventsAdded=false};InteractionManager.prototype.update=function update(deltaTime){this._deltaTime+=deltaTime;if(this._deltaTime<this.interactionFrequency){return}this._deltaTime=0;if(!this.interactionDOMElement){return}if(this.didMove){this.didMove=false;return}this.cursor=null;for(var k in this.activeInteractionData){if(this.activeInteractionData.hasOwnProperty(k)){var interactionData=this.activeInteractionData[k];if(interactionData.originalEvent&&interactionData.pointerType!=="touch"){var interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,interactionData.originalEvent,interactionData);this.processInteractive(interactionEvent,this.renderer._lastObjectRendered,this.processPointerOverOut,true)}}}this.setCursorMode(this.cursor)};InteractionManager.prototype.setCursorMode=function setCursorMode(mode){mode=mode||"default";if(this.currentCursorMode===mode){return}this.currentCursorMode=mode;var style=this.cursorStyles[mode];if(style){switch(typeof style==="undefined"?"undefined":_typeof(style)){case"string":this.interactionDOMElement.style.cursor=style;break;case"function":style(mode);break;case"object":Object.assign(this.interactionDOMElement.style,style);break}}else if(typeof mode==="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,mode)){this.interactionDOMElement.style.cursor=mode}};InteractionManager.prototype.dispatchEvent=function dispatchEvent(displayObject,eventString,eventData){if(!eventData.stopped){eventData.currentTarget=displayObject;eventData.type=eventString;displayObject.emit(eventString,eventData);if(displayObject[eventString]){displayObject[eventString](eventData)}}};InteractionManager.prototype.mapPositionToPoint=function mapPositionToPoint(point,x,y){var rect=void 0;if(!this.interactionDOMElement.parentElement){rect={x:0,y:0,width:0,height:0}}else{rect=this.interactionDOMElement.getBoundingClientRect()}var resolutionMultiplier=navigator.isCocoonJS?this.resolution:1/this.resolution;point.x=(x-rect.left)*(this.interactionDOMElement.width/rect.width)*resolutionMultiplier;point.y=(y-rect.top)*(this.interactionDOMElement.height/rect.height)*resolutionMultiplier};InteractionManager.prototype.processInteractive=function processInteractive(interactionEvent,displayObject,func,hitTest,interactive){if(!displayObject||!displayObject.visible){return false}var point=interactionEvent.data.global;interactive=displayObject.interactive||interactive;var hit=false;var interactiveParent=interactive;var hitTestChildren=true;if(displayObject.hitArea){if(hitTest){displayObject.worldTransform.applyInverse(point,this._tempPoint);if(!displayObject.hitArea.contains(this._tempPoint.x,this._tempPoint.y)){hitTest=false;hitTestChildren=false}else{hit=true}}interactiveParent=false}else if(displayObject._mask){if(hitTest){if(!displayObject._mask.containsPoint(point)){hitTest=false;hitTestChildren=false}}}if(hitTestChildren&&displayObject.interactiveChildren&&displayObject.children){var children=displayObject.children;for(var i=children.length-1;i>=0;i--){var child=children[i];var childHit=this.processInteractive(interactionEvent,child,func,hitTest,interactiveParent);if(childHit){if(!child.parent){continue}interactiveParent=false;if(childHit){if(interactionEvent.target){hitTest=false}hit=true}}}}if(interactive){if(hitTest&&!interactionEvent.target){if(!displayObject.hitArea&&displayObject.containsPoint){if(displayObject.containsPoint(point)){hit=true}}}if(displayObject.interactive){if(hit&&!interactionEvent.target){interactionEvent.target=displayObject}if(func){func(interactionEvent,displayObject,!!hit)}}}return hit};InteractionManager.prototype.onPointerDown=function onPointerDown(originalEvent){if(this.supportsTouchEvents&&originalEvent.pointerType==="touch")return;var events=this.normalizeToPointerData(originalEvent);if(this.autoPreventDefault&&events[0].isNormalized){originalEvent.preventDefault()}var eventLen=events.length;for(var i=0;i<eventLen;i++){var event=events[i];var interactionData=this.getInteractionDataForPointerId(event);var interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);interactionEvent.data.originalEvent=originalEvent;this.processInteractive(interactionEvent,this.renderer._lastObjectRendered,this.processPointerDown,true);this.emit("pointerdown",interactionEvent);if(event.pointerType==="touch"){this.emit("touchstart",interactionEvent)}else if(event.pointerType==="mouse"||event.pointerType==="pen"){var isRightButton=event.button===2;this.emit(isRightButton?"rightdown":"mousedown",this.eventData)}}};InteractionManager.prototype.processPointerDown=function processPointerDown(interactionEvent,displayObject,hit){var data=interactionEvent.data;var id=interactionEvent.data.identifier;if(hit){if(!displayObject.trackedPointers[id]){displayObject.trackedPointers[id]=new _InteractionTrackingData2.default(id)}this.dispatchEvent(displayObject,"pointerdown",interactionEvent);if(data.pointerType==="touch"){this.dispatchEvent(displayObject,"touchstart",interactionEvent)}else if(data.pointerType==="mouse"||data.pointerType==="pen"){var isRightButton=data.button===2;if(isRightButton){displayObject.trackedPointers[id].rightDown=true}else{displayObject.trackedPointers[id].leftDown=true}this.dispatchEvent(displayObject,isRightButton?"rightdown":"mousedown",interactionEvent)}}};InteractionManager.prototype.onPointerComplete=function onPointerComplete(originalEvent,cancelled,func){var events=this.normalizeToPointerData(originalEvent);var eventLen=events.length;var eventAppend=originalEvent.target!==this.interactionDOMElement?"outside":"";for(var i=0;i<eventLen;i++){var event=events[i];var interactionData=this.getInteractionDataForPointerId(event);var interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);interactionEvent.data.originalEvent=originalEvent;this.processInteractive(interactionEvent,this.renderer._lastObjectRendered,func,cancelled||!eventAppend);this.emit(cancelled?"pointercancel":"pointerup"+eventAppend,interactionEvent);if(event.pointerType==="mouse"||event.pointerType==="pen"){var isRightButton=event.button===2;this.emit(isRightButton?"rightup"+eventAppend:"mouseup"+eventAppend,interactionEvent)}else if(event.pointerType==="touch"){this.emit(cancelled?"touchcancel":"touchend"+eventAppend,interactionEvent);this.releaseInteractionDataForPointerId(event.pointerId,interactionData)}}};InteractionManager.prototype.onPointerCancel=function onPointerCancel(event){if(this.supportsTouchEvents&&event.pointerType==="touch")return;this.onPointerComplete(event,true,this.processPointerCancel)};InteractionManager.prototype.processPointerCancel=function processPointerCancel(interactionEvent,displayObject){var data=interactionEvent.data;var id=interactionEvent.data.identifier;if(displayObject.trackedPointers[id]!==undefined){delete displayObject.trackedPointers[id];this.dispatchEvent(displayObject,"pointercancel",interactionEvent);if(data.pointerType==="touch"){this.dispatchEvent(displayObject,"touchcancel",interactionEvent)}}};InteractionManager.prototype.onPointerUp=function onPointerUp(event){if(this.supportsTouchEvents&&event.pointerType==="touch")return;this.onPointerComplete(event,false,this.processPointerUp)};InteractionManager.prototype.processPointerUp=function processPointerUp(interactionEvent,displayObject,hit){var data=interactionEvent.data;var id=interactionEvent.data.identifier;var trackingData=displayObject.trackedPointers[id];var isTouch=data.pointerType==="touch";var isMouse=data.pointerType==="mouse"||data.pointerType==="pen";var isMouseTap=false;if(isMouse){var isRightButton=data.button===2;var flags=_InteractionTrackingData2.default.FLAGS;var test=isRightButton?flags.RIGHT_DOWN:flags.LEFT_DOWN;var isDown=trackingData!==undefined&&trackingData.flags&test;if(hit){this.dispatchEvent(displayObject,isRightButton?"rightup":"mouseup",interactionEvent);if(isDown){this.dispatchEvent(displayObject,isRightButton?"rightclick":"click",interactionEvent);isMouseTap=true}}else if(isDown){this.dispatchEvent(displayObject,isRightButton?"rightupoutside":"mouseupoutside",interactionEvent)}if(trackingData){if(isRightButton){trackingData.rightDown=false}else{trackingData.leftDown=false}}}if(hit){this.dispatchEvent(displayObject,"pointerup",interactionEvent);if(isTouch)this.dispatchEvent(displayObject,"touchend",interactionEvent);if(trackingData){if(!isMouse||isMouseTap){this.dispatchEvent(displayObject,"pointertap",interactionEvent)}if(isTouch){this.dispatchEvent(displayObject,"tap",interactionEvent);trackingData.over=false}}}else if(trackingData){this.dispatchEvent(displayObject,"pointerupoutside",interactionEvent);if(isTouch)this.dispatchEvent(displayObject,"touchendoutside",interactionEvent)}if(trackingData&&trackingData.none){delete displayObject.trackedPointers[id]}};InteractionManager.prototype.onPointerMove=function onPointerMove(originalEvent){if(this.supportsTouchEvents&&originalEvent.pointerType==="touch")return;var events=this.normalizeToPointerData(originalEvent);if(events[0].pointerType==="mouse"||events[0].pointerType==="pen"){this.didMove=true;this.cursor=null}var eventLen=events.length;for(var i=0;i<eventLen;i++){var event=events[i];var interactionData=this.getInteractionDataForPointerId(event);var interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);interactionEvent.data.originalEvent=originalEvent;var interactive=event.pointerType==="touch"?this.moveWhenInside:true;this.processInteractive(interactionEvent,this.renderer._lastObjectRendered,this.processPointerMove,interactive);this.emit("pointermove",interactionEvent);if(event.pointerType==="touch")this.emit("touchmove",interactionEvent);if(event.pointerType==="mouse"||event.pointerType==="pen")this.emit("mousemove",interactionEvent)}if(events[0].pointerType==="mouse"){this.setCursorMode(this.cursor)}};InteractionManager.prototype.processPointerMove=function processPointerMove(interactionEvent,displayObject,hit){var data=interactionEvent.data;var isTouch=data.pointerType==="touch";var isMouse=data.pointerType==="mouse"||data.pointerType==="pen";if(isMouse){this.processPointerOverOut(interactionEvent,displayObject,hit)}if(!this.moveWhenInside||hit){this.dispatchEvent(displayObject,"pointermove",interactionEvent);if(isTouch)this.dispatchEvent(displayObject,"touchmove",interactionEvent);if(isMouse)this.dispatchEvent(displayObject,"mousemove",interactionEvent)}};InteractionManager.prototype.onPointerOut=function onPointerOut(originalEvent){if(this.supportsTouchEvents&&originalEvent.pointerType==="touch")return;var events=this.normalizeToPointerData(originalEvent);var event=events[0];if(event.pointerType==="mouse"){this.mouseOverRenderer=false;this.setCursorMode(null)}var interactionData=this.getInteractionDataForPointerId(event);var interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);interactionEvent.data.originalEvent=event;this.processInteractive(interactionEvent,this.renderer._lastObjectRendered,this.processPointerOverOut,false);this.emit("pointerout",interactionEvent);if(event.pointerType==="mouse"||event.pointerType==="pen"){this.emit("mouseout",interactionEvent)}else{this.releaseInteractionDataForPointerId(interactionData.identifier)}};InteractionManager.prototype.processPointerOverOut=function processPointerOverOut(interactionEvent,displayObject,hit){var data=interactionEvent.data;var id=interactionEvent.data.identifier;var isMouse=data.pointerType==="mouse"||data.pointerType==="pen";var trackingData=displayObject.trackedPointers[id];if(hit&&!trackingData){trackingData=displayObject.trackedPointers[id]=new _InteractionTrackingData2.default(id)}if(trackingData===undefined)return;if(hit&&this.mouseOverRenderer){if(!trackingData.over){trackingData.over=true;this.dispatchEvent(displayObject,"pointerover",interactionEvent);if(isMouse){this.dispatchEvent(displayObject,"mouseover",interactionEvent)}}if(isMouse&&this.cursor===null){this.cursor=displayObject.cursor}}else if(trackingData.over){trackingData.over=false;this.dispatchEvent(displayObject,"pointerout",this.eventData);if(isMouse){this.dispatchEvent(displayObject,"mouseout",interactionEvent)}if(trackingData.none){delete displayObject.trackedPointers[id]}}};InteractionManager.prototype.onPointerOver=function onPointerOver(originalEvent){var events=this.normalizeToPointerData(originalEvent);var event=events[0];var interactionData=this.getInteractionDataForPointerId(event);var interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);interactionEvent.data.originalEvent=event;if(event.pointerType==="mouse"){this.mouseOverRenderer=true}this.emit("pointerover",interactionEvent);if(event.pointerType==="mouse"||event.pointerType==="pen"){this.emit("mouseover",interactionEvent)}};InteractionManager.prototype.getInteractionDataForPointerId=function getInteractionDataForPointerId(event){var pointerId=event.pointerId;var interactionData=void 0;if(pointerId===MOUSE_POINTER_ID||event.pointerType==="mouse"){interactionData=this.mouse}else if(this.activeInteractionData[pointerId]){interactionData=this.activeInteractionData[pointerId]}else{interactionData=this.interactionDataPool.pop()||new _InteractionData2.default;interactionData.identifier=pointerId;this.activeInteractionData[pointerId]=interactionData}interactionData.copyEvent(event);return interactionData};InteractionManager.prototype.releaseInteractionDataForPointerId=function releaseInteractionDataForPointerId(pointerId){var interactionData=this.activeInteractionData[pointerId];if(interactionData){delete this.activeInteractionData[pointerId];interactionData.reset();this.interactionDataPool.push(interactionData)}};InteractionManager.prototype.configureInteractionEventForDOMEvent=function configureInteractionEventForDOMEvent(interactionEvent,pointerEvent,interactionData){interactionEvent.data=interactionData;this.mapPositionToPoint(interactionData.global,pointerEvent.clientX,pointerEvent.clientY);if(navigator.isCocoonJS&&pointerEvent.pointerType==="touch"){interactionData.global.x=interactionData.global.x/this.resolution;interactionData.global.y=interactionData.global.y/this.resolution}if(pointerEvent.pointerType==="touch"){pointerEvent.globalX=interactionData.global.x;pointerEvent.globalY=interactionData.global.y}interactionData.originalEvent=pointerEvent;interactionEvent.reset();return interactionEvent};InteractionManager.prototype.normalizeToPointerData=function normalizeToPointerData(event){var normalizedEvents=[];if(this.supportsTouchEvents&&event instanceof TouchEvent){for(var i=0,li=event.changedTouches.length;i<li;i++){var touch=event.changedTouches[i];if(typeof touch.button==="undefined")touch.button=event.touches.length?1:0;if(typeof touch.buttons==="undefined")touch.buttons=event.touches.length?1:0;if(typeof touch.isPrimary==="undefined"){touch.isPrimary=event.touches.length===1&&event.type==="touchstart"}if(typeof touch.width==="undefined")touch.width=touch.radiusX||1;if(typeof touch.height==="undefined")touch.height=touch.radiusY||1;if(typeof touch.tiltX==="undefined")touch.tiltX=0;if(typeof touch.tiltY==="undefined")touch.tiltY=0;if(typeof touch.pointerType==="undefined")touch.pointerType="touch";if(typeof touch.pointerId==="undefined")touch.pointerId=touch.identifier||0;if(typeof touch.pressure==="undefined")touch.pressure=touch.force||.5;if(typeof touch.twist==="undefined")touch.twist=0;if(typeof touch.tangentialPressure==="undefined")touch.tangentialPressure=0;if(typeof touch.layerX==="undefined")touch.layerX=touch.offsetX=touch.clientX;if(typeof touch.layerY==="undefined")touch.layerY=touch.offsetY=touch.clientY;touch.isNormalized=true;normalizedEvents.push(touch)}}else if(event instanceof MouseEvent&&(!this.supportsPointerEvents||!(event instanceof window.PointerEvent))){if(typeof event.isPrimary==="undefined")event.isPrimary=true;if(typeof event.width==="undefined")event.width=1;if(typeof event.height==="undefined")event.height=1;if(typeof event.tiltX==="undefined")event.tiltX=0;if(typeof event.tiltY==="undefined")event.tiltY=0;if(typeof event.pointerType==="undefined")event.pointerType="mouse";if(typeof event.pointerId==="undefined")event.pointerId=MOUSE_POINTER_ID;if(typeof event.pressure==="undefined")event.pressure=.5;if(typeof event.twist==="undefined")event.twist=0;if(typeof event.tangentialPressure==="undefined")event.tangentialPressure=0;event.isNormalized=true;normalizedEvents.push(event)}else{normalizedEvents.push(event)}return normalizedEvents};InteractionManager.prototype.destroy=function destroy(){this.removeEvents();this.removeAllListeners();this.renderer=null;this.mouse=null;this.eventData=null;this.interactionDOMElement=null;this.onPointerDown=null;this.processPointerDown=null;this.onPointerUp=null;this.processPointerUp=null;this.onPointerCancel=null;this.processPointerCancel=null;this.onPointerMove=null;this.processPointerMove=null;this.onPointerOut=null;this.processPointerOverOut=null;this.onPointerOver=null;this._tempPoint=null};return InteractionManager}(_eventemitter2.default);exports.default=InteractionManager;core.WebGLRenderer.registerPlugin("interaction",InteractionManager);core.CanvasRenderer.registerPlugin("interaction",InteractionManager)},{"../core":110,"./InteractionData":201,"./InteractionEvent":202,"./InteractionTrackingData":204,"./interactiveTarget":206,eventemitter3:235}],204:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var InteractionTrackingData=function(){function InteractionTrackingData(pointerId){_classCallCheck(this,InteractionTrackingData);this._pointerId=pointerId;this._flags=InteractionTrackingData.FLAGS.NONE}InteractionTrackingData.prototype._doSet=function _doSet(flag,yn){if(yn){this._flags=this._flags|flag}else{this._flags=this._flags&~flag}};_createClass(InteractionTrackingData,[{key:"pointerId",get:function get(){return this._pointerId}},{key:"flags",get:function get(){return this._flags},set:function set(flags){this._flags=flags}},{key:"none",get:function get(){return this._flags===this.constructor.FLAGS.NONE}},{key:"over",get:function get(){return(this._flags&this.constructor.FLAGS.OVER)!==0},set:function set(yn){this._doSet(this.constructor.FLAGS.OVER,yn)}},{key:"rightDown",get:function get(){return(this._flags&this.constructor.FLAGS.RIGHT_DOWN)!==0},set:function set(yn){this._doSet(this.constructor.FLAGS.RIGHT_DOWN,yn)}},{key:"leftDown",get:function get(){return(this._flags&this.constructor.FLAGS.LEFT_DOWN)!==0},set:function set(yn){this._doSet(this.constructor.FLAGS.LEFT_DOWN,yn)}}]);return InteractionTrackingData}();exports.default=InteractionTrackingData;InteractionTrackingData.FLAGS=Object.freeze({NONE:0,OVER:1<<0,LEFT_DOWN:1<<1,RIGHT_DOWN:1<<2})},{}],205:[function(require,module,exports){"use strict";exports.__esModule=true;var _InteractionData=require("./InteractionData");Object.defineProperty(exports,"InteractionData",{enumerable:true,get:function get(){return _interopRequireDefault(_InteractionData).default}});var _InteractionManager=require("./InteractionManager");Object.defineProperty(exports,"InteractionManager",{enumerable:true,get:function get(){return _interopRequireDefault(_InteractionManager).default}});var _interactiveTarget=require("./interactiveTarget");Object.defineProperty(exports,"interactiveTarget",{enumerable:true,get:function get(){return _interopRequireDefault(_interactiveTarget).default}});var _InteractionTrackingData=require("./InteractionTrackingData");Object.defineProperty(exports,"InteractionTrackingData",{enumerable:true,get:function get(){return _interopRequireDefault(_InteractionTrackingData).default}});var _InteractionEvent=require("./InteractionEvent");Object.defineProperty(exports,"InteractionEvent",{enumerable:true,get:function get(){return _interopRequireDefault(_InteractionEvent).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./InteractionData":201,"./InteractionEvent":202,"./InteractionManager":203,"./InteractionTrackingData":204,"./interactiveTarget":206}],206:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default={interactive:false,interactiveChildren:true,hitArea:null,get buttonMode(){return this.cursor==="pointer"},set buttonMode(value){if(value){this.cursor="pointer"}else if(this.cursor==="pointer"){this.cursor=null}},cursor:null,get trackedPointers(){if(this._trackedPointers===undefined)this._trackedPointers={};return this._trackedPointers},_trackedPointers:undefined}},{}],207:[function(require,module,exports){"use strict";exports.__esModule=true;exports.parse=parse;exports.default=function(){return function bitmapFontParser(resource,next){if(!resource.data||resource.type!==_resourceLoader.Resource.TYPE.XML){next();return}if(resource.data.getElementsByTagName("page").length===0||resource.data.getElementsByTagName("info").length===0||resource.data.getElementsByTagName("info")[0].getAttribute("face")===null){next();return}var xmlUrl=!resource.isDataUrl?path.dirname(resource.url):"";if(resource.isDataUrl){if(xmlUrl==="."){xmlUrl=""}if(this.baseUrl&&xmlUrl){if(this.baseUrl.charAt(this.baseUrl.length-1)==="/"){xmlUrl+="/"}}}xmlUrl=xmlUrl.replace(this.baseUrl,"");if(xmlUrl&&xmlUrl.charAt(xmlUrl.length-1)!=="/"){xmlUrl+="/"}var pages=resource.data.getElementsByTagName("page");var textures={};var completed=function completed(page){textures[page.metadata.pageFile]=page.texture;if(Object.keys(textures).length===pages.length){parse(resource,textures);next()}};for(var i=0;i<pages.length;++i){var pageFile=pages[i].getAttribute("file");var url=xmlUrl+pageFile;var exists=false;for(var name in this.resources){var bitmapResource=this.resources[name];if(bitmapResource.url===url){bitmapResource.metadata.pageFile=pageFile;if(bitmapResource.texture){completed(bitmapResource)}else{bitmapResource.onAfterMiddleware.add(completed)}exists=true;break}}if(!exists){var options={crossOrigin:resource.crossOrigin,loadType:_resourceLoader.Resource.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:pageFile},resource.metadata.imageMetadata),parentResource:resource};this.add(url,options,completed)}}}};var _path=require("path");var path=_interopRequireWildcard(_path);var _resourceLoader=require("resource-loader");var _extras=require("../extras");function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function parse(resource,textures){resource.bitmapFont=_extras.BitmapText.registerFont(resource.data,textures)}},{"../extras":186,path:49,"resource-loader":246}],208:[function(require,module,exports){"use strict";exports.__esModule=true;exports.shared=exports.Resource=exports.textureParser=exports.getResourcePath=exports.spritesheetParser=exports.parseBitmapFontData=exports.bitmapFontParser=exports.Loader=undefined;var _bitmapFontParser=require("./bitmapFontParser");Object.defineProperty(exports,"bitmapFontParser",{enumerable:true,get:function get(){return _interopRequireDefault(_bitmapFontParser).default}});Object.defineProperty(exports,"parseBitmapFontData",{enumerable:true,get:function get(){return _bitmapFontParser.parse}});var _spritesheetParser=require("./spritesheetParser");Object.defineProperty(exports,"spritesheetParser",{enumerable:true,get:function get(){return _interopRequireDefault(_spritesheetParser).default}});Object.defineProperty(exports,"getResourcePath",{enumerable:true,get:function get(){return _spritesheetParser.getResourcePath}});var _textureParser=require("./textureParser");Object.defineProperty(exports,"textureParser",{enumerable:true,get:function get(){return _interopRequireDefault(_textureParser).default}});var _resourceLoader=require("resource-loader");Object.defineProperty(exports,"Resource",{enumerable:true,get:function get(){return _resourceLoader.Resource}});var _Application=require("../core/Application");var _Application2=_interopRequireDefault(_Application);var _loader=require("./loader");var _loader2=_interopRequireDefault(_loader);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.Loader=_loader2.default;var shared=new _loader2.default;shared.destroy=function(){};exports.shared=shared;var AppPrototype=_Application2.default.prototype;AppPrototype._loader=null;Object.defineProperty(AppPrototype,"loader",{get:function get(){if(!this._loader){var sharedLoader=this._options.sharedLoader;this._loader=sharedLoader?shared:new _loader2.default}return this._loader}});AppPrototype._parentDestroy=AppPrototype.destroy;AppPrototype.destroy=function destroy(removeView,stageOptions){if(this._loader){this._loader.destroy();this._loader=null}this._parentDestroy(removeView,stageOptions)}},{"../core/Application":88,"./bitmapFontParser":207,"./loader":209,"./spritesheetParser":210,"./textureParser":211,"resource-loader":246}],209:[function(require,module,exports){"use strict";exports.__esModule=true;var _resourceLoader=require("resource-loader");var _resourceLoader2=_interopRequireDefault(_resourceLoader);var _blob=require("resource-loader/lib/middlewares/parsing/blob");var _eventemitter=require("eventemitter3");var _eventemitter2=_interopRequireDefault(_eventemitter);var _textureParser=require("./textureParser");var _textureParser2=_interopRequireDefault(_textureParser);var _spritesheetParser=require("./spritesheetParser");var _spritesheetParser2=_interopRequireDefault(_spritesheetParser);var _bitmapFontParser=require("./bitmapFontParser");var _bitmapFontParser2=_interopRequireDefault(_bitmapFontParser);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Loader=function(_ResourceLoader){_inherits(Loader,_ResourceLoader);function Loader(baseUrl,concurrency){_classCallCheck(this,Loader);var _this=_possibleConstructorReturn(this,_ResourceLoader.call(this,baseUrl,concurrency));_eventemitter2.default.call(_this);for(var i=0;i<Loader._pixiMiddleware.length;++i){_this.use(Loader._pixiMiddleware[i]())}_this.onStart.add(function(l){return _this.emit("start",l)});_this.onProgress.add(function(l,r){return _this.emit("progress",l,r)});_this.onError.add(function(e,l,r){return _this.emit("error",e,l,r)});_this.onLoad.add(function(l,r){return _this.emit("load",l,r)});_this.onComplete.add(function(l,r){return _this.emit("complete",l,r)});return _this}Loader.addPixiMiddleware=function addPixiMiddleware(fn){Loader._pixiMiddleware.push(fn)};Loader.prototype.destroy=function destroy(){this.removeAllListeners();this.reset()};return Loader}(_resourceLoader2.default);exports.default=Loader;for(var k in _eventemitter2.default.prototype){Loader.prototype[k]=_eventemitter2.default.prototype[k]}Loader._pixiMiddleware=[_blob.blobMiddlewareFactory,_textureParser2.default,_spritesheetParser2.default,_bitmapFontParser2.default];var Resource=_resourceLoader2.default.Resource;Resource.setExtensionXhrType("fnt",Resource.XHR_RESPONSE_TYPE.DOCUMENT)},{"./bitmapFontParser":207,"./spritesheetParser":210,"./textureParser":211,eventemitter3:235,"resource-loader":246,"resource-loader/lib/middlewares/parsing/blob":247}],210:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=function(){return function spritesheetParser(resource,next){var imageResourceName=resource.name+"_image";if(!resource.data||resource.type!==_resourceLoader.Resource.TYPE.JSON||!resource.data.frames||this.resources[imageResourceName]){next();return}var loadOptions={crossOrigin:resource.crossOrigin,metadata:resource.metadata.imageMetadata,parentResource:resource};var resourcePath=getResourcePath(resource,this.baseUrl);this.add(imageResourceName,resourcePath,loadOptions,function onImageLoad(res){if(res.error){next(res.error);return}var spritesheet=new _core.Spritesheet(res.texture.baseTexture,resource.data,resource.url);spritesheet.parse(function(){resource.spritesheet=spritesheet;resource.textures=spritesheet.textures;next()})})}};exports.getResourcePath=getResourcePath;var _resourceLoader=require("resource-loader");var _url=require("url");var _url2=_interopRequireDefault(_url);var _core=require("../core");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getResourcePath(resource,baseUrl){if(resource.isDataUrl){return resource.data.meta.image}return _url2.default.resolve(resource.url.replace(baseUrl,""),resource.data.meta.image)}},{"../core":110,"resource-loader":246,url:248}],211:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=function(){return function textureParser(resource,next){if(resource.data&&resource.type===_resourceLoader.Resource.TYPE.IMAGE){resource.texture=_Texture2.default.fromLoader(resource.data,resource.url,resource.name)}next()}};var _resourceLoader=require("resource-loader");var _Texture=require("../core/textures/Texture");var _Texture2=_interopRequireDefault(_Texture);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"../core/textures/Texture":160,"resource-loader":246}],212:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../core");var core=_interopRequireWildcard(_core);var _Texture=require("../core/textures/Texture");var _Texture2=_interopRequireDefault(_Texture);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var tempPoint=new core.Point;var tempPolygon=new core.Polygon;var Mesh=function(_core$Container){_inherits(Mesh,_core$Container);function Mesh(texture,vertices,uvs,indices,drawMode){_classCallCheck(this,Mesh);var _this=_possibleConstructorReturn(this,_core$Container.call(this));_this._texture=texture||_Texture2.default.EMPTY;_this.uvs=uvs||new Float32Array([0,0,1,0,1,1,0,1]);_this.vertices=vertices||new Float32Array([0,0,100,0,100,100,0,100]);_this.indices=indices||new Uint16Array([0,1,3,2]);_this.dirty=0;_this.indexDirty=0;_this.vertexDirty=0;_this.autoUpdate=true;_this.blendMode=core.BLEND_MODES.NORMAL;_this.canvasPadding=core.settings.MESH_CANVAS_PADDING;_this.drawMode=drawMode||Mesh.DRAW_MODES.TRIANGLE_MESH;_this.shader=null;_this.tintRgb=new Float32Array([1,1,1]);_this._glDatas={};_this._uvTransform=new core.TextureMatrix(_this._texture);_this.uploadUvTransform=false;_this.pluginName="mesh";return _this}Mesh.prototype._renderWebGL=function _renderWebGL(renderer){this.refresh();renderer.setObjectRenderer(renderer.plugins[this.pluginName]);renderer.plugins[this.pluginName].render(this)};Mesh.prototype._renderCanvas=function _renderCanvas(renderer){this.refresh();renderer.plugins[this.pluginName].render(this)};Mesh.prototype._onTextureUpdate=function _onTextureUpdate(){this._uvTransform.texture=this._texture;this.refresh()};Mesh.prototype.multiplyUvs=function multiplyUvs(){if(!this.uploadUvTransform){this._uvTransform.multiplyUvs(this.uvs)}};Mesh.prototype.refresh=function refresh(forceUpdate){if(this.autoUpdate){this.vertexDirty++}if(this._uvTransform.update(forceUpdate)){this._refresh()}};Mesh.prototype._refresh=function _refresh(){};Mesh.prototype._calculateBounds=function _calculateBounds(){this._bounds.addVertices(this.transform,this.vertices,0,this.vertices.length)};Mesh.prototype.containsPoint=function containsPoint(point){if(!this.getBounds().contains(point.x,point.y)){return false}this.worldTransform.applyInverse(point,tempPoint);var vertices=this.vertices;var points=tempPolygon.points;var indices=this.indices;var len=this.indices.length;var step=this.drawMode===Mesh.DRAW_MODES.TRIANGLES?3:1;for(var i=0;i+2<len;i+=step){var ind0=indices[i]*2;var ind1=indices[i+1]*2;var ind2=indices[i+2]*2;points[0]=vertices[ind0];points[1]=vertices[ind0+1];points[2]=vertices[ind1];points[3]=vertices[ind1+1];points[4]=vertices[ind2];points[5]=vertices[ind2+1];if(tempPolygon.contains(tempPoint.x,tempPoint.y)){return true}}return false};Mesh.prototype.destroy=function destroy(options){for(var id in this._glDatas){var data=this._glDatas[id];if(data.destroy){data.destroy()}else{if(data.vertexBuffer){data.vertexBuffer.destroy();data.vertexBuffer=null}if(data.indexBuffer){data.indexBuffer.destroy();data.indexBuffer=null}if(data.uvBuffer){data.uvBuffer.destroy();data.uvBuffer=null}if(data.vao){data.vao.destroy();data.vao=null}}}this._glDatas=null;_core$Container.prototype.destroy.call(this,options)};_createClass(Mesh,[{key:"texture",get:function get(){return this._texture},set:function set(value){if(this._texture===value){return}this._texture=value;if(value){if(value.baseTexture.hasLoaded){this._onTextureUpdate()}else{value.once("update",this._onTextureUpdate,this)}}}},{key:"tint",get:function get(){return core.utils.rgb2hex(this.tintRgb)},set:function set(value){this.tintRgb=core.utils.hex2rgb(value,this.tintRgb)}}]);return Mesh}(core.Container);exports.default=Mesh;Mesh.DRAW_MODES={TRIANGLE_MESH:0,TRIANGLES:1}},{"../core":110,"../core/textures/Texture":160}],213:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _Plane2=require("./Plane");var _Plane3=_interopRequireDefault(_Plane2);var _CanvasTinter=require("../core/sprites/canvas/CanvasTinter");var _CanvasTinter2=_interopRequireDefault(_CanvasTinter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_BORDER_SIZE=10;var NineSlicePlane=function(_Plane){_inherits(NineSlicePlane,_Plane);function NineSlicePlane(texture,leftWidth,topHeight,rightWidth,bottomHeight){_classCallCheck(this,NineSlicePlane);var _this=_possibleConstructorReturn(this,_Plane.call(this,texture,4,4));_this._origWidth=texture.orig.width;_this._origHeight=texture.orig.height;_this._width=_this._origWidth;_this._height=_this._origHeight;_this._leftWidth=typeof leftWidth!=="undefined"?leftWidth:DEFAULT_BORDER_SIZE;_this._rightWidth=typeof rightWidth!=="undefined"?rightWidth:DEFAULT_BORDER_SIZE;_this._topHeight=typeof topHeight!=="undefined"?topHeight:DEFAULT_BORDER_SIZE;_this._bottomHeight=typeof bottomHeight!=="undefined"?bottomHeight:DEFAULT_BORDER_SIZE;_this._cachedTint=16777215;_this._tintedTexture=null;_this._canvasUvs=null;_this.refresh(true);return _this}NineSlicePlane.prototype.updateHorizontalVertices=function updateHorizontalVertices(){var vertices=this.vertices;var h=this._topHeight+this._bottomHeight;var scale=this._height>h?1:this._height/h;vertices[9]=vertices[11]=vertices[13]=vertices[15]=this._topHeight*scale;vertices[17]=vertices[19]=vertices[21]=vertices[23]=this._height-this._bottomHeight*scale;vertices[25]=vertices[27]=vertices[29]=vertices[31]=this._height};NineSlicePlane.prototype.updateVerticalVertices=function updateVerticalVertices(){var vertices=this.vertices;var w=this._leftWidth+this._rightWidth;var scale=this._width>w?1:this._width/w;vertices[2]=vertices[10]=vertices[18]=vertices[26]=this._leftWidth*scale;vertices[4]=vertices[12]=vertices[20]=vertices[28]=this._width-this._rightWidth*scale;vertices[6]=vertices[14]=vertices[22]=vertices[30]=this._width};NineSlicePlane.prototype._renderCanvas=function _renderCanvas(renderer){var context=renderer.context;var transform=this.worldTransform;var res=renderer.resolution;var isTinted=this.tint!==16777215;var texture=this._texture;if(isTinted){if(this._cachedTint!==this.tint){this._cachedTint=this.tint;this._tintedTexture=_CanvasTinter2.default.getTintedTexture(this,this.tint)}}var textureSource=!isTinted?texture.baseTexture.source:this._tintedTexture;if(!this._canvasUvs){this._canvasUvs=[0,0,0,0,0,0,0,0]}var vertices=this.vertices;var uvs=this._canvasUvs;var u0=isTinted?0:texture.frame.x;var v0=isTinted?0:texture.frame.y;var u1=u0+texture.frame.width;var v1=v0+texture.frame.height;uvs[0]=u0;uvs[1]=u0+this._leftWidth;uvs[2]=u1-this._rightWidth;uvs[3]=u1;uvs[4]=v0;uvs[5]=v0+this._topHeight;uvs[6]=v1-this._bottomHeight;uvs[7]=v1;for(var i=0;i<8;i++){uvs[i]*=texture.baseTexture.resolution}context.globalAlpha=this.worldAlpha;renderer.setBlendMode(this.blendMode);if(renderer.roundPixels){context.setTransform(transform.a*res,transform.b*res,transform.c*res,transform.d*res,transform.tx*res|0,transform.ty*res|0)}else{context.setTransform(transform.a*res,transform.b*res,transform.c*res,transform.d*res,transform.tx*res,transform.ty*res)}for(var row=0;row<3;row++){for(var col=0;col<3;col++){var ind=col*2+row*8;var sw=Math.max(1,uvs[col+1]-uvs[col]);var sh=Math.max(1,uvs[row+5]-uvs[row+4]);var dw=Math.max(1,vertices[ind+10]-vertices[ind]);var dh=Math.max(1,vertices[ind+11]-vertices[ind+1]);context.drawImage(textureSource,uvs[col],uvs[row+4],sw,sh,vertices[ind],vertices[ind+1],dw,dh)}}};NineSlicePlane.prototype._refresh=function _refresh(){_Plane.prototype._refresh.call(this);var uvs=this.uvs;var texture=this._texture;this._origWidth=texture.orig.width;this._origHeight=texture.orig.height;var _uvw=1/this._origWidth;var _uvh=1/this._origHeight;uvs[0]=uvs[8]=uvs[16]=uvs[24]=0;uvs[1]=uvs[3]=uvs[5]=uvs[7]=0;uvs[6]=uvs[14]=uvs[22]=uvs[30]=1;uvs[25]=uvs[27]=uvs[29]=uvs[31]=1;uvs[2]=uvs[10]=uvs[18]=uvs[26]=_uvw*this._leftWidth;uvs[4]=uvs[12]=uvs[20]=uvs[28]=1-_uvw*this._rightWidth;uvs[9]=uvs[11]=uvs[13]=uvs[15]=_uvh*this._topHeight;uvs[17]=uvs[19]=uvs[21]=uvs[23]=1-_uvh*this._bottomHeight;this.updateHorizontalVertices();this.updateVerticalVertices();this.dirty++;this.multiplyUvs()};_createClass(NineSlicePlane,[{key:"width",get:function get(){return this._width},set:function set(value){this._width=value;this._refresh()}},{key:"height",get:function get(){return this._height},set:function set(value){this._height=value;this._refresh()}},{key:"leftWidth",get:function get(){return this._leftWidth},set:function set(value){this._leftWidth=value;this._refresh()}},{key:"rightWidth",get:function get(){return this._rightWidth},set:function set(value){this._rightWidth=value;this._refresh()}},{key:"topHeight",get:function get(){return this._topHeight},set:function set(value){this._topHeight=value;this._refresh()}},{key:"bottomHeight",get:function get(){return this._bottomHeight},set:function set(value){this._bottomHeight=value;this._refresh()}}]);return NineSlicePlane}(_Plane3.default);exports.default=NineSlicePlane},{"../core/sprites/canvas/CanvasTinter":149,"./Plane":214}],214:[function(require,module,exports){"use strict";exports.__esModule=true;var _Mesh2=require("./Mesh");var _Mesh3=_interopRequireDefault(_Mesh2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Plane=function(_Mesh){_inherits(Plane,_Mesh);function Plane(texture,verticesX,verticesY){_classCallCheck(this,Plane);var _this=_possibleConstructorReturn(this,_Mesh.call(this,texture));_this._ready=true;_this.verticesX=verticesX||10;_this.verticesY=verticesY||10;_this.drawMode=_Mesh3.default.DRAW_MODES.TRIANGLES;_this.refresh();return _this}Plane.prototype._refresh=function _refresh(){var texture=this._texture;var total=this.verticesX*this.verticesY;var verts=[];var colors=[];var uvs=[];var indices=[];var segmentsX=this.verticesX-1;var segmentsY=this.verticesY-1;var sizeX=texture.width/segmentsX;var sizeY=texture.height/segmentsY;for(var i=0;i<total;i++){var x=i%this.verticesX;var y=i/this.verticesX|0;verts.push(x*sizeX,y*sizeY);uvs.push(x/segmentsX,y/segmentsY)}var totalSub=segmentsX*segmentsY;for(var _i=0;_i<totalSub;_i++){var xpos=_i%segmentsX;var ypos=_i/segmentsX|0;var value=ypos*this.verticesX+xpos;var value2=ypos*this.verticesX+xpos+1;var value3=(ypos+1)*this.verticesX+xpos;var value4=(ypos+1)*this.verticesX+xpos+1;indices.push(value,value2,value3);indices.push(value2,value4,value3)}this.vertices=new Float32Array(verts);this.uvs=new Float32Array(uvs);this.colors=new Float32Array(colors);this.indices=new Uint16Array(indices);this.dirty++;this.indexDirty++;this.multiplyUvs()};Plane.prototype._onTextureUpdate=function _onTextureUpdate(){_Mesh3.default.prototype._onTextureUpdate.call(this);if(this._ready){this.refresh()}};return Plane}(_Mesh3.default);exports.default=Plane},{"./Mesh":212}],215:[function(require,module,exports){"use strict";exports.__esModule=true;var _Mesh2=require("./Mesh");var _Mesh3=_interopRequireDefault(_Mesh2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Rope=function(_Mesh){_inherits(Rope,_Mesh);function Rope(texture,points){_classCallCheck(this,Rope);var _this=_possibleConstructorReturn(this,_Mesh.call(this,texture));_this.points=points;_this.vertices=new Float32Array(points.length*4);_this.uvs=new Float32Array(points.length*4);_this.colors=new Float32Array(points.length*2);_this.indices=new Uint16Array(points.length*2);_this.autoUpdate=true;_this.refresh();return _this}Rope.prototype._refresh=function _refresh(){var points=this.points;if(points.length<1||!this._texture._uvs){return}if(this.vertices.length/4!==points.length){this.vertices=new Float32Array(points.length*4);this.uvs=new Float32Array(points.length*4);this.colors=new Float32Array(points.length*2);this.indices=new Uint16Array(points.length*2)}var uvs=this.uvs;var indices=this.indices;var colors=this.colors;uvs[0]=0;uvs[1]=0;uvs[2]=0;uvs[3]=1;colors[0]=1;colors[1]=1;indices[0]=0;indices[1]=1;var total=points.length;for(var i=1;i<total;i++){var index=i*4;var amount=i/(total-1);uvs[index]=amount;uvs[index+1]=0;uvs[index+2]=amount;uvs[index+3]=1;index=i*2;colors[index]=1;colors[index+1]=1;index=i*2;indices[index]=index;indices[index+1]=index+1}this.dirty++;this.indexDirty++;this.multiplyUvs();this.refreshVertices()};Rope.prototype.refreshVertices=function refreshVertices(){var points=this.points;if(points.length<1){return}var lastPoint=points[0];var nextPoint=void 0;var perpX=0;var perpY=0;var vertices=this.vertices;var total=points.length;for(var i=0;i<total;i++){var point=points[i];var index=i*4;if(i<points.length-1){nextPoint=points[i+1]}else{nextPoint=point}perpY=-(nextPoint.x-lastPoint.x);perpX=nextPoint.y-lastPoint.y;var ratio=(1-i/(total-1))*10;if(ratio>1){ratio=1}var perpLength=Math.sqrt(perpX*perpX+perpY*perpY);var num=this._texture.height/2;perpX/=perpLength;perpY/=perpLength;perpX*=num;perpY*=num;vertices[index]=point.x+perpX;vertices[index+1]=point.y+perpY;vertices[index+2]=point.x-perpX;vertices[index+3]=point.y-perpY;lastPoint=point}};Rope.prototype.updateTransform=function updateTransform(){if(this.autoUpdate){this.refreshVertices()}this.containerUpdateTransform()};return Rope}(_Mesh3.default);exports.default=Rope},{"./Mesh":212}],216:[function(require,module,exports){"use strict";exports.__esModule=true;var _core=require("../../core");var core=_interopRequireWildcard(_core);var _Mesh=require("../Mesh");var _Mesh2=_interopRequireDefault(_Mesh);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var MeshSpriteRenderer=function(){function MeshSpriteRenderer(renderer){_classCallCheck(this,MeshSpriteRenderer);this.renderer=renderer}MeshSpriteRenderer.prototype.render=function render(mesh){var renderer=this.renderer;var context=renderer.context;var transform=mesh.worldTransform;var res=renderer.resolution;if(renderer.roundPixels){context.setTransform(transform.a*res,transform.b*res,transform.c*res,transform.d*res,transform.tx*res|0,transform.ty*res|0)}else{context.setTransform(transform.a*res,transform.b*res,transform.c*res,transform.d*res,transform.tx*res,transform.ty*res)}renderer.context.globalAlpha=mesh.worldAlpha;renderer.setBlendMode(mesh.blendMode);if(mesh.drawMode===_Mesh2.default.DRAW_MODES.TRIANGLE_MESH){this._renderTriangleMesh(mesh)}else{this._renderTriangles(mesh)}};MeshSpriteRenderer.prototype._renderTriangleMesh=function _renderTriangleMesh(mesh){var length=mesh.vertices.length/2;for(var i=0;i<length-2;i++){var index=i*2;this._renderDrawTriangle(mesh,index,index+2,index+4)}};MeshSpriteRenderer.prototype._renderTriangles=function _renderTriangles(mesh){var indices=mesh.indices;var length=indices.length;for(var i=0;i<length;i+=3){var index0=indices[i]*2;var index1=indices[i+1]*2;var index2=indices[i+2]*2;this._renderDrawTriangle(mesh,index0,index1,index2)}};MeshSpriteRenderer.prototype._renderDrawTriangle=function _renderDrawTriangle(mesh,index0,index1,index2){var context=this.renderer.context;var uvs=mesh.uvs;var vertices=mesh.vertices;var texture=mesh._texture;if(!texture.valid){return}var base=texture.baseTexture;var textureSource=base.source;var textureWidth=base.width;var textureHeight=base.height;var u0=void 0;var u1=void 0;var u2=void 0;var v0=void 0;var v1=void 0;var v2=void 0;if(mesh.uploadUvTransform){var ut=mesh._uvTransform.mapCoord;u0=(uvs[index0]*ut.a+uvs[index0+1]*ut.c+ut.tx)*base.width;u1=(uvs[index1]*ut.a+uvs[index1+1]*ut.c+ut.tx)*base.width;u2=(uvs[index2]*ut.a+uvs[index2+1]*ut.c+ut.tx)*base.width;v0=(uvs[index0]*ut.b+uvs[index0+1]*ut.d+ut.ty)*base.height;v1=(uvs[index1]*ut.b+uvs[index1+1]*ut.d+ut.ty)*base.height;v2=(uvs[index2]*ut.b+uvs[index2+1]*ut.d+ut.ty)*base.height}else{u0=uvs[index0]*base.width;u1=uvs[index1]*base.width;u2=uvs[index2]*base.width;v0=uvs[index0+1]*base.height;v1=uvs[index1+1]*base.height;v2=uvs[index2+1]*base.height}var x0=vertices[index0];var x1=vertices[index1];var x2=vertices[index2];var y0=vertices[index0+1];var y1=vertices[index1+1];var y2=vertices[index2+1];var canvasPadding=mesh.canvasPadding/this.renderer.resolution;if(canvasPadding>0){var paddingX=canvasPadding/Math.abs(mesh.worldTransform.a);var paddingY=canvasPadding/Math.abs(mesh.worldTransform.d);var centerX=(x0+x1+x2)/3;var centerY=(y0+y1+y2)/3;var normX=x0-centerX;var normY=y0-centerY;var dist=Math.sqrt(normX*normX+normY*normY);x0=centerX+normX/dist*(dist+paddingX);y0=centerY+normY/dist*(dist+paddingY);normX=x1-centerX;normY=y1-centerY;dist=Math.sqrt(normX*normX+normY*normY);x1=centerX+normX/dist*(dist+paddingX);y1=centerY+normY/dist*(dist+paddingY);normX=x2-centerX;normY=y2-centerY;dist=Math.sqrt(normX*normX+normY*normY);x2=centerX+normX/dist*(dist+paddingX);y2=centerY+normY/dist*(dist+paddingY)}context.save();context.beginPath();context.moveTo(x0,y0);context.lineTo(x1,y1);context.lineTo(x2,y2);context.closePath();context.clip();var delta=u0*v1+v0*u2+u1*v2-v1*u2-v0*u1-u0*v2;var deltaA=x0*v1+v0*x2+x1*v2-v1*x2-v0*x1-x0*v2;var deltaB=u0*x1+x0*u2+u1*x2-x1*u2-x0*u1-u0*x2;var deltaC=u0*v1*x2+v0*x1*u2+x0*u1*v2-x0*v1*u2-v0*u1*x2-u0*x1*v2;var deltaD=y0*v1+v0*y2+y1*v2-v1*y2-v0*y1-y0*v2;var deltaE=u0*y1+y0*u2+u1*y2-y1*u2-y0*u1-u0*y2;var deltaF=u0*v1*y2+v0*y1*u2+y0*u1*v2-y0*v1*u2-v0*u1*y2-u0*y1*v2;context.transform(deltaA/delta,deltaD/delta,deltaB/delta,deltaE/delta,deltaC/delta,deltaF/delta);context.drawImage(textureSource,0,0,textureWidth*base.resolution,textureHeight*base.resolution,0,0,textureWidth,textureHeight);context.restore();this.renderer.invalidateBlendMode()};MeshSpriteRenderer.prototype.renderMeshFlat=function renderMeshFlat(mesh){var context=this.renderer.context;var vertices=mesh.vertices;var length=vertices.length/2;context.beginPath();for(var i=1;i<length-2;++i){var index=i*2;var x0=vertices[index];var y0=vertices[index+1];var x1=vertices[index+2];var y1=vertices[index+3];var x2=vertices[index+4];var y2=vertices[index+5];context.moveTo(x0,y0);context.lineTo(x1,y1);context.lineTo(x2,y2)}context.fillStyle="#FF0000";context.fill();context.closePath()};MeshSpriteRenderer.prototype.destroy=function destroy(){this.renderer=null};return MeshSpriteRenderer}();exports.default=MeshSpriteRenderer;core.CanvasRenderer.registerPlugin("mesh",MeshSpriteRenderer)},{"../../core":110,"../Mesh":212}],217:[function(require,module,exports){"use strict";exports.__esModule=true;var _Mesh=require("./Mesh");Object.defineProperty(exports,"Mesh",{enumerable:true,get:function get(){return _interopRequireDefault(_Mesh).default}});var _MeshRenderer=require("./webgl/MeshRenderer");Object.defineProperty(exports,"MeshRenderer",{enumerable:true,get:function get(){return _interopRequireDefault(_MeshRenderer).default}});var _CanvasMeshRenderer=require("./canvas/CanvasMeshRenderer");Object.defineProperty(exports,"CanvasMeshRenderer",{enumerable:true,get:function get(){return _interopRequireDefault(_CanvasMeshRenderer).default}});var _Plane=require("./Plane");Object.defineProperty(exports,"Plane",{enumerable:true,get:function get(){return _interopRequireDefault(_Plane).default}});var _NineSlicePlane=require("./NineSlicePlane");Object.defineProperty(exports,"NineSlicePlane",{enumerable:true,get:function get(){return _interopRequireDefault(_NineSlicePlane).default}});var _Rope=require("./Rope");Object.defineProperty(exports,"Rope",{enumerable:true,get:function get(){return _interopRequireDefault(_Rope).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./Mesh":212,"./NineSlicePlane":213,"./Plane":214,"./Rope":215,"./canvas/CanvasMeshRenderer":216,"./webgl/MeshRenderer":218}],218:[function(require,module,exports){"use strict";exports.__esModule=true;var _core=require("../../core");var core=_interopRequireWildcard(_core);var _pixiGlCore=require("pixi-gl-core");var _pixiGlCore2=_interopRequireDefault(_pixiGlCore);var _Mesh=require("../Mesh");var _Mesh2=_interopRequireDefault(_Mesh);var _path=require("path");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var matrixIdentity=core.Matrix.IDENTITY;var MeshRenderer=function(_core$ObjectRenderer){_inherits(MeshRenderer,_core$ObjectRenderer);function MeshRenderer(renderer){_classCallCheck(this,MeshRenderer);var _this=_possibleConstructorReturn(this,_core$ObjectRenderer.call(this,renderer));_this.shader=null;return _this}MeshRenderer.prototype.onContextChange=function onContextChange(){var gl=this.renderer.gl;this.shader=new core.Shader(gl,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n")};MeshRenderer.prototype.render=function render(mesh){var renderer=this.renderer;var gl=renderer.gl;var texture=mesh._texture;if(!texture.valid){return}var glData=mesh._glDatas[renderer.CONTEXT_UID];if(!glData){renderer.bindVao(null);glData={shader:this.shader,vertexBuffer:_pixiGlCore2.default.GLBuffer.createVertexBuffer(gl,mesh.vertices,gl.STREAM_DRAW),uvBuffer:_pixiGlCore2.default.GLBuffer.createVertexBuffer(gl,mesh.uvs,gl.STREAM_DRAW),indexBuffer:_pixiGlCore2.default.GLBuffer.createIndexBuffer(gl,mesh.indices,gl.STATIC_DRAW),vao:null,dirty:mesh.dirty,indexDirty:mesh.indexDirty,vertexDirty:mesh.vertexDirty};glData.vao=new _pixiGlCore2.default.VertexArrayObject(gl).addIndex(glData.indexBuffer).addAttribute(glData.vertexBuffer,glData.shader.attributes.aVertexPosition,gl.FLOAT,false,2*4,0).addAttribute(glData.uvBuffer,glData.shader.attributes.aTextureCoord,gl.FLOAT,false,2*4,0);mesh._glDatas[renderer.CONTEXT_UID]=glData}renderer.bindVao(glData.vao);if(mesh.dirty!==glData.dirty){glData.dirty=mesh.dirty;glData.uvBuffer.upload(mesh.uvs)}if(mesh.indexDirty!==glData.indexDirty){glData.indexDirty=mesh.indexDirty;glData.indexBuffer.upload(mesh.indices)}if(mesh.vertexDirty!==glData.vertexDirty){glData.vertexDirty=mesh.vertexDirty;glData.vertexBuffer.upload(mesh.vertices)}renderer.bindShader(glData.shader);glData.shader.uniforms.uSampler=renderer.bindTexture(texture);renderer.state.setBlendMode(core.utils.correctBlendMode(mesh.blendMode,texture.baseTexture.premultipliedAlpha));if(glData.shader.uniforms.uTransform){if(mesh.uploadUvTransform){glData.shader.uniforms.uTransform=mesh._uvTransform.mapCoord.toArray(true)}else{glData.shader.uniforms.uTransform=matrixIdentity.toArray(true)}}glData.shader.uniforms.translationMatrix=mesh.worldTransform.toArray(true);glData.shader.uniforms.uColor=core.utils.premultiplyRgba(mesh.tintRgb,mesh.worldAlpha,glData.shader.uniforms.uColor,texture.baseTexture.premultipliedAlpha);var drawMode=mesh.drawMode===_Mesh2.default.DRAW_MODES.TRIANGLE_MESH?gl.TRIANGLE_STRIP:gl.TRIANGLES;glData.vao.draw(drawMode,mesh.indices.length,0)};return MeshRenderer}(core.ObjectRenderer);exports.default=MeshRenderer;core.WebGLRenderer.registerPlugin("mesh",MeshRenderer)},{"../../core":110,"../Mesh":212,path:49,"pixi-gl-core":60}],219:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../core");var core=_interopRequireWildcard(_core);var _utils=require("../core/utils");function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ParticleContainer=function(_core$Container){_inherits(ParticleContainer,_core$Container);function ParticleContainer(){var maxSize=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1500;var properties=arguments[1];var batchSize=arguments.length>2&&arguments[2]!==undefined?arguments[2]:16384;var autoResize=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;_classCallCheck(this,ParticleContainer);var _this=_possibleConstructorReturn(this,_core$Container.call(this));var maxBatchSize=16384;if(batchSize>maxBatchSize){batchSize=maxBatchSize}if(batchSize>maxSize){batchSize=maxSize}_this._properties=[false,true,false,false,false];_this._maxSize=maxSize;_this._batchSize=batchSize;_this._glBuffers={};_this._bufferUpdateIDs=[];_this._updateID=0;_this.interactiveChildren=false;_this.blendMode=core.BLEND_MODES.NORMAL;_this.autoResize=autoResize;_this.roundPixels=true;_this.baseTexture=null;_this.setProperties(properties);_this._tint=0;_this.tintRgb=new Float32Array(4);_this.tint=16777215;return _this}ParticleContainer.prototype.setProperties=function setProperties(properties){if(properties){this._properties[0]="vertices"in properties||"scale"in properties?!!properties.vertices||!!properties.scale:this._properties[0];this._properties[1]="position"in properties?!!properties.position:this._properties[1];this._properties[2]="rotation"in properties?!!properties.rotation:this._properties[2];this._properties[3]="uvs"in properties?!!properties.uvs:this._properties[3];this._properties[4]="tint"in properties||"alpha"in properties?!!properties.tint||!!properties.alpha:this._properties[4]}};ParticleContainer.prototype.updateTransform=function updateTransform(){this.displayObjectUpdateTransform()};ParticleContainer.prototype.renderWebGL=function renderWebGL(renderer){var _this2=this;if(!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable){return}if(!this.baseTexture){this.baseTexture=this.children[0]._texture.baseTexture;if(!this.baseTexture.hasLoaded){this.baseTexture.once("update",function(){return _this2.onChildrenChange(0)})}}renderer.setObjectRenderer(renderer.plugins.particle);renderer.plugins.particle.render(this)};ParticleContainer.prototype.onChildrenChange=function onChildrenChange(smallestChildIndex){var bufferIndex=Math.floor(smallestChildIndex/this._batchSize);while(this._bufferUpdateIDs.length<bufferIndex){this._bufferUpdateIDs.push(0)}this._bufferUpdateIDs[bufferIndex]=++this._updateID};ParticleContainer.prototype.renderCanvas=function renderCanvas(renderer){if(!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable){return}var context=renderer.context;var transform=this.worldTransform;var isRotated=true;var positionX=0;var positionY=0;var finalWidth=0;var finalHeight=0;renderer.setBlendMode(this.blendMode);context.globalAlpha=this.worldAlpha;this.displayObjectUpdateTransform();for(var i=0;i<this.children.length;++i){var child=this.children[i];if(!child.visible){continue}var frame=child._texture.frame;context.globalAlpha=this.worldAlpha*child.alpha;if(child.rotation%(Math.PI*2)===0){if(isRotated){context.setTransform(transform.a,transform.b,transform.c,transform.d,transform.tx*renderer.resolution,transform.ty*renderer.resolution);isRotated=false}positionX=child.anchor.x*(-frame.width*child.scale.x)+child.position.x+.5;positionY=child.anchor.y*(-frame.height*child.scale.y)+child.position.y+.5;finalWidth=frame.width*child.scale.x;finalHeight=frame.height*child.scale.y}else{if(!isRotated){isRotated=true}child.displayObjectUpdateTransform();var childTransform=child.worldTransform;if(renderer.roundPixels){context.setTransform(childTransform.a,childTransform.b,childTransform.c,childTransform.d,childTransform.tx*renderer.resolution|0,childTransform.ty*renderer.resolution|0)}else{context.setTransform(childTransform.a,childTransform.b,childTransform.c,childTransform.d,childTransform.tx*renderer.resolution,childTransform.ty*renderer.resolution)}positionX=child.anchor.x*-frame.width+.5;positionY=child.anchor.y*-frame.height+.5;finalWidth=frame.width;finalHeight=frame.height}var resolution=child._texture.baseTexture.resolution;context.drawImage(child._texture.baseTexture.source,frame.x*resolution,frame.y*resolution,frame.width*resolution,frame.height*resolution,positionX*renderer.resolution,positionY*renderer.resolution,finalWidth*renderer.resolution,finalHeight*renderer.resolution)}};ParticleContainer.prototype.destroy=function destroy(options){_core$Container.prototype.destroy.call(this,options);if(this._buffers){for(var i=0;i<this._buffers.length;++i){this._buffers[i].destroy()}}this._properties=null;this._buffers=null;this._bufferUpdateIDs=null};_createClass(ParticleContainer,[{key:"tint",get:function get(){return this._tint},set:function set(value){this._tint=value;(0,_utils.hex2rgb)(value,this.tintRgb)}}]);return ParticleContainer}(core.Container);exports.default=ParticleContainer},{"../core":110,"../core/utils":170}],220:[function(require,module,exports){"use strict";exports.__esModule=true;var _ParticleContainer=require("./ParticleContainer");Object.defineProperty(exports,"ParticleContainer",{enumerable:true,get:function get(){return _interopRequireDefault(_ParticleContainer).default}});var _ParticleRenderer=require("./webgl/ParticleRenderer");Object.defineProperty(exports,"ParticleRenderer",{enumerable:true,get:function get(){return _interopRequireDefault(_ParticleRenderer).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./ParticleContainer":219,"./webgl/ParticleRenderer":222}],221:[function(require,module,exports){"use strict";exports.__esModule=true;var _pixiGlCore=require("pixi-gl-core");var _pixiGlCore2=_interopRequireDefault(_pixiGlCore);var _createIndicesForQuads=require("../../core/utils/createIndicesForQuads");var _createIndicesForQuads2=_interopRequireDefault(_createIndicesForQuads);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ParticleBuffer=function(){function ParticleBuffer(gl,properties,dynamicPropertyFlags,size){_classCallCheck(this,ParticleBuffer);this.gl=gl;this.size=size;this.dynamicProperties=[];this.staticProperties=[];for(var i=0;i<properties.length;++i){var property=properties[i];property={attribute:property.attribute,size:property.size,uploadFunction:property.uploadFunction,unsignedByte:property.unsignedByte,offset:property.offset};if(dynamicPropertyFlags[i]){this.dynamicProperties.push(property)}else{this.staticProperties.push(property)}}this.staticStride=0;this.staticBuffer=null;this.staticData=null;this.staticDataUint32=null;this.dynamicStride=0;this.dynamicBuffer=null;this.dynamicData=null;this.dynamicDataUint32=null;this._updateID=0;this.initBuffers()}ParticleBuffer.prototype.initBuffers=function initBuffers(){var gl=this.gl;var dynamicOffset=0;this.indices=(0,_createIndicesForQuads2.default)(this.size);this.indexBuffer=_pixiGlCore2.default.GLBuffer.createIndexBuffer(gl,this.indices,gl.STATIC_DRAW);this.dynamicStride=0;for(var i=0;i<this.dynamicProperties.length;++i){var property=this.dynamicProperties[i];property.offset=dynamicOffset;dynamicOffset+=property.size;this.dynamicStride+=property.size}var dynBuffer=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(dynBuffer);this.dynamicDataUint32=new Uint32Array(dynBuffer);this.dynamicBuffer=_pixiGlCore2.default.GLBuffer.createVertexBuffer(gl,dynBuffer,gl.STREAM_DRAW);var staticOffset=0;this.staticStride=0;for(var _i=0;_i<this.staticProperties.length;++_i){var _property=this.staticProperties[_i];_property.offset=staticOffset;staticOffset+=_property.size;this.staticStride+=_property.size}var statBuffer=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(statBuffer);this.staticDataUint32=new Uint32Array(statBuffer);this.staticBuffer=_pixiGlCore2.default.GLBuffer.createVertexBuffer(gl,statBuffer,gl.STATIC_DRAW);this.vao=new _pixiGlCore2.default.VertexArrayObject(gl).addIndex(this.indexBuffer);for(var _i2=0;_i2<this.dynamicProperties.length;++_i2){var _property2=this.dynamicProperties[_i2];if(_property2.unsignedByte){this.vao.addAttribute(this.dynamicBuffer,_property2.attribute,gl.UNSIGNED_BYTE,true,this.dynamicStride*4,_property2.offset*4)}else{this.vao.addAttribute(this.dynamicBuffer,_property2.attribute,gl.FLOAT,false,this.dynamicStride*4,_property2.offset*4)}}for(var _i3=0;_i3<this.staticProperties.length;++_i3){var _property3=this.staticProperties[_i3];if(_property3.unsignedByte){this.vao.addAttribute(this.staticBuffer,_property3.attribute,gl.UNSIGNED_BYTE,true,this.staticStride*4,_property3.offset*4)}else{this.vao.addAttribute(this.staticBuffer,_property3.attribute,gl.FLOAT,false,this.staticStride*4,_property3.offset*4)}}};ParticleBuffer.prototype.uploadDynamic=function uploadDynamic(children,startIndex,amount){for(var i=0;i<this.dynamicProperties.length;i++){var property=this.dynamicProperties[i];property.uploadFunction(children,startIndex,amount,property.unsignedByte?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,property.offset)}this.dynamicBuffer.upload()};ParticleBuffer.prototype.uploadStatic=function uploadStatic(children,startIndex,amount){for(var i=0;i<this.staticProperties.length;i++){var property=this.staticProperties[i];property.uploadFunction(children,startIndex,amount,property.unsignedByte?this.staticDataUint32:this.staticData,this.staticStride,property.offset)}this.staticBuffer.upload()};ParticleBuffer.prototype.destroy=function destroy(){this.dynamicProperties=null;this.dynamicBuffer.destroy();this.dynamicBuffer=null;this.dynamicData=null;this.dynamicDataUint32=null;this.staticProperties=null;this.staticBuffer.destroy();this.staticBuffer=null;this.staticData=null;this.staticDataUint32=null};return ParticleBuffer}();exports.default=ParticleBuffer},{"../../core/utils/createIndicesForQuads":168,"pixi-gl-core":60}],222:[function(require,module,exports){"use strict";exports.__esModule=true;var _core=require("../../core");var core=_interopRequireWildcard(_core);var _ParticleShader=require("./ParticleShader");var _ParticleShader2=_interopRequireDefault(_ParticleShader);var _ParticleBuffer=require("./ParticleBuffer");var _ParticleBuffer2=_interopRequireDefault(_ParticleBuffer);var _utils=require("../../core/utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ParticleRenderer=function(_core$ObjectRenderer){_inherits(ParticleRenderer,_core$ObjectRenderer);function ParticleRenderer(renderer){_classCallCheck(this,ParticleRenderer);var _this=_possibleConstructorReturn(this,_core$ObjectRenderer.call(this,renderer));_this.shader=null;_this.indexBuffer=null;_this.properties=null;_this.tempMatrix=new core.Matrix;_this.CONTEXT_UID=0;return _this}ParticleRenderer.prototype.onContextChange=function onContextChange(){var gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID;this.shader=new _ParticleShader2.default(gl);this.properties=[{attribute:this.shader.attributes.aVertexPosition,size:2,uploadFunction:this.uploadVertices,offset:0},{attribute:this.shader.attributes.aPositionCoord,size:2,uploadFunction:this.uploadPosition,offset:0},{attribute:this.shader.attributes.aRotation,size:1,uploadFunction:this.uploadRotation,offset:0},{attribute:this.shader.attributes.aTextureCoord,size:2,uploadFunction:this.uploadUvs,offset:0},{attribute:this.shader.attributes.aColor,size:1,unsignedByte:true,uploadFunction:this.uploadTint,offset:0}]};ParticleRenderer.prototype.start=function start(){this.renderer.bindShader(this.shader)};ParticleRenderer.prototype.render=function render(container){var children=container.children;var maxSize=container._maxSize;var batchSize=container._batchSize;var renderer=this.renderer;var totalChildren=children.length;if(totalChildren===0){return}else if(totalChildren>maxSize){totalChildren=maxSize}var buffers=container._glBuffers[renderer.CONTEXT_UID];if(!buffers){buffers=container._glBuffers[renderer.CONTEXT_UID]=this.generateBuffers(container)}var baseTexture=children[0]._texture.baseTexture;this.renderer.setBlendMode(core.utils.correctBlendMode(container.blendMode,baseTexture.premultipliedAlpha));var gl=renderer.gl;var m=container.worldTransform.copy(this.tempMatrix);m.prepend(renderer._activeRenderTarget.projectionMatrix);this.shader.uniforms.projectionMatrix=m.toArray(true);this.shader.uniforms.uColor=core.utils.premultiplyRgba(container.tintRgb,container.worldAlpha,this.shader.uniforms.uColor,baseTexture.premultipliedAlpha);this.shader.uniforms.uSampler=renderer.bindTexture(baseTexture);var updateStatic=false;for(var i=0,j=0;i<totalChildren;i+=batchSize,j+=1){var amount=totalChildren-i;if(amount>batchSize){amount=batchSize}if(j>=buffers.length){if(!container.autoResize){break}buffers.push(this._generateOneMoreBuffer(container))}var buffer=buffers[j];buffer.uploadDynamic(children,i,amount);var bid=container._bufferUpdateIDs[j]||0;updateStatic=updateStatic||buffer._updateID<bid;if(updateStatic){buffer._updateID=container._updateID;buffer.uploadStatic(children,i,amount)}renderer.bindVao(buffer.vao);buffer.vao.draw(gl.TRIANGLES,amount*6)}};ParticleRenderer.prototype.generateBuffers=function generateBuffers(container){var gl=this.renderer.gl;var buffers=[];var size=container._maxSize;var batchSize=container._batchSize;var dynamicPropertyFlags=container._properties;for(var i=0;i<size;i+=batchSize){buffers.push(new _ParticleBuffer2.default(gl,this.properties,dynamicPropertyFlags,batchSize))}return buffers};ParticleRenderer.prototype._generateOneMoreBuffer=function _generateOneMoreBuffer(container){var gl=this.renderer.gl;var batchSize=container._batchSize;var dynamicPropertyFlags=container._properties;return new _ParticleBuffer2.default(gl,this.properties,dynamicPropertyFlags,batchSize)};ParticleRenderer.prototype.uploadVertices=function uploadVertices(children,startIndex,amount,array,stride,offset){var w0=0;var w1=0;var h0=0;var h1=0;for(var i=0;i<amount;++i){var sprite=children[startIndex+i];var texture=sprite._texture;var sx=sprite.scale.x;var sy=sprite.scale.y;var trim=texture.trim;var orig=texture.orig;if(trim){w1=trim.x-sprite.anchor.x*orig.width;w0=w1+trim.width;h1=trim.y-sprite.anchor.y*orig.height;h0=h1+trim.height}else{w0=orig.width*(1-sprite.anchor.x);w1=orig.width*-sprite.anchor.x;h0=orig.height*(1-sprite.anchor.y);h1=orig.height*-sprite.anchor.y}array[offset]=w1*sx;array[offset+1]=h1*sy;array[offset+stride]=w0*sx;array[offset+stride+1]=h1*sy;array[offset+stride*2]=w0*sx;array[offset+stride*2+1]=h0*sy;array[offset+stride*3]=w1*sx;array[offset+stride*3+1]=h0*sy;offset+=stride*4}};ParticleRenderer.prototype.uploadPosition=function uploadPosition(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;i++){var spritePosition=children[startIndex+i].position;array[offset]=spritePosition.x;array[offset+1]=spritePosition.y;array[offset+stride]=spritePosition.x;array[offset+stride+1]=spritePosition.y;array[offset+stride*2]=spritePosition.x;array[offset+stride*2+1]=spritePosition.y;array[offset+stride*3]=spritePosition.x;array[offset+stride*3+1]=spritePosition.y;offset+=stride*4}};ParticleRenderer.prototype.uploadRotation=function uploadRotation(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;i++){var spriteRotation=children[startIndex+i].rotation;array[offset]=spriteRotation;array[offset+stride]=spriteRotation;array[offset+stride*2]=spriteRotation;array[offset+stride*3]=spriteRotation;offset+=stride*4}};ParticleRenderer.prototype.uploadUvs=function uploadUvs(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;++i){var textureUvs=children[startIndex+i]._texture._uvs;if(textureUvs){array[offset]=textureUvs.x0;array[offset+1]=textureUvs.y0;array[offset+stride]=textureUvs.x1;array[offset+stride+1]=textureUvs.y1;array[offset+stride*2]=textureUvs.x2;array[offset+stride*2+1]=textureUvs.y2;array[offset+stride*3]=textureUvs.x3;array[offset+stride*3+1]=textureUvs.y3;offset+=stride*4}else{array[offset]=0;array[offset+1]=0;array[offset+stride]=0;array[offset+stride+1]=0;array[offset+stride*2]=0;array[offset+stride*2+1]=0;array[offset+stride*3]=0;array[offset+stride*3+1]=0;offset+=stride*4}}};ParticleRenderer.prototype.uploadTint=function uploadTint(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;++i){var sprite=children[startIndex+i];var premultiplied=sprite._texture.baseTexture.premultipliedAlpha;var alpha=sprite.alpha;var argb=alpha<1&&premultiplied?(0,_utils.premultiplyTint)(sprite._tintRGB,alpha):sprite._tintRGB+(alpha*255<<24);array[offset]=argb;array[offset+stride]=argb;array[offset+stride*2]=argb;array[offset+stride*3]=argb;offset+=stride*4}};ParticleRenderer.prototype.destroy=function destroy(){if(this.renderer.gl){this.renderer.gl.deleteBuffer(this.indexBuffer)}_core$ObjectRenderer.prototype.destroy.call(this);this.shader.destroy();this.indices=null;this.tempMatrix=null};return ParticleRenderer}(core.ObjectRenderer);exports.default=ParticleRenderer;core.WebGLRenderer.registerPlugin("particle",ParticleRenderer)},{"../../core":110,"../../core/utils":170,"./ParticleBuffer":221,"./ParticleShader":223}],223:[function(require,module,exports){"use strict";exports.__esModule=true;var _Shader2=require("../../core/Shader");var _Shader3=_interopRequireDefault(_Shader2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ParticleShader=function(_Shader){_inherits(ParticleShader,_Shader);function ParticleShader(gl){_classCallCheck(this,ParticleShader);return _possibleConstructorReturn(this,_Shader.call(this,gl,["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","attribute vec2 aPositionCoord;","attribute float aRotation;","uniform mat3 projectionMatrix;","uniform vec4 uColor;","varying vec2 vTextureCoord;","varying vec4 vColor;","void main(void){","   float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);","   float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);","   vec2 v = vec2(x, y);","   v = v + aPositionCoord;","   gl_Position = vec4((projectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor * uColor;","}"].join("\n"),["varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void){","  vec4 color = texture2D(uSampler, vTextureCoord) * vColor;","  gl_FragColor = color;","}"].join("\n")))}return ParticleShader}(_Shader3.default);exports.default=ParticleShader},{"../../core/Shader":89}],224:[function(require,module,exports){"use strict";if(!Math.sign){Math.sign=function mathSign(x){x=Number(x);if(x===0||isNaN(x)){return x}return x>0?1:-1}}},{}],225:[function(require,module,exports){"use strict";if(!Number.isInteger){Number.isInteger=function numberIsInteger(value){return typeof value==="number"&&isFinite(value)&&Math.floor(value)===value}}},{}],226:[function(require,module,exports){"use strict";var _objectAssign=require("object-assign");var _objectAssign2=_interopRequireDefault(_objectAssign);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}if(!Object.assign){Object.assign=_objectAssign2.default}},{"object-assign":47}],227:[function(require,module,exports){"use strict";require("./Object.assign");require("./requestAnimationFrame");require("./Math.sign");require("./Number.isInteger");if(!window.ArrayBuffer){window.ArrayBuffer=Array}if(!window.Float32Array){window.Float32Array=Array}if(!window.Uint32Array){window.Uint32Array=Array}if(!window.Uint16Array){window.Uint16Array=Array}},{"./Math.sign":224,"./Number.isInteger":225,"./Object.assign":226,"./requestAnimationFrame":228}],228:[function(require,module,exports){(function(global){"use strict";var ONE_FRAME_TIME=16;if(!(Date.now&&Date.prototype.getTime)){Date.now=function now(){return(new Date).getTime()}}if(!(global.performance&&global.performance.now)){var startTime=Date.now();if(!global.performance){global.performance={}}global.performance.now=function(){return Date.now()-startTime}}var lastTime=Date.now();var vendors=["ms","moz","webkit","o"];for(var x=0;x<vendors.length&&!global.requestAnimationFrame;++x){var p=vendors[x];global.requestAnimationFrame=global[p+"RequestAnimationFrame"];global.cancelAnimationFrame=global[p+"CancelAnimationFrame"]||global[p+"CancelRequestAnimationFrame"]}if(!global.requestAnimationFrame){global.requestAnimationFrame=function(callback){if(typeof callback!=="function"){throw new TypeError(callback+"is not a function")}var currentTime=Date.now();var delay=ONE_FRAME_TIME+lastTime-currentTime;if(delay<0){delay=0}lastTime=currentTime;return setTimeout(function(){lastTime=Date.now();callback(performance.now())},delay)}}if(!global.cancelAnimationFrame){global.cancelAnimationFrame=function(id){return clearTimeout(id)}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],229:[function(require,module,exports){"use strict";exports.__esModule=true;var _core=require("../core");var core=_interopRequireWildcard(_core);var _CountLimiter=require("./limiters/CountLimiter");var _CountLimiter2=_interopRequireDefault(_CountLimiter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var SharedTicker=core.ticker.shared;core.settings.UPLOADS_PER_FRAME=4;var BasePrepare=function(){function BasePrepare(renderer){var _this=this;_classCallCheck(this,BasePrepare);this.limiter=new _CountLimiter2.default(core.settings.UPLOADS_PER_FRAME);this.renderer=renderer;this.uploadHookHelper=null;this.queue=[];this.addHooks=[];this.uploadHooks=[];this.completes=[];this.ticking=false;this.delayedTick=function(){if(!_this.queue){return}_this.prepareItems()};this.registerFindHook(findText);this.registerFindHook(findTextStyle);this.registerFindHook(findMultipleBaseTextures);this.registerFindHook(findBaseTexture);this.registerFindHook(findTexture);this.registerUploadHook(drawText);this.registerUploadHook(calculateTextStyle)}BasePrepare.prototype.upload=function upload(item,done){if(typeof item==="function"){done=item;item=null}if(item){this.add(item)}if(this.queue.length){if(done){this.completes.push(done)}if(!this.ticking){this.ticking=true;SharedTicker.addOnce(this.tick,this,core.UPDATE_PRIORITY.UTILITY)}}else if(done){done()}};BasePrepare.prototype.tick=function tick(){setTimeout(this.delayedTick,0)};BasePrepare.prototype.prepareItems=function prepareItems(){this.limiter.beginFrame();while(this.queue.length&&this.limiter.allowedToUpload()){var item=this.queue[0];var uploaded=false;if(item&&!item._destroyed){for(var i=0,len=this.uploadHooks.length;i<len;i++){if(this.uploadHooks[i](this.uploadHookHelper,item)){this.queue.shift();uploaded=true;break}}}if(!uploaded){this.queue.shift()}}if(!this.queue.length){this.ticking=false;var completes=this.completes.slice(0);this.completes.length=0;for(var _i=0,_len=completes.length;_i<_len;_i++){completes[_i]()}}else{SharedTicker.addOnce(this.tick,this,core.UPDATE_PRIORITY.UTILITY)}};BasePrepare.prototype.registerFindHook=function registerFindHook(addHook){if(addHook){this.addHooks.push(addHook)}return this};BasePrepare.prototype.registerUploadHook=function registerUploadHook(uploadHook){if(uploadHook){this.uploadHooks.push(uploadHook)}return this};BasePrepare.prototype.add=function add(item){for(var i=0,len=this.addHooks.length;i<len;i++){if(this.addHooks[i](item,this.queue)){break}}if(item instanceof core.Container){for(var _i2=item.children.length-1;_i2>=0;_i2--){this.add(item.children[_i2])}}return this};BasePrepare.prototype.destroy=function destroy(){if(this.ticking){SharedTicker.remove(this.tick,this)}this.ticking=false;this.addHooks=null;this.uploadHooks=null;this.renderer=null;this.completes=null;this.queue=null;this.limiter=null;this.uploadHookHelper=null};return BasePrepare}();exports.default=BasePrepare;function findMultipleBaseTextures(item,queue){var result=false;if(item&&item._textures&&item._textures.length){for(var i=0;i<item._textures.length;i++){if(item._textures[i]instanceof core.Texture){var baseTexture=item._textures[i].baseTexture;if(queue.indexOf(baseTexture)===-1){queue.push(baseTexture);result=true}}}}return result}function findBaseTexture(item,queue){if(item instanceof core.BaseTexture){if(queue.indexOf(item)===-1){queue.push(item)}return true}return false}function findTexture(item,queue){if(item._texture&&item._texture instanceof core.Texture){var texture=item._texture.baseTexture;if(queue.indexOf(texture)===-1){queue.push(texture)}return true}return false}function drawText(helper,item){if(item instanceof core.Text){item.updateText(true);return true}return false}function calculateTextStyle(helper,item){if(item instanceof core.TextStyle){var font=item.toFontString();core.TextMetrics.measureFont(font);return true}return false}function findText(item,queue){if(item instanceof core.Text){if(queue.indexOf(item.style)===-1){queue.push(item.style)}if(queue.indexOf(item)===-1){queue.push(item)}var texture=item._texture.baseTexture;if(queue.indexOf(texture)===-1){queue.push(texture)}return true}return false}function findTextStyle(item,queue){if(item instanceof core.TextStyle){if(queue.indexOf(item)===-1){queue.push(item)}return true}return false}},{"../core":110,"./limiters/CountLimiter":232}],230:[function(require,module,exports){"use strict";exports.__esModule=true;var _core=require("../../core");var core=_interopRequireWildcard(_core);var _BasePrepare2=require("../BasePrepare");var _BasePrepare3=_interopRequireDefault(_BasePrepare2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CANVAS_START_SIZE=16;var CanvasPrepare=function(_BasePrepare){_inherits(CanvasPrepare,_BasePrepare);function CanvasPrepare(renderer){_classCallCheck(this,CanvasPrepare);var _this=_possibleConstructorReturn(this,_BasePrepare.call(this,renderer));_this.uploadHookHelper=_this;_this.canvas=document.createElement("canvas");_this.canvas.width=CANVAS_START_SIZE;_this.canvas.height=CANVAS_START_SIZE;_this.ctx=_this.canvas.getContext("2d");_this.registerUploadHook(uploadBaseTextures);return _this}CanvasPrepare.prototype.destroy=function destroy(){_BasePrepare.prototype.destroy.call(this);this.ctx=null;this.canvas=null};return CanvasPrepare}(_BasePrepare3.default);exports.default=CanvasPrepare;function uploadBaseTextures(prepare,item){if(item instanceof core.BaseTexture){var image=item.source;var imageWidth=image.width===0?prepare.canvas.width:Math.min(prepare.canvas.width,image.width);var imageHeight=image.height===0?prepare.canvas.height:Math.min(prepare.canvas.height,image.height);prepare.ctx.drawImage(image,0,0,imageWidth,imageHeight,0,0,prepare.canvas.width,prepare.canvas.height);return true}return false}core.CanvasRenderer.registerPlugin("prepare",CanvasPrepare)},{"../../core":110,"../BasePrepare":229}],231:[function(require,module,exports){"use strict";exports.__esModule=true;var _WebGLPrepare=require("./webgl/WebGLPrepare");Object.defineProperty(exports,"webgl",{enumerable:true,get:function get(){return _interopRequireDefault(_WebGLPrepare).default}});var _CanvasPrepare=require("./canvas/CanvasPrepare");Object.defineProperty(exports,"canvas",{enumerable:true,get:function get(){return _interopRequireDefault(_CanvasPrepare).default}});var _BasePrepare=require("./BasePrepare");Object.defineProperty(exports,"BasePrepare",{enumerable:true,get:function get(){return _interopRequireDefault(_BasePrepare).default}});var _CountLimiter=require("./limiters/CountLimiter");Object.defineProperty(exports,"CountLimiter",{enumerable:true,get:function get(){return _interopRequireDefault(_CountLimiter).default}});var _TimeLimiter=require("./limiters/TimeLimiter");Object.defineProperty(exports,"TimeLimiter",{enumerable:true,get:function get(){return _interopRequireDefault(_TimeLimiter).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./BasePrepare":229,"./canvas/CanvasPrepare":230,"./limiters/CountLimiter":232,"./limiters/TimeLimiter":233,"./webgl/WebGLPrepare":234}],232:[function(require,module,exports){"use strict";exports.__esModule=true;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var CountLimiter=function(){function CountLimiter(maxItemsPerFrame){_classCallCheck(this,CountLimiter);this.maxItemsPerFrame=maxItemsPerFrame;this.itemsLeft=0}CountLimiter.prototype.beginFrame=function beginFrame(){this.itemsLeft=this.maxItemsPerFrame};CountLimiter.prototype.allowedToUpload=function allowedToUpload(){return this.itemsLeft-- >0};return CountLimiter}();exports.default=CountLimiter},{}],233:[function(require,module,exports){"use strict";exports.__esModule=true;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var TimeLimiter=function(){function TimeLimiter(maxMilliseconds){_classCallCheck(this,TimeLimiter);this.maxMilliseconds=maxMilliseconds;this.frameStart=0}TimeLimiter.prototype.beginFrame=function beginFrame(){this.frameStart=Date.now()};TimeLimiter.prototype.allowedToUpload=function allowedToUpload(){return Date.now()-this.frameStart<this.maxMilliseconds};return TimeLimiter}();exports.default=TimeLimiter},{}],234:[function(require,module,exports){"use strict";exports.__esModule=true;var _core=require("../../core");var core=_interopRequireWildcard(_core);var _BasePrepare2=require("../BasePrepare");var _BasePrepare3=_interopRequireDefault(_BasePrepare2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var WebGLPrepare=function(_BasePrepare){_inherits(WebGLPrepare,_BasePrepare);function WebGLPrepare(renderer){_classCallCheck(this,WebGLPrepare);var _this=_possibleConstructorReturn(this,_BasePrepare.call(this,renderer));_this.uploadHookHelper=_this.renderer;_this.registerFindHook(findGraphics);_this.registerUploadHook(uploadBaseTextures);_this.registerUploadHook(uploadGraphics);return _this}return WebGLPrepare}(_BasePrepare3.default);exports.default=WebGLPrepare;function uploadBaseTextures(renderer,item){if(item instanceof core.BaseTexture){if(!item._glTextures[renderer.CONTEXT_UID]){renderer.textureManager.updateTexture(item)}return true}return false}function uploadGraphics(renderer,item){if(item instanceof core.Graphics){if(item.dirty||item.clearDirty||!item._webGL[renderer.plugins.graphics.CONTEXT_UID]){renderer.plugins.graphics.updateGraphics(item)}return true}return false}function findGraphics(item,queue){if(item instanceof core.Graphics){queue.push(item);return true}return false}core.WebGLRenderer.registerPlugin("prepare",WebGLPrepare)},{"../../core":110,"../BasePrepare":229}],235:[function(require,module,exports){"use strict";var has=Object.prototype.hasOwnProperty,prefix="~";function Events(){}if(Object.create){Events.prototype=Object.create(null);if(!(new Events).__proto__)prefix=false}function EE(fn,context,once){this.fn=fn;this.context=context;this.once=once||false}function EventEmitter(){this._events=new Events;this._eventsCount=0}EventEmitter.prototype.eventNames=function eventNames(){var names=[],events,name;if(this._eventsCount===0)return names;for(name in events=this._events){if(has.call(events,name))names.push(prefix?name.slice(1):name)}if(Object.getOwnPropertySymbols){return names.concat(Object.getOwnPropertySymbols(events))}return names};EventEmitter.prototype.listeners=function listeners(event,exists){var evt=prefix?prefix+event:event,available=this._events[evt];if(exists)return!!available;if(!available)return[];if(available.fn)return[available.fn];for(var i=0,l=available.length,ee=new Array(l);i<l;i++){ee[i]=available[i].fn}return ee};EventEmitter.prototype.emit=function emit(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events[evt])return false;var listeners=this._events[evt],len=arguments.length,args,i;if(listeners.fn){if(listeners.once)this.removeListener(event,listeners.fn,undefined,true);switch(len){case 1:return listeners.fn.call(listeners.context),true;case 2:return listeners.fn.call(listeners.context,a1),true;case 3:return listeners.fn.call(listeners.context,a1,a2),true;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),true;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),true;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),true}for(i=1,args=new Array(len-1);i<len;i++){args[i-1]=arguments[i]}listeners.fn.apply(listeners.context,args)}else{var length=listeners.length,j;for(i=0;i<length;i++){if(listeners[i].once)this.removeListener(event,listeners[i].fn,undefined,true);switch(len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++){args[j-1]=arguments[j]}listeners[i].fn.apply(listeners[i].context,args)}}}return true};EventEmitter.prototype.on=function on(event,fn,context){var listener=new EE(fn,context||this),evt=prefix?prefix+event:event;if(!this._events[evt])this._events[evt]=listener,this._eventsCount++;else if(!this._events[evt].fn)this._events[evt].push(listener);else this._events[evt]=[this._events[evt],listener];return this};EventEmitter.prototype.once=function once(event,fn,context){var listener=new EE(fn,context||this,true),evt=prefix?prefix+event:event;if(!this._events[evt])this._events[evt]=listener,this._eventsCount++;else if(!this._events[evt].fn)this._events[evt].push(listener);else this._events[evt]=[this._events[evt],listener];return this};EventEmitter.prototype.removeListener=function removeListener(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events[evt])return this;if(!fn){if(--this._eventsCount===0)this._events=new Events;else delete this._events[evt];return this}var listeners=this._events[evt];if(listeners.fn){if(listeners.fn===fn&&(!once||listeners.once)&&(!context||listeners.context===context)){if(--this._eventsCount===0)this._events=new Events;else delete this._events[evt]}}else{for(var i=0,events=[],length=listeners.length;i<length;i++){if(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context){events.push(listeners[i])}}if(events.length)this._events[evt]=events.length===1?events[0]:events;else if(--this._eventsCount===0)this._events=new Events;else delete this._events[evt]}return this};EventEmitter.prototype.removeAllListeners=function removeAllListeners(event){var evt;if(event){evt=prefix?prefix+event:event;if(this._events[evt]){if(--this._eventsCount===0)this._events=new Events;else delete this._events[evt]}}else{this._events=new Events;this._eventsCount=0}return this};EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.addListener=EventEmitter.prototype.on;EventEmitter.prototype.setMaxListeners=function setMaxListeners(){return this};EventEmitter.prefixed=prefix;EventEmitter.EventEmitter=EventEmitter;if("undefined"!==typeof module){module.exports=EventEmitter}},{}],236:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[]};process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],237:[function(require,module,exports){(function(global){(function(root){var freeExports=typeof exports=="object"&&exports&&!exports.nodeType&&exports;var freeModule=typeof module=="object"&&module&&!module.nodeType&&module;var freeGlobal=typeof global=="object"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal){root=freeGlobal}var punycode,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode,key;function error(type){throw new RangeError(errors[type])}function map(array,fn){var length=array.length;var result=[];while(length--){result[length]=fn(array[length])}return result}function mapDomain(string,fn){var parts=string.split("@");var result="";if(parts.length>1){result=parts[0]+"@";string=parts[1]}string=string.replace(regexSeparators,".");var labels=string.split(".");var encoded=map(labels,fn).join(".");return result+encoded}function ucs2decode(string){var output=[],counter=0,length=string.length,value,extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){return map(array,function(value){var output="";if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value);return output}).join("")}function basicToDigit(codePoint){if(codePoint-48<10){return codePoint-22}if(codePoint-65<26){return codePoint-65}if(codePoint-97<26){return codePoint-97}return base}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((flag!=0)<<5)}function adapt(delta,numPoints,firstTime){var k=0;delta=firstTime?floor(delta/damp):delta>>1;delta+=floor(delta/numPoints);for(;delta>baseMinusTMin*tMax>>1;k+=base){delta=floor(delta/baseMinusTMin)}return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var output=[],inputLength=input.length,out,i=0,n=initialN,bias=initialBias,basic,j,index,oldi,w,k,digit,t,baseMinusT;basic=input.lastIndexOf(delimiter);if(basic<0){basic=0}for(j=0;j<basic;++j){if(input.charCodeAt(j)>=128){error("not-basic")}output.push(input.charCodeAt(j))}for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;;k+=base){if(index>=inputLength){error("invalid-input")}digit=basicToDigit(input.charCodeAt(index++));if(digit>=base||digit>floor((maxInt-i)/w)){error("overflow")}i+=digit*w;t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(digit<t){break}baseMinusT=base-t;if(w>floor(maxInt/baseMinusT)){error("overflow")}w*=baseMinusT}out=output.length+1;bias=adapt(i-oldi,out,oldi==0);if(floor(i/out)>maxInt-n){error("overflow")}n+=floor(i/out);i%=out;output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,output=[],inputLength,handledCPCountPlusOne,baseMinusT,qMinusT;input=ucs2decode(input);inputLength=input.length;n=initialN;delta=0;bias=initialBias;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<128){output.push(stringFromCharCode(currentValue))}}handledCPCount=basicLength=output.length;if(basicLength){output.push(delimiter)}while(handledCPCount<inputLength){for(m=maxInt,j=0;j<inputLength;++j){currentValue=input[j];if(currentValue>=n&&currentValue<m){m=currentValue}}handledCPCountPlusOne=handledCPCount+1;if(m-n>floor((maxInt-delta)/handledCPCountPlusOne)){error("overflow")}delta+=(m-n)*handledCPCountPlusOne;n=m;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<n&&++delta>maxInt){error("overflow")}if(currentValue==n){for(q=delta,k=base;;k+=base){t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(q<t){break}qMinusT=q-t;baseMinusT=base-t;output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0)));q=floor(qMinusT/baseMinusT)}output.push(stringFromCharCode(digitToBasic(q,0)));bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength);delta=0;++handledCPCount}}++delta;++n}return output.join("")}function toUnicode(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}function toASCII(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})}punycode={version:"1.4.1",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:toASCII,toUnicode:toUnicode};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){define("punycode",function(){return punycode})}else if(freeExports&&freeModule){if(module.exports==freeExports){freeModule.exports=punycode}else{for(key in punycode){punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key])}}}else{root.punycode=punycode}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],238:[function(require,module,exports){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&";eq=eq||"=";var obj={};if(typeof qs!=="string"||qs.length===0){return obj}var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;if(options&&typeof options.maxKeys==="number"){maxKeys=options.maxKeys}var len=qs.length;if(maxKeys>0&&len>maxKeys){len=maxKeys}for(var i=0;i<len;++i){var x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq),kstr,vstr,k,v;if(idx>=0){kstr=x.substr(0,idx);vstr=x.substr(idx+1)}else{kstr=x;vstr=""}k=decodeURIComponent(kstr);v=decodeURIComponent(vstr);if(!hasOwnProperty(obj,k)){obj[k]=v}else if(isArray(obj[k])){obj[k].push(v)}else{obj[k]=[obj[k],v]}}return obj};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"}},{}],239:[function(require,module,exports){"use strict";var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){sep=sep||"&";eq=eq||"=";if(obj===null){obj=undefined}if(typeof obj==="object"){return map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;if(isArray(obj[k])){return map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep)}else{return ks+encodeURIComponent(stringifyPrimitive(obj[k]))}}).join(sep)}if(!name)return"";return encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj))};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"};function map(xs,f){if(xs.map)return xs.map(f);var res=[];for(var i=0;i<xs.length;i++){res.push(f(xs[i],i))}return res}var objectKeys=Object.keys||function(obj){var res=[];for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))res.push(key)}return res}},{}],240:[function(require,module,exports){"use strict";exports.decode=exports.parse=require("./decode");exports.encode=exports.stringify=require("./encode")},{"./decode":238,"./encode":239}],241:[function(require,module,exports){"use strict";module.exports=function removeItems(arr,startIdx,removeCount){var i,length=arr.length;if(startIdx>=length||removeCount===0){return}removeCount=startIdx+removeCount>length?length-startIdx:removeCount;var len=length-removeCount;for(i=startIdx;i<len;++i){arr[i]=arr[i+removeCount]}arr.length=len}},{}],242:[function(require,module,exports){"use strict";exports.__esModule=true;exports.Loader=undefined;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _miniSignals=require("mini-signals");var _miniSignals2=_interopRequireDefault(_miniSignals);var _parseUri=require("parse-uri");var _parseUri2=_interopRequireDefault(_parseUri);var _async=require("./async");var async=_interopRequireWildcard(_async);var _Resource=require("./Resource");function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var MAX_PROGRESS=100;var rgxExtractUrlHash=/(#[\w-]+)?$/;var Loader=exports.Loader=function(){function Loader(){var _this=this;var baseUrl=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var concurrency=arguments.length>1&&arguments[1]!==undefined?arguments[1]:10;_classCallCheck(this,Loader);this.baseUrl=baseUrl;this.progress=0;this.loading=false;this.defaultQueryString="";this._beforeMiddleware=[];this._afterMiddleware=[];this._resourcesParsing=[];this._boundLoadResource=function(r,d){return _this._loadResource(r,d)};this._queue=async.queue(this._boundLoadResource,concurrency);this._queue.pause();this.resources={};this.onProgress=new _miniSignals2.default;this.onError=new _miniSignals2.default;this.onLoad=new _miniSignals2.default;this.onStart=new _miniSignals2.default;this.onComplete=new _miniSignals2.default;for(var i=0;i<Loader._defaultBeforeMiddleware.length;++i){this.pre(Loader._defaultBeforeMiddleware[i])}for(var _i=0;_i<Loader._defaultAfterMiddleware.length;++_i){this.use(Loader._defaultAfterMiddleware[_i])}}Loader.prototype.add=function add(name,url,options,cb){if(Array.isArray(name)){for(var i=0;i<name.length;++i){this.add(name[i])}return this}if((typeof name==="undefined"?"undefined":_typeof(name))==="object"){cb=url||name.callback||name.onComplete;options=name;url=name.url;name=name.name||name.key||name.url}if(typeof url!=="string"){cb=options;options=url;url=name}if(typeof url!=="string"){throw new Error("No url passed to add resource to loader.")}if(typeof options==="function"){cb=options;options=null}if(this.loading&&(!options||!options.parentResource)){throw new Error("Cannot add resources while the loader is running.")}if(this.resources[name]){throw new Error('Resource named "'+name+'" already exists.')}url=this._prepareUrl(url);this.resources[name]=new _Resource.Resource(name,url,options);if(typeof cb==="function"){this.resources[name].onAfterMiddleware.once(cb)}if(this.loading){var parent=options.parentResource;var incompleteChildren=[];for(var _i2=0;_i2<parent.children.length;++_i2){if(!parent.children[_i2].isComplete){incompleteChildren.push(parent.children[_i2])}}var fullChunk=parent.progressChunk*(incompleteChildren.length+1);var eachChunk=fullChunk/(incompleteChildren.length+2);parent.children.push(this.resources[name]);parent.progressChunk=eachChunk;for(var _i3=0;_i3<incompleteChildren.length;++_i3){incompleteChildren[_i3].progressChunk=eachChunk}this.resources[name].progressChunk=eachChunk}this._queue.push(this.resources[name]);return this};Loader.prototype.pre=function pre(fn){this._beforeMiddleware.push(fn);return this};Loader.prototype.use=function use(fn){this._afterMiddleware.push(fn);return this};Loader.prototype.reset=function reset(){this.progress=0;this.loading=false;this._queue.kill();this._queue.pause();for(var k in this.resources){var res=this.resources[k];if(res._onLoadBinding){res._onLoadBinding.detach()}if(res.isLoading){res.abort()}}this.resources={};return this};Loader.prototype.load=function load(cb){if(typeof cb==="function"){this.onComplete.once(cb)}if(this.loading){return this}if(this._queue.idle()){this._onStart();this._onComplete()}else{var numTasks=this._queue._tasks.length;var chunk=MAX_PROGRESS/numTasks;for(var i=0;i<this._queue._tasks.length;++i){this._queue._tasks[i].data.progressChunk=chunk}this._onStart();this._queue.resume()}return this};Loader.prototype._prepareUrl=function _prepareUrl(url){var parsedUrl=(0,_parseUri2.default)(url,{strictMode:true});var result=void 0;if(parsedUrl.protocol||!parsedUrl.path||url.indexOf("//")===0){result=url}else if(this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&url.charAt(0)!=="/"){result=this.baseUrl+"/"+url}else{result=this.baseUrl+url}if(this.defaultQueryString){var hash=rgxExtractUrlHash.exec(result)[0];result=result.substr(0,result.length-hash.length);if(result.indexOf("?")!==-1){result+="&"+this.defaultQueryString}else{result+="?"+this.defaultQueryString}result+=hash}return result};Loader.prototype._loadResource=function _loadResource(resource,dequeue){var _this2=this;resource._dequeue=dequeue;async.eachSeries(this._beforeMiddleware,function(fn,next){fn.call(_this2,resource,function(){next(resource.isComplete?{}:null)})},function(){if(resource.isComplete){_this2._onLoad(resource)}else{resource._onLoadBinding=resource.onComplete.once(_this2._onLoad,_this2);resource.load()}},true)};Loader.prototype._onStart=function _onStart(){this.progress=0;this.loading=true;this.onStart.dispatch(this)};Loader.prototype._onComplete=function _onComplete(){this.progress=MAX_PROGRESS;this.loading=false;this.onComplete.dispatch(this,this.resources)};Loader.prototype._onLoad=function _onLoad(resource){var _this3=this;resource._onLoadBinding=null;this._resourcesParsing.push(resource);resource._dequeue();async.eachSeries(this._afterMiddleware,function(fn,next){fn.call(_this3,resource,next)},function(){resource.onAfterMiddleware.dispatch(resource);_this3.progress=Math.min(MAX_PROGRESS,_this3.progress+resource.progressChunk);_this3.onProgress.dispatch(_this3,resource);if(resource.error){_this3.onError.dispatch(resource.error,_this3,resource)}else{_this3.onLoad.dispatch(_this3,resource)}_this3._resourcesParsing.splice(_this3._resourcesParsing.indexOf(resource),1);if(_this3._queue.idle()&&_this3._resourcesParsing.length===0){_this3._onComplete()}},true)};_createClass(Loader,[{key:"concurrency",get:function get(){return this._queue.concurrency},set:function set(concurrency){this._queue.concurrency=concurrency}}]);return Loader}();Loader._defaultBeforeMiddleware=[];Loader._defaultAfterMiddleware=[];Loader.pre=function LoaderPreStatic(fn){Loader._defaultBeforeMiddleware.push(fn);return Loader};Loader.use=function LoaderUseStatic(fn){Loader._defaultAfterMiddleware.push(fn);return Loader}},{"./Resource":243,"./async":244,"mini-signals":44,"parse-uri":48}],243:[function(require,module,exports){"use strict";exports.__esModule=true;exports.Resource=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _parseUri=require("parse-uri");var _parseUri2=_interopRequireDefault(_parseUri);var _miniSignals=require("mini-signals");var _miniSignals2=_interopRequireDefault(_miniSignals);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var useXdr=!!(window.XDomainRequest&&!("withCredentials"in new XMLHttpRequest));var tempAnchor=null;var STATUS_NONE=0;var STATUS_OK=200;var STATUS_EMPTY=204;var STATUS_IE_BUG_EMPTY=1223;var STATUS_TYPE_OK=2;function _noop(){}var Resource=exports.Resource=function(){Resource.setExtensionLoadType=function setExtensionLoadType(extname,loadType){setExtMap(Resource._loadTypeMap,extname,loadType)};Resource.setExtensionXhrType=function setExtensionXhrType(extname,xhrType){setExtMap(Resource._xhrTypeMap,extname,xhrType)};function Resource(name,url,options){_classCallCheck(this,Resource);if(typeof name!=="string"||typeof url!=="string"){throw new Error("Both name and url are required for constructing a resource.")}options=options||{};this._flags=0;this._setFlag(Resource.STATUS_FLAGS.DATA_URL,url.indexOf("data:")===0);this.name=name;this.url=url;this.extension=this._getExtension();this.data=null;this.crossOrigin=options.crossOrigin===true?"anonymous":options.crossOrigin;this.timeout=options.timeout||0;this.loadType=options.loadType||this._determineLoadType();this.xhrType=options.xhrType;this.metadata=options.metadata||{};this.error=null;this.xhr=null;this.children=[];this.type=Resource.TYPE.UNKNOWN;this.progressChunk=0;this._dequeue=_noop;this._onLoadBinding=null;this._elementTimer=0;this._boundComplete=this.complete.bind(this);this._boundOnError=this._onError.bind(this);this._boundOnProgress=this._onProgress.bind(this);this._boundOnTimeout=this._onTimeout.bind(this);this._boundXhrOnError=this._xhrOnError.bind(this);this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this);this._boundXhrOnAbort=this._xhrOnAbort.bind(this);this._boundXhrOnLoad=this._xhrOnLoad.bind(this);this.onStart=new _miniSignals2.default;this.onProgress=new _miniSignals2.default;this.onComplete=new _miniSignals2.default;this.onAfterMiddleware=new _miniSignals2.default}Resource.prototype.complete=function complete(){this._clearEvents();this._finish()};Resource.prototype.abort=function abort(message){if(this.error){return}this.error=new Error(message);this._clearEvents();if(this.xhr){this.xhr.abort()}else if(this.xdr){this.xdr.abort()}else if(this.data){if(this.data.src){this.data.src=Resource.EMPTY_GIF}else{while(this.data.firstChild){this.data.removeChild(this.data.firstChild)}}}this._finish()};Resource.prototype.load=function load(cb){var _this=this;if(this.isLoading){return}if(this.isComplete){if(cb){setTimeout(function(){return cb(_this)},1)}return}else if(cb){this.onComplete.once(cb)}this._setFlag(Resource.STATUS_FLAGS.LOADING,true);this.onStart.dispatch(this);if(this.crossOrigin===false||typeof this.crossOrigin!=="string"){this.crossOrigin=this._determineCrossOrigin(this.url)}switch(this.loadType){case Resource.LOAD_TYPE.IMAGE:this.type=Resource.TYPE.IMAGE;this._loadElement("image");break;case Resource.LOAD_TYPE.AUDIO:this.type=Resource.TYPE.AUDIO;this._loadSourceElement("audio");break;case Resource.LOAD_TYPE.VIDEO:this.type=Resource.TYPE.VIDEO;this._loadSourceElement("video");break;case Resource.LOAD_TYPE.XHR:default:if(useXdr&&this.crossOrigin){this._loadXdr()}else{this._loadXhr()}break}};Resource.prototype._hasFlag=function _hasFlag(flag){return(this._flags&flag)!==0};Resource.prototype._setFlag=function _setFlag(flag,value){this._flags=value?this._flags|flag:this._flags&~flag};Resource.prototype._clearEvents=function _clearEvents(){clearTimeout(this._elementTimer);if(this.data&&this.data.removeEventListener){this.data.removeEventListener("error",this._boundOnError,false);this.data.removeEventListener("load",this._boundComplete,false);this.data.removeEventListener("progress",this._boundOnProgress,false);this.data.removeEventListener("canplaythrough",this._boundComplete,false)}if(this.xhr){if(this.xhr.removeEventListener){this.xhr.removeEventListener("error",this._boundXhrOnError,false);this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,false);this.xhr.removeEventListener("abort",this._boundXhrOnAbort,false);this.xhr.removeEventListener("progress",this._boundOnProgress,false);this.xhr.removeEventListener("load",this._boundXhrOnLoad,false)}else{this.xhr.onerror=null;this.xhr.ontimeout=null;this.xhr.onprogress=null;this.xhr.onload=null}}};Resource.prototype._finish=function _finish(){if(this.isComplete){throw new Error("Complete called again for an already completed resource.")}this._setFlag(Resource.STATUS_FLAGS.COMPLETE,true);this._setFlag(Resource.STATUS_FLAGS.LOADING,false);this.onComplete.dispatch(this)};Resource.prototype._loadElement=function _loadElement(type){if(this.metadata.loadElement){this.data=this.metadata.loadElement}else if(type==="image"&&typeof window.Image!=="undefined"){this.data=new Image}else{this.data=document.createElement(type)}if(this.crossOrigin){this.data.crossOrigin=this.crossOrigin}if(!this.metadata.skipSource){this.data.src=this.url}this.data.addEventListener("error",this._boundOnError,false);this.data.addEventListener("load",this._boundComplete,false);this.data.addEventListener("progress",this._boundOnProgress,false);if(this.timeout){this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout)}};Resource.prototype._loadSourceElement=function _loadSourceElement(type){if(this.metadata.loadElement){this.data=this.metadata.loadElement}else if(type==="audio"&&typeof window.Audio!=="undefined"){this.data=new Audio}else{this.data=document.createElement(type)}if(this.data===null){this.abort("Unsupported element: "+type);return}if(this.crossOrigin){this.data.crossOrigin=this.crossOrigin}if(!this.metadata.skipSource){if(navigator.isCocoonJS){this.data.src=Array.isArray(this.url)?this.url[0]:this.url}else if(Array.isArray(this.url)){var mimeTypes=this.metadata.mimeType;for(var i=0;i<this.url.length;++i){this.data.appendChild(this._createSource(type,this.url[i],Array.isArray(mimeTypes)?mimeTypes[i]:mimeTypes))}}else{var _mimeTypes=this.metadata.mimeType;this.data.appendChild(this._createSource(type,this.url,Array.isArray(_mimeTypes)?_mimeTypes[0]:_mimeTypes))}}this.data.addEventListener("error",this._boundOnError,false);this.data.addEventListener("load",this._boundComplete,false);this.data.addEventListener("progress",this._boundOnProgress,false);this.data.addEventListener("canplaythrough",this._boundComplete,false);this.data.load();if(this.timeout){this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout)}};Resource.prototype._loadXhr=function _loadXhr(){if(typeof this.xhrType!=="string"){this.xhrType=this._determineXhrType()}var xhr=this.xhr=new XMLHttpRequest;xhr.open("GET",this.url,true);xhr.timeout=this.timeout;if(this.xhrType===Resource.XHR_RESPONSE_TYPE.JSON||this.xhrType===Resource.XHR_RESPONSE_TYPE.DOCUMENT){xhr.responseType=Resource.XHR_RESPONSE_TYPE.TEXT}else{xhr.responseType=this.xhrType}xhr.addEventListener("error",this._boundXhrOnError,false);xhr.addEventListener("timeout",this._boundXhrOnTimeout,false);xhr.addEventListener("abort",this._boundXhrOnAbort,false);xhr.addEventListener("progress",this._boundOnProgress,false);xhr.addEventListener("load",this._boundXhrOnLoad,false);xhr.send()};Resource.prototype._loadXdr=function _loadXdr(){if(typeof this.xhrType!=="string"){this.xhrType=this._determineXhrType()}var xdr=this.xhr=new XDomainRequest;xdr.timeout=this.timeout||5e3;xdr.onerror=this._boundXhrOnError;xdr.ontimeout=this._boundXhrOnTimeout;xdr.onprogress=this._boundOnProgress;xdr.onload=this._boundXhrOnLoad;xdr.open("GET",this.url,true);setTimeout(function(){return xdr.send()},1)};Resource.prototype._createSource=function _createSource(type,url,mime){if(!mime){mime=type+"/"+this._getExtension(url)}var source=document.createElement("source");source.src=url;source.type=mime;return source};Resource.prototype._onError=function _onError(event){this.abort("Failed to load element using: "+event.target.nodeName)};Resource.prototype._onProgress=function _onProgress(event){if(event&&event.lengthComputable){this.onProgress.dispatch(this,event.loaded/event.total)}};Resource.prototype._onTimeout=function _onTimeout(){this.abort("Load timed out.")};Resource.prototype._xhrOnError=function _xhrOnError(){var xhr=this.xhr;this.abort(reqType(xhr)+" Request failed. Status: "+xhr.status+', text: "'+xhr.statusText+'"')};Resource.prototype._xhrOnTimeout=function _xhrOnTimeout(){var xhr=this.xhr;this.abort(reqType(xhr)+" Request timed out.")};Resource.prototype._xhrOnAbort=function _xhrOnAbort(){var xhr=this.xhr;this.abort(reqType(xhr)+" Request was aborted by the user.")};Resource.prototype._xhrOnLoad=function _xhrOnLoad(){var xhr=this.xhr;var text="";var status=typeof xhr.status==="undefined"?STATUS_OK:xhr.status;if(xhr.responseType===""||xhr.responseType==="text"||typeof xhr.responseType==="undefined"){text=xhr.responseText}if(status===STATUS_NONE&&(text.length>0||xhr.responseType===Resource.XHR_RESPONSE_TYPE.BUFFER)){status=STATUS_OK}else if(status===STATUS_IE_BUG_EMPTY){status=STATUS_EMPTY}var statusType=status/100|0;if(statusType===STATUS_TYPE_OK){if(this.xhrType===Resource.XHR_RESPONSE_TYPE.TEXT){this.data=text;this.type=Resource.TYPE.TEXT}else if(this.xhrType===Resource.XHR_RESPONSE_TYPE.JSON){try{this.data=JSON.parse(text);this.type=Resource.TYPE.JSON}catch(e){this.abort("Error trying to parse loaded json: "+e);return}}else if(this.xhrType===Resource.XHR_RESPONSE_TYPE.DOCUMENT){try{if(window.DOMParser){var domparser=new DOMParser;this.data=domparser.parseFromString(text,"text/xml")}else{var div=document.createElement("div");div.innerHTML=text;this.data=div}this.type=Resource.TYPE.XML}catch(e){this.abort("Error trying to parse loaded xml: "+e);return}}else{this.data=xhr.response||text}}else{this.abort("["+xhr.status+"] "+xhr.statusText+": "+xhr.responseURL);return}this.complete()};Resource.prototype._determineCrossOrigin=function _determineCrossOrigin(url,loc){if(url.indexOf("data:")===0){return""}if(window.origin!==window.location.origin){return"anonymous"}loc=loc||window.location;if(!tempAnchor){tempAnchor=document.createElement("a")}tempAnchor.href=url;url=(0,_parseUri2.default)(tempAnchor.href,{strictMode:true});var samePort=!url.port&&loc.port===""||url.port===loc.port;var protocol=url.protocol?url.protocol+":":"";if(url.host!==loc.hostname||!samePort||protocol!==loc.protocol){return"anonymous"}return""};Resource.prototype._determineXhrType=function _determineXhrType(){return Resource._xhrTypeMap[this.extension]||Resource.XHR_RESPONSE_TYPE.TEXT};Resource.prototype._determineLoadType=function _determineLoadType(){return Resource._loadTypeMap[this.extension]||Resource.LOAD_TYPE.XHR};Resource.prototype._getExtension=function _getExtension(){var url=this.url;var ext="";if(this.isDataUrl){var slashIndex=url.indexOf("/");ext=url.substring(slashIndex+1,url.indexOf(";",slashIndex))}else{var queryStart=url.indexOf("?");var hashStart=url.indexOf("#");var index=Math.min(queryStart>-1?queryStart:url.length,hashStart>-1?hashStart:url.length);url=url.substring(0,index);ext=url.substring(url.lastIndexOf(".")+1)}return ext.toLowerCase()};Resource.prototype._getMimeFromXhrType=function _getMimeFromXhrType(type){switch(type){case Resource.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case Resource.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case Resource.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case Resource.XHR_RESPONSE_TYPE.JSON:return"application/json";case Resource.XHR_RESPONSE_TYPE.DEFAULT:case Resource.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}};_createClass(Resource,[{key:"isDataUrl",get:function get(){return this._hasFlag(Resource.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function get(){return this._hasFlag(Resource.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function get(){return this._hasFlag(Resource.STATUS_FLAGS.LOADING)}}]);return Resource}();Resource.STATUS_FLAGS={NONE:0,DATA_URL:1<<0,COMPLETE:1<<1,LOADING:1<<2};Resource.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6};Resource.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4};Resource.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"};Resource._loadTypeMap={gif:Resource.LOAD_TYPE.IMAGE,png:Resource.LOAD_TYPE.IMAGE,bmp:Resource.LOAD_TYPE.IMAGE,jpg:Resource.LOAD_TYPE.IMAGE,jpeg:Resource.LOAD_TYPE.IMAGE,tif:Resource.LOAD_TYPE.IMAGE,tiff:Resource.LOAD_TYPE.IMAGE,webp:Resource.LOAD_TYPE.IMAGE,tga:Resource.LOAD_TYPE.IMAGE,svg:Resource.LOAD_TYPE.IMAGE,"svg+xml":Resource.LOAD_TYPE.IMAGE,mp3:Resource.LOAD_TYPE.AUDIO,ogg:Resource.LOAD_TYPE.AUDIO,wav:Resource.LOAD_TYPE.AUDIO,mp4:Resource.LOAD_TYPE.VIDEO,webm:Resource.LOAD_TYPE.VIDEO};Resource._xhrTypeMap={xhtml:Resource.XHR_RESPONSE_TYPE.DOCUMENT,html:Resource.XHR_RESPONSE_TYPE.DOCUMENT,htm:Resource.XHR_RESPONSE_TYPE.DOCUMENT,xml:Resource.XHR_RESPONSE_TYPE.DOCUMENT,tmx:Resource.XHR_RESPONSE_TYPE.DOCUMENT,svg:Resource.XHR_RESPONSE_TYPE.DOCUMENT,tsx:Resource.XHR_RESPONSE_TYPE.DOCUMENT,gif:Resource.XHR_RESPONSE_TYPE.BLOB,png:Resource.XHR_RESPONSE_TYPE.BLOB,bmp:Resource.XHR_RESPONSE_TYPE.BLOB,jpg:Resource.XHR_RESPONSE_TYPE.BLOB,jpeg:Resource.XHR_RESPONSE_TYPE.BLOB,tif:Resource.XHR_RESPONSE_TYPE.BLOB,tiff:Resource.XHR_RESPONSE_TYPE.BLOB,webp:Resource.XHR_RESPONSE_TYPE.BLOB,tga:Resource.XHR_RESPONSE_TYPE.BLOB,json:Resource.XHR_RESPONSE_TYPE.JSON,text:Resource.XHR_RESPONSE_TYPE.TEXT,txt:Resource.XHR_RESPONSE_TYPE.TEXT,ttf:Resource.XHR_RESPONSE_TYPE.BUFFER,otf:Resource.XHR_RESPONSE_TYPE.BUFFER};Resource.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";function setExtMap(map,extname,val){if(extname&&extname.indexOf(".")===0){extname=extname.substring(1)}if(!extname){return}map[extname]=val}function reqType(xhr){return xhr.toString().replace("object ","")}if(typeof module!=="undefined"){module.exports.default=Resource}},{"mini-signals":44,"parse-uri":48}],244:[function(require,module,exports){"use strict";exports.__esModule=true;exports.eachSeries=eachSeries;exports.queue=queue;function _noop(){}function eachSeries(array,iterator,callback,deferNext){var i=0;var len=array.length;(function next(err){if(err||i===len){if(callback){callback(err)}return}if(deferNext){setTimeout(function(){iterator(array[i++],next)},1)}else{iterator(array[i++],next)}})()}function onlyOnce(fn){return function onceWrapper(){if(fn===null){throw new Error("Callback was already called.")}var callFn=fn;fn=null;callFn.apply(this,arguments)}}function queue(worker,concurrency){if(concurrency==null){concurrency=1}else if(concurrency===0){throw new Error("Concurrency must not be zero")}var workers=0;var q={_tasks:[],concurrency:concurrency,saturated:_noop,unsaturated:_noop,buffer:concurrency/4,empty:_noop,drain:_noop,error:_noop,started:false,paused:false,push:function push(data,callback){_insert(data,false,callback)},kill:function kill(){workers=0;q.drain=_noop;q.started=false;q._tasks=[]},unshift:function unshift(data,callback){_insert(data,true,callback)},process:function process(){while(!q.paused&&workers<q.concurrency&&q._tasks.length){var task=q._tasks.shift();if(q._tasks.length===0){q.empty()}workers+=1;if(workers===q.concurrency){q.saturated()}worker(task.data,onlyOnce(_next(task)))}},length:function length(){return q._tasks.length},running:function running(){return workers},idle:function idle(){return q._tasks.length+workers===0},pause:function pause(){if(q.paused===true){return}q.paused=true},resume:function resume(){if(q.paused===false){return}q.paused=false;for(var w=1;w<=q.concurrency;w++){q.process()}}};function _insert(data,insertAtFront,callback){if(callback!=null&&typeof callback!=="function"){throw new Error("task callback must be a function")}q.started=true;if(data==null&&q.idle()){setTimeout(function(){return q.drain()},1);return}var item={data:data,callback:typeof callback==="function"?callback:_noop};if(insertAtFront){q._tasks.unshift(item)}else{q._tasks.push(item)}setTimeout(function(){return q.process()},1)}function _next(task){return function next(){workers-=1;task.callback.apply(task,arguments);if(arguments[0]!=null){q.error(arguments[0],task.data)}if(workers<=q.concurrency-q.buffer){q.unsaturated()}if(q.idle()){q.drain()}q.process()}}return q}},{}],245:[function(require,module,exports){"use strict";exports.__esModule=true;exports.encodeBinary=encodeBinary;var _keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function encodeBinary(input){var output="";var inx=0;while(inx<input.length){var bytebuffer=[0,0,0];var encodedCharIndexes=[0,0,0,0];for(var jnx=0;jnx<bytebuffer.length;++jnx){if(inx<input.length){bytebuffer[jnx]=input.charCodeAt(inx++)&255}else{bytebuffer[jnx]=0}}encodedCharIndexes[0]=bytebuffer[0]>>2;encodedCharIndexes[1]=(bytebuffer[0]&3)<<4|bytebuffer[1]>>4;encodedCharIndexes[2]=(bytebuffer[1]&15)<<2|bytebuffer[2]>>6;encodedCharIndexes[3]=bytebuffer[2]&63;var paddingBytes=inx-(input.length-1);switch(paddingBytes){case 2:encodedCharIndexes[3]=64;encodedCharIndexes[2]=64;break;case 1:encodedCharIndexes[3]=64;break;default:break}for(var _jnx=0;_jnx<encodedCharIndexes.length;++_jnx){output+=_keyStr.charAt(encodedCharIndexes[_jnx])}}return output}if(typeof module!=="undefined"){module.exports.default=encodeBinary}},{}],246:[function(require,module,exports){"use strict";var Loader=require("./Loader").Loader;var Resource=require("./Resource").Resource;var async=require("./async");var b64=require("./b64");Loader.Resource=Resource;Loader.async=async;Loader.encodeBinary=b64;Loader.base64=b64;module.exports=Loader;module.exports.Loader=Loader;module.exports.default=Loader},{"./Loader":242,"./Resource":243,"./async":244,"./b64":245}],247:[function(require,module,exports){"use strict";exports.__esModule=true;exports.blobMiddlewareFactory=blobMiddlewareFactory;var _Resource=require("../../Resource");var _b=require("../../b64");var Url=window.URL||window.webkitURL;function blobMiddlewareFactory(){return function blobMiddleware(resource,next){if(!resource.data){next();return}if(resource.xhr&&resource.xhrType===_Resource.Resource.XHR_RESPONSE_TYPE.BLOB){if(!window.Blob||typeof resource.data==="string"){var type=resource.xhr.getResponseHeader("content-type");if(type&&type.indexOf("image")===0){resource.data=new Image;resource.data.src="data:"+type+";base64,"+(0,_b.encodeBinary)(resource.xhr.responseText);resource.type=_Resource.Resource.TYPE.IMAGE;resource.data.onload=function(){resource.data.onload=null;next()};return}}else if(resource.data.type.indexOf("image")===0){var src=Url.createObjectURL(resource.data);resource.blob=resource.data;resource.data=new Image;resource.data.src=src;resource.type=_Resource.Resource.TYPE.IMAGE;resource.data.onload=function(){Url.revokeObjectURL(src);resource.data.onload=null;next()};return}}next()}}},{"../../Resource":243,"../../b64":245}],248:[function(require,module,exports){"use strict";var punycode=require("punycode");var util=require("./util");exports.parse=urlParse;exports.resolve=urlResolve;exports.resolveObject=urlResolveObject;exports.format=urlFormat;exports.Url=Url;function Url(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims=["<",">",'"',"`"," ","\r","\n","\t"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:true,"javascript:":true},hostlessProtocol={javascript:true,"javascript:":true},slashedProtocol={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true},querystring=require("querystring");function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&util.isObject(url)&&url instanceof Url)return url;var u=new Url;u.parse(url,parseQueryString,slashesDenoteHost);return u}Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!util.isString(url)){throw new TypeError("Parameter 'url' must be a string, not "+typeof url)}var queryIndex=url.indexOf("?"),splitter=queryIndex!==-1&&queryIndex<url.indexOf("#")?"?":"#",uSplit=url.split(splitter),slashRegex=/\\/g;uSplit[0]=uSplit[0].replace(slashRegex,"/");url=uSplit.join(splitter);var rest=url;rest=rest.trim();if(!slashesDenoteHost&&url.split("#").length===1){var simplePath=simplePathPattern.exec(rest);if(simplePath){this.path=rest;this.href=rest;this.pathname=simplePath[1];if(simplePath[2]){this.search=simplePath[2];if(parseQueryString){this.query=querystring.parse(this.search.substr(1))}else{this.query=this.search.substr(1)}}else if(parseQueryString){this.search="";this.query={}}return this}}var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];var lowerProto=proto.toLowerCase();this.protocol=lowerProto;rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes=rest.substr(0,2)==="//";if(slashes&&!(proto&&hostlessProtocol[proto])){rest=rest.substr(2);this.slashes=true}}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){var hostEnd=-1;for(var i=0;i<hostEndingChars.length;i++){var hec=rest.indexOf(hostEndingChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd))hostEnd=hec}var auth,atSign;if(hostEnd===-1){atSign=rest.lastIndexOf("@")}else{atSign=rest.lastIndexOf("@",hostEnd)}if(atSign!==-1){auth=rest.slice(0,atSign);rest=rest.slice(atSign+1);this.auth=decodeURIComponent(auth)}hostEnd=-1;for(var i=0;i<nonHostChars.length;i++){var hec=rest.indexOf(nonHostChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd))hostEnd=hec}if(hostEnd===-1)hostEnd=rest.length;this.host=rest.slice(0,hostEnd);rest=rest.slice(hostEnd);this.parseHost();this.hostname=this.hostname||"";var ipv6Hostname=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!ipv6Hostname){var hostparts=this.hostname.split(/\./);for(var i=0,l=hostparts.length;i<l;i++){var part=hostparts[i];if(!part)continue;if(!part.match(hostnamePartPattern)){var newpart="";for(var j=0,k=part.length;j<k;j++){if(part.charCodeAt(j)>127){newpart+="x"}else{newpart+=part[j]}}if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i);var notHost=hostparts.slice(i+1);var bit=part.match(hostnamePartStart);if(bit){validParts.push(bit[1]);notHost.unshift(bit[2])}if(notHost.length){rest="/"+notHost.join(".")+rest}this.hostname=validParts.join(".");break}}}}if(this.hostname.length>hostnameMaxLen){this.hostname=""}else{this.hostname=this.hostname.toLowerCase()}if(!ipv6Hostname){this.hostname=punycode.toASCII(this.hostname)}var p=this.port?":"+this.port:"";var h=this.hostname||"";this.host=h+p;this.href+=this.host;if(ipv6Hostname){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(rest[0]!=="/"){rest="/"+rest}}}if(!unsafeProtocol[lowerProto]){for(var i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];if(rest.indexOf(ae)===-1)continue;var esc=encodeURIComponent(ae);if(esc===ae){esc=escape(ae)}rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");if(hash!==-1){this.hash=rest.substr(hash);rest=rest.slice(0,hash)}var qm=rest.indexOf("?");if(qm!==-1){this.search=rest.substr(qm);this.query=rest.substr(qm+1);if(parseQueryString){this.query=querystring.parse(this.query)}rest=rest.slice(0,qm)}else if(parseQueryString){this.search="";this.query={}}if(rest)this.pathname=rest;if(slashedProtocol[lowerProto]&&this.hostname&&!this.pathname){this.pathname="/"}if(this.pathname||this.search){var p=this.pathname||"";var s=this.search||"";this.path=p+s}this.href=this.format();return this};function urlFormat(obj){if(util.isString(obj))obj=urlParse(obj);if(!(obj instanceof Url))return Url.prototype.format.call(obj);return obj.format()}Url.prototype.format=function(){var auth=this.auth||"";if(auth){auth=encodeURIComponent(auth);auth=auth.replace(/%3A/i,":");auth+="@"}var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=false,query="";if(this.host){host=auth+this.host}else if(this.hostname){host=auth+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]");if(this.port){host+=":"+this.port}}if(this.query&&util.isObject(this.query)&&Object.keys(this.query).length){query=querystring.stringify(this.query)}var search=this.search||query&&"?"+query||"";if(protocol&&protocol.substr(-1)!==":")protocol+=":";if(this.slashes||(!protocol||slashedProtocol[protocol])&&host!==false){host="//"+(host||"");if(pathname&&pathname.charAt(0)!=="/")pathname="/"+pathname}else if(!host){host=""}if(hash&&hash.charAt(0)!=="#")hash="#"+hash;if(search&&search.charAt(0)!=="?")search="?"+search;pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)});search=search.replace("#","%23");return protocol+host+pathname+search+hash};function urlResolve(source,relative){return urlParse(source,false,true).resolve(relative)}Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,false,true)).format()};function urlResolveObject(source,relative){if(!source)return relative;return urlParse(source,false,true).resolveObject(relative)}Url.prototype.resolveObject=function(relative){if(util.isString(relative)){var rel=new Url;rel.parse(relative,false,true);relative=rel}var result=new Url;var tkeys=Object.keys(this);for(var tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}result.hash=relative.hash;if(relative.href===""){result.href=result.format();return result}if(relative.slashes&&!relative.protocol){var rkeys=Object.keys(relative);for(var rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];if(rkey!=="protocol")result[rkey]=relative[rkey]}if(slashedProtocol[result.protocol]&&result.hostname&&!result.pathname){result.path=result.pathname="/"}result.href=result.format();return result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){var keys=Object.keys(relative);for(var v=0;v<keys.length;v++){var k=keys[v];result[k]=relative[k]}result.href=result.format();return result}result.protocol=relative.protocol;if(!relative.host&&!hostlessProtocol[relative.protocol]){var relPath=(relative.pathname||"").split("/");while(relPath.length&&!(relative.host=relPath.shift()));if(!relative.host)relative.host="";if(!relative.hostname)relative.hostname="";if(relPath[0]!=="")relPath.unshift("");if(relPath.length<2)relPath.unshift("");result.pathname=relPath.join("/")}else{result.pathname=relative.pathname}result.search=relative.search;result.query=relative.query;result.host=relative.host||"";result.auth=relative.auth;result.hostname=relative.hostname||relative.host;result.port=relative.port;if(result.pathname||result.search){var p=result.pathname||"";var s=result.search||"";result.path=p+s}result.slashes=result.slashes||relative.slashes;result.href=result.format();return result}var isSourceAbs=result.pathname&&result.pathname.charAt(0)==="/",isRelAbs=relative.host||relative.pathname&&relative.pathname.charAt(0)==="/",mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],relPath=relative.pathname&&relative.pathname.split("/")||[],psychotic=result.protocol&&!slashedProtocol[result.protocol];if(psychotic){result.hostname="";result.port=null;if(result.host){if(srcPath[0]==="")srcPath[0]=result.host;else srcPath.unshift(result.host)}result.host="";if(relative.protocol){relative.hostname=null;relative.port=null;if(relative.host){if(relPath[0]==="")relPath[0]=relative.host;else relPath.unshift(relative.host)}relative.host=null}mustEndAbs=mustEndAbs&&(relPath[0]===""||srcPath[0]==="")}if(isRelAbs){result.host=relative.host||relative.host===""?relative.host:result.host;result.hostname=relative.hostname||relative.hostname===""?relative.hostname:result.hostname;result.search=relative.search;result.query=relative.query;srcPath=relPath}else if(relPath.length){if(!srcPath)srcPath=[];srcPath.pop();srcPath=srcPath.concat(relPath);result.search=relative.search;result.query=relative.query}else if(!util.isNullOrUndefined(relative.search)){if(psychotic){result.hostname=result.host=srcPath.shift();var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):false;if(authInHost){result.auth=authInHost.shift();result.host=result.hostname=authInHost.shift()}}result.search=relative.search;result.query=relative.query;if(!util.isNull(result.pathname)||!util.isNull(result.search)){result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")}result.href=result.format();return result}if(!srcPath.length){result.pathname=null;if(result.search){result.path="/"+result.search}else{result.path=null}result.href=result.format();return result}var last=srcPath.slice(-1)[0];var hasTrailingSlash=(result.host||relative.host||srcPath.length>1)&&(last==="."||last==="..")||last==="";var up=0;for(var i=srcPath.length;i>=0;i--){last=srcPath[i];if(last==="."){srcPath.splice(i,1)}else if(last===".."){srcPath.splice(i,1);up++}else if(up){srcPath.splice(i,1);up--}}if(!mustEndAbs&&!removeAllDots){for(;up--;up){srcPath.unshift("..")}}if(mustEndAbs&&srcPath[0]!==""&&(!srcPath[0]||srcPath[0].charAt(0)!=="/")){srcPath.unshift("")}if(hasTrailingSlash&&srcPath.join("/").substr(-1)!=="/"){srcPath.push("")}var isAbsolute=srcPath[0]===""||srcPath[0]&&srcPath[0].charAt(0)==="/";if(psychotic){result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"";var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):false;if(authInHost){result.auth=authInHost.shift();result.host=result.hostname=authInHost.shift()}}mustEndAbs=mustEndAbs||result.host&&srcPath.length;if(mustEndAbs&&!isAbsolute){srcPath.unshift("")}if(!srcPath.length){result.pathname=null;result.path=null}else{result.pathname=srcPath.join("/")}if(!util.isNull(result.pathname)||!util.isNull(result.search)){result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")}result.auth=relative.auth||result.auth;result.slashes=result.slashes||relative.slashes;result.href=result.format();return result};Url.prototype.parseHost=function(){var host=this.host;var port=portPattern.exec(host);if(port){port=port[0];if(port!==":"){this.port=port.substr(1)}host=host.substr(0,host.length-port.length)}if(host)this.hostname=host}},{"./util":249,punycode:237,querystring:240}],249:[function(require,module,exports){"use strict";module.exports={isString:function(arg){return typeof arg==="string"},isObject:function(arg){return typeof arg==="object"&&arg!==null},isNull:function(arg){return arg===null},isNullOrUndefined:function(arg){return arg==null}}},{}]},{},[1]);
